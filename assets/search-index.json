{"version":1,"generatedAt":"2026-01-17","count":132,"docs":[{"path":"螺线翻译tml教程/0-开始/0-Home 主页.md","filename":"0-Home 主页.md","title":"0-Home 主页","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Looking for install instructions? (Steam and non steam) Welcome to the tModLoader wiki! This place serves as a center for guides related to tModLoader. These guides help to teach basic concepts regarding tModLoader modding and should prove as a useful resource to modders. Please feel free to contribute guides for topics not yet covered, but please refrain from editing well established guides without consulting the developers first. The documents classes and members of Terraria and the tModLoader API. It can be consulted to learn about specific methods and fields, but modders should start with the learning resources on this wiki and in ExampleMod. The documentation has separate pages corresponding to the various available versions of tModLoader. You can navigate through the pages through the links in one of the sidebars on the right. If you have suggestions, tips, or have found things such as spelling errors or grammar mistakes, please notify us in , or to suggest a change. A list of useful resources can be found . Below is a structured list of wiki pages that you can use to learn more about the API. If you wish to contribute, please view our beforehand. Informative pages These pages tend to describe certain files or folders. (Learn about how tModLoader is built) (How to publish and update your mod) (Among other things: how to license your mod, about tML's license) Getting started Learn tModLoader if you want to play mods Learn how to work with tModLoader to create mods Learn how to contribute to tModLoader Learn the basics of using tML Find fixes to common usage issues and bugs Start here if you want to make a mod. Learn how to setup a modded server Development These pages aim to aid you to learn how to develop mods properly, how to setup your developing environment, etc. Recommended, but Windows only. Lightweight, cross platform, lacks a few features. Cross platform. Learn how Visual Studio and other IDEs help modders make mods more easily. Debugging is how we find and fix errors and bugs. Contains info on code updates required for updating (aka porting) mods to each new tModLoader release. Easy guides These guides are easy and should be used if you are new to the tModLoader API. Their goal is to get you familiar with tModLoader and help you learn how to make various types of content. Intermediate guides The following guides are more advanced than the easy ones, but not advanced or expert level. : RecipeGroups, Custom Conditions, Shimmer, Ordering, Editing Accessing and Loading textures and shaders Advanced guides The following guides are considered advanced, and should only be attempted if the intermediate level is mastered. Accessing and modifying and members of tModLoader and other mods. Expert guides Expert level guides are not necessarily harder than advanced guides, but they more often cover a particular (difficult) subject. Expert guides should be followed if you are interested in learning about complicated topics or improving your mod's quality. Call, weakReferences, modReferences, recipes Patching the game using MonoMod Armor dyes and screen shaders Information about configuring and implementing new code fixes for tModLoader's custom code analyzer. Vanilla References Guides / Value References / Changes ItemID, ProjectileID, TileID, NPCID, TileID, WallID, BuffID, SoundID, etc. IDs / Names Class Documentation Other pages These are pages that we have so far failed to categorize or simply do not belong in one."},{"path":"螺线翻译tml教程/0-开始/1-tModLoader-guide-for-players tModLoader玩家指引.md","filename":"1-tModLoader-guide-for-players tModLoader玩家指引.md","title":"1-tModLoader-guide-for-players tModLoader玩家指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Steam Installation To install on Steam, you need to own on Steam. Simply browse for on Steam and install it. The tModLoader installation will exist alongside the vanilla installation, allowing you to play both vanilla and modded without the hassle of reinstalling vanilla. Note that users using Family Share to install Terraria will need to follow the instructions below. By default, the current stable version of tModLoader will be installed by Steam. Currently the stable version is based on Terraria v1.4.4 content. Beta Branches tModLoader updates regularly. Most users will want to use the default release, but users can use the beta branches feature of Steam to switch to a legacy or preview version of tModLoader. Legacy versions of tModLoader are useful for playing a mod that hasn't been updated to the latest stable tModLoader. Preview versions of tModLoader are useful to test new features or to test new content added in a Terraria update that hasn't made it to stable yet. Note: If you are switching tModLoader versions to use a particular mod, be aware that other mods you enjoy might not be on the version you switch to, so you might not be able to use all the mods you want together. This is particularly true for preview versions of tModLoader. Here are the available options: This is the stable version that we expect players to use. It is currently based on Terraria 1.4.4.9 content. Users in the middle of a 1.4.3 playthrough should switch back to to . This is the latest 1.3 release. There are a few fondly remembered mods only available on 1.3 tModLoader. This is the latest 1.4.3 release. This is where many users currently playing the game should be, especially those waiting for mods to update to 1.4.4. This version contains upcoming changes. This is where we test new features. Users should be aware that playing through the game on a preview version is not recommended. To access 1.3 (Legacy tModLoader) and other Beta options Follow the instructions below to switch to a different version of tModLoader in Steam. If you are a GOG user or otherwise need to manually install a specific version, use the instructions instead. Video Instructions: If these video instructions are unclear, read the Written Instructions below. https://github.com/tModLoader/tModLoader/assets/4522492/4ac8e231 c409 48e9 a3e0 9024b78f2af1 Written Instructions: Go to Library: Find tModLoader: Right Click tModLoader: Click Properties to Open the Steam Game Control Panel Select Betas In the dropdown, select whichever beta you want Close the Prompt (no code required) How to uninstall? Simply right click tModLoader Manage Uninstall. Your vanilla install will be unharmed. Steam Family Share Installation For some reason, if you don't own Terraria and are instead using a family shared Terraria, tModLoader won't launch and will take you to the Steam store. This is a limitation on Steam's end, however workarounds exist for both 1.4.X and 1.3 versions Please note that these workarounds do not allow for Steam Multiplayer and thus you will need to use options for multiplayer On the 1.4.X version, the workaround is to install tModLoader following the Manual Installation instructions and launch it using the included in the files. Alternatively, if you are able to get Steam to download the files in the Steam Client, that also works in theory, but has seen varying success among users. You may also choose to setup this launch as a in your library to enable steam overlay in game. On the 1.3 version, a workaround is to install tModLoader through steam as normal and then copy the file from the Terraria install folder to the tModLoader install folder, replacing the existing file. Manual Installation This installation is necessary for players who have purchased Terraria from GOG or who otherwise want to install a particular version of tModLoader. These steps should be repeated each time you want to update tModLoader. Installing tModLoader is relatively easy. 1. Goto the page and download the tModLoader release you want. 1. : Visit and download 2. : Visit and download the file corresponding to your operating system 3. : Visit the and find the latest entry that mentions 1.4.3. Expand the section labeled \"Assets\" and click to download the \"tModLoader.zip\" file. 4. : The download for the preview version of tModLoader for can be found by visiting the . Find the most recent entry that has \"preview\" in the name. Expand the section labeled \"Assets\" and click to download the \"tModLoader.zip\" file. You'll need to regularly manually install new versions of 1.4.4 preview if you want to keep up to date with changes. 2. Unzip the contents of the zip you downloaded to a folder named either next to or nested inside the Terraria install folder. On 1.4, if the folder contains a 'Build' folder, you will need to remove this intermediate folder and bring the contents up one level. (GOG usually installs to , and Steam to . See to find the steam installation location if you customized it.) (If you are on Linux and own the game on GOG, the nested option inside is preferred) If you don't know how to unzip a zip file, get someone who knows how to use a computer to help you. Option 1, side by side (Recommended) : Option 2, nested : DO NOT install the tModLoader files directly into the Terraria folder. This option not supported for GOG on Mac. 3. [This step applies to 1.3 ONLY] Remove or Add the Steam files depending on which version of the game you own: 1. If you are using the GOG version of Terraria, delete the Steam file from the folder you just extracted tModLoader into (these files might already be deleted from the zip you downloaded): Windows: Linux: and Mac: 2. If you are using the Steam version of Terraria, if the Steam files are missing from the zip, copy them from your Terraria install to the tModLoader install: Copy the , then, depending on your platform: Windows: and Linux: , , , and Mac: and 5. [1.4 ONLY] GoG users will need to install Steam if they haven't already. Our Mod Browser uses some of the Steam install files to facilitate accessing the Steam Workshop. You should NOT need an account/be logged in for this to work. 1. Special Note for Linux: If your steam installation is not recognized (Error \"unable to access steam workshop\"), try uninstalling it and reinstalling Steam from the APT repositories via the terminal 2. If for some reason installing Steam is impossible on your system, tModLoader will still work but downloading mods in game will not. Mods will have to be manually installed. 6. [Linux/Mac only] Make , , and executable. You can do this in the file properties or by running the command in a terminal while in the destination install directory (do the same for the other 2 filenames). 7. Done. You can now make a desktop shortcut for tModLoader and launch tModLoader from that. (The file launches the game, that is what you could make a shortcut to.) Tip: Here is an easy way to find where your Terraria files are located: ( ) 1. Locate Terraria in your Steam game library, right click it and click 'Properties' 2. Browse to the 'Local Files' tab and click on the 'Browse local files...' button 3. You are now in your Terraria folder (this is where you should install tModLoader) Manual Installation Common Issues Windows 1.3 only: If the game doesn't launch at all, you might not have .NET 4.5 or XNA 4.0 installed. Download and run both installers: 1. 2. Linux/Mac: When launching from Steam, Steam shows the game launching and then the button goes right back to \"Play\": This is most likely caused by not making the files executable. Revisit step 6 of the above. How to uninstall? 1. Open Steam, go to your game library section and locate Terraria. 2. Let Steam for Terraria, this will reconfigure your game files to run vanilla. 4. Done. You can launch Terraria as usual. If you use GOG, simply delete the tModLoader folder you made before. Your worlds and players will be saved. Downgrade tModLoader 1.4 tModLoader updates every month. Sometimes a mod you are using fails to update in a timely manner and will cease to work with the latest tModLoader 1.4 release. Other times a rare bug affecting your setup might manifest that was not caught. You can manually downgrade if this is the case. To manually downgrade, find the latest release for the version you used to use on page and download it. It is a file. To easily find the latest release from the previous update, type \"stable\" into the search bar and press enter. This will filter out all the \"preview\" releases. Scroll down to find the release you need. For example, if you launch tModLoader and it recently updated to and it stopped working with an important mod, you can find the latest stable release and download it. After downloading, open up the tModLoader install directory and delete all the files. Make sure you are in the install folder and not the saves folder. To find the install directory, right click on tModLoader, click , then . This shows that process. After deleting the original files, you can take the files from the .zip you downloaded and put them in the install folder. This shows this process. Linux and Mac users will additionally need to make the files executable, see step 6 of the above. Once you know the outdated mod updated, you can delete all files in the install directory and use steam to verify game integrity to upgrade back to the current tModLoader release. To use 1.3, simply select in the tModLoader betas menu: Dual Install Have 1.3 and 1.4 tModLoader installed at the same time You can keep 1.3 and 1.4 tModLoader installed at the same time if you utilize Steams ability to add non Steam games. To do this, first switch to and make sure the download finished. Open the install folder and copy all the files. Go up one level and make a tModLoader13 folder. Go into the tModLoader13 folder and paste the files. In Steam, switch back to the default beta branch on tModLoader. Next, click on the menu and click . Click and navigate to the tModLoader13 folder, most likely this will be \"C: Program Files (x86) Steam steamapps common tModLoader13\". Click on \"tModLoader.exe\", click \"Open\", then click \"Add Selected Programs\". Finally, right click on the 2nd tModLoader entry in your library and click properties, then change \"tModLoader\" to \"tModLoader 1.3\" and close the window. Now you have the legacy tModLoader and the auto updating 1.4 tModLoader both in your library. Migrate Everything From 1.3 to 1.4 For the most part, the transition from 1.3 to 1.4 should be a clean start. The 2 are practically different games, and available mods won't match up. If you want to, however, you can migrate existing mods, worlds, and players. Mods Be aware the most of the mods you used on 1.3 might not be on 1.4. You can manually search for mods in the \"Download Mods\" menu, or you can use a modpack file to attempt to download all of them in one go. First, open up the 1.3 saves folder and find the enabled.json file in the Mods folder, this might be in . Open up 1.4 tModLoader, click , , and then click . Paste the enabled.json file that you copied earlier into this folder. Click and then to refresh the menu. You should see an entry for \"enabled\". Click then click . You'll most likely get a message that not all mods were found on the mod browser. If you do, simply click the download button on each mod in the listing. Players Use the in game menu to migrate players. Cloud players will not show up so you will have to switch to and take them off the cloud if you wish to copy them over. Worlds Use the in game menu to migrate worlds. Cloud worlds will not show up so you will have to switch to and take them off the cloud if you wish to copy them over. My worlds and characters disappeared when I installed! tModLoader DOES NOT use your vanilla world and player files. The in game should give you the option to copy over your original vanilla files. This option won't work for players and worlds you have used in Terraria 1.4. You do not have to worry about your vanilla saves being modified; they will be copied for modded gameplay use. When you go back to vanilla, you will see your original saves. tModLoader uses separate folders to store player (.plr) and world (.wld) files, mainly because it will store additional data for them. Your vanilla players and worlds will be stored in: (for Windows) in the Players and Worlds folders respectively. If the automatic copy doesn't work, copy the \"World\" and \"Player\" folders from to . How do I download and play mods? tModLoader comes with a mod browser. Refer to the to learn how to download and play mods. I have too little memory to run multiple mods! Terraria and 1.3 tModLoader are 32 bit applications. In short, this means they are only capable of utilizing up to 4 GiB of RAM. With a lot of mods, you may run out of memory. The solution is using less mods, unfortunately. Alternatively, you can try using the unofficial 64 bit version of 1.3 tModLoader. 1.4 tModLoader is 64 bit by default, which alleviates this problem. I use macOS Catalina. What do I do? If you experience any problems, try using the 64 bit version of tModLoader or talk to us on Discord. How Do I Use Mod Packs in 1.4? 1.4 tModLoader significantly overhauls the Mod Pack feature to provide several additional functionalities. To start with, save your Enabled Mods as usual. The UI will now show a lot of buttons. Let's walkthrough them. First and foremost, I will use two different terms moving forward: A mod pack will refer to a frozen copy of mods that don't update with time. A mod collection will refer to a list of mods that are always the latest. The first 2 buttons operate on the 'Mod Collection' style. Enable Only this List disables all mods, and than loads only those defined in the collection Enable this List loads mods defined in the collection on top of any existing loaded mods. Useful for stacking collections View List & View Mods in Mod Browser allow you to see what the mods in the pack/collection are, and download them freshly on the mod browser for yourself. Update List with Enabled Updates the mod pack or collection with the currently enabled set of mods. Will delete or add to the collection/pack as required Import Pack (Local) Tells tModLoader to check the mod pack for the frozen set of mods to load. Any mods loaded from the Pack, while active, will override any existing mods you have downloaded. When a Mod Pack is active, it will shows as such in the Top Right Corner. Remove Pack (Local) Undoes the changes made by Import Pack (Local) Export Pack Instance Exports a copy of the ModConfigs and /Mods folder to InstallDirectory/ so that you can either setup a second instance of tModLoader with an older version OR quickly setup a server with the pack. Check InstallDirectory/ /SaveData/Mods for an install.txt file listing all the workshop publish ids and a tmlversion.txt labelling the tml version to use. Delete Instance Deletes the exported instance files created by Export Pack Instance"},{"path":"螺线翻译tml教程/0-开始/10-Developing-on-Mac-or-Linux 在Mac或Linux上开发模组.md","filename":"10-Developing-on-Mac-or-Linux 在Mac或Linux上开发模组.md","title":"10-Developing-on-Mac-or-Linux 在Mac或Linux上开发模组","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Warning: This guide was written long ago and is no longer relevant to current tModLoader. Please do NOT follow this guide. We recommend or for developing mods on Mac and Linux. Mac and Linux no longer require any OS specific instructions. These instructions do not apply yet For now, the only instructions are here: Everything below this possible relates to tModLoader v0.11, but the instructions do not work yet. Note: Work in Progress, instructions are not completely working or tested yet. Currently there is no implementation to decompile Terraria on Linux/Mac. This means that you need to run the tool to decompile Terraria under Windows. This will hopefully soon be implemented on Linux and Mac as well. Developing on Mac or Linux tModLoader requires the Microsoft C Compiler ( ) to be installed. On Windows, it's bundled with the .NET installation itself. On Mac and Linux however, it requires a separate package which might not be pre installed on your system. You can check if it is present by opening a terminal and executing the command , you should see something like this: Or you can simply try compiling and look for errors. Instructions on how to install the required packages are in the following section. Building mods inside of tModLoader tModLoader has the ability to build mods that have no external dependencies/references within Terraria itself. If you are new to modding or have no idea what external dependencies are, this is most likely what you want. If you want to use external dependencies which allow for more \"fancy\" features and you know what you are doing you can look into Installing mono Having the Mono framework installed allows you to build mods directly within tModLoader under the menu option. Linux On most Linux distributions the package is called or simply . If you are having trouble installing the package you can go to the page on the mono projects website for further assistance. Mac Visit the Mono website and follow the for Mac. Apparently this install doesn't add the appropriate tools to the Path, so you may need to follow these instructions if you still can't build in game. Please update this page with any relevant information if you have any. Edit: Some further instructions can be found in the answers section of this Untested. Building outside of tModLoader If you would like to have a more flexible and generally better development environment, you should probably look into building mods outside of tModLoader. This implies using an IDE such as Visual Studio Code (The regular Visual Studio is not supported on Linux, although it is on Mac). MonoDevelop/Xamarin (on which Visual Studio for Mac is based on) is the easiest method to get started. The following instructions can be followed for getting a simple environment going: Working Visual Studio for Mac instructions Using the skeleton generator in game, the following changes can be made to the generated .csproj to make it work on Visual Studio for Mac. These results are the results of one modders attempts at getting it working. We'll try to make the workflow better in further updates. In the meantime, here is the edited csproj: Tweaks to MonoDevelop Compilation on Debian (2020 05 31, Debian 10/4.19.118, MonoDevelop 7.8.4, Mono 6.8.0.123, Steam tModLoader v0.11.7.4) tModLoader looked to want when building a mod. Mostly following instructions in link above, using the supplied blank Linux csproj, with the following notable exceptions. Prior to opening project: When installing MonoDevelop, added repository to apt cache, updated all mono packages, then installed. Grabbed ModCompile zips from https://github.com/tModLoader/tModLoader/releases/tag/v0.11.4 and combined them both in a new ModCompile folder in the Terraria installation folder. Created symbolic links to tModLoader and Terraria installation near project for pathing ease. Changed to in project file. In MonoDevelop, after opening project: Removed all referenced assemblies, added back and from tModLoader folder. Will likely need to add others as required by code and when someone can test the Windows half of the build, so wrote down the ones removed. Under project options / Configurations, renamed to . Under project options / Configurations, renamed to . Under project options / Compiler, changed Debug information from to in both configurations. Under project options / Custom Commands, added After Build step to both configurations. Was then able to compile both configurations, run successfully, and the simple mod (1 tile, 1 item) worked in game. Need to test in Windows. mymod.csproj Known issues Mac The type initializer for 'System.Drawing.GDIPlus' threw an exception On Mac after you've followed this guide you might find that you encounter this error when trying to build a mod that contains png files. To fix this download and extract the contents to where you installed tModLoader (usually it will be ), overwriting/merging any folders/files if asked."},{"path":"螺线翻译tml教程/0-开始/11-Useful-Resources 实用资源.md","filename":"11-Useful-Resources 实用资源.md","title":"11-Useful-Resources 实用资源","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following covers a list of useful resources, adapted from the . Feel free to add a new resource if you think it is useful to others, but please refrain from adding unuseful items. Sites tModloader Github wiki You are here This is an old wikipedia, used with tConfig This is an old documentation site, used with tAPI (WARNING: SSL SECURITY ISSUE) You can chat with developers and fellow modders on our Discord server. This is the best place for feedback, issues, collaboration, help, and interacting with the tModLoader community. and , which have occasional announcements, update posts, and mod showcases. Utilities/Other Extract images and sounds from Terraria. Useful for viewing various sprites. Add padding to multi block tile textures with this tool Ready to use sprites for Terraria tiles. Similar to TPadder but with more customization options Quickly create armor animation sprites with this tool (body/chestplate/shirt is broken since Tmod1.4 changed how the sprite sheet of it works) Quickly makes tile textures for ores. Allows for quick evaluation and debugging for armor, items, etc. against character models and other stuff. Unfortunately, much of this guide is broken due to broken links. This can be used to visualize and verify / saves External mod wikis Some popular mods have their own wikis. Use the links below to find information about them. Note: not all wikis are listed here, but a few popular ones. hosted on the Terraria mods wiki. Uncategorized Guides Note: tutorial [x] are likely outdated, it is recommended you use contents on this wiki instead [Tutorial: [1] Getting started with tModLoader](https://forums.terraria.org/index.php?threads/.44817/) [Tutorial: [2] Recipes](https://forums.terraria.org/index.php?threads/.44822/) [Tutorial: [3] Items](https://forums.terraria.org/index.php?threads/.44842/) [Tutorial: [4] Projectiles](https://forums.terraria.org/index.php?threads/.44857/) Youtube Tutorials Note that following youtube tutorials isn't recommended, because they are often outdated. Youtube content creators covering modded content"},{"path":"螺线翻译tml教程/0-开始/2-tModLoader-guide-for-developers tModLoader开发者指引.md","filename":"2-tModLoader-guide-for-developers tModLoader开发者指引.md","title":"2-tModLoader-guide-for-developers tModLoader开发者指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Installation If you still need to install tModLoader refer to the . Developing with tModLoader Before you begin, you will need two things, the \".NET 8 SDK\" and a suitable IDE. Once you have these installed, you should start with the . IDE Choose your favorite IDE to mod with tModLoader. Refer to the on the homepage. For the best mod making experience, using Visual Studio is highly recommended. Currently 2022 v17.8 or higher is required. .NET SDK Install the by downloading the installer, running it, and following the instructions. Download the installer for the latest SDK release labeled \"x64\" corresponding to your operating system. Don't download from links in the column labeled \"Binaries\". Don't download the .NET 9.0, .NET 7.0, or .NET 6.0 versions, those will not work. Click to view visual instructions To verify that you have the \".NET 8 SDK\" properly installed, you can open a new command prompt and type and press enter. If you see a result with a version starting with the number 8, it is installed. The folders shown should show the folder not the folder. If you see the 86 folder, that means you installed the 32 bit SDK by accident. You can uninstall it and then install the correct version OR install the correct version and so that the 64 bit SDK shows up instead. If tModLoader still complains that it can't find the SDK, you may need to restart your computer for the changes to take effect. I am new to modding If you are new to modding, it is recommended to start with . You can then move on to the . The following links might be useful for you: 1. 1. 2. tModLoader wiki (useful information and guides) you are here right now. 3. (requires a free Discord account) 4. 5. A mod showcasing and teaching various tModLoader mod capabilities 6. I am returning to modding If you made tModLoader mods previously and either want to update your outdated mod or make a new mod, there is a high chance that the tModLoader API has changed. Please read the for the versions you missed after reading the . Feel free to ask questions in Discord if you have any questions."},{"path":"螺线翻译tml教程/0-开始/3-tModLoader-guide-for-contributors tModLoader贡献者指引.md","filename":"3-tModLoader-guide-for-contributors tModLoader贡献者指引.md","title":"3-tModLoader-guide-for-contributors tModLoader贡献者指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Installation If you still need to install tModLoader refer to the . IDE You will need an IDE (Integrated Development Environment) to help develop tModLoader. For Windows users, we recommend . A prevalent cross platform alternative would be Jetbrains' . Rider is free for non commercial use such as this project. Git If you've never used Git before, checkout our . If you ever come across something in this guide you don't recognize, just Google it. You should be easily able to find something relevant to your problem. You can also checkout . Further, if command line inherently scares you, additional tools such as and can provide most of the functionality you need in a user friendly interface. Code patcher tModLoader uses its own code patcher tool, which you will have to use if you want to contribute to tModLoader. We are required to use a patches system because we are not allowed to upload vanilla source code publicly. It also allows for relatively easy code maintenance. Getting the tModLoader code for the first time Note: The setup GUI (Graphical User Interface) is currently Windows only, use CLI (Command Line Interface) on other systems! 1. ; 2. Fork this repository, then clone your fork onto your PC. You HAVE to use Git for this, downloading source code as a zip file won't work; 3. GUI: Open in the root folder; CLI: Open a terminal in the root folder; 4. GUI: Click on 'Setup' (top left button); CLI: Run ; If asked, select your vanilla . If you want to work on the 1.4.3 or 1.3 version of tModLoader, you need and , or and . 5. When decompilation is complete, verify that you have these folders: (You will be primarily modifying files within this folder, through the patcher and file) 6. To open up the tModLoader workspace, navigate to and open with your IDE. Recommended contribution/development cycle Start: 1. Pull the branch. You HAVE to use Git for this, downloading source code as a zip file won't work; 2. Create a new Git branch for the feature you're developing (i.e. or ); 3. Run Setup ( ) or Regenerate Source ( ) in the development GUI/CLI; Develop: 1. Develop your contribution using and your IDE; Please follow the established when making changes. 2. ( ) the workspace you developed it for to turn your code into patches; Your workspace is 99% of the time. If it isn't, we imply you know what you're doing. 3. Create a new commit to commit the patches/ folder Before you push your commit, please check our . Thanks! 4. If the branch was modified by someone else pull the patches in Git and ( ) in setup to apply them to your code. 5. Repeat. Open the pull request: When you're done, PR your branch to , and not to , , or . If you're in need of early feedback you can and should open pull requests before they're done! They can be marked as drafts if needed. Testing your Code If you are testing bug fixes, simply debugging the configuration is all that is required. Adding examples to Example Mod As you add features to tModLoader, you'll want to add examples of using those features to Example Mod. The Example Mod examples should be straightforward and minimize unrelated effects. Examples should showcase at least the most common usage of the new feature, but a more advanced example can also be added if helpful. Comments should focus on what is unique about the added example. There is no need to comment code that the reader should already have a basic understanding of, such as and methods. The name of the example should hint at what can be learned from the example. There are rare cases where multiple classes in a single file is acceptable, but for the most part each class should be in it's own file with the same name. Sprites should be simple. You can reuse existing sprites directly (such as overriding ), make a sprite in the style of other Example Mod sprites, or even desaturate an existing Terraria sprite in an image editor and use that. Do not let are get in the way of making a pull request, there are plenty of contributors willing to help. You can always make a placeholder sprite for the pull request and we can help with that as the pull request is reviewed. Prior to v2025.01, the ExampleMod folder would need to have a symbolic link created in the ModSources folder to show up in the \"Develop Mods\" menu. This is no longer required and if you have this already it can be deleted if desired. You will, however, need to build ExampleMod at least once from before it will show up in game in the \"Develop Mods\" menu. To do this, click the startup item dropdown and select \"ExampleMod\", then debug or build the ExampleMod project as normal. Make sure it builds successfully as part of your testing before making a pull request. Before you're about to make a contribution, please check . Thanks in advance. Keeping your code up to date NOTE: it is wise that you backup your edits before pulling latest patches, if you have any that you haven't committed yet. Applying the latest patches will delete any of your work not included in them. Setup (do this if you're updating your code for the first time, it also requires that you have some kind of command line installed) 1. Open a Git Bash window or whatever in the tML folder 2. Enter 3. To ensure that it's been setup correctly, enter and you should see something like this: Actually pulling 1. Open up another shell window (if you want, enter to make sure everything's as it should be) 2. Enter 3. Then This will pull all the newest commits from branchtomerge into the branch that you have checked out You should verify that you now have the latest patches, located in patches/ 4. Open setup.bat in the root folder 5. Click on 'Regenerate Source' (bottom right corner) After this process you can open solutions/tModLoader.sln as usual with the updated code HELP! I accidentally committed on a wrong branch! Simply stash changes and checkout. 1. Open in git shell/bash or whatever 2. Run or (should default to save) 3. Run Replace xxxx by branch name Omit b if not creating a new branch 4. Run Acquiring a specific Terraria version TModLoader development no longer requires downloading specific Terraria versions, but if you need them for reference, then follow these steps: Download the utility. Head over to , pick and remember the depot (OS) you want, navigate to Manifests, select the branch in filters, and grab the manifest ID of the version you need. Run to download that version. Further online assistance If you would like to contact us or tModLoader users, it's best to join our . Discord is a chat and voice application."},{"path":"螺线翻译tml教程/0-开始/4-Why-Use-an-IDE 为什么使用IDE开发.md","filename":"4-Why-Use-an-IDE 为什么使用IDE开发.md","title":"4-Why-Use-an-IDE 为什么使用IDE开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Why Use an IDE This page will hopefully convince you to abandon making mods in Notepad. Be sure to click the links below to watch the videos. All info presented corresponds to , but other IDEs such as and have similar functionality. Syntax Error Checking When you make a syntax error, you'll see red underlines under the bad code, similar to a spell check. You can hover over the error to see an explanation. Seeing the explanation above, we can fix the code easily by changing to just . Simple Misspellings Visual Studio can fix simple misspellings as well. https://github.com/tModLoader/tModLoader/assets/4522492/5bab82f0 84dd 4b7d 8623 68c70275e8a4 Show Potential Fixes Sometimes Visual Studio can guess how to fix your error. For example, below we forget to add to our ModItem class. Clicking or pressing the hotkey shows the following options. Clicking the first option adds the appropriate using statement to our code. We can fix errors without trying to build in game. https://github.com/tModLoader/tModLoader/assets/4522492/9055c84c fe13 4cb9 bf54 6a201cc5db31 Autocomplete / Intellisense Field names A common problem with new modders is that they don't know all the Terraria variable names or method names. For example, the various biomes/zones have names that aren't always what you might expect. You'll still need a little experience to know which class to look for these variables, but Intellisense helps immensely. In the video below, we see Intellisense suggesting the available Zones and downed bosses. Notice how Plantera being defeated is . This is why Intellisense is so valuable to a self sufficient modder. https://github.com/tModLoader/tModLoader/assets/4522492/8565bfed b085 416c 841a b5c409b0339c ItemIDs, NPCIDs, ProjectilesIDs, etc... While you can waste your time looking up various vanilla IDs in our , it is much easier to just let Autocomplete do the work for us! Simply start typing your guess for the ID name and you will quickly see suggestions. You can select a suggestion to autocomplete it. How nice is that? Method names and parameters Method names are also suggested in the same way. In addition, you can see the method parameters, both their names and types. For example, I'd like to add a buff to an enemy when I hit him with my sword. Typing will bring up the parameters, helping me complete my call to the AddBuff method. https://github.com/tModLoader/tModLoader/assets/4522492/df0ed4f6 80b2 4158 b440 178b2fbfa340 Override An extremely common task when making mods is to override various hooks such as or . Remembering the parameters to these hooks is sometimes hard to do. By using Visual Studio, you can easily write \"override\" followed by a space, followed by a few letters of the method you want to override, and then enter to easily override hooks. As a bonus, any missing using references will automatically be added to your code. Before: After: https://github.com/tModLoader/tModLoader/assets/4522492/2715244e b526 46b2 bfc9 1cdd82d15c46 Cross Mod By using the extract mod feature, (and optionally a documentation file if it exists) will be placed in . This file can be added as a dll reference to your .csproj if your mod has a strong or weak reference to another mod (you'll still need the build.txt entries). This path is consistent and accessible from the Mod Sources folder, meaning that the reference added to .csproj is portable for all contributors for your mod, provided they extract the referenced mod on their computer. By doing this, you can enjoy auto complete for the API provided by the mods you reference as well. Read more on that . Build You can build the mod from your IDE. In VS, find the menu to build the mod. Note that this is usually less useful than just debugging, but it can have some uses. Also note that attempting to build the mod while it is loaded in an open client won't work. Debug With an IDE, such as VS, you can debug your mod. Debugging is the best way to pinpoint issues in your mod and solve them. While debugging, you can set 'breakpoints' which will make the application 'stop' and pause itself when it gets to that point. During this pause you can inspect what is happening, by for example looking at the values of variables in scope. You can quickly resume the application, or step over code to try to find the cause of a problem. To learn more about debugging, see its . Edit And Continue With Edit And Continue (or eac) you can edit code after you've hit a breakpoint and see the effect of your edits in game immediately, rather than having to rebuild your mod manually. This is extremely useful for positioning projectile spawns or tweaking item defaults. Be sure to read in order to use this feature. Note that things like , , or other code might only run when the mod is loading, so they cannot benefit from eac. Simple Example In this video, we see 2 Example Gun spawned. After the first is spawned, a breakpoint is set in SetDefaults. Once it is hit, the game is paused and Visual Studio comes to the front. Then, is changed from 40 to 80. We press continue and we can hover over the 2 items and see that the second item was spawned with 80 damage. https://github.com/tModLoader/tModLoader/assets/4522492/34bba15f 23d0 4484 bee2 b8f5e8de8533 Another Example In the guide, an example is shown using a breakpoint to test values for : Documentation tModLoader will automatically provide documentation XMLdoc files, you can see documentation for a method when you hover it. This is the same info contained in the , just more easily accessible. For example, when the menu is active, clicking on an entry will show the documentation for that method where the purpose and potential usages of that method can be viewed: Hovering over an existing overridden method will also show the documentation: Hover over a method parameter to see details on what the parameter does: Hover over fields or methods to see details: Note that the amount and distribution of documentation is driven by modder feedback. If you find something that needs documentation, feel free to suggest it in the Discord chat. Documenting your own Mod Documenting your own mod can be useful, once the mod becomes complex. Try to document things that are important, but don't feel pressured to document everything, this is all for your own benefit (unless you intend for other mods to use these methods, see the next section). Writing readable code is better than documenting nonsensical code, after all. For more information on writing documentation, see . The easiest way to document a method is to type the line above a method, Visual Studio will autocomplete the template and you can type notes. Mod Documentation Modders making mods with API to be used by other mods can include files in their mod and they will be automatically extracted alongside their file and placed in for easy collaboration (provided is not true, which would be counter productive for a mod expecting to be referenced by other mods.). XMLdoc files for mods can be generated in Visual Studio during a regular build and should be named [ModName].xml and placed in the root of the mod's source folder. To have Visual Studio generate documentation, add the following to the section in your file: To edit the file, either right click on the project in Visual Studio and click or open the file directly in a text editor. You'll want to document any public methods and fields that you expect modders to use. To do this, type on the line above the field or method. This will cause Visual Studio to generate the documentation stub, after that add any information you want to the section. You can look at the to see what useful documentation should look like. If you find the \"Missing XML comment for publicly visible type or member X\" warning annoying, feel free to add to your file or add to the section along with the other new lines to ignore this warning. Whenever you update the documentation, remember to build from Visual Studio at least once before release to update the documentation file. To use documentation from other mods, simply follow the steps in the . If a file shows up in the folder, it included documentation. Remember that we suggest leaving the referenced files in the folder rather than copying them to your mod's source code folder, but if you do move the file make sure to copy over the file as well. Now, hover over any documented member as you normally would and you should see documentation show up if the mod author has documented that member. Many mods maintain documentation on their homepage or GitHub wiki, be sure to check those locations out if an documentation file is not included in the mod. Find All References (Ctrl K, R) Find all references makes it easy to locate all usages of a variable in your whole project. Simply right click on a variable and click . This is very useful to see where you assign and use your variables. https://github.com/tModLoader/tModLoader/assets/4522492/e37f0e9a 2bf7 4704 8e90 a5bf0a26d1ce Go To Definition (F12, Ctrl Left Mouse Click) By clicking on a variable or classname, you can press F12 (or Ctrl Left Mouse Click) and Visual Studio will bring you right to where that class or variable is declared. If you do this on a class not in your code, such as the Terraria class or the XNA class , you will be led to a page with just the variables and methods, not the actual code. It is very useful to be able to read the Terraria code directly. Follow the \"Go To Decompiled Code\" section below to enable navigating directly into decompiled code, allowing you to view that code as well. https://github.com/tModLoader/tModLoader/assets/4522492/a19265ee 8f0c 4e33 a1c0 554c3b6bab75 Go To Decompiled Code By default, the command will not allow you to see the tModLoader/Terraria source code. We can enable this feature to make modding much more productive. In Visual Studio, use the search (Ctrl Q) to search for \"decompile source\". Click on \"Enable navigation to decompiled sources\" and then check the checkbox and click \"OK\": From now on, you should be able to use the command to view decompiled Terraria code. Try it now by typing and use the command on . After a delay as Visual Studio decompiles tModLoader, you should see the code of the method: Rename (F2) Imagine you name a variable or class something stupid and want to change it. Without an IDE, you would have to manually check each file the variable is used in and edit the text. Even something like \"Find and Replace\" would be error prone if you use similar names for other variables. Using the Rename function, you can easily rename classes and variables. Be aware that if you are using methods like rather than , this won't work. This is also a great reason to use the < type methods for ItemType and NPCType, it is much easier to maintain. In the video, we rename a variable called to something better, . https://github.com/tModLoader/tModLoader/assets/4522492/88a34158 cbfc 4eb6 8f19 81d1eaa9cc79 Parameter Info (Ctrl Shift Space) Some Terraria methods have many many parameters. It can be hard to remember the order and types of those parameters. If you'd like to see the parameters of something like Item.NewItem or Projectile.NewProjectile, simply place your cursor inside the method and press . You can navigate left and right and watch the bold parameter change. Press up and down to switch between overloads of the same method. https://github.com/tModLoader/tModLoader/assets/4522492/61c8ca1e fe95 40c7 93f2 d8460edeb97a https://github.com/tModLoader/tModLoader/assets/4522492/571f8868 7094 4815 ad23 d0250dce15b5 Goto (Ctrl ,) An extremely useful shortcut, Goto allows you to quickly navigate to and class, method, or field in your code. Simply type and the Go to All window will pop up. Type the name or part of the name and select the item to quickly navigate to the code. You can also type the first letter of each word in a name to find it. For example, typing will suggest . Visual Studio will smartly handle misspellings and partial matches as well. The video shows just how quick this feature can be and how easy it is to quickly navigate to other places in your code. https://github.com/tModLoader/tModLoader/assets/4522492/24e0cb32 6c07 4635 9e90 f692dfc54534 Quick Actions and Refactorings (Ctrl .) This context sensitive hotkey is useful in several situations. The suggestions depend on where the cursor is or what text is selected. Here are some useful actions: Introduce Local for All Occurrences If you are repeating yourself a lot in your code accessing the same object via fields and methods, sometimes your code can get a bit repetitive. Making a local variable and re using that variable makes the code much cleaner. If you highlight the first occurrence of repeated object access, you can use this action to quickly introduce a local variable that you can then give an appropriate name to. https://github.com/tModLoader/tModLoader/assets/4522492/7f8be194 6862 4056 b91d 70e611320cab Format Document (Ctrl E, D or Edit Advanced Format Document) Properly formatted code is key for readability. Make sure to run this command before asking for help with your code as nothing is more annoying that poorly formatted code. https://github.com/tModLoader/tModLoader/assets/4522492/03e49732 da87 454f 8ab8 5b71c578f752 Structure Guide Lines Sometimes, especially in Projectile and NPC AI, you might get lost within your code. This is especially true with nested if statements. Hover over the dotted lines to quickly see where you currently are in your code. For example, here I easily see at a glance where in the logic of my AI I currently am. Code Folding Folding code by pressing the or buttons can be useful if you need a wider perspective on your code. Goto Brace (Ctrl ]) Using this hotkey is useful when navigating vanilla code with large blocks of code within braces. https://github.com/tModLoader/tModLoader/assets/4522492/86ea2d85 b84a 4e11 b4f3 427b222b4dad Launch Profiles Launch profiles can be setup to streamline mod development and testing. For example, a profile can be setup to launch the game directly into the world, skipping the player and world select menus. Launching the debugger directly into the game saves time and clicks. Other uses of launch profiles include testing specific mod packs and maintaining a mod specific save directory for organizational purposes. See to learn how to use this feature. C Interactive Did you know that in c is not ? Sometimes you might want to experiment with some c syntax, but don't want to make a mod just to test the code. The c interactive window is very useful for this. You can do whatever you want in the c interactive, each command will execute it after you press enter. can be used to bring up previous statements. https://github.com/tModLoader/tModLoader/assets/4522492/9e1f8d4f c000 47d5 bb8c 61e0b5b90276 Git integration Git integration allows you to interact with your GitHub repository directly within your IDE. You can view diffs and make commits directly within your IDE. We recommend finding guides on Google to learn more. Visual Studio Live Share This feature lets you invite someone into your project and collaboratively work on the code. Useful for mentoring other developers on your mod team or getting help on a tricky problem. Pair with Discord chat for voice chat."},{"path":"螺线翻译tml教程/0-开始/5-Learn-How-To-Debug 学习如何调试.md","filename":"5-Learn-How-To-Debug 学习如何调试.md","title":"5-Learn-How-To-Debug 学习如何调试","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is Debugging? Debugging is how modders investigate problems in their code in an attempt to fix them. The mod builds fine, but the mod does not behave as expected. Inevitably, something in your mod will not work as intended. When this happens, you'll need to \"debug\" the mod to determine where the issue is happening. Debugging can take many forms, this guide will focus on 3 approaches: , , and . This guide focuses on tModLoader modding. The official guide is a great resource for general C debugging and covers a few more conceptual topics as well as general C debugging. It is highly recommended that modders read that as well. Isolation Debugging The first step when encountering a bug is to isolate it as much as possible. Testing with a new world and new player can rule out many sources of issues. Additionally, other mods are a big source of unknown behaviors, the bug you are seeing could potentially be a feature or a conflict with one of them. Disable all other mods and make sure the bug still exists, if it does, that means the problem is in your code, which means you can fix it. If the bug does not exist, you'll need to figure out which mod is causing the issue by loading individual mods with your mod. If the bug happens with only one other mod, it might be a bug from that mod. Collaborating with that modder to fix the issue might be necessary. Once you know a bug is caused by your mod, you'll want to identify where the issue is coming from. The following sections will help you discover the issue. Text Debugging If you are not familiar with using a debugger like Visual Studio or just need to quickly visualize some data, then debugging via text can be useful. Do note that eventually you'll want to learn because it is quicker and more powerful. Text debugging, simply put, is printing text that you can read in an attempt to identify an issue. For example, if some math operation isn't giving the results you expect, printing the values out can help identify the issue. First, let's explore the text debugging methods available: Text Debugging Methods The following are typical approaches for text debugging in tModLoader. With all of these approaches, make a string from the data you want to output. For example, if you have a variable called , you might want to make a string and pass that into any of these methods. To learn more about creating a string from text and data, see this tutorial. Main.NewText This method outputs text to the in game chat window. This is simple and straightforward. The text will be easily visible and will disappear after some time. : Mod.Logger.Info This method outputs text to the . A client outputs to and the server process outputs to . This approach will persist the data, so it might be more useful to use this approach if you need to track something over time. : Console.WriteLine If you are familiar with programming, using for text debugging should be familiar with you. This approach, however, is not very useful for debugging mods. The console is hidden, so there is no way to see the text. Use one of the other approaches. CombatText.NewText This approach spawns floating text. The text quickly disappears, but because the text spawns at a specified location, it can be useful for situations where that is helpful. The method requires passing in a Rectangle for the location and a Color: : Dust.QuickDust, Dust.QuickBox, Dust.QuickDustLine Not text, but spawning dust at specific world coordinates can be useful for code dealing with world locations. Use this to verify in Projectile and NPC AI code. How to use Text Debugging Now that we know how to output text, lets go through an example. This exercise will help teach how to use Text Debugging. Consider the following code in a healing potion item similar to : The intent of this code is to heal the player 100 health plus 10 health for every Diamond Ring in the player's inventory, up to a max of 200 health total. At first glance, this code seem correct, but it actually always heals for 100 health because of bugs. Lets add some text debugging to identify the issues: This code results in the following output when the player is holding 5 Diamond Rings: For some reason the method is only counting up to 1. Lets look at the documentation for the method: It seems that there is a 2nd parameter called . We want to count up to 10, so lets fix this issue by changing that line to and try again: The value of is now correct, but is still incorrect. It seems that results in a value of when is ! This is not what we want. This is caused by , we can fix this by changing to . Lets do that fix and try again: It's all working correctly now. In this example we used text debugging to determine where bugs were happening. Using a similar approach, you should be able to locate logic errors in your mod's code. Text debugging is a useful tool, but can be quite tedious. Typing out code to output text to the chat isn't very efficient. Once you are familiar with the basic concept of debugging, you should advance to using as soon as possible. Clean Up Once text debugging has served it's purpose, remember to remove text debugging code from your mod. Nothing is more annoying for your users than seeing strange text appear in the chat during seemingly random circumstances. There are some situations where the text debugging code might be useful later. One approach is to use a to hide the code in the release build of the mod. With this approach, the code will be present when debugging from Visual Studio, but will not be present in the mod when built in game: Sometimes debug text can be useful if you are remotely helping a user of your mod diagnose an issue. Sending them a special build of the mod with the debug text can be useful, but another approach is to provide a config that toggles additional debug logging. For example, the mod uses to control if text will be logged. This toggle allows mods integrating with that mod a way to diagnose their code. Debugger Debugging In the Text Debugging section, we learned to output specific values to the chat to identify and fix a couple of bugs. That process is tedious because the modder needs to rebuild the mod each time they make a change. In this section we will learn to leverage the power of a debugger (Visual Studio) to debug our mods. This section assumes the modder is using and has correctly set it up, please consult that guide to follow those prerequisites. This section will cover the basics of debugging, it is highly recommended that modders familiar with these basics should further consult the official guide for more tips. There are a variety of additional techniques discussed there to greatly enhance the usefulness of debugging. Launching the Debugger First, make sure to open your mod's project in Visual Studio. Next, make sure tModLoader is closed. Also make sure that \"Debug\" is selected in the solution configuration drop down. Now click the button labeled \"Terraria\" or press F5: If you have errors, the Error List will appear, otherwise, the mod will build, be enabled automatically, and Terraria will start. (You may find that Full screen mode makes modding difficult, I suggest using Windowed mode while making mods.) If Visual Studio tells you that there are build errors and asks if you would like to launch anyway, say no! Fix the errors and try again. You'll know it is working if you see this: Go in game and prepare to trigger your bug. Debugging the Server You can debug the server process directly by selecting the \"Terraria Server\" launch target instead of \"Terraria\" in the dropdown. You can launch a client normally and connect to the server via as the ip address once the server loads the world. Breakpoint We need to pause the program to \"inspect\" the data. This is called \"break mode\". To do this, click in the \"line number margin\" on a line of code where you suspect a bug is happening. This will place a red dot. This red dot is a \"breakpoint\". The next time tModLoader runs that line of code, the game will enter break mode and you'll see a yellow arrow in visual studio overlapping that breakpoint. You will not be able to interact with the game while in break mode. The yellow arrow indicates which line of code will run next. In tModLoader, do whatever action is needed to trigger the line of code that has a breakpoint on it. (This could be shooting the weapon, killing an enemy, equipping an accessory, etc.) By pressing the keys, you can advance the state of the game by 1 line. This is called \"stepping through\" the code. Pressing or the green continue button will leave break mode and the game will resume. The game will run until it hits another breakpoint. Inspect Variables If the game isn't in break mode, repeat the steps to enter break mode near the code that has a bug. We will now \"inspect\" variables. To do this, simply hover the cursor over the variable. The guide talks more about this feature: It is important to remember that the yellow arrow indicates the next line to execute. In the image above, the value of is still because the line of code hasn't run yet. Pressing to advance one line, the value has now changed to , which is correct. By stepping through the code and inspecting variables, we can follow the logic and identify where errors are happening. The will quickly show all variables relevant to the current method. Pinning variables is another useful technique. Another useful feature is that the values of pinned variables and variables in the Locals or Autos windows will turn red after they are changed while stepping through code. Edit Code Once a bug has been identified, you can make edits to code even while debugging. When the file is saved, they should take effect immediately. To enable this feature, double check that the \"Hot Reload on File Save\" option is checked: Note that adding new methods and classes will likely require the game to be relaunched: Using \"Debugger Debugging\", you should be able to fix the same issue used as an example in the \"Text Debugging\" much more quickly. Fixing bugs quicker leaves you more time to make fun mods. Exception Debugging Debugging exceptions is something only possible while using the debugger. When an exception happens while debugging, the game will immediately enter break mode. In Visual Studio, the line responsible for the exception will appear. From there, you can inspect variables and try to identify the bug. If the exception happens in tModLoader code, you may see a blank screen because you do not have the source code available. In this case, look at the \"Stack Trace\" window and navigate to the lines from your mod that caused tModLoader code to throw an exception. The and sections on the official guide explain this concept in further depth. Exception Debugging Example Discovering the exact cause of errors: In this , we can easily diagnose where the error is happening. When the error happens in the game, Visual Studio is brought to the front and the line where the error occurs is highlighted. We can then hover over things and inspect their values. Here we notice that is null. Now we can fix the error, we can use to confirm that yes, we forgot to set to a value. You might notice the green underline under warning us that is never assigned. We should have paid attention! Now we can easily fix the error: View Decompiled tModLoader Code While debugging, we can use F10 to step over lines. Sometimes we need to look into a method to figure out an issue. F11 allows us to step into a method. By stepping into a method, we can see how and why an object might be changed. If that method is from tModLoader, we won't be able to step into it by default. We can enable a feature to allow stepping into decompiled code. To do this in Visual Studio, use the search (Ctrl Q) to search for \"decompile source\". Click on \"Automatically decompile to source when needed (Managed only)\", Scroll down to check the checkbox, and finally click \"OK\": From now on, you'll be able to step into tModLoader methods as you are debugging. It may take a bit of time for the decompilation to finish."},{"path":"螺线翻译tml教程/0-开始/6-Developing-with-Visual-Studio 使用VisualStudio开发.md","filename":"6-Developing-with-Visual-Studio 使用VisualStudio开发.md","title":"6-Developing-with-Visual-Studio 使用VisualStudio开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This guide supports VS 2019 and VS 2022 edition Visual Studio only runs on Windows. Mac and Linux users should consider or instead. It does not cover . This guide is not meant to learn C fundamentals Prerequisites 1. Download . 1. The community edition is free of charge. 1. If you are using tml 1.3 , you need to download and install the (If the community edition is not available there, try ), else you get the errors mentioned below. You can use 2022 afterwards if you want to. 1. If you are using tml 1.4 , you need 2022. v17.8 or higher is required, you may need to . 1. During installation, check the workload. Nothing else needs to be checked. ( ) 1. You may be tempted to uncheck items you think you don't need in the tab to save hard drive space or bandwidth. We have not currently determined which individual components are able to be unchecked for tModLoader modding. Many have unchecked things and have been unable to compile mods. If you get an error message similar to \"The type 'Object' is defined in an assembly that is not referenced.\", you may have this issue and should do the full workload install. 1. If you've forgotten this step, you can click on Tools Get Tools and Features to bring up the installer again. ( ) 1. Install by visiting , downloading the installer for the latest SDK release labeled \"x64\" corresponding to your operating system, and running the installer to completion. Don't download the .NET 6.0 or .NET 7.0 versions, those will not work. You might need to restart Visual Studio or your computer after the install. ( ) Creating a Project First we must create a new project for our mod. To do this, follow the instructions in for generating a Mod Skeleton, which will contain the project files. Creating or Updating an existing project for an old mod If you are updating a mod from before 1.4, you can use the \"Upgrade .csproj file\" button in the Mod Sources menu. This will create a fully working project for you to open and continue working on. Opening your Project It is very important that you open the file from the file explorer. If you open individual files, Visual Studio will be completely useless. To open the , navigate to and double click on . Make sure you aren't opening the or files. This will likely happen if you do not have file extensions shown. Watch to see how to toggle file extensions. Now that Visual Studio is open, make sure you see the following: Click the button to see the files in your mod. You must open files from here in order to correctly use Visual Studio. Let's make sure autocomplete is working. Open up and type on a new line after the existing . You should see the autocomplete popup show up: Congratulations, you are ready to write code for your mod. Read below for info on building and debugging within Visual Studio. Building with Visual Studio Building your mod within Visual Studio lets you quickly make sure the code you have written doesn't have any build errors. First, make sure tModLoader itself is closed, or at least that the mod you are building is unloaded. Next, simply select the Build Build [Modname] menu item: If you have errors, you'll see them in the Error List. You can click on each error to see the offending code: If you do not have errors, you should see Build Succeeded on the bottom left. If you open the Output Panel (View Output), you should see something similar to this: Please keep in mind that Visual Studio DOES NOT abide to your buildIgnore rules, and your built .tmod file will be larger than if you would use the in game build option. So, before you release your mod, ALWAYS build using the in game menu . Debugging Debugging is the main feature that sets Visual Studio apart from Visual Studio Code. This will let you set breakpoints in your mod and inspect variables in Visual Studio. To debug, first make sure tModLoader is closed , then simply click the button labeled \"Terraria\" or press F5: If you have errors, the Error List will appear, otherwise, the mod will build, be enabled automatically, and Terraria will start. (You may find that Full screen mode makes modding difficult, I suggest using Windowed mode while making mods.) If Visual Studio tells you that there are build errors and asks if you would like to launch anyway, say no ! Fix the errors and try again. You'll know it is working if you see this: More information on how to debug and the benefits of debugging are found in the page, please read it, it is extremely useful. Debugging with Family Share If you are launching tModLoader through Family Share on Steam, you will be required to do the following fix, otherwise it will fail to launch the game correctly through VS: 1. Open the folder in your mod's root folder, and open the in a text editor. 2. Change to 3. Save the file. Alternatively, you can open VS, navigate to Debug Debug Properties, and add into the \"Environment variables\" field (or into Name and into Value, depending on your VS version). Edit and Continue While debugging, you can edit the source code and recompile the mod in game without having to reload mods or restart the game. The page has more info on this topic, please read it, it is extremely useful. Anything between \"Next Steps\" and \"Common issues\" is not required to do, this has been set up by the \"Create Mod\" button when you made your mod. Don't touch your .csproj if you don't know EXACTLY what you are doing. Next Steps Now that you have setup Visual Studio, your mod development speed can increase greatly. Please read for more tips on how an IDE like Visual Studio greatly speed up your modding. Additional Recommended Extensions To further improve the modding experience, consider these extensions that can be added to Visual Studio. HJSON The adds syntax highlighting to files. Keys and values are colored to help identify mistakes. HLSL The greatly improves editing shader files in Visual Studio. Manual Setup Setting up a project for your mod manually is not recommended. Modders should use the automatic mod project generation. The info in this section is for informational purposes only and likely only applies to outdated tModLoader versions. Expand for Manual Setup instructions Creating a Project 1. Open Visual Studio and go to New Project 1. Select the \"Class Library\" template 1. Set the internal name for your mod. (No special characters allowed) 1. Uncheck \"Create directory for solution\" if using VS 2017, and check \"Place solution and project in the same directory\" if using VS 2019. 1. Make sure to set the location to the Mod Sources directory 1. Click OK 1. Your output should look similar to . Note, your window may look different, this is the window for VS 2019. 1. Go to the Solution Explorer tab, right click on Solution ModName References and click Add Reference... ( ) 1. Click Browse... and select the tModLoader executable (likely: , if you're not on Windows check out ) 1. Add a new txt file named to the root of your project 1. to your build.txt 1. Add the XNA references to your project. You should have these if you can play Terraria, otherwise see 1. Open the csproj file in a good text editor (like ) 1. Find the reference section and add the following: 1. VS should prompt to reload the project, do so. Otherwise, simply re open the project. 1. Create a class extending Building with Visual Studio This will let you build your mod from within Visual Studio, so you don't have to rebuild from within the game, or have your sources in the Mod Sources folder. 1. Right click on your mod project in the Solution Explorer and click Properties 1. Go to the Build Events tab 1. Add the following to the Post build event command line 1. Ensure the paths are enclosed by double quotes, change the path to your tModLoaderServer if you have it installed elsewhere. Debugging This will let you set breakpoints in your mod and inspect variables in VS. Change the paths if you installed Terraria elsewhere. 1. Right click on your mod project in the Solution Explorer and click Properties 1. Go to the Debug tab 1. Set the Start Action to Start external program: 1. Set the Working directory to 1. Add the line to your build.txt if you want to include line numbers in exception stack traces (useful for debugging). However it will increase the size of your mod and should be omitted from release builds . Setup Edit and Continue This will let you edit the source code and recompile the mod during debugging, without having to restart the game. 1. Simply add to the end of your Post build event command line Common issues These issues usually only apply if you have not upgraded to the 0.11 .csproj. Please update your csproj in the Mod Sources menu first. Autocomplete isn't doing anything for me. (Also: Autocomplete is changing things I don't want it to, like changing to .) 1. Check that your .cs files are actually in the project, and that you are opening the project not just individual .cs files. You can use the show all files toggle and then right click include in project to add missing source files to the project. 2. Make sure you aren't opening .cs files from the File Explorer. You should always open the .csproj (or .sln) file and then once Visual Studio is open, open your .cs source files from the Solution Explorer. If you don't, you'll notice that the top left area says Miscellaneous Files, meaning the file doesn't belong to a project. If you see Miscellaneous Files, check step 2 again. After fixing: 3. Make sure the Solution Explorer is in solution view and not folder view. 4. Make sure Visual Studio is at v17.8 or higher. . The current .NET SDK does not support targeting .NET 8.0. Either target .NET 7.0 or lower, or use a version of the .NET SDK that supports .NET 8.0 This means you need to update Visual Studio to v17.8 or higher. This is required as of May 1st, 2024, the v2024.03 stable release. . The SDK 'Microsoft.NET.Sdk' specified could not be found. This means you skipped installing the workload mentioned at the top of this page. If you are sure you did that, then another possibility is that the 32 bit dotnet SDK is taking priority on your computer's . Follow the instructions in to see if that applies to your situation and how to fix it. The project doesn't know how to run the profile with the name 'Terraria' and the command 'Executable' This means you skipped installing the workload mentioned at the top of this page. Error CS0246 The type or namespace name 'ReLogic' could not be found Make sure you are using the updated .csproj and this error will automatically fix itself. See to update your csproj. Error CS0246 The type or namespace name 'Mod' (or 'ModLoader', 'ModItem', etc) could not be found You have added a reference to the vanilla Terraria.exe, remove it and add a correct reference to the modded Terraria.exe. CS5001 Program does not contain a static 'Main' method suitable for an entry point Make sure \"Output type\" is set to \"Class Library\" in the project properties. References to other classes stopped working! (such as : ModItem, : ModProjectile etc.) Simply restart Visual Studio and it should fix itself. If it does not, you can attempt removing the .vs folder in your mod source root, then reloading the project. Failed to load pre compiled edit and continue dll System.IO.FileNotFoundException: Could not find file 'C: ... YYY.pdb'. This error occurs when the project wasn't created with the mod skeleton generator. To fix this error, go under your project's properties (right click the project under the Solution Explorer and click ), go to the tab, click the button and change the value of to . VS 2019 keeps opening instead of VS 2022 If you find that opening your file is opening VS 2019 when you have 2022 installed, the issue can be solved by updating the file. First, open up VS 2022, then use to open the directly. Next, open the panel and click on the line at the top. Click and then click . This will update the file that the is bound to. You can now close VS and try double clicking on the .csproj to verify that it opens VS 2022 now. Miscellaneous Determining issues from screenshots If you are helping someone online that is struggling to get Visual Studio to work, these visual clues will help identify their issues: Wrong Visual Studio Version The icon is an easy way to recognize if they are in the wrong Visual Studio version. Direct them to to download Visual Studio 2022. Wrong Program The guidelines in Visual Studio are a dotted line, Visual Studio Code has solid lines, and Notepad++ has dotted lines with very small dots. Also note how Notepad++ fails to do complete syntax highlighting. Direct them to to download Visual Studio 2022. Unsaved Changes All editors have a small mark in the editor tab indicating that a file has changes that are not saved. In Visual Studio and Notepad++, colors in the gutter area indicate lines that have not yet been saved. In VS, hollow gutter marks are unsaved edits or additions, while solid marks are recently saved changes. In Notepad++ orange lines are unsaved and green lines are saved changes. Even if changes are saved, the mod might not have been rebuilt. The easiest way to avoid these issues altogether is to always launch directly from Visual Studio rather than saving changes in the editor and then building the mod in game. This approach also has the added benefit of allowing hot reload and build and continue to work, greatly speeding up testing. Miscellaneous Files If you see \"Miscellaneous Files\" instead of the mod name, the user didn't open their and instead opened the file directly. Other clues include a lack of syntax highlighting for classes and method invocations. Direct them to ."},{"path":"螺线翻译tml教程/0-开始/7-Developing-with-Visual-Studio-Code 使用VisualStudioCode开发.md","filename":"7-Developing-with-Visual-Studio-Code 使用VisualStudioCode开发.md","title":"7-Developing-with-Visual-Studio-Code 使用VisualStudioCode开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This guide does not cover , but Visual Studio Code. Visual Studio Code takes less space to store than Visual Studio. Visual Studio Code runs on Windows, Mac, and Linux. If you inexperienced in modding, have space on your computer and are on Windows, it is highly recommended to get Visual Studio instead. This guide is not meant to learn C fundamentals Prerequisites Installation 1. Download . 1. Install Visual Studio Code by running the downloaded installer. Allow the program to run and accept license agreements as you would normally do. The default options should be suitable. 1. Install the by downloading the installer, running it, and following the instructions. Download the installer for the latest SDK release labeled \"x64\" corresponding to your operating system. Don't download the .NET 6.0 or .NET 7.0 versions, those will not work. ( ) 1. Launch Visual Studio Code. 1. Install the C Dev Kit extension. 1. You should see something similar to the following: 1. Click the Extensions button: 1. Type into the search bar, click the \"C Dev Kit\" extension, then click the install button: 2. Optional . If you are an experienced user, IntelliCode for C Dev Kit will be a helpful extension. Install that as well if interested. However, if you are inexperienced, this will just cause confusion and is not recommended: 3. Wait for the installation to complete. The output window will show other extensions being downloaded and installed as it is packaged with C Dev Kit: Creating a Mod Follow the instructions in Open your Mod Source 1. It is very important that you installed the extensions mentioned above and .NET 8 SDK listed in . 1. Open Visual Studio Code 1. Click . If you don't see it, click . Navigate to if you're on Windows, or Navigate to if you're on Mac, and click : 1. You should now see various files available to edit. Open and you should be able to start writing code. 1. You can create new folders and files by right clicking in empty space in the Explorer pane: Build your Mod 1. Building your mod is easy. Just open from the Menu Bar: 2. Once the terminal is open, simply just type to build your mod. Enabling Hot Reload This feature is disabled by default. You will need to open settings and enable it. 1. Press on your keyboard to open settings, then click on the icon on the top right: 2. Inside the curly braces, add these lines: 3. Press to save. Hot Reloading should be enabled. Common Build Issues If you get an error relating to \"project.assets.json not found. Run a NuGet package restore to generate this file.\", then go to , run the command in the terminal that appears. Now you can run the build again with . If you get an error relating to \"System.IO.IOException: The process cannot access the file TutorialMod.tmod because it is being used by another process.\", you need to disable the mod in tModLoader and reload mods so that the file can be edited. Closing tModLoader completely is also an option when building. Why Use Visual Studio Code Please read the page. Most of the features apply to Visual Studio Code. If you aren't seeing errors being underlined or fixes being suggested, you might have skipped installing the . Debugging Debugging can be achieved by using VS Code's Run and Debug feature. 1. Click (or press ): 2. While having a related to the mod opened in the main editor, click button: 3. tModLoader should start while enabling your current state of your mod. You can add breakpoints from here and hot reload when necessary and if enabled: 4. To add breakpoints, simply click the red dot left of the line number as so: Issues Autocomplete, Error Reporting, or IntelliSense not working Assuming you followed every step in , the most common reason for this error is failing to open your mod's code correctly. Please follow the section. Failure to open your mod this way will make using Visual Studio Code counterproductive."},{"path":"螺线翻译tml教程/0-开始/8-Developing-with-Rider 使用Rider开发.md","filename":"8-Developing-with-Rider 使用Rider开发.md","title":"8-Developing-with-Rider 使用Rider开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introductory Rider is a lightweight IDE, developed by JetBrains. It is similar to but has a different layout more similar to those found in Intellij and PyCharm. If you have previously used other JetBrains IDEs you may have a significantly easier time using Rider than you would Visual Studio. Rider is easier to run than Visual Studio, while still having IntelliSense and code debugging. Importantly, it runs on Windows, Mac, and Linux while is Windows only. It is free for non commercial use, and Students can get a . Table of Contents Start First, install Rider. Rider is free to use non commercially, and can be downloaded here: https://www.jetbrains.com/rider/ JetBrains' entire suite of IDEs is also avaliable through requiring only a recognized school email. Sign up . Opening an existing VS project After launching Rider, simply select \"Open Solution or Project\". Then navigate to your project's or file and open it. Rider will open a new window and load the project. Creating a new Rider project It is recommended that you create your project files through tModLoader itself. This can be done by following the steps laid out in the . After creating a new mod skeleton through tModLoader, your mod folder will be located in your Mod Sources directory found here: follow the steps above and paste this path into your file explorer to find the mod folder. Your project will be generated with the proper build settings so there is no need to change them. You can now follow to begin working on your mod. Features of Rider Modders use an IDE like Rider because it helps identify and fix programming errors. See for basic information on how an IDE benefits a modder. Adding project references The generated project file will automatically have all the appropriate settings and references applied. If you need to reference a unique .dll, such as , follow the instructions below. On the left side of the window will be a panel labeled explorer, this is your Solutions Explorer. Near the top will be a drop down menu. By default it will be set to Solution, if it is not click it and select Solution from the drop down menu. Now the explorer should show your solution. From the explorer, right click the main tab with a green C on it, and your mods name written to its right. A menu should appear. Click Add, and then Add Reference. A new window will appear, select 'Add From...' a file explorer should appear. Find the .dll file and double click on it to add it as a project reference. Viewing file structure To view file structure like in VS studio (dropdowns for methods etc.) Go to This opens a structure view window as shown: Clicking on any method or field will make your editor scroll to it. To return the regular file explorer simply select the Explorer tab on the left side. Optimal view setup If you plan on working on large code, like tMLs, it is recommended to enable the 'View whitespaces' and 'Use soft wrap' options. Go to and enable these options. Viewing whitespaces (indents) is important to ensure you don't use whitespaces but tabs of width 4. Keeping track of TODOs Rider has a useful window that can find things marked TODO in comments or throwing NotImplementedException() To open this window, go to This opens a new window as shown: No distraction mode This is a useful tip when you want to write code without being distracted. To use this mode, navigate to This gets rid of pretty much any side windows as shown: Code analysis, inspection settings For your own benefits, it is recommend to enable code analysis and propagate code annotations. Open the settings, by going to or using the shortcut. Navigate to On Inspection Settings, tick to enable and Next, to enable code annotations propagation navigate to in the same dropdown, and tick as shown: You probably also want to disable the hint, which can be annoying. Navigate to Type in the search bar and uncheck it as shown: If you are also annoyed by the , it can be disabled as well: Split view: working on multiple files simultaneously Another useful feature in Rider is split views. It can look something like the following: To do this, right click the tab you wish to split and then select \"Split Vertically\" or \"Split Horizontally\", you can do this multiple times however readability quicky declines. Debugging To debug your mod, make sure tModLoader is closed and then click the green arrow button to build and launch your mod. Debugging should work similarly to how it does in Visual Studio. The guides on this wiki show screenshots and examples using Visual Studio, but the same options are all present in Rider. See the for more information."},{"path":"螺线翻译tml教程/0-开始/9-Developing-with-Notepad-Plus-Plus 使用Notepad++开发.md","filename":"9-Developing-with-Notepad-Plus-Plus 使用Notepad++开发.md","title":"9-Developing-with-Notepad-Plus-Plus 使用Notepad++开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Warning: This guide was written long ago and is no longer relevant to current tModLoader. Please do NOT follow this guide. We recommend , or instead. Introductory Notepad++ is a lightweight rich text editor. It features syntax highlighting, amongst other features such as being able to open really large files if you have the 64 bit edition. You can download notepad++ on First and foremost, debugging using notepad++ is not possible at this time. However, you can get auto completion as shown: You can also get an 'easy' build mod script, however it is only supported on Windows at this time. Table of contents Setup First, have np++ installed. I recommend 64 bit if your computer can handle it. Next, you'll want to be able to open a folder as directory tree like in other IDEs. Navigate to and open your mod source. This will open a nice directory tree as shown: Compile scripts I've written a few batch scripts that can compile your mod source against the server similarly in Rider and Visual studio. You will have two files: and . Both rely on each other, so you need both. Don't worry though, you'll only ever be manually calling run build. Download a .zip of the files . ( Note: In change line 36 to: if the script does not work initially ) As shown above, it contains two files. Place these files wherever you want, but inside your mod source is preferred. You'll need to change settings inside the run build script once. Open up in np++ and see the first setup sections. It comes with 5 settings that can be configured. Read the instructions thoroughly and change the settings accordingly. The settings include: server path the path to your tModLoaderServer.exe mod sources path the path to your mod sources folder mod name the name of your mod (internal name) compile with eac whether to compile with eac instructions make logs whether to write info to log files Note: an easier setup is possible having 1 superscript and calling it from within your mod source folder. However, this requires that the user knows batch scripting so I didn't opt for it. To run the compile script and build the mod, right click the script in the directory tree and click 'Run by system' as shown: Note: do not ever run the script manually, it requires information from the run build script. It is recommended to add the following lines to your buildIgnore: If all works well, you should get an output similar to this: Note that, when a compile error happens, likely is that the error doesn't display well in the console. For this reason, it is recommended to enable logging if your mod fails to compile. Acquiring auto completion To get auto completion, you will need a plugin called cs script for notepad++. It is recommended to not use the np++ plugin managers as it has bugs when installing cs script. A manual install is required. To get cs script, go to and download the latest release. To install, you will need to know where notepad++ install is located. If you don't know, it's usually in Program Files or Program Files (x86). Alternatively, you can run this command in shell: (change C: drive if you use a different drive) which will output the path to the exe it finds. Navigate to the top level of that path, e.g: . Whilst in there, move the folders 'plugins' and 'updater' into it. You might need administrator privileges. Now reopen notepad++, you are likely greeted by a welcome popup. Now to actually acquire auto completion, you will need to add Terraria as a reference. However, cs script only support top level .dll files as references. Go to your Terraria install directory and copy over Terraria.exe (tModLoader) to your mod source folder. Then rename it to have the .dll extension. Verify that it shows in your directory tree in notepad++. Add the following line at the top of your file: You should now have auto completion as shown: Without having to compile your mod, you can look for syntax errors by cs script build, using the command shortcut: . If you have any syntax errors, they will display as shown:"},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Developing-on-Mac-or-Linux 在Mac或Linux上开发模组.md","filename":"Developing-on-Mac-or-Linux 在Mac或Linux上开发模组.md","title":"Developing-on-Mac-or-Linux 在Mac或Linux上开发模组","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Warning: This guide was written long ago and is no longer relevant to current tModLoader. Please do NOT follow this guide. We recommend or for developing mods on Mac and Linux. Mac and Linux no longer require any OS specific instructions. These instructions do not apply yet For now, the only instructions are here: Everything below this possible relates to tModLoader v0.11, but the instructions do not work yet. Note: Work in Progress, instructions are not completely working or tested yet. Currently there is no implementation to decompile Terraria on Linux/Mac. This means that you need to run the tool to decompile Terraria under Windows. This will hopefully soon be implemented on Linux and Mac as well. Developing on Mac or Linux tModLoader requires the Microsoft C Compiler ( ) to be installed. On Windows, it's bundled with the .NET installation itself. On Mac and Linux however, it requires a separate package which might not be pre installed on your system. You can check if it is present by opening a terminal and executing the command , you should see something like this: Or you can simply try compiling and look for errors. Instructions on how to install the required packages are in the following section. Building mods inside of tModLoader tModLoader has the ability to build mods that have no external dependencies/references within Terraria itself. If you are new to modding or have no idea what external dependencies are, this is most likely what you want. If you want to use external dependencies which allow for more \"fancy\" features and you know what you are doing you can look into Installing mono Having the Mono framework installed allows you to build mods directly within tModLoader under the menu option. Linux On most Linux distributions the package is called or simply . If you are having trouble installing the package you can go to the page on the mono projects website for further assistance. Mac Visit the Mono website and follow the for Mac. Apparently this install doesn't add the appropriate tools to the Path, so you may need to follow these instructions if you still can't build in game. Please update this page with any relevant information if you have any. Edit: Some further instructions can be found in the answers section of this Untested. Building outside of tModLoader If you would like to have a more flexible and generally better development environment, you should probably look into building mods outside of tModLoader. This implies using an IDE such as Visual Studio Code (The regular Visual Studio is not supported on Linux, although it is on Mac). MonoDevelop/Xamarin (on which Visual Studio for Mac is based on) is the easiest method to get started. The following instructions can be followed for getting a simple environment going: Working Visual Studio for Mac instructions Using the skeleton generator in game, the following changes can be made to the generated .csproj to make it work on Visual Studio for Mac. These results are the results of one modders attempts at getting it working. We'll try to make the workflow better in further updates. In the meantime, here is the edited csproj: Tweaks to MonoDevelop Compilation on Debian (2020 05 31, Debian 10/4.19.118, MonoDevelop 7.8.4, Mono 6.8.0.123, Steam tModLoader v0.11.7.4) tModLoader looked to want when building a mod. Mostly following instructions in link above, using the supplied blank Linux csproj, with the following notable exceptions. Prior to opening project: When installing MonoDevelop, added repository to apt cache, updated all mono packages, then installed. Grabbed ModCompile zips from https://github.com/tModLoader/tModLoader/releases/tag/v0.11.4 and combined them both in a new ModCompile folder in the Terraria installation folder. Created symbolic links to tModLoader and Terraria installation near project for pathing ease. Changed to in project file. In MonoDevelop, after opening project: Removed all referenced assemblies, added back and from tModLoader folder. Will likely need to add others as required by code and when someone can test the Windows half of the build, so wrote down the ones removed. Under project options / Configurations, renamed to . Under project options / Configurations, renamed to . Under project options / Compiler, changed Debug information from to in both configurations. Under project options / Custom Commands, added After Build step to both configurations. Was then able to compile both configurations, run successfully, and the simple mod (1 tile, 1 item) worked in game. Need to test in Windows. mymod.csproj Known issues Mac The type initializer for 'System.Drawing.GDIPlus' threw an exception On Mac after you've followed this guide you might find that you encounter this error when trying to build a mod that contains png files. To fix this download and extract the contents to where you installed tModLoader (usually it will be ), overwriting/merging any folders/files if asked."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Developing-with-Notepad-Plus-Plus 使用Notepad++开发.md","filename":"Developing-with-Notepad-Plus-Plus 使用Notepad++开发.md","title":"Developing-with-Notepad-Plus-Plus 使用Notepad++开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Warning: This guide was written long ago and is no longer relevant to current tModLoader. Please do NOT follow this guide. We recommend , or instead. Introductory Notepad++ is a lightweight rich text editor. It features syntax highlighting, amongst other features such as being able to open really large files if you have the 64 bit edition. You can download notepad++ on First and foremost, debugging using notepad++ is not possible at this time. However, you can get auto completion as shown: You can also get an 'easy' build mod script, however it is only supported on Windows at this time. Table of contents Setup First, have np++ installed. I recommend 64 bit if your computer can handle it. Next, you'll want to be able to open a folder as directory tree like in other IDEs. Navigate to and open your mod source. This will open a nice directory tree as shown: Compile scripts I've written a few batch scripts that can compile your mod source against the server similarly in Rider and Visual studio. You will have two files: and . Both rely on each other, so you need both. Don't worry though, you'll only ever be manually calling run build. Download a .zip of the files . ( Note: In change line 36 to: if the script does not work initially ) As shown above, it contains two files. Place these files wherever you want, but inside your mod source is preferred. You'll need to change settings inside the run build script once. Open up in np++ and see the first setup sections. It comes with 5 settings that can be configured. Read the instructions thoroughly and change the settings accordingly. The settings include: server path the path to your tModLoaderServer.exe mod sources path the path to your mod sources folder mod name the name of your mod (internal name) compile with eac whether to compile with eac instructions make logs whether to write info to log files Note: an easier setup is possible having 1 superscript and calling it from within your mod source folder. However, this requires that the user knows batch scripting so I didn't opt for it. To run the compile script and build the mod, right click the script in the directory tree and click 'Run by system' as shown: Note: do not ever run the script manually, it requires information from the run build script. It is recommended to add the following lines to your buildIgnore: If all works well, you should get an output similar to this: Note that, when a compile error happens, likely is that the error doesn't display well in the console. For this reason, it is recommended to enable logging if your mod fails to compile. Acquiring auto completion To get auto completion, you will need a plugin called cs script for notepad++. It is recommended to not use the np++ plugin managers as it has bugs when installing cs script. A manual install is required. To get cs script, go to and download the latest release. To install, you will need to know where notepad++ install is located. If you don't know, it's usually in Program Files or Program Files (x86). Alternatively, you can run this command in shell: (change C: drive if you use a different drive) which will output the path to the exe it finds. Navigate to the top level of that path, e.g: . Whilst in there, move the folders 'plugins' and 'updater' into it. You might need administrator privileges. Now reopen notepad++, you are likely greeted by a welcome popup. Now to actually acquire auto completion, you will need to add Terraria as a reference. However, cs script only support top level .dll files as references. Go to your Terraria install directory and copy over Terraria.exe (tModLoader) to your mod source folder. Then rename it to have the .dll extension. Verify that it shows in your directory tree in notepad++. Add the following line at the top of your file: You should now have auto completion as shown: Without having to compile your mod, you can look for syntax errors by cs script build, using the command shortcut: . If you have any syntax errors, they will display as shown:"},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Developing-with-Rider 使用Rider开发.md","filename":"Developing-with-Rider 使用Rider开发.md","title":"Developing-with-Rider 使用Rider开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introductory Rider is a lightweight IDE, developed by JetBrains. It is similar to but has a different layout more similar to those found in Intellij and PyCharm. If you have previously used other JetBrains IDEs you may have a significantly easier time using Rider than you would Visual Studio. Rider is easier to run than Visual Studio, while still having IntelliSense and code debugging. Importantly, it runs on Windows, Mac, and Linux while is Windows only. It is free for non commercial use, and Students can get a . Table of Contents Start First, install Rider. Rider is free to use non commercially, and can be downloaded here: https://www.jetbrains.com/rider/ JetBrains' entire suite of IDEs is also avaliable through requiring only a recognized school email. Sign up . Opening an existing VS project After launching Rider, simply select \"Open Solution or Project\". Then navigate to your project's or file and open it. Rider will open a new window and load the project. Creating a new Rider project It is recommended that you create your project files through tModLoader itself. This can be done by following the steps laid out in the . After creating a new mod skeleton through tModLoader, your mod folder will be located in your Mod Sources directory found here: follow the steps above and paste this path into your file explorer to find the mod folder. Your project will be generated with the proper build settings so there is no need to change them. You can now follow to begin working on your mod. Features of Rider Modders use an IDE like Rider because it helps identify and fix programming errors. See for basic information on how an IDE benefits a modder. Adding project references The generated project file will automatically have all the appropriate settings and references applied. If you need to reference a unique .dll, such as , follow the instructions below. On the left side of the window will be a panel labeled explorer, this is your Solutions Explorer. Near the top will be a drop down menu. By default it will be set to Solution, if it is not click it and select Solution from the drop down menu. Now the explorer should show your solution. From the explorer, right click the main tab with a green C on it, and your mods name written to its right. A menu should appear. Click Add, and then Add Reference. A new window will appear, select 'Add From...' a file explorer should appear. Find the .dll file and double click on it to add it as a project reference. Viewing file structure To view file structure like in VS studio (dropdowns for methods etc.) Go to This opens a structure view window as shown: Clicking on any method or field will make your editor scroll to it. To return the regular file explorer simply select the Explorer tab on the left side. Optimal view setup If you plan on working on large code, like tMLs, it is recommended to enable the 'View whitespaces' and 'Use soft wrap' options. Go to and enable these options. Viewing whitespaces (indents) is important to ensure you don't use whitespaces but tabs of width 4. Keeping track of TODOs Rider has a useful window that can find things marked TODO in comments or throwing NotImplementedException() To open this window, go to This opens a new window as shown: No distraction mode This is a useful tip when you want to write code without being distracted. To use this mode, navigate to This gets rid of pretty much any side windows as shown: Code analysis, inspection settings For your own benefits, it is recommend to enable code analysis and propagate code annotations. Open the settings, by going to or using the shortcut. Navigate to On Inspection Settings, tick to enable and Next, to enable code annotations propagation navigate to in the same dropdown, and tick as shown: You probably also want to disable the hint, which can be annoying. Navigate to Type in the search bar and uncheck it as shown: If you are also annoyed by the , it can be disabled as well: Split view: working on multiple files simultaneously Another useful feature in Rider is split views. It can look something like the following: To do this, right click the tab you wish to split and then select \"Split Vertically\" or \"Split Horizontally\", you can do this multiple times however readability quicky declines. Debugging To debug your mod, make sure tModLoader is closed and then click the green arrow button to build and launch your mod. Debugging should work similarly to how it does in Visual Studio. The guides on this wiki show screenshots and examples using Visual Studio, but the same options are all present in Rider. See the for more information."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Developing-with-Visual-Studio 使用VisualStudio开发.md","filename":"Developing-with-Visual-Studio 使用VisualStudio开发.md","title":"Developing-with-Visual-Studio 使用VisualStudio开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This guide supports VS 2019 and VS 2022 edition Visual Studio only runs on Windows. Mac and Linux users should consider or instead. It does not cover . This guide is not meant to learn C fundamentals Prerequisites 1. Download . 1. The community edition is free of charge. 1. If you are using tml 1.3 , you need to download and install the (If the community edition is not available there, try ), else you get the errors mentioned below. You can use 2022 afterwards if you want to. 1. If you are using tml 1.4 , you need 2022. v17.8 or higher is required, you may need to . 1. During installation, check the workload. Nothing else needs to be checked. ( ) 1. You may be tempted to uncheck items you think you don't need in the tab to save hard drive space or bandwidth. We have not currently determined which individual components are able to be unchecked for tModLoader modding. Many have unchecked things and have been unable to compile mods. If you get an error message similar to \"The type 'Object' is defined in an assembly that is not referenced.\", you may have this issue and should do the full workload install. 1. If you've forgotten this step, you can click on Tools Get Tools and Features to bring up the installer again. ( ) 1. Install by visiting , downloading the installer for the latest SDK release labeled \"x64\" corresponding to your operating system, and running the installer to completion. Don't download the .NET 6.0 or .NET 7.0 versions, those will not work. You might need to restart Visual Studio or your computer after the install. ( ) Creating a Project First we must create a new project for our mod. To do this, follow the instructions in for generating a Mod Skeleton, which will contain the project files. Creating or Updating an existing project for an old mod If you are updating a mod from before 1.4, you can use the \"Upgrade .csproj file\" button in the Mod Sources menu. This will create a fully working project for you to open and continue working on. Opening your Project It is very important that you open the file from the file explorer. If you open individual files, Visual Studio will be completely useless. To open the , navigate to and double click on . Make sure you aren't opening the or files. This will likely happen if you do not have file extensions shown. Watch to see how to toggle file extensions. Now that Visual Studio is open, make sure you see the following: Click the button to see the files in your mod. You must open files from here in order to correctly use Visual Studio. Let's make sure autocomplete is working. Open up and type on a new line after the existing . You should see the autocomplete popup show up: Congratulations, you are ready to write code for your mod. Read below for info on building and debugging within Visual Studio. Building with Visual Studio Building your mod within Visual Studio lets you quickly make sure the code you have written doesn't have any build errors. First, make sure tModLoader itself is closed, or at least that the mod you are building is unloaded. Next, simply select the Build Build [Modname] menu item: If you have errors, you'll see them in the Error List. You can click on each error to see the offending code: If you do not have errors, you should see Build Succeeded on the bottom left. If you open the Output Panel (View Output), you should see something similar to this: Please keep in mind that Visual Studio DOES NOT abide to your buildIgnore rules, and your built .tmod file will be larger than if you would use the in game build option. So, before you release your mod, ALWAYS build using the in game menu . Debugging Debugging is the main feature that sets Visual Studio apart from Visual Studio Code. This will let you set breakpoints in your mod and inspect variables in Visual Studio. To debug, first make sure tModLoader is closed , then simply click the button labeled \"Terraria\" or press F5: If you have errors, the Error List will appear, otherwise, the mod will build, be enabled automatically, and Terraria will start. (You may find that Full screen mode makes modding difficult, I suggest using Windowed mode while making mods.) If Visual Studio tells you that there are build errors and asks if you would like to launch anyway, say no ! Fix the errors and try again. You'll know it is working if you see this: More information on how to debug and the benefits of debugging are found in the page, please read it, it is extremely useful. Debugging with Family Share If you are launching tModLoader through Family Share on Steam, you will be required to do the following fix, otherwise it will fail to launch the game correctly through VS: 1. Open the folder in your mod's root folder, and open the in a text editor. 2. Change to 3. Save the file. Alternatively, you can open VS, navigate to Debug Debug Properties, and add into the \"Environment variables\" field (or into Name and into Value, depending on your VS version). Edit and Continue While debugging, you can edit the source code and recompile the mod in game without having to reload mods or restart the game. The page has more info on this topic, please read it, it is extremely useful. Anything between \"Next Steps\" and \"Common issues\" is not required to do, this has been set up by the \"Create Mod\" button when you made your mod. Don't touch your .csproj if you don't know EXACTLY what you are doing. Next Steps Now that you have setup Visual Studio, your mod development speed can increase greatly. Please read for more tips on how an IDE like Visual Studio greatly speed up your modding. Additional Recommended Extensions To further improve the modding experience, consider these extensions that can be added to Visual Studio. HJSON The adds syntax highlighting to files. Keys and values are colored to help identify mistakes. HLSL The greatly improves editing shader files in Visual Studio. Manual Setup Setting up a project for your mod manually is not recommended. Modders should use the automatic mod project generation. The info in this section is for informational purposes only and likely only applies to outdated tModLoader versions. Expand for Manual Setup instructions Creating a Project 1. Open Visual Studio and go to New Project 1. Select the \"Class Library\" template 1. Set the internal name for your mod. (No special characters allowed) 1. Uncheck \"Create directory for solution\" if using VS 2017, and check \"Place solution and project in the same directory\" if using VS 2019. 1. Make sure to set the location to the Mod Sources directory 1. Click OK 1. Your output should look similar to . Note, your window may look different, this is the window for VS 2019. 1. Go to the Solution Explorer tab, right click on Solution ModName References and click Add Reference... ( ) 1. Click Browse... and select the tModLoader executable (likely: , if you're not on Windows check out ) 1. Add a new txt file named to the root of your project 1. to your build.txt 1. Add the XNA references to your project. You should have these if you can play Terraria, otherwise see 1. Open the csproj file in a good text editor (like ) 1. Find the reference section and add the following: 1. VS should prompt to reload the project, do so. Otherwise, simply re open the project. 1. Create a class extending Building with Visual Studio This will let you build your mod from within Visual Studio, so you don't have to rebuild from within the game, or have your sources in the Mod Sources folder. 1. Right click on your mod project in the Solution Explorer and click Properties 1. Go to the Build Events tab 1. Add the following to the Post build event command line 1. Ensure the paths are enclosed by double quotes, change the path to your tModLoaderServer if you have it installed elsewhere. Debugging This will let you set breakpoints in your mod and inspect variables in VS. Change the paths if you installed Terraria elsewhere. 1. Right click on your mod project in the Solution Explorer and click Properties 1. Go to the Debug tab 1. Set the Start Action to Start external program: 1. Set the Working directory to 1. Add the line to your build.txt if you want to include line numbers in exception stack traces (useful for debugging). However it will increase the size of your mod and should be omitted from release builds . Setup Edit and Continue This will let you edit the source code and recompile the mod during debugging, without having to restart the game. 1. Simply add to the end of your Post build event command line Common issues These issues usually only apply if you have not upgraded to the 0.11 .csproj. Please update your csproj in the Mod Sources menu first. Autocomplete isn't doing anything for me. (Also: Autocomplete is changing things I don't want it to, like changing to .) 1. Check that your .cs files are actually in the project, and that you are opening the project not just individual .cs files. You can use the show all files toggle and then right click include in project to add missing source files to the project. 2. Make sure you aren't opening .cs files from the File Explorer. You should always open the .csproj (or .sln) file and then once Visual Studio is open, open your .cs source files from the Solution Explorer. If you don't, you'll notice that the top left area says Miscellaneous Files, meaning the file doesn't belong to a project. If you see Miscellaneous Files, check step 2 again. After fixing: 3. Make sure the Solution Explorer is in solution view and not folder view. 4. Make sure Visual Studio is at v17.8 or higher. . The current .NET SDK does not support targeting .NET 8.0. Either target .NET 7.0 or lower, or use a version of the .NET SDK that supports .NET 8.0 This means you need to update Visual Studio to v17.8 or higher. This is required as of May 1st, 2024, the v2024.03 stable release. . The SDK 'Microsoft.NET.Sdk' specified could not be found. This means you skipped installing the workload mentioned at the top of this page. If you are sure you did that, then another possibility is that the 32 bit dotnet SDK is taking priority on your computer's . Follow the instructions in to see if that applies to your situation and how to fix it. The project doesn't know how to run the profile with the name 'Terraria' and the command 'Executable' This means you skipped installing the workload mentioned at the top of this page. Error CS0246 The type or namespace name 'ReLogic' could not be found Make sure you are using the updated .csproj and this error will automatically fix itself. See to update your csproj. Error CS0246 The type or namespace name 'Mod' (or 'ModLoader', 'ModItem', etc) could not be found You have added a reference to the vanilla Terraria.exe, remove it and add a correct reference to the modded Terraria.exe. CS5001 Program does not contain a static 'Main' method suitable for an entry point Make sure \"Output type\" is set to \"Class Library\" in the project properties. References to other classes stopped working! (such as : ModItem, : ModProjectile etc.) Simply restart Visual Studio and it should fix itself. If it does not, you can attempt removing the .vs folder in your mod source root, then reloading the project. Failed to load pre compiled edit and continue dll System.IO.FileNotFoundException: Could not find file 'C: ... YYY.pdb'. This error occurs when the project wasn't created with the mod skeleton generator. To fix this error, go under your project's properties (right click the project under the Solution Explorer and click ), go to the tab, click the button and change the value of to . VS 2019 keeps opening instead of VS 2022 If you find that opening your file is opening VS 2019 when you have 2022 installed, the issue can be solved by updating the file. First, open up VS 2022, then use to open the directly. Next, open the panel and click on the line at the top. Click and then click . This will update the file that the is bound to. You can now close VS and try double clicking on the .csproj to verify that it opens VS 2022 now. Miscellaneous Determining issues from screenshots If you are helping someone online that is struggling to get Visual Studio to work, these visual clues will help identify their issues: Wrong Visual Studio Version The icon is an easy way to recognize if they are in the wrong Visual Studio version. Direct them to to download Visual Studio 2022. Wrong Program The guidelines in Visual Studio are a dotted line, Visual Studio Code has solid lines, and Notepad++ has dotted lines with very small dots. Also note how Notepad++ fails to do complete syntax highlighting. Direct them to to download Visual Studio 2022. Unsaved Changes All editors have a small mark in the editor tab indicating that a file has changes that are not saved. In Visual Studio and Notepad++, colors in the gutter area indicate lines that have not yet been saved. In VS, hollow gutter marks are unsaved edits or additions, while solid marks are recently saved changes. In Notepad++ orange lines are unsaved and green lines are saved changes. Even if changes are saved, the mod might not have been rebuilt. The easiest way to avoid these issues altogether is to always launch directly from Visual Studio rather than saving changes in the editor and then building the mod in game. This approach also has the added benefit of allowing hot reload and build and continue to work, greatly speeding up testing. Miscellaneous Files If you see \"Miscellaneous Files\" instead of the mod name, the user didn't open their and instead opened the file directly. Other clues include a lack of syntax highlighting for classes and method invocations. Direct them to ."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Developing-with-Visual-Studio-Code 使用VisualStudioCode开发.md","filename":"Developing-with-Visual-Studio-Code 使用VisualStudioCode开发.md","title":"Developing-with-Visual-Studio-Code 使用VisualStudioCode开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This guide does not cover , but Visual Studio Code. Visual Studio Code takes less space to store than Visual Studio. Visual Studio Code runs on Windows, Mac, and Linux. If you inexperienced in modding, have space on your computer and are on Windows, it is highly recommended to get Visual Studio instead. This guide is not meant to learn C fundamentals Prerequisites Installation 1. Download . 1. Install Visual Studio Code by running the downloaded installer. Allow the program to run and accept license agreements as you would normally do. The default options should be suitable. 1. Install the by downloading the installer, running it, and following the instructions. Download the installer for the latest SDK release labeled \"x64\" corresponding to your operating system. Don't download the .NET 6.0 or .NET 7.0 versions, those will not work. ( ) 1. Launch Visual Studio Code. 1. Install the C Dev Kit extension. 1. You should see something similar to the following: 1. Click the Extensions button: 1. Type into the search bar, click the \"C Dev Kit\" extension, then click the install button: 2. Optional . If you are an experienced user, IntelliCode for C Dev Kit will be a helpful extension. Install that as well if interested. However, if you are inexperienced, this will just cause confusion and is not recommended: 3. Wait for the installation to complete. The output window will show other extensions being downloaded and installed as it is packaged with C Dev Kit: Creating a Mod Follow the instructions in Open your Mod Source 1. It is very important that you installed the extensions mentioned above and .NET 8 SDK listed in . 1. Open Visual Studio Code 1. Click . If you don't see it, click . Navigate to if you're on Windows, or Navigate to if you're on Mac, and click : 1. You should now see various files available to edit. Open and you should be able to start writing code. 1. You can create new folders and files by right clicking in empty space in the Explorer pane: Build your Mod 1. Building your mod is easy. Just open from the Menu Bar: 2. Once the terminal is open, simply just type to build your mod. Enabling Hot Reload This feature is disabled by default. You will need to open settings and enable it. 1. Press on your keyboard to open settings, then click on the icon on the top right: 2. Inside the curly braces, add these lines: 3. Press to save. Hot Reloading should be enabled. Common Build Issues If you get an error relating to \"project.assets.json not found. Run a NuGet package restore to generate this file.\", then go to , run the command in the terminal that appears. Now you can run the build again with . If you get an error relating to \"System.IO.IOException: The process cannot access the file TutorialMod.tmod because it is being used by another process.\", you need to disable the mod in tModLoader and reload mods so that the file can be edited. Closing tModLoader completely is also an option when building. Why Use Visual Studio Code Please read the page. Most of the features apply to Visual Studio Code. If you aren't seeing errors being underlined or fixes being suggested, you might have skipped installing the . Debugging Debugging can be achieved by using VS Code's Run and Debug feature. 1. Click (or press ): 2. While having a related to the mod opened in the main editor, click button: 3. tModLoader should start while enabling your current state of your mod. You can add breakpoints from here and hot reload when necessary and if enabled: 4. To add breakpoints, simply click the red dot left of the line number as so: Issues Autocomplete, Error Reporting, or IntelliSense not working Assuming you followed every step in , the most common reason for this error is failing to open your mod's code correctly. Please follow the section. Failure to open your mod this way will make using Visual Studio Code counterproductive."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Home 主页.md","filename":"Home 主页.md","title":"Home 主页","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Looking for install instructions? (Steam and non steam) Welcome to the tModLoader wiki! This place serves as a center for guides related to tModLoader. These guides help to teach basic concepts regarding tModLoader modding and should prove as a useful resource to modders. Please feel free to contribute guides for topics not yet covered, but please refrain from editing well established guides without consulting the developers first. The documents classes and members of Terraria and the tModLoader API. It can be consulted to learn about specific methods and fields, but modders should start with the learning resources on this wiki and in ExampleMod. The documentation has separate pages corresponding to the various available versions of tModLoader. You can navigate through the pages through the links in one of the sidebars on the right. If you have suggestions, tips, or have found things such as spelling errors or grammar mistakes, please notify us in , or to suggest a change. A list of useful resources can be found . Below is a structured list of wiki pages that you can use to learn more about the API. If you wish to contribute, please view our beforehand. Informative pages These pages tend to describe certain files or folders. (Learn about how tModLoader is built) (How to publish and update your mod) (Among other things: how to license your mod, about tML's license) Getting started Learn tModLoader if you want to play mods Learn how to work with tModLoader to create mods Learn how to contribute to tModLoader Learn the basics of using tML Find fixes to common usage issues and bugs Start here if you want to make a mod. Learn how to setup a modded server Development These pages aim to aid you to learn how to develop mods properly, how to setup your developing environment, etc. Recommended, but Windows only. Lightweight, cross platform, lacks a few features. Cross platform. Learn how Visual Studio and other IDEs help modders make mods more easily. Debugging is how we find and fix errors and bugs. Contains info on code updates required for updating (aka porting) mods to each new tModLoader release. Easy guides These guides are easy and should be used if you are new to the tModLoader API. Their goal is to get you familiar with tModLoader and help you learn how to make various types of content. Intermediate guides The following guides are more advanced than the easy ones, but not advanced or expert level. : RecipeGroups, Custom Conditions, Shimmer, Ordering, Editing Accessing and Loading textures and shaders Advanced guides The following guides are considered advanced, and should only be attempted if the intermediate level is mastered. Accessing and modifying and members of tModLoader and other mods. Expert guides Expert level guides are not necessarily harder than advanced guides, but they more often cover a particular (difficult) subject. Expert guides should be followed if you are interested in learning about complicated topics or improving your mod's quality. Call, weakReferences, modReferences, recipes Patching the game using MonoMod Armor dyes and screen shaders Information about configuring and implementing new code fixes for tModLoader's custom code analyzer. Vanilla References Guides / Value References / Changes ItemID, ProjectileID, TileID, NPCID, TileID, WallID, BuffID, SoundID, etc. IDs / Names Class Documentation Other pages These are pages that we have so far failed to categorize or simply do not belong in one."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Learn-How-To-Debug 学习如何调试.md","filename":"Learn-How-To-Debug 学习如何调试.md","title":"Learn-How-To-Debug 学习如何调试","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is Debugging? Debugging is how modders investigate problems in their code in an attempt to fix them. The mod builds fine, but the mod does not behave as expected. Inevitably, something in your mod will not work as intended. When this happens, you'll need to \"debug\" the mod to determine where the issue is happening. Debugging can take many forms, this guide will focus on 3 approaches: , , and . This guide focuses on tModLoader modding. The official guide is a great resource for general C debugging and covers a few more conceptual topics as well as general C debugging. It is highly recommended that modders read that as well. Isolation Debugging The first step when encountering a bug is to isolate it as much as possible. Testing with a new world and new player can rule out many sources of issues. Additionally, other mods are a big source of unknown behaviors, the bug you are seeing could potentially be a feature or a conflict with one of them. Disable all other mods and make sure the bug still exists, if it does, that means the problem is in your code, which means you can fix it. If the bug does not exist, you'll need to figure out which mod is causing the issue by loading individual mods with your mod. If the bug happens with only one other mod, it might be a bug from that mod. Collaborating with that modder to fix the issue might be necessary. Once you know a bug is caused by your mod, you'll want to identify where the issue is coming from. The following sections will help you discover the issue. Text Debugging If you are not familiar with using a debugger like Visual Studio or just need to quickly visualize some data, then debugging via text can be useful. Do note that eventually you'll want to learn because it is quicker and more powerful. Text debugging, simply put, is printing text that you can read in an attempt to identify an issue. For example, if some math operation isn't giving the results you expect, printing the values out can help identify the issue. First, let's explore the text debugging methods available: Text Debugging Methods The following are typical approaches for text debugging in tModLoader. With all of these approaches, make a string from the data you want to output. For example, if you have a variable called , you might want to make a string and pass that into any of these methods. To learn more about creating a string from text and data, see this tutorial. Main.NewText This method outputs text to the in game chat window. This is simple and straightforward. The text will be easily visible and will disappear after some time. : Mod.Logger.Info This method outputs text to the . A client outputs to and the server process outputs to . This approach will persist the data, so it might be more useful to use this approach if you need to track something over time. : Console.WriteLine If you are familiar with programming, using for text debugging should be familiar with you. This approach, however, is not very useful for debugging mods. The console is hidden, so there is no way to see the text. Use one of the other approaches. CombatText.NewText This approach spawns floating text. The text quickly disappears, but because the text spawns at a specified location, it can be useful for situations where that is helpful. The method requires passing in a Rectangle for the location and a Color: : Dust.QuickDust, Dust.QuickBox, Dust.QuickDustLine Not text, but spawning dust at specific world coordinates can be useful for code dealing with world locations. Use this to verify in Projectile and NPC AI code. How to use Text Debugging Now that we know how to output text, lets go through an example. This exercise will help teach how to use Text Debugging. Consider the following code in a healing potion item similar to : The intent of this code is to heal the player 100 health plus 10 health for every Diamond Ring in the player's inventory, up to a max of 200 health total. At first glance, this code seem correct, but it actually always heals for 100 health because of bugs. Lets add some text debugging to identify the issues: This code results in the following output when the player is holding 5 Diamond Rings: For some reason the method is only counting up to 1. Lets look at the documentation for the method: It seems that there is a 2nd parameter called . We want to count up to 10, so lets fix this issue by changing that line to and try again: The value of is now correct, but is still incorrect. It seems that results in a value of when is ! This is not what we want. This is caused by , we can fix this by changing to . Lets do that fix and try again: It's all working correctly now. In this example we used text debugging to determine where bugs were happening. Using a similar approach, you should be able to locate logic errors in your mod's code. Text debugging is a useful tool, but can be quite tedious. Typing out code to output text to the chat isn't very efficient. Once you are familiar with the basic concept of debugging, you should advance to using as soon as possible. Clean Up Once text debugging has served it's purpose, remember to remove text debugging code from your mod. Nothing is more annoying for your users than seeing strange text appear in the chat during seemingly random circumstances. There are some situations where the text debugging code might be useful later. One approach is to use a to hide the code in the release build of the mod. With this approach, the code will be present when debugging from Visual Studio, but will not be present in the mod when built in game: Sometimes debug text can be useful if you are remotely helping a user of your mod diagnose an issue. Sending them a special build of the mod with the debug text can be useful, but another approach is to provide a config that toggles additional debug logging. For example, the mod uses to control if text will be logged. This toggle allows mods integrating with that mod a way to diagnose their code. Debugger Debugging In the Text Debugging section, we learned to output specific values to the chat to identify and fix a couple of bugs. That process is tedious because the modder needs to rebuild the mod each time they make a change. In this section we will learn to leverage the power of a debugger (Visual Studio) to debug our mods. This section assumes the modder is using and has correctly set it up, please consult that guide to follow those prerequisites. This section will cover the basics of debugging, it is highly recommended that modders familiar with these basics should further consult the official guide for more tips. There are a variety of additional techniques discussed there to greatly enhance the usefulness of debugging. Launching the Debugger First, make sure to open your mod's project in Visual Studio. Next, make sure tModLoader is closed. Also make sure that \"Debug\" is selected in the solution configuration drop down. Now click the button labeled \"Terraria\" or press F5: If you have errors, the Error List will appear, otherwise, the mod will build, be enabled automatically, and Terraria will start. (You may find that Full screen mode makes modding difficult, I suggest using Windowed mode while making mods.) If Visual Studio tells you that there are build errors and asks if you would like to launch anyway, say no! Fix the errors and try again. You'll know it is working if you see this: Go in game and prepare to trigger your bug. Debugging the Server You can debug the server process directly by selecting the \"Terraria Server\" launch target instead of \"Terraria\" in the dropdown. You can launch a client normally and connect to the server via as the ip address once the server loads the world. Breakpoint We need to pause the program to \"inspect\" the data. This is called \"break mode\". To do this, click in the \"line number margin\" on a line of code where you suspect a bug is happening. This will place a red dot. This red dot is a \"breakpoint\". The next time tModLoader runs that line of code, the game will enter break mode and you'll see a yellow arrow in visual studio overlapping that breakpoint. You will not be able to interact with the game while in break mode. The yellow arrow indicates which line of code will run next. In tModLoader, do whatever action is needed to trigger the line of code that has a breakpoint on it. (This could be shooting the weapon, killing an enemy, equipping an accessory, etc.) By pressing the keys, you can advance the state of the game by 1 line. This is called \"stepping through\" the code. Pressing or the green continue button will leave break mode and the game will resume. The game will run until it hits another breakpoint. Inspect Variables If the game isn't in break mode, repeat the steps to enter break mode near the code that has a bug. We will now \"inspect\" variables. To do this, simply hover the cursor over the variable. The guide talks more about this feature: It is important to remember that the yellow arrow indicates the next line to execute. In the image above, the value of is still because the line of code hasn't run yet. Pressing to advance one line, the value has now changed to , which is correct. By stepping through the code and inspecting variables, we can follow the logic and identify where errors are happening. The will quickly show all variables relevant to the current method. Pinning variables is another useful technique. Another useful feature is that the values of pinned variables and variables in the Locals or Autos windows will turn red after they are changed while stepping through code. Edit Code Once a bug has been identified, you can make edits to code even while debugging. When the file is saved, they should take effect immediately. To enable this feature, double check that the \"Hot Reload on File Save\" option is checked: Note that adding new methods and classes will likely require the game to be relaunched: Using \"Debugger Debugging\", you should be able to fix the same issue used as an example in the \"Text Debugging\" much more quickly. Fixing bugs quicker leaves you more time to make fun mods. Exception Debugging Debugging exceptions is something only possible while using the debugger. When an exception happens while debugging, the game will immediately enter break mode. In Visual Studio, the line responsible for the exception will appear. From there, you can inspect variables and try to identify the bug. If the exception happens in tModLoader code, you may see a blank screen because you do not have the source code available. In this case, look at the \"Stack Trace\" window and navigate to the lines from your mod that caused tModLoader code to throw an exception. The and sections on the official guide explain this concept in further depth. Exception Debugging Example Discovering the exact cause of errors: In this , we can easily diagnose where the error is happening. When the error happens in the game, Visual Studio is brought to the front and the line where the error occurs is highlighted. We can then hover over things and inspect their values. Here we notice that is null. Now we can fix the error, we can use to confirm that yes, we forgot to set to a value. You might notice the green underline under warning us that is never assigned. We should have paid attention! Now we can easily fix the error: View Decompiled tModLoader Code While debugging, we can use F10 to step over lines. Sometimes we need to look into a method to figure out an issue. F11 allows us to step into a method. By stepping into a method, we can see how and why an object might be changed. If that method is from tModLoader, we won't be able to step into it by default. We can enable a feature to allow stepping into decompiled code. To do this in Visual Studio, use the search (Ctrl Q) to search for \"decompile source\". Click on \"Automatically decompile to source when needed (Managed only)\", Scroll down to check the checkbox, and finally click \"OK\": From now on, you'll be able to step into tModLoader methods as you are debugging. It may take a bit of time for the decompilation to finish."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Useful-Resources 实用资源.md","filename":"Useful-Resources 实用资源.md","title":"Useful-Resources 实用资源","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following covers a list of useful resources, adapted from the . Feel free to add a new resource if you think it is useful to others, but please refrain from adding unuseful items. Sites tModloader Github wiki You are here This is an old wikipedia, used with tConfig This is an old documentation site, used with tAPI (WARNING: SSL SECURITY ISSUE) You can chat with developers and fellow modders on our Discord server. This is the best place for feedback, issues, collaboration, help, and interacting with the tModLoader community. and , which have occasional announcements, update posts, and mod showcases. Utilities/Other Extract images and sounds from Terraria. Useful for viewing various sprites. Add padding to multi block tile textures with this tool Ready to use sprites for Terraria tiles. Similar to TPadder but with more customization options Quickly create armor animation sprites with this tool (body/chestplate/shirt is broken since Tmod1.4 changed how the sprite sheet of it works) Quickly makes tile textures for ores. Allows for quick evaluation and debugging for armor, items, etc. against character models and other stuff. Unfortunately, much of this guide is broken due to broken links. This can be used to visualize and verify / saves External mod wikis Some popular mods have their own wikis. Use the links below to find information about them. Note: not all wikis are listed here, but a few popular ones. hosted on the Terraria mods wiki. Uncategorized Guides Note: tutorial [x] are likely outdated, it is recommended you use contents on this wiki instead [Tutorial: [1] Getting started with tModLoader](https://forums.terraria.org/index.php?threads/.44817/) [Tutorial: [2] Recipes](https://forums.terraria.org/index.php?threads/.44822/) [Tutorial: [3] Items](https://forums.terraria.org/index.php?threads/.44842/) [Tutorial: [4] Projectiles](https://forums.terraria.org/index.php?threads/.44857/) Youtube Tutorials Note that following youtube tutorials isn't recommended, because they are often outdated. Youtube content creators covering modded content"},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/Why-Use-an-IDE 为什么使用IDE开发.md","filename":"Why-Use-an-IDE 为什么使用IDE开发.md","title":"Why-Use-an-IDE 为什么使用IDE开发","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Why Use an IDE This page will hopefully convince you to abandon making mods in Notepad. Be sure to click the links below to watch the videos. All info presented corresponds to , but other IDEs such as and have similar functionality. Syntax Error Checking When you make a syntax error, you'll see red underlines under the bad code, similar to a spell check. You can hover over the error to see an explanation. Seeing the explanation above, we can fix the code easily by changing to just . Simple Misspellings Visual Studio can fix simple misspellings as well. https://github.com/tModLoader/tModLoader/assets/4522492/5bab82f0 84dd 4b7d 8623 68c70275e8a4 Show Potential Fixes Sometimes Visual Studio can guess how to fix your error. For example, below we forget to add to our ModItem class. Clicking or pressing the hotkey shows the following options. Clicking the first option adds the appropriate using statement to our code. We can fix errors without trying to build in game. https://github.com/tModLoader/tModLoader/assets/4522492/9055c84c fe13 4cb9 bf54 6a201cc5db31 Autocomplete / Intellisense Field names A common problem with new modders is that they don't know all the Terraria variable names or method names. For example, the various biomes/zones have names that aren't always what you might expect. You'll still need a little experience to know which class to look for these variables, but Intellisense helps immensely. In the video below, we see Intellisense suggesting the available Zones and downed bosses. Notice how Plantera being defeated is . This is why Intellisense is so valuable to a self sufficient modder. https://github.com/tModLoader/tModLoader/assets/4522492/8565bfed b085 416c 841a b5c409b0339c ItemIDs, NPCIDs, ProjectilesIDs, etc... While you can waste your time looking up various vanilla IDs in our , it is much easier to just let Autocomplete do the work for us! Simply start typing your guess for the ID name and you will quickly see suggestions. You can select a suggestion to autocomplete it. How nice is that? Method names and parameters Method names are also suggested in the same way. In addition, you can see the method parameters, both their names and types. For example, I'd like to add a buff to an enemy when I hit him with my sword. Typing will bring up the parameters, helping me complete my call to the AddBuff method. https://github.com/tModLoader/tModLoader/assets/4522492/df0ed4f6 80b2 4158 b440 178b2fbfa340 Override An extremely common task when making mods is to override various hooks such as or . Remembering the parameters to these hooks is sometimes hard to do. By using Visual Studio, you can easily write \"override\" followed by a space, followed by a few letters of the method you want to override, and then enter to easily override hooks. As a bonus, any missing using references will automatically be added to your code. Before: After: https://github.com/tModLoader/tModLoader/assets/4522492/2715244e b526 46b2 bfc9 1cdd82d15c46 Cross Mod By using the extract mod feature, (and optionally a documentation file if it exists) will be placed in . This file can be added as a dll reference to your .csproj if your mod has a strong or weak reference to another mod (you'll still need the build.txt entries). This path is consistent and accessible from the Mod Sources folder, meaning that the reference added to .csproj is portable for all contributors for your mod, provided they extract the referenced mod on their computer. By doing this, you can enjoy auto complete for the API provided by the mods you reference as well. Read more on that . Build You can build the mod from your IDE. In VS, find the menu to build the mod. Note that this is usually less useful than just debugging, but it can have some uses. Also note that attempting to build the mod while it is loaded in an open client won't work. Debug With an IDE, such as VS, you can debug your mod. Debugging is the best way to pinpoint issues in your mod and solve them. While debugging, you can set 'breakpoints' which will make the application 'stop' and pause itself when it gets to that point. During this pause you can inspect what is happening, by for example looking at the values of variables in scope. You can quickly resume the application, or step over code to try to find the cause of a problem. To learn more about debugging, see its . Edit And Continue With Edit And Continue (or eac) you can edit code after you've hit a breakpoint and see the effect of your edits in game immediately, rather than having to rebuild your mod manually. This is extremely useful for positioning projectile spawns or tweaking item defaults. Be sure to read in order to use this feature. Note that things like , , or other code might only run when the mod is loading, so they cannot benefit from eac. Simple Example In this video, we see 2 Example Gun spawned. After the first is spawned, a breakpoint is set in SetDefaults. Once it is hit, the game is paused and Visual Studio comes to the front. Then, is changed from 40 to 80. We press continue and we can hover over the 2 items and see that the second item was spawned with 80 damage. https://github.com/tModLoader/tModLoader/assets/4522492/34bba15f 23d0 4484 bee2 b8f5e8de8533 Another Example In the guide, an example is shown using a breakpoint to test values for : Documentation tModLoader will automatically provide documentation XMLdoc files, you can see documentation for a method when you hover it. This is the same info contained in the , just more easily accessible. For example, when the menu is active, clicking on an entry will show the documentation for that method where the purpose and potential usages of that method can be viewed: Hovering over an existing overridden method will also show the documentation: Hover over a method parameter to see details on what the parameter does: Hover over fields or methods to see details: Note that the amount and distribution of documentation is driven by modder feedback. If you find something that needs documentation, feel free to suggest it in the Discord chat. Documenting your own Mod Documenting your own mod can be useful, once the mod becomes complex. Try to document things that are important, but don't feel pressured to document everything, this is all for your own benefit (unless you intend for other mods to use these methods, see the next section). Writing readable code is better than documenting nonsensical code, after all. For more information on writing documentation, see . The easiest way to document a method is to type the line above a method, Visual Studio will autocomplete the template and you can type notes. Mod Documentation Modders making mods with API to be used by other mods can include files in their mod and they will be automatically extracted alongside their file and placed in for easy collaboration (provided is not true, which would be counter productive for a mod expecting to be referenced by other mods.). XMLdoc files for mods can be generated in Visual Studio during a regular build and should be named [ModName].xml and placed in the root of the mod's source folder. To have Visual Studio generate documentation, add the following to the section in your file: To edit the file, either right click on the project in Visual Studio and click or open the file directly in a text editor. You'll want to document any public methods and fields that you expect modders to use. To do this, type on the line above the field or method. This will cause Visual Studio to generate the documentation stub, after that add any information you want to the section. You can look at the to see what useful documentation should look like. If you find the \"Missing XML comment for publicly visible type or member X\" warning annoying, feel free to add to your file or add to the section along with the other new lines to ignore this warning. Whenever you update the documentation, remember to build from Visual Studio at least once before release to update the documentation file. To use documentation from other mods, simply follow the steps in the . If a file shows up in the folder, it included documentation. Remember that we suggest leaving the referenced files in the folder rather than copying them to your mod's source code folder, but if you do move the file make sure to copy over the file as well. Now, hover over any documented member as you normally would and you should see documentation show up if the mod author has documented that member. Many mods maintain documentation on their homepage or GitHub wiki, be sure to check those locations out if an documentation file is not included in the mod. Find All References (Ctrl K, R) Find all references makes it easy to locate all usages of a variable in your whole project. Simply right click on a variable and click . This is very useful to see where you assign and use your variables. https://github.com/tModLoader/tModLoader/assets/4522492/e37f0e9a 2bf7 4704 8e90 a5bf0a26d1ce Go To Definition (F12, Ctrl Left Mouse Click) By clicking on a variable or classname, you can press F12 (or Ctrl Left Mouse Click) and Visual Studio will bring you right to where that class or variable is declared. If you do this on a class not in your code, such as the Terraria class or the XNA class , you will be led to a page with just the variables and methods, not the actual code. It is very useful to be able to read the Terraria code directly. Follow the \"Go To Decompiled Code\" section below to enable navigating directly into decompiled code, allowing you to view that code as well. https://github.com/tModLoader/tModLoader/assets/4522492/a19265ee 8f0c 4e33 a1c0 554c3b6bab75 Go To Decompiled Code By default, the command will not allow you to see the tModLoader/Terraria source code. We can enable this feature to make modding much more productive. In Visual Studio, use the search (Ctrl Q) to search for \"decompile source\". Click on \"Enable navigation to decompiled sources\" and then check the checkbox and click \"OK\": From now on, you should be able to use the command to view decompiled Terraria code. Try it now by typing and use the command on . After a delay as Visual Studio decompiles tModLoader, you should see the code of the method: Rename (F2) Imagine you name a variable or class something stupid and want to change it. Without an IDE, you would have to manually check each file the variable is used in and edit the text. Even something like \"Find and Replace\" would be error prone if you use similar names for other variables. Using the Rename function, you can easily rename classes and variables. Be aware that if you are using methods like rather than , this won't work. This is also a great reason to use the < type methods for ItemType and NPCType, it is much easier to maintain. In the video, we rename a variable called to something better, . https://github.com/tModLoader/tModLoader/assets/4522492/88a34158 cbfc 4eb6 8f19 81d1eaa9cc79 Parameter Info (Ctrl Shift Space) Some Terraria methods have many many parameters. It can be hard to remember the order and types of those parameters. If you'd like to see the parameters of something like Item.NewItem or Projectile.NewProjectile, simply place your cursor inside the method and press . You can navigate left and right and watch the bold parameter change. Press up and down to switch between overloads of the same method. https://github.com/tModLoader/tModLoader/assets/4522492/61c8ca1e fe95 40c7 93f2 d8460edeb97a https://github.com/tModLoader/tModLoader/assets/4522492/571f8868 7094 4815 ad23 d0250dce15b5 Goto (Ctrl ,) An extremely useful shortcut, Goto allows you to quickly navigate to and class, method, or field in your code. Simply type and the Go to All window will pop up. Type the name or part of the name and select the item to quickly navigate to the code. You can also type the first letter of each word in a name to find it. For example, typing will suggest . Visual Studio will smartly handle misspellings and partial matches as well. The video shows just how quick this feature can be and how easy it is to quickly navigate to other places in your code. https://github.com/tModLoader/tModLoader/assets/4522492/24e0cb32 6c07 4635 9e90 f692dfc54534 Quick Actions and Refactorings (Ctrl .) This context sensitive hotkey is useful in several situations. The suggestions depend on where the cursor is or what text is selected. Here are some useful actions: Introduce Local for All Occurrences If you are repeating yourself a lot in your code accessing the same object via fields and methods, sometimes your code can get a bit repetitive. Making a local variable and re using that variable makes the code much cleaner. If you highlight the first occurrence of repeated object access, you can use this action to quickly introduce a local variable that you can then give an appropriate name to. https://github.com/tModLoader/tModLoader/assets/4522492/7f8be194 6862 4056 b91d 70e611320cab Format Document (Ctrl E, D or Edit Advanced Format Document) Properly formatted code is key for readability. Make sure to run this command before asking for help with your code as nothing is more annoying that poorly formatted code. https://github.com/tModLoader/tModLoader/assets/4522492/03e49732 da87 454f 8ab8 5b71c578f752 Structure Guide Lines Sometimes, especially in Projectile and NPC AI, you might get lost within your code. This is especially true with nested if statements. Hover over the dotted lines to quickly see where you currently are in your code. For example, here I easily see at a glance where in the logic of my AI I currently am. Code Folding Folding code by pressing the or buttons can be useful if you need a wider perspective on your code. Goto Brace (Ctrl ]) Using this hotkey is useful when navigating vanilla code with large blocks of code within braces. https://github.com/tModLoader/tModLoader/assets/4522492/86ea2d85 b84a 4e11 b4f3 427b222b4dad Launch Profiles Launch profiles can be setup to streamline mod development and testing. For example, a profile can be setup to launch the game directly into the world, skipping the player and world select menus. Launching the debugger directly into the game saves time and clicks. Other uses of launch profiles include testing specific mod packs and maintaining a mod specific save directory for organizational purposes. See to learn how to use this feature. C Interactive Did you know that in c is not ? Sometimes you might want to experiment with some c syntax, but don't want to make a mod just to test the code. The c interactive window is very useful for this. You can do whatever you want in the c interactive, each command will execute it after you press enter. can be used to bring up previous statements. https://github.com/tModLoader/tModLoader/assets/4522492/9e1f8d4f c000 47d5 bb8c 61e0b5b90276 Git integration Git integration allows you to interact with your GitHub repository directly within your IDE. You can view diffs and make commits directly within your IDE. We recommend finding guides on Google to learn more. Visual Studio Live Share This feature lets you invite someone into your project and collaboratively work on the code. Useful for mentoring other developers on your mod team or getting help on a tricky problem. Pair with Discord chat for voice chat."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/tModLoader-guide-for-contributors tModLoader贡献者指引.md","filename":"tModLoader-guide-for-contributors tModLoader贡献者指引.md","title":"tModLoader-guide-for-contributors tModLoader贡献者指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Installation If you still need to install tModLoader refer to the . IDE You will need an IDE (Integrated Development Environment) to help develop tModLoader. For Windows users, we recommend . A prevalent cross platform alternative would be Jetbrains' . Rider is free for non commercial use such as this project. Git If you've never used Git before, checkout our . If you ever come across something in this guide you don't recognize, just Google it. You should be easily able to find something relevant to your problem. You can also checkout . Further, if command line inherently scares you, additional tools such as and can provide most of the functionality you need in a user friendly interface. Code patcher tModLoader uses its own code patcher tool, which you will have to use if you want to contribute to tModLoader. We are required to use a patches system because we are not allowed to upload vanilla source code publicly. It also allows for relatively easy code maintenance. Getting the tModLoader code for the first time Note: The setup GUI (Graphical User Interface) is currently Windows only, use CLI (Command Line Interface) on other systems! 1. ; 2. Fork this repository, then clone your fork onto your PC. You HAVE to use Git for this, downloading source code as a zip file won't work; 3. GUI: Open in the root folder; CLI: Open a terminal in the root folder; 4. GUI: Click on 'Setup' (top left button); CLI: Run ; If asked, select your vanilla . If you want to work on the 1.4.3 or 1.3 version of tModLoader, you need and , or and . 5. When decompilation is complete, verify that you have these folders: (You will be primarily modifying files within this folder, through the patcher and file) 6. To open up the tModLoader workspace, navigate to and open with your IDE. Recommended contribution/development cycle Start: 1. Pull the branch. You HAVE to use Git for this, downloading source code as a zip file won't work; 2. Create a new Git branch for the feature you're developing (i.e. or ); 3. Run Setup ( ) or Regenerate Source ( ) in the development GUI/CLI; Develop: 1. Develop your contribution using and your IDE; Please follow the established when making changes. 2. ( ) the workspace you developed it for to turn your code into patches; Your workspace is 99% of the time. If it isn't, we imply you know what you're doing. 3. Create a new commit to commit the patches/ folder Before you push your commit, please check our . Thanks! 4. If the branch was modified by someone else pull the patches in Git and ( ) in setup to apply them to your code. 5. Repeat. Open the pull request: When you're done, PR your branch to , and not to , , or . If you're in need of early feedback you can and should open pull requests before they're done! They can be marked as drafts if needed. Testing your Code If you are testing bug fixes, simply debugging the configuration is all that is required. Adding examples to Example Mod As you add features to tModLoader, you'll want to add examples of using those features to Example Mod. The Example Mod examples should be straightforward and minimize unrelated effects. Examples should showcase at least the most common usage of the new feature, but a more advanced example can also be added if helpful. Comments should focus on what is unique about the added example. There is no need to comment code that the reader should already have a basic understanding of, such as and methods. The name of the example should hint at what can be learned from the example. There are rare cases where multiple classes in a single file is acceptable, but for the most part each class should be in it's own file with the same name. Sprites should be simple. You can reuse existing sprites directly (such as overriding ), make a sprite in the style of other Example Mod sprites, or even desaturate an existing Terraria sprite in an image editor and use that. Do not let are get in the way of making a pull request, there are plenty of contributors willing to help. You can always make a placeholder sprite for the pull request and we can help with that as the pull request is reviewed. Prior to v2025.01, the ExampleMod folder would need to have a symbolic link created in the ModSources folder to show up in the \"Develop Mods\" menu. This is no longer required and if you have this already it can be deleted if desired. You will, however, need to build ExampleMod at least once from before it will show up in game in the \"Develop Mods\" menu. To do this, click the startup item dropdown and select \"ExampleMod\", then debug or build the ExampleMod project as normal. Make sure it builds successfully as part of your testing before making a pull request. Before you're about to make a contribution, please check . Thanks in advance. Keeping your code up to date NOTE: it is wise that you backup your edits before pulling latest patches, if you have any that you haven't committed yet. Applying the latest patches will delete any of your work not included in them. Setup (do this if you're updating your code for the first time, it also requires that you have some kind of command line installed) 1. Open a Git Bash window or whatever in the tML folder 2. Enter 3. To ensure that it's been setup correctly, enter and you should see something like this: Actually pulling 1. Open up another shell window (if you want, enter to make sure everything's as it should be) 2. Enter 3. Then This will pull all the newest commits from branchtomerge into the branch that you have checked out You should verify that you now have the latest patches, located in patches/ 4. Open setup.bat in the root folder 5. Click on 'Regenerate Source' (bottom right corner) After this process you can open solutions/tModLoader.sln as usual with the updated code HELP! I accidentally committed on a wrong branch! Simply stash changes and checkout. 1. Open in git shell/bash or whatever 2. Run or (should default to save) 3. Run Replace xxxx by branch name Omit b if not creating a new branch 4. Run Acquiring a specific Terraria version TModLoader development no longer requires downloading specific Terraria versions, but if you need them for reference, then follow these steps: Download the utility. Head over to , pick and remember the depot (OS) you want, navigate to Manifests, select the branch in filters, and grab the manifest ID of the version you need. Run to download that version. Further online assistance If you would like to contact us or tModLoader users, it's best to join our . Discord is a chat and voice application."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/tModLoader-guide-for-developers tModLoader开发者指引.md","filename":"tModLoader-guide-for-developers tModLoader开发者指引.md","title":"tModLoader-guide-for-developers tModLoader开发者指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Installation If you still need to install tModLoader refer to the . Developing with tModLoader Before you begin, you will need two things, the \".NET 8 SDK\" and a suitable IDE. Once you have these installed, you should start with the . IDE Choose your favorite IDE to mod with tModLoader. Refer to the on the homepage. For the best mod making experience, using Visual Studio is highly recommended. Currently 2022 v17.8 or higher is required. .NET SDK Install the by downloading the installer, running it, and following the instructions. Download the installer for the latest SDK release labeled \"x64\" corresponding to your operating system. Don't download from links in the column labeled \"Binaries\". Don't download the .NET 9.0, .NET 7.0, or .NET 6.0 versions, those will not work. Click to view visual instructions To verify that you have the \".NET 8 SDK\" properly installed, you can open a new command prompt and type and press enter. If you see a result with a version starting with the number 8, it is installed. The folders shown should show the folder not the folder. If you see the 86 folder, that means you installed the 32 bit SDK by accident. You can uninstall it and then install the correct version OR install the correct version and so that the 64 bit SDK shows up instead. If tModLoader still complains that it can't find the SDK, you may need to restart your computer for the changes to take effect. I am new to modding If you are new to modding, it is recommended to start with . You can then move on to the . The following links might be useful for you: 1. 1. 2. tModLoader wiki (useful information and guides) you are here right now. 3. (requires a free Discord account) 4. 5. A mod showcasing and teaching various tModLoader mod capabilities 6. I am returning to modding If you made tModLoader mods previously and either want to update your outdated mod or make a new mod, there is a high chance that the tModLoader API has changed. Please read the for the versions you missed after reading the . Feel free to ask questions in Discord if you have any questions."},{"path":"螺线翻译tml教程/0-开始/原文件名顺序-方便查找原文对比/tModLoader-guide-for-players tModLoader玩家指引.md","filename":"tModLoader-guide-for-players tModLoader玩家指引.md","title":"tModLoader-guide-for-players tModLoader玩家指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Steam Installation To install on Steam, you need to own on Steam. Simply browse for on Steam and install it. The tModLoader installation will exist alongside the vanilla installation, allowing you to play both vanilla and modded without the hassle of reinstalling vanilla. Note that users using Family Share to install Terraria will need to follow the instructions below. By default, the current stable version of tModLoader will be installed by Steam. Currently the stable version is based on Terraria v1.4.4 content. Beta Branches tModLoader updates regularly. Most users will want to use the default release, but users can use the beta branches feature of Steam to switch to a legacy or preview version of tModLoader. Legacy versions of tModLoader are useful for playing a mod that hasn't been updated to the latest stable tModLoader. Preview versions of tModLoader are useful to test new features or to test new content added in a Terraria update that hasn't made it to stable yet. Note: If you are switching tModLoader versions to use a particular mod, be aware that other mods you enjoy might not be on the version you switch to, so you might not be able to use all the mods you want together. This is particularly true for preview versions of tModLoader. Here are the available options: This is the stable version that we expect players to use. It is currently based on Terraria 1.4.4.9 content. Users in the middle of a 1.4.3 playthrough should switch back to to . This is the latest 1.3 release. There are a few fondly remembered mods only available on 1.3 tModLoader. This is the latest 1.4.3 release. This is where many users currently playing the game should be, especially those waiting for mods to update to 1.4.4. This version contains upcoming changes. This is where we test new features. Users should be aware that playing through the game on a preview version is not recommended. To access 1.3 (Legacy tModLoader) and other Beta options Follow the instructions below to switch to a different version of tModLoader in Steam. If you are a GOG user or otherwise need to manually install a specific version, use the instructions instead. Video Instructions: If these video instructions are unclear, read the Written Instructions below. https://github.com/tModLoader/tModLoader/assets/4522492/4ac8e231 c409 48e9 a3e0 9024b78f2af1 Written Instructions: Go to Library: Find tModLoader: Right Click tModLoader: Click Properties to Open the Steam Game Control Panel Select Betas In the dropdown, select whichever beta you want Close the Prompt (no code required) How to uninstall? Simply right click tModLoader Manage Uninstall. Your vanilla install will be unharmed. Steam Family Share Installation For some reason, if you don't own Terraria and are instead using a family shared Terraria, tModLoader won't launch and will take you to the Steam store. This is a limitation on Steam's end, however workarounds exist for both 1.4.X and 1.3 versions Please note that these workarounds do not allow for Steam Multiplayer and thus you will need to use options for multiplayer On the 1.4.X version, the workaround is to install tModLoader following the Manual Installation instructions and launch it using the included in the files. Alternatively, if you are able to get Steam to download the files in the Steam Client, that also works in theory, but has seen varying success among users. You may also choose to setup this launch as a in your library to enable steam overlay in game. On the 1.3 version, a workaround is to install tModLoader through steam as normal and then copy the file from the Terraria install folder to the tModLoader install folder, replacing the existing file. Manual Installation This installation is necessary for players who have purchased Terraria from GOG or who otherwise want to install a particular version of tModLoader. These steps should be repeated each time you want to update tModLoader. Installing tModLoader is relatively easy. 1. Goto the page and download the tModLoader release you want. 1. : Visit and download 2. : Visit and download the file corresponding to your operating system 3. : Visit the and find the latest entry that mentions 1.4.3. Expand the section labeled \"Assets\" and click to download the \"tModLoader.zip\" file. 4. : The download for the preview version of tModLoader for can be found by visiting the . Find the most recent entry that has \"preview\" in the name. Expand the section labeled \"Assets\" and click to download the \"tModLoader.zip\" file. You'll need to regularly manually install new versions of 1.4.4 preview if you want to keep up to date with changes. 2. Unzip the contents of the zip you downloaded to a folder named either next to or nested inside the Terraria install folder. On 1.4, if the folder contains a 'Build' folder, you will need to remove this intermediate folder and bring the contents up one level. (GOG usually installs to , and Steam to . See to find the steam installation location if you customized it.) (If you are on Linux and own the game on GOG, the nested option inside is preferred) If you don't know how to unzip a zip file, get someone who knows how to use a computer to help you. Option 1, side by side (Recommended) : Option 2, nested : DO NOT install the tModLoader files directly into the Terraria folder. This option not supported for GOG on Mac. 3. [This step applies to 1.3 ONLY] Remove or Add the Steam files depending on which version of the game you own: 1. If you are using the GOG version of Terraria, delete the Steam file from the folder you just extracted tModLoader into (these files might already be deleted from the zip you downloaded): Windows: Linux: and Mac: 2. If you are using the Steam version of Terraria, if the Steam files are missing from the zip, copy them from your Terraria install to the tModLoader install: Copy the , then, depending on your platform: Windows: and Linux: , , , and Mac: and 5. [1.4 ONLY] GoG users will need to install Steam if they haven't already. Our Mod Browser uses some of the Steam install files to facilitate accessing the Steam Workshop. You should NOT need an account/be logged in for this to work. 1. Special Note for Linux: If your steam installation is not recognized (Error \"unable to access steam workshop\"), try uninstalling it and reinstalling Steam from the APT repositories via the terminal 2. If for some reason installing Steam is impossible on your system, tModLoader will still work but downloading mods in game will not. Mods will have to be manually installed. 6. [Linux/Mac only] Make , , and executable. You can do this in the file properties or by running the command in a terminal while in the destination install directory (do the same for the other 2 filenames). 7. Done. You can now make a desktop shortcut for tModLoader and launch tModLoader from that. (The file launches the game, that is what you could make a shortcut to.) Tip: Here is an easy way to find where your Terraria files are located: ( ) 1. Locate Terraria in your Steam game library, right click it and click 'Properties' 2. Browse to the 'Local Files' tab and click on the 'Browse local files...' button 3. You are now in your Terraria folder (this is where you should install tModLoader) Manual Installation Common Issues Windows 1.3 only: If the game doesn't launch at all, you might not have .NET 4.5 or XNA 4.0 installed. Download and run both installers: 1. 2. Linux/Mac: When launching from Steam, Steam shows the game launching and then the button goes right back to \"Play\": This is most likely caused by not making the files executable. Revisit step 6 of the above. How to uninstall? 1. Open Steam, go to your game library section and locate Terraria. 2. Let Steam for Terraria, this will reconfigure your game files to run vanilla. 4. Done. You can launch Terraria as usual. If you use GOG, simply delete the tModLoader folder you made before. Your worlds and players will be saved. Downgrade tModLoader 1.4 tModLoader updates every month. Sometimes a mod you are using fails to update in a timely manner and will cease to work with the latest tModLoader 1.4 release. Other times a rare bug affecting your setup might manifest that was not caught. You can manually downgrade if this is the case. To manually downgrade, find the latest release for the version you used to use on page and download it. It is a file. To easily find the latest release from the previous update, type \"stable\" into the search bar and press enter. This will filter out all the \"preview\" releases. Scroll down to find the release you need. For example, if you launch tModLoader and it recently updated to and it stopped working with an important mod, you can find the latest stable release and download it. After downloading, open up the tModLoader install directory and delete all the files. Make sure you are in the install folder and not the saves folder. To find the install directory, right click on tModLoader, click , then . This shows that process. After deleting the original files, you can take the files from the .zip you downloaded and put them in the install folder. This shows this process. Linux and Mac users will additionally need to make the files executable, see step 6 of the above. Once you know the outdated mod updated, you can delete all files in the install directory and use steam to verify game integrity to upgrade back to the current tModLoader release. To use 1.3, simply select in the tModLoader betas menu: Dual Install Have 1.3 and 1.4 tModLoader installed at the same time You can keep 1.3 and 1.4 tModLoader installed at the same time if you utilize Steams ability to add non Steam games. To do this, first switch to and make sure the download finished. Open the install folder and copy all the files. Go up one level and make a tModLoader13 folder. Go into the tModLoader13 folder and paste the files. In Steam, switch back to the default beta branch on tModLoader. Next, click on the menu and click . Click and navigate to the tModLoader13 folder, most likely this will be \"C: Program Files (x86) Steam steamapps common tModLoader13\". Click on \"tModLoader.exe\", click \"Open\", then click \"Add Selected Programs\". Finally, right click on the 2nd tModLoader entry in your library and click properties, then change \"tModLoader\" to \"tModLoader 1.3\" and close the window. Now you have the legacy tModLoader and the auto updating 1.4 tModLoader both in your library. Migrate Everything From 1.3 to 1.4 For the most part, the transition from 1.3 to 1.4 should be a clean start. The 2 are practically different games, and available mods won't match up. If you want to, however, you can migrate existing mods, worlds, and players. Mods Be aware the most of the mods you used on 1.3 might not be on 1.4. You can manually search for mods in the \"Download Mods\" menu, or you can use a modpack file to attempt to download all of them in one go. First, open up the 1.3 saves folder and find the enabled.json file in the Mods folder, this might be in . Open up 1.4 tModLoader, click , , and then click . Paste the enabled.json file that you copied earlier into this folder. Click and then to refresh the menu. You should see an entry for \"enabled\". Click then click . You'll most likely get a message that not all mods were found on the mod browser. If you do, simply click the download button on each mod in the listing. Players Use the in game menu to migrate players. Cloud players will not show up so you will have to switch to and take them off the cloud if you wish to copy them over. Worlds Use the in game menu to migrate worlds. Cloud worlds will not show up so you will have to switch to and take them off the cloud if you wish to copy them over. My worlds and characters disappeared when I installed! tModLoader DOES NOT use your vanilla world and player files. The in game should give you the option to copy over your original vanilla files. This option won't work for players and worlds you have used in Terraria 1.4. You do not have to worry about your vanilla saves being modified; they will be copied for modded gameplay use. When you go back to vanilla, you will see your original saves. tModLoader uses separate folders to store player (.plr) and world (.wld) files, mainly because it will store additional data for them. Your vanilla players and worlds will be stored in: (for Windows) in the Players and Worlds folders respectively. If the automatic copy doesn't work, copy the \"World\" and \"Player\" folders from to . How do I download and play mods? tModLoader comes with a mod browser. Refer to the to learn how to download and play mods. I have too little memory to run multiple mods! Terraria and 1.3 tModLoader are 32 bit applications. In short, this means they are only capable of utilizing up to 4 GiB of RAM. With a lot of mods, you may run out of memory. The solution is using less mods, unfortunately. Alternatively, you can try using the unofficial 64 bit version of 1.3 tModLoader. 1.4 tModLoader is 64 bit by default, which alleviates this problem. I use macOS Catalina. What do I do? If you experience any problems, try using the 64 bit version of tModLoader or talk to us on Discord. How Do I Use Mod Packs in 1.4? 1.4 tModLoader significantly overhauls the Mod Pack feature to provide several additional functionalities. To start with, save your Enabled Mods as usual. The UI will now show a lot of buttons. Let's walkthrough them. First and foremost, I will use two different terms moving forward: A mod pack will refer to a frozen copy of mods that don't update with time. A mod collection will refer to a list of mods that are always the latest. The first 2 buttons operate on the 'Mod Collection' style. Enable Only this List disables all mods, and than loads only those defined in the collection Enable this List loads mods defined in the collection on top of any existing loaded mods. Useful for stacking collections View List & View Mods in Mod Browser allow you to see what the mods in the pack/collection are, and download them freshly on the mod browser for yourself. Update List with Enabled Updates the mod pack or collection with the currently enabled set of mods. Will delete or add to the collection/pack as required Import Pack (Local) Tells tModLoader to check the mod pack for the frozen set of mods to load. Any mods loaded from the Pack, while active, will override any existing mods you have downloaded. When a Mod Pack is active, it will shows as such in the Top Right Corner. Remove Pack (Local) Undoes the changes made by Import Pack (Local) Export Pack Instance Exports a copy of the ModConfigs and /Mods folder to InstallDirectory/ so that you can either setup a second instance of tModLoader with an older version OR quickly setup a server with the pack. Check InstallDirectory/ /SaveData/Mods for an install.txt file listing all the workshop publish ids and a tmlversion.txt labelling the tml version to use. Delete Instance Deletes the exported instance files created by Export Pack Instance"},{"path":"螺线翻译tml教程/1-基础/0-Basic-Prerequisites 基础-先决条件.md","filename":"0-Basic-Prerequisites 基础-先决条件.md","title":"0-Basic-Prerequisites 基础-先决条件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"基础 先决条件 在阅读任何任何基础级教程之前，请先阅读以下内容以确保你对基础概念有所准备 语法 基础教程并不要求太大量的语法知识，但是它们需要对C 语法的基本理解 请阅读并内化以下内容 文本编辑器 另一样你需要的是文本编辑器.你的操作系统自带了一个，但是我们有更好的选择 以下是一些更加强大的文本编辑器(对于 Windows, Linux 和 Mac) 仅Windows 为什么我们需要一个好的文本编辑器 一个好的文本编辑器可以打开多个文件，提供语法高亮和关键词支持，还能显示行数 此外，这些编辑器中的大多数（如果不是全部的话）都提供可扩展的设置和键盘快捷键(有些还能添加插件) 所有这些功能都会让模组开发过程简单得多。 以下是Notepad++与记事本的对比，表明Notepad++比记事本有多么适合开发： 那关于Visual Studio或者其它的集成开发环境(IDE)呢？ 你也许听说过Visual Studio, 我们后续会在 中讨论IDE。 如果你对编程很熟悉，或者对自己有信息，可以跳过文本编辑器阶段直接进入IDE阶段 绘图程序 最后一样你需要的东西是图片编辑器 我们会在这个程序里制作所有我们要用到的贴图 微软绘图(Windows 11 之前的版本)是 无法 制作我们需要的图片的 因为它不能保存透明像素 以下是模组开发者最常用的一些程序 Krita 是一款免费开源的软件，能够制作像素精灵图的光栅图形编辑器，如 所示 免费开源跨平台图像编辑器，提供几乎所有东西的支持，但是它的初始配置是比较复杂的，可以参考这个 免费开源矢量图编辑器，可以参考 非常强大，但是比较昂贵而且不是为像素精灵图设计 免费而且在精灵图画师中较为著名 开源，这意味着它是免费的，但是你需要自己编译因为他们不提供免费发行版。 你也可以在Steam上购买这款软件，点击 Aseprite 是专为像素艺术设计的，使用起来相当简单直观。 制作一个简单的模组 现在你作好准备了, 请访问 ，然后跟随这篇教程中的每一步，在尝试任何其它基础级指引之前"},{"path":"螺线翻译tml教程/1-基础/1-Basic-Item 基础-物品.md","filename":"1-Basic-Item 基础-物品.md","title":"1-Basic-Item 基础-物品","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4.4. If you need to view the old 1.3 version of this wiki page, click Basic Item This guide serves to explain common things shared among all items. What is an Item? It is important to be aware of the distinction between Items, Projectiles, and Tiles. Starting out, you may inadvertently confuse concepts if you aren't clear how they are different. For example, some people might get confused and try to add a workbench item to a recipe when really they wanted to add the workbench tile. It is also important to realize that many something like a boomerang weapon consists of both the item and the projectile. While a simple concept, try to remember. Making an Item To add an item to Terraria, we must first create a \"class\" that \"inherits\" from ModItem. To do so, make a .cs file in your mod's source directory ( ) and then open that file in your text editor. Paste the following into that file, replacing with the internal name of your item and with your mod's foldername/namespace. (A common mistake is to use apostrophes or spaces in internal names, don't do this, the computer won't understand.) Now that you have a file, bring in your texture file (a image file that you have made) and put it in the folder with this file. Make sure read so you know how to satisfy what the computer expects for its filename and folder structure. SetDefaults The most important part of an Item is the . is where you set values for the item, things like what ammo does the item use, how big is the item, and which tile the item places. See to see what values commonly set in mean. You can also view vanilla item values by visiting . Many examples of different items can be found in Localization After you build your mod, the localization file, typically found in , will be populated with entries for the newly added items. For items you'll see entries for the and the . The will default to the with capital letters separating the words. The will default to nothing. You can edit this file to customize these localizations: If you want a tooltip with multiple lines, please read to learn the correct syntax."},{"path":"螺线翻译tml教程/1-基础/10-Basic-NPC-Spawning 基础-NPC生成.md","filename":"10-Basic-NPC-Spawning 基础-NPC生成.md","title":"10-Basic-NPC-Spawning 基础-NPC生成","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic NPC Spawning This guide will teach the basics of spawning enemies. Basic Ideas There are a few ideas you need to understand first: Balance It is hard to guess a good value for the return of ModNPC.SpawnChance. We don't want our NPC spawning too often compared to vanilla NPC. Usually a value of 0.1f or something smaller is good, but you should use NPC Spawn Tool to compare your NPC's spawn rate to vanilla and other Mod's NPCs. Terraria Spawning Terraria spawns NPC by first deciding on a position to spawn the NPC, and then asking each NPC if they would like to spawn at that position. Each time Terraria decides to spawn an NPC, it will be in conjunction with a Player object (NPCSpawnInfo.Player). In Multiplayer, the server handles all spawning decisions. If you make a custom biome in your mod and notice that spawning doesn't work correctly in multiplayer, your ModPlayer.SendCustomBiomes and related hooks need to be implemented correctly so the server knows the correct values of the custom biome booleans, so that it can make the correct decisions. Return values The ModNPC.SpawnChance hook returns a float. Google that if you don't understand. The ModNPC.CanTownNPCSpawn hook returns a bool. ModNPC.SpawnChance This is the main focus of this guide. All naturally spawning non boss, non townNPC ModNPC classes should override this hook: ModNPC.CanTownNPCSpawn Only for townNPC ModNPC. Note that this class returns a bool not a float. Use this to let your townNPC spawn after certain conditions, such as defeating bosses, have been met. Conditionals (if else) Spawning NPC boils down to making a decision whether or not to spawn our ModNPC. Read up on if else . Not Operator (!) Read up . if(Main.dayTime) // if day time if(!Main.dayTime) // if night time And and OR (&& and ||) Read up on and . Note that && has higher precedence than ||. We will use this to combine conditions. = vs == Don't mix these two up. assigns a value to a variable and compares two values. Make sure to never do things like or you'll be confused why your world is suddenly in hard mode. Ternary A more compact version of an if else conditional is a ternary. Read up on it . Basically it changes: To this: return condition ? .1f : 0f; NPCSpawnInfo NPCSpawnInfo is a struct that contains all the info pertaining to the spawn position that Terraria wishes to spawn an NPC. See for the fields. We will use the values from this struct to guide our logic and arrive at a final decision. Player Biomes Use the Player object passed in inside NPCSpawnInfo rather than Main.LocalPlayer to use player biomes in spawn logic. Heights When worlds are generated, a few values are saved with the world to specify various heights. Main.worldSurface is a few tiles below spawn, and Main.rockLayer is below that where rock becomes more prevalent than dirt. Main.maxTilesY is the max value for Y in the world, the lowest point. We can use these values and math to drive our spawn conditions. We can also use predefined Zones as seen in the image below rather than messing with math. On the right side of the image we see the Zones that are predefined for us, and on the left we see the math that drives those zones. For example, the following are equivalent: We can use simple math to make more precise Height based spawn conditions. For example could be used to specify a spawn condition of the lower half of the ZoneRockLayerHeight as seen above. The predefined height based zones are easy to use, but remember that you can use math for more specific behavior. Also remember that the Y coordinates start at 0 in the sky and increase in value as you go down in the world. Do not be fooled by WorldGen.lavaLine, WorldGen.waterLine, WorldGen.worldSurfaceHigh, and other values not mentioned here, they are not saved in the world file and will not be applicable to NPC spawning. Lateral Positions Some enemies rarely use X position for spawn chance. For example Goblin Scout and King Slime only spawn on the edges of the world. can be used in logic to accomplish this. For example, internally uses the following logic to only spawn in the far left and right sixths of the map: Other Values In addition to NPCSpawnInfo, we can also use other fields in our SpawnChance logic: true during the day, false at night and true if the named boss has been defeated in this world true if in hard mode true if in expert mode A value between 0 (4:30 AM) and 54000 (7:30 PM) during the day and between 0 (7:30 PM) and 32400 (4:30 AM) during the night. Use with . usually increments by 1 each tick. Each in game hour is 3600 ticks. Example: Morning between 4:30 AM and 9:30 AM (because 18000/3600 == 5) The method can be used to simplify world time based spawn conditions. Example: Before 6:00 AM true if currently raining true if any Ice Golem is in the world. Use with ! to prevent duplicate spawns of mini bosses. or same, but for modded NPC true if less than 2 of the NPC exist in the world true if the spawn tile is any type of sand tile. There are other sets in TileID.Sets.Conversion that might be useful true if spawn tile is on one of the outer thirds of the map the wave number during an event Need More? Ask for help from us on Discord and we can add more to this list. SpawnCondition is a class that contains a set of ready to use fields that mimic the logic of various Vanilla NPC spawn conditions. See for available s. Using fields can simplify you logic. For example, a daytime slime can easily be implemented like this: as opposed to Examples Each of the following examples will be as if they were inside a ModNPC.SpawnChance method: public override float SpawnChance(NPCSpawnInfo spawnInfo) { // Example Code Here } Spawn on my ModTile return spawnInfo.spawnTileType == mod.TileType () ? .1f : 0f; Spawn if player in custom Biome/Zone return spawnInfo.Player.GetModPlayer ().ZoneCrystal ? .1f : 0f; Spawn in Jungle Temple return spawnInfo.spawnTileType == TileID.LihzahrdBrick && spawnInfo.lihzahrd ? .1f : 0f; // or return SpawnCondition.JungleTemple.Chance 0.1f; Spawn during Solar Eclipse return spawnInfo.spawnTileY <= Main.worldSurface && Main.dayTime && Main.eclipse // or return SpawnCondition.SolarEclipse.Chance 0.05f; // Remember to test this value for balance Player standing on Sunplate tile // Here I show off 2 ways of converting a boolean to an int. (False is 0, True is 1) return (Main.tile[spawnInfo.playerFloorX, spawnInfo.PlayerFloorY].type == TileID.Sunplate).ToInt() 0.2f; // or return Convert.ToInt32(Main.tile[spawnInfo.PlayerFloorX, spawnInfo.PlayerFloorY].type == TileID.Sunplate) 0.2f; // using System; Combining Snippets Just like in Examples above, we combine pieces of logic to construct our final decision. See !, &&, and || above. Combining bool and float The SpawnCondition fields return float values representing chance while a lot of other conditions are simply bools. This can lead to some tricky code. Lets try to put together code for an NPC that should spawn in spider caves but only at night. We can use SpawnCondition.SpiderCave and Main.dayTime for this. Easy Syntax If you don't know c very well, just separate the bools and floats. Use the bools in an if statement using !, &&, and || if needed and then if we pass those conditions, use the in the return. If the conditions fail, the code will return 0 meaning the NPC will not spawn: Moderate Syntax Using the Ternary we learned above, we can make our spawn condition logic more compact. Complicated Syntax If you find that your logic makes more sense if you interpret bools as 0 and 1 when false and true respectively, you can do that. This approach isn't really that common, but could be useful: Common Errors Why is my world in HardMode suddenly? Many new programmers confuse and . assigns a value to a variable and compares values. If you do you are assigning true to hardMode, essentially progressing the world straight into hardmode, not what you want. Make sure to do or better yet, . CS0161 '[ClassName].SpawnChance(NPCSpawnInfo)': not all code paths return a value This means your code has a chance to not return a value. For example. if (spawnInfo.granite) return 0.2f; would need to be fixed like this: if (spawnInfo.granite) return 0.2f; return 0f; CS0029 Cannot implicitly convert type 'bool' to 'float' This means you probably forgot to use your logic to decide on a value to return. See above. Relevant References Not covered in Basic level ModNPC.CheckConditions Custom TownNPC House conditions (like Truffle) Mod Boss Booleans See ExampleMod for proper syncing and usage Using ModNPC.SpawnNPC Manipulating NPC at spawn GlobalNPC.EditSpawnRate Manipulate max spawns and spawn rate (Water Candle) GlobalNPC.EditSpawnRange GlobalNPC.EditSpawnPool Manipulate Spawn Pool after populated with choices GlobalNPC.SpawnNPC"},{"path":"螺线翻译tml教程/1-基础/11-Basic-Tile 基础-物块.md","filename":"11-Basic-Tile 基础-物块.md","title":"11-Basic-Tile 基础-物块","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4.4. If you need to view the old 1.3 version of this wiki page, click . The 1.4 version can be found Basic Tile This guide serves to explain the basics of Tiles. What is a Tile? It is important to clearly understand tiles in your mind. Starting out, you might confuse or conflate tiles and items. Items are things in your inventory. Tiles are blocks in the world. Many items in the game place tiles, but aside from the item placing the tile and the tile returning the item, there is no enforced connection between an item and the tile it places. That said, most tiles modders will add will have 1 or many corresponding items. Confusingly, tiles exist alongside walls and wires in the struct. Every tile coordinate in the game world corresponds to a struct. contains all of those s. Keep in mind if you work with the struct directly that they contain more than just the tile data. If you are curious about the struct itself, or need to directly work with it, please see Tile Item Pairing An Item will place a specific Tile when is set to the of the . If a Tile has multiple styles, setting allows you to specify that style. See for more details. The will return the when mined as well. This process is automated, but can be customized for special tiles if needed. Modders can use to manually register drops for specific styles. can be used for full control of the drops. can be used to query the item drop from a tile type and tile style. is an example of a tile that uses custom styles, so custom item drop code is used. Basic tile placing item code Items that place tiles are usually very simple. The following is about all that is needed. Adding a is a typical additional section of code added to a tile placing item. Making a Tile To add a tile to Terraria, we must first create a \"class\" that \"inherits\" from . To do so, make a .cs file in your mod's source directory ( ) and then open that file in your text editor. Paste the following into that file, replacing with the internal name of your tile and with your mod's foldername/namespace. (A common mistake is to use apostrophes or spaces in internal names, don't do this, the computer won't understand.) Now that you have a .cs file, bring in your texture file (a .png image file that you have made) and put it in the folder with this .cs file. Make sure read so you know how to satisfy what the computer expects for its filename and folder structure. Framed vs FrameImportant Tiles There are 2 different types of Tiles. One type is the regular tiles that are 1x1 (width of 1, height of 1) and adjust themselves as you place similar tiles next to them. These will be referred to as \"Framed\" tiles in this guide, but are also known as \"Terrain\" tiles. The other type are the tiles that do not change automatically, which we will call \"FrameImportant\" tiles. These tiles are usually larger than 1x1 so another name for them could be \"MultiTiles\". \"Furniture\" tiles is also another name for these tiles. Here is an example of the sprite of a Framed tile: Here is an example of the sprite of a FrameImportant tile: Not all 1x1 tiles are Framed tiles, here is an example of a 1x1 FrameImportant tile. If you recall, this tile doesn't change when placed next to other tiles like Framed tiles do: As you might have noticed, FrameImportant tiles can have multiple unique tile \"styles\". You might have also noticed some empty space in the spritesheets, this is padding. These concepts will be explored later. Coordinates Tile coordinates are 1/16th the size of World coordinates. Remember this if you ever need to do anything involving Tiles and anything else such as NPC, Player, or Projectile. See the to learn more. Padding When making a sprite, it is important to adhere to the proper dimensions expected. For the most part, every individual tile will be 16x16 pixels with 2 pixels of padding to the right and below each, for a total of 18x18. If you need help padding a sprite, you can use an external tool called . SetStaticDefaults Now that we've gone through some preliminary info, lets focus on and what to put in it. This section will explain most of the common items in . The further expands on these settings as well as many other more specialized settings not covered in this guide. The point of is to define how the tile acts, such as is it solid, can things stand on it, and does lava kill it. Consulting similar tiles that you wish to emulate in ExampleMod is probably better than trying to do this from scratch. Many of the lines below set something to true, this means the default value is false. Don't bother including lines setting the value to the default, it just clutters your code. It is useful to reference to use as a guide when creating your own , especially when learning. Find the that is closest to what you need and copy the code and then modify it if needed. For this guide, many gifs will refer to this tile sprite: MinPick controls the minimum pickaxe power that a pickaxe needs to break a tile. For example, setting to 50 for a tile will mean a pickaxe needs a pickaxe power higher than 50% to break it. defaults to 0, so any pickaxe can break the tile. Very few vanilla tiles use as it is often set for progression reasons, for example, Lihzahrd Brick has a of 210 to stop people breaking into the Jungle Temple early. For vanilla pickaxe powers, see the vanilla wiki: , , . MineResist controls how hard the tile is to mine by making it have more hitpoints, which normally would be 100 hitpoints. is a multiplier, so a of 2f will double the hitpoints of a tile to 200, and a of 0.5f will half it to 50. defaults to 1f, so the hitpoints of your tile stay at 100. is often set on tiles that also set a value. For vanilla values, see the table below or the . | Tile | MineResist | | | | | Default | 1f | | Dirt, Sand, Clay, Mud, Silt, Ash, Snow, Slush, Hardened Sand Block | 0.5f | | Spikes & Wooden Spikes | 0.5f | | Ebonstone, Crimstone, Pearlstone, & Dungeon Bricks | 2f | | Cobalt & Palladium | 2f | | Mythril & Orichalcum | 3f | | Tombstones | 3f normally, 4f on a For The Worthy world | | Adamantite & Titanium | 4f | | Lihzahrd Brick | 4f | | Chlorophyte | 5f | Main.tileSolid[Type] = true; Setting this to true means the tile will be solid. Projectiles will collide with it and NPC and Players can stand on it. | (default) | | | | | | | | Main.tileSolidTop[Type] = true; Many tiles, such as placed bars, tables, anvils, etc. can be stood on but aren't solid. These tiles all set this value. : Main.tileTable[Type] = true; Some tiles, such as bottles, can only be placed on \"tables\". Be sure to set this for flat topped furniture tiles. | (default) | | | | | | | | Main.tileMergeDirt[Type] = true; This terrain tile will merge with dirt using the extra sprites provided in the spritesheet. | (default) | | | | | | | | Main.tileSpelunker[Type] = true; Main.tileShine[Type] = true; Main.tileShine2[Type] = true; Main.tileValue[Type] = true; These are related to Metal Detector and ore shining. See Main.tileBlockLight[Type] = true; If set to , light is blocked by this tile and the light will decrease as it passes through. Main.tileLighted[Type] = true; If , then the tile produces light. You can set the light color for tile using the hook. Main.tileLavaDeath[Type] = true; Set to if you'd like your tile to die if hit by lava. Main.tileWaterDeath[Type] = true; Set to if you'd like your tile to die if hit by water. Main.tileNoAttach[Type] = true; Prevents tiles from attaching to this tile. | (default) | | | | | | | | Main.tileCut[Type] = true; The tile can be destroyed by weapons. Main.tileLargeFrames[Type] = 1 or 2; See below. Other These are more rarely used and won't be explained in this guide. See the or vanilla source code if you need hints with these. Main.tileBouncy[Type] = true; Main.tileAlch[Type] = true; Main.tileStone[Type] = true; Main.tileAxe[Type] = true; Main.tileHammer[Type] = true; Main.tileNoSunLight[Type] = true; Main.tileDungeon[Type] = true; Main.tileRope[Type] = true; Main.tileBrick[Type] = true; Main.tileMoss[Type] = true; Main.tileNoFail[Type] = true; Main.tileObsidianKill[Type] = true; Main.tilePile[Type] = true; Main.tileBlendAll[Type] = true; Main.tileGlowMask[Type] = true; Main.tileContainer[Type] = true; Main.tileSign[Type] = true; Main.tileMerge[Type][otherType] = true; Main.tileSand[Type] = true; Main.tileFlame[Type] = true; Main.tileFrame[Type] = true; Main.tileFrameCounter[Type] = true; Main.tileFrameImportant[Type] = true; This indicates that a tile is a FrameImportant tile. The frame important part of the name suggest that the frame is important, but what is frame? Frame is the coordinates within the spritesheet that the current tile should draw. For Framed tiles, the frame is never saved since the coordinate frame of a Framed tile is calculated when the world is loaded. For FrameImportant tiles, the world needs to save those coordinates, hence, \"important\". For modders, just remember to set this to when you make a tile that uses a , or basically all tiles that aren't like dirt, ores, or other basic building tiles. See below for details. ModTile properties: DustType, AdjTiles, etc These are explained in the . You will need to expand the \"Properties inherited from \" section to see inherited properties such as and . AddToArray(ref TileID.Sets.RoomNeeds.????); Used to make a ModTile act as a lightsource, chair or table for the purposes of housing. Some examples: AddMapEntry is for setting the color and optional text associated with the Tile when viewed on the map. Explore and the documentation for more info. Terrain or Framed Tiles Terrain tiles make up the majority of the world, like Dirt, Sand, Wood, Stone, etc. The vast majority of framed tiles are solid and will set . These tiles are known as \"framed\" tiles because the game will automatically adjust which frame of the spritesheet to use based on nearby tiles. For example, some frames correspond to a lone tile and another might correspond to a tile with a tile above and a tile below. In this diagram we can see how several frames appear in game when placed. Template Here are a couple templates to use. The colors in these templates correspond to the variations explained later in this guide. The first template does not merge with dirt while the other does and sets . Template 1: Template 2: Other or can also be used as a template. Variation By default the game will automatically randomize between 3 different options when a tile is placed. This is the value. This will require more art work to be done to create a working spritesheet, but the variation makes the tile look more natural. In this example each color belongs to a different variation, notice how they are randomly used. Custom Framing It is possible to customize the tile framing logic to merge with other tiles, have completely custom framing logic, and adjust the tile variation. shows how to implement merging correctly with other non dirt terrain tiles. Custom Tile Variation The random variation is not always suitable for the desired look of a tile. Some tiles, like Lunar Rust Brick and Smooth Marble Block have custom tile variation code to instead present a consistent pattern. shows a custom tile variation pattern that alternates row by row. or 2x2 tiled pattern Lunar Rust Brick has lines that are intended to connect to each other, it sets to use a custom tile variation pattern that forces tile variations to repeat in a tiled 2x2 pattern. This pattern uses 4 variations instead of 3, so the tilesheet has a 2nd set of sprites to contain the 4th variation. The 5th and 6th variations are not actually used and are duplicates of the 4th option. or 3x4 tiles pattern Smooth Marble Block has a large tiled 3x4 pattern, it sets to use this tile variation pattern. Again the 5th and 6th variations aren't used and are just duplicated in the spritesheet for simplicity. Animation Terrain tiles that animate duplicate the whole spritesheet 1 or more times vertically. shows the code needed and shows how the spritesheet is expected to be laid out. TileObjectData or FrameImportant/MultiTiles If a is not a Framed tile, it must have and the in . FrameImportant tiles can be any size, from 1x1 to anything bigger. They can also have many different \"styles\". Each style can also have \"alternates\" which are alternate placements of the particular style. For this guide, many gifs will refer to this tile sprite: Multiple Styles You can take advantage of tile styles to simplify your code and avoid code repetition. Using this, you can have 1 file that places several styles. Each item that places this tile will have the same but will have different to differentiate which style to place. The method will set all the required properties for a tile placing item and will assign and as well. Tile style specific code can be added to various methods as well to customize the behavior of specific tile styles. , for example, has different liquid placement properties, light color, and hover icon for the 2 styles of the tile. See , and below for more information on how tile styles are organized in the spritesheet. Basic TileObjectData.newTile structure In we use to define properties of our tile. There are a few approaches to doing this. We can copy from a template, copy from an existing tile, or create a from scratch. Copying from a template or an existing tile can greatly simplify code and is suitable for inheriting common furniture settings. For example copying from creates a typical 2x2 tile that can be placed on the ground and is immune to lava. Sometimes, however, we might inherit unexpected behaviors. For example creates a 4x2 tile, but that tile is setup to have left and right placements. This is useful for beds, but might not be what is expected. Using can be convenient for common furniture types, but sometimes it is easier to just make the directly. This is especially true for tiles with dimensions not represented in the existing templates. Some existing templates might have behaviors that are unexpected, such as lava immunity or left and right placements, so doing it directly ensures that the tile behaves exactly as intended. These approaches are explored more in the sections below. The basic structure of setting up a is as follows: The most important thing to remember is that must be last and must be first if used. Doing this out of order will lead to errors. TileObjectData from scratch To create a directly, follow the template below. Adjust values according to your desired width and height and then make whatever other adjustments are needed for your desired behavior. CopyFrom Terraria includes several existing templates to use as a base. If one of these templates match the desired behavior, you can use to easily setup the for your tile. The names are self explanatory usually. Existing Templates include: Typically, you'll want to start out by copying a template, and modifying it as needed. For example, first does: ....and then it makes adjustments such as: ....and finally calls: CopyFrom TileID We can copy from a specific existing tile rather than copy from one of the templates. Copying from an existing tile means copying even more specific behaviors. For example, copying from would result in a typical 1x2 tile, but copying from would result in a 1x2 tile that has a left and right placement style. Note that when using , tile style specific behaviors such as how some obsidian furniture is lava proof won't be copied. The method would additionally copy the style specific information. Width Modifies the width of the tiles in tile coordinates: Note that if you are modifying , you'll most likely need to modify in a later statement as well. Height Modifies the height of the tiles in tile coordinates: Note that if you are modifying , you'll most likely need to modify in a later statement as well. Origin Modifies which part of the tile is centered on the mouse, in tile coordinates, from the top right corner: Note how the cursor is placing the tile using the area marked \"3\" which is 2 to the right: CoordinateHeights This int array defines how tall each row of individual tiles within the tile should be. This array must be exactly the same number of elements as the value of or errors will happen. Note that these values don't include the padding pixels. Basically, all values should be 16 in most cases. Use 18 on the bottom so that the texture can extend a little into the ground below. Here is a closeup of the texture, note how there is white there, this is to illustrate why we use 18 on a bottom tile sometimes. Here we see the white pixels peeking out from behind the grass. Grass tiles don't completely cover their 16x16 area, leaving tiny holes. Correctly doing this will help the tile look like it's actually there and sitting in the soil, obviously modders should draw the sprite correctly and not with white. (note that it seems solid must be false for this.) Notice how the grass doesn't completely cover its area, so our tile seems to float a little. It is also possible to use to shift a whole tile down to achieve a similar effect. Non 16 or 18 values Values other than 16 or 18 are possible, but are very rarely done, usually just for 1x1 tiles (since bigger heights would just draw over each other for larger tiles). The coral tile, for example, is 24x26 (each style, excluding padding of course.) The code defines the follow for this effect: DrawYOffset Offsets the drawing of this tile in the Y direction. Can be used to draw a tile at a location higher or lower than the default. The most common usage of this is to push a tile into the ground a little to make it appear to be sitting in the soil rather than floating above it. (This can also be done by having the bottom tile be 18 pixels tall using , but if your art is already 16 pixels tall this is another option.) will move the tile 2 pixels down. Another common usage is hanging tiles like banners and lanterns, these use negative values. Banner tiles, like also use to offset the drawing either 2 or 10 pixels depending on if it is hanging below a platform or not. This image shows several examples, note how these tiles all push into the dirt. The only exception in this screenshot is which does not use at all and appears to hover as a result. The background can be seen peeking through the gaps in the grass below ExampleClock. DrawXOffset Similar to except applies to the X direction. The only example of this is how switches, seen in the image above, push into the tile they are placed on to appear more natural. This example also uses alternate placements to apply different values to each orientation. CoordinateWidth Unlike , all tiles in a tile share the same width, so this is an not an . If you aren't copying a style, make sure to set it to 16. CoordinatePadding This is the padding between tiles in the tile spritesheet. Adds a padding of 2 pixels to right and bottom of each area in the spritesheet. By convention, stick to 2. Do this or weird artifacts will appear. If you aren't copying an existing TileObjectData, make sure to set it to 2. AnchorBottom/AnchorLeft/AnchorRight/AnchorTop Anchors define required neighboring tiles for the placement of the tile to be valid. The most common anchor is anchored to solid tiles for the full width of the tile, but more complex anchors can be made, such as an anchor only covering half of the side of the tile or anchoring to the left or right. Usually you get appropriate anchors for free when you use , but be aware that you'll need to fix anchors if you change the width or height of the if that width or height is used in an Anchor: Here is an example of a custom . The 2nd variable in the constructor is the width and the 3rd is the start of the tiles that require the anchor. If the 1st or 2nd block under this is broken, the tile will break as well, but if the 3rd block is broken it will not break. The 1st Variable is a BitMask describing the types or tiles valid for the anchor. Here is an example of an that requires the tile above to be empty. Place a tile above Coral and you'll see the coral break because of this code: By default, all anchors are empty, but if you used to copy from an existing tile, you might want to clear out an anchor that you inherited. To clear out an anchor set the anchor to : Multiple AnchorType The 1st parameter of the constructor can be provided with multiple s by combining them using the logical operator ( ). When multiple s are combined, the tile's anchor will be satisfied by anchored tiles matching ANY of the provided . For example, uses . This allows the tile to anchor to solid tiles, terrain tiles that are not sloped on the face being anchored to, tiles with a solid bottom, and planter boxes. also uses to define another placement that only anchors to . It uses this approach to provide a custom value to the placement specifically below platforms. Direction The direction this tile will be eligible to be placed in. By default this is set to meaning the tile can be placed when the player is facing either direction. When used with alternate placements, a tile can be given separate sprites when the player is facing left and placing the tile or facing right and placing the tile. This is how chairs and bed tiles typically work. By convention, the normal placement is usually left and the alternate is right. https://github.com/tModLoader/tModLoader/assets/4522492/fb2c9892 6e4f 4426 a1df 40379dd1dbf6 StyleHorizontal By default, tile styles are oriented vertically on the spritesheet: It may be more convenient to place them horizontally. In fact, most of the templates are oriented horizontally. To do this: StyleWrapLimit If you are making a lot of styles, you should consider using to keep your spritesheet files neatly laid out. This can make it easier to work with than a really long or tall image. makes the image wrap around to the next row/column (depending on ) to continue placing styles. In the Banner tile sprite (Tiles 91.xnb), means that styles 0 to 110 are on the first line, styles 111 to 221 are on the next, and so on. If you don't have additional lines of styles, you do not need to set this to anything. Note that this value is counted in placement styles, which is not necessarily tile styles if alternates or random styles are being used. StyleMultiplier Used to give room for alternate placements and random styles in the spritesheet. This room is added along the style layout direction, meaning horizontally if is true. This should be set to the product of the alternate placement styles and to ensure that each alternate placement and random style placement are all considered the same tile style. Some tiles use and together to place each style on its own line with only its alternate placements. For example, torches set both and to 6 while setting to true. The end result is each tile style is on a new row rather than on the same row as placement styles from other tile styles: StyleLineSkip Similar to , but adds room between lines of styles instead of in line with styles. If is true, this means that additional rows will be added between rows of styles after the is reached. This extra space can be used for tile states, such as \"on\" or \"off\" states and growth states. It can also be used for tile animation. This should be set even if is not used to correctly calculate tile drops. RandomStyleRange Allows this tile to place a randomly selected placement style when placing. For example, the Coral tile uses a value of 6, allowing 6 different tile placement styles to be selected when placing. Use with to ensure all placed tiles are interpreted as the same style to allow tile drops to work as expected. UsesCustomCanPlace Should always be . If you copied a template it will already be , but be sure you set it if you aren't copying from a template. Wires, Toggles, Changing Frame, Changing States Sometimes we use extra frames in the spritesheet to allow our tile to toggle between off and on. The placement of extra sprites depends on and . These extra \"states\" for our tiles should still be the same tile style if set up correctly. See to see how changes the to change which sprite is drawn. DrawFlipHorizontal and DrawFlipVertical If true, the tile placement preview will draw this tile flipped horizontally (or vertically) at even X (or Y) tile coordinates. This effect must be replicated in to work for the placed tile. See for an example. https://github.com/tModLoader/tModLoader/assets/4522492/7d57d23a 68ab 46f6 a53a 5d371b9e626e Other There are many more not yet explained in this guide. Many of these are explained in the actual or in . Decompile Terraria and look in to figure out how they are used: addTile(Type); Be sure to call this or your mod won't load properly. This should be the last line of code dealing with in . newAlternate Alternate placement styles Some tiles have alternate placement styles. Beds and Chairs for example have alternate placement styles for facing left or facing right. Torches have alternate placement styles for anchoring to tiles below, to the left, to the right, or anchoring to walls. Additionally, sometimes additional placement options are added to a tile to allow placing the tile using multiple origins, such as how closed doors can be placed by clicking anywhere in the doorframe. These alternate placements are registered using . We can modify to assign different properties to each alternate placement. The basic pattern for is to the current , make style specific changes to , then call to finish it up. This should be done before any changes and before . This should be done after doing changes. When using alternate placements, be sure to also set to ensure alternate placements of a tile style are still interpreted as the same tile style. See the for an example of left and right placements. See and for examples of alternate placements using different anchors. See for an example of using to register multiple placement origins of the same placement style. newSubTile Tile styles Tiles with multiple tile styles sometimes benefit from custom behavior for specific tile styles. This is done through . Conditional Behavior You may have noticed that things like are indexed by the tile type. You may have also remembered that both Cursed Torch and Ichor Torch work underwater and are not destroyed when touched by water. If you look in the code, you'll see that Cursed Torch and Ichor Torch are the same tile type as all the other torches. How is this possible? This is possible through . We can modify to allows different properties to be applied to different \"tile styles\" of the same tile type. More advanced usages of can be learned by studying the source. The basic pattern for is to the current , make style specific changes to , then call to finish it up. If alternate placements are being used needs to also be used. This should be done before and after doing and changes. This examples shows the basic pattern and shows customizing tile style 1 to be placeable in lava and water. This example can be seen in full in . Retrieving tile style from We can retrieve the tile style of a placed using the method. This is mostly used to facilitate tile style specific behaviors in various methods. For example, in the method is used in to customize the light emitted by the and styles: We also use it to set an appropriate cursor icon when the tile is hovered over. This code uses the method to retrieve the item type of the corresponding tile type and style: Animation Do not change or of the tile for animation. The tile and its values should stay the same as it is animating. shows changing state and animating a tile. shows more animated tile options. shows an animated Terrain tile. Full Examples Framed Tile Typical terrain block FrameImportant Tile Typical furniture tile Showcases many advanced options. Serves as an example of how alternate placements, tile styles, animation, tile states, and random styles all fit together. Relevant References Contains other methods and properties that both and inherit. Contains additional documentation for various fields."},{"path":"螺线翻译tml教程/1-基础/12-Basic-Tile-Entity 基础-物块实体.md","filename":"12-Basic-Tile-Entity 基础-物块实体.md","title":"12-Basic-Tile-Entity 基础-物块实体","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic Tile Entity This guide serves to explain common things shared among all tile entities. This guide assumes that you know how to create files, create classes and know what it means for a class to \"inherit from\" another class. The file in ExampleMod showcases a basic tile entity. It can be studied alongside this guide as a working example of the concepts taught. What is a Tile Entity? It's important to recognize that there's a distinction between Tiles and Tile Entities. Tiles are at fixed locations within a world and must be accessed via the variable, they cannot contain additional data and can't run code during the game update. Tile entities are additional data usually attached to a that have an method, they usually work in conjunction with a Tile to make a tile behave dynamically. Tile entities can run code every game update, while normal Tiles only have a chance to run code when is called on it by the world update game loop. Basically, if a Tile needs to have additional data or reliably run code, it needs to have a corresponding Tile Entity bound to it and work with it. Making a Tile Entity There are three components for making a tile entity. The places a . That attaches a to itself when placed. Together, these three classes are needed for a working Tile Entity. Making the Item First and foremost, you will need a that places a . The noteworthy line needed is the line in which sets . See . Making the Tile Entity Setting up a requires the usage of a few hooks within the class. IsTileValidForEntity(int x, int y) This hook runs during world loading and when placing the entity on the server. It is used to automatically kill the tile entity if the hook returns , indicating it is in an invalid location. Below is a standard usage of : LoadData/SaveData/NetSend/NetReceive While not technically required to create a working tile entity, tile entities almost always need to store and sync custom data since this is one of their main purposes. The basic concepts of as well as are taught in other guides. Feel free to consult them if you are not yet familiar with the concepts. Usually anything worth saving and loading is also worth syncing. Failure to sync data properly will lead to clients not seeing the correct values when interacting with the tile entity. The example is a simple example showcasing storing and syncing an single value. Override these methods but leave them unchanged for now. Update is where logic for the tile entity can be executed every frame. This is also not technically required, but you will end up using it once you add features to your , so override it as well but leave it unchanged for now. The other hooks present in are optional and will not be covered in this guide. Making the Tile After making a normal multitile (see the for more information), you only have to add a few lines in order to make it automatically place the tile entity. SetDefaults() / SetStaticDefaults() Before the line, add the following: KillMultiTile(int i, int j, int frameX, int frameY) Add the following line to this hook: Basic Template Here is a minimum example for the needed , , and . Other Access the ModTileEntity from ModTile The player will interreact with the by interacting with the . The will retrieve the that exists at the provided coordinates. You'll want to use within methods such as , , , and more where appropriate. By accessing the tile entity instance, you can then open a UI, spawn items, display a message, display a tooltip, customize the tile visuals, and much more. The methods show several examples of using correctly. Here is a basic example, note how is used within an statement. There are rare situations where the might not exist, so be sure to write defensive code like this to account for this situation: Visualize Tile Entities Tile entities are invisible, they usually only have a visual effect if the they belong to use them for custom visuals. This can make it difficult while modding to verify the presence of a . Modders can add to for a quick way to verify that that the exists: Another option is a mod like , it provides a toggle for visualizing all tile entity locations: Examples is the primary example of a tile entity. It showcases the vast majority of desired functionality while being simple enough to read and understand. and are classes. The class inherits from itself and implements the required logic by itself. While not useful as learning examples for the hooks, it is important to realize that pylons are tile entities."},{"path":"螺线翻译tml教程/1-基础/13-Basic-Sounds 基础-音效.md","filename":"13-Basic-Sounds 基础-音效.md","title":"13-Basic-Sounds 基础-音效","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Introduction We can use sounds in many places in tModLoader and this guide will educate you on how tModLoader organize and use sounds. Sound Basics There are 2 concepts to be aware of. The first is the actual sound asset. This correlates with a specific sound file, such as a .wav file. The second concept is the , which is an object representing a sound asset and associated playback settings. Sound Assets Sound assets can be found in your ModSources folder and in the Terraria install directory. Sound assets can be many different sound file formats including .wav, .ogg, .mp3, and .xnb. For example, has an file found in . In your Terraria install folder, you'll find hundreds of sound files in the folder. These files are .xnb files, which is a special format that you can't listen to directly by double clicking. To listen to these sounds on your computer, see the section below. SoundStyle Existing s can be found in the class and new s can be created in your mod for variations on existing sound assets or playing sound assets contained within your mod. To create a new , you'll need the path to the sound file without the file extension. Using that path, you can create the SoundStyle object and store it for later use. Instead of assigning to a variable, you can directly play the sound: s can be further customized to adjust volume, pitch, overlap behavior, and more. See the section below to learn more. Play Sounds Some sounds play automatically, while others can be manually played. Pre Determined Event Sounds The most common usage of sounds is to play them when certain events occur. For example, when an is used, the is played automatically. By assigning a to these existing fields, the sound will play automatically when expected. We can assign a to , , , , and . We will do these in the corresponding override. Below are some examples using existing s as well as an example using a custom : Other available existing sounds to use can be found through , but be aware that most sounds have fairly generic names. You'll want to consult the section below if you are trying to find a specific sound. When using an existing , you inherit the playback settings assigned to that . See the section below to learn more. Play Sounds Manually To play a sound manually, use the method. This method is in the namespace, so make sure you have at the top of your .cs file. The method has 2 parameters. The first is the , this is required. The 2nd parameter is an optional representing the position of the sound in world coordinates. If the position is omitted, the sound is played without any panning effect as if it were happening in the center of the screen. To play an existing sound, simply call the method: To play that sound at a specific location, pass in the location as the 2nd parameter. The location is in world coordinates. This example assumes the code is in a : Where do I put this code? Wherever makes sense, but commonly or are the most frequent places to manually play sounds. Using randomness or timers can help make your content seem natural. Customizing Sound Playback Many existing s found in the class are pre configured with various playback customization. For example, if you play , you'll notice that it is half as loud as . Each has data attached to it that configures these custom behaviors. To customize a , we will use the . The syntax basically allows us to create a copy of an existing object except with some specified changes. For example, if we use in our but find that the volume is too high to fit our enemy, we could create a copy with custom volume like this: The syntax works with modded and vanilla sounds, and also allows multiple tweaks. The most common tweaks are explored below. Here is how multiple tweaks can be used in a single statement: Volume Volume defaults to (100%) and can range from to . Pitch Pitch can be adjusted up or down and defaults to . The lower limit, , is down one octave and the upper limit, , is up one octave. Pitch Variance Pitch variance is a randomness added to the pitch each time the sound is played. This can add some variety to sounds to make them less repetitive. MaxInstances This dictates how many instances of a sound can be playing at the same time. The default is . Adjust this to allow overlapping sounds. SoundLimitBehavior When the limit is reached, this tweak adjusts what will happen. The default is to , which will restart the sound. The other option is , which will ignore the latest attempt to play the sound. IsLooped This dictates if the sound should loop. Defaults to false. When using this, it is extremely important that you follow the guidelines in the section of this guide. Variation It is possible to assign multiple sound assets to a sound style and have them randomly play. To do this, the sound assets must be named the same but postfixed with a final number at the end. For example, would randomly play , , or with equal chance. Weighted Chance and Specific Variant Postfixes Weighted chance and more control over the specific postfixes can be achieved through the other constructor overloads. The vanilla duck sound is a good example. There are 2 main variations, and . There is also an extremely rare , which is a human saying \"quack\". Quite unsettling. The code for this uses weights to strongly favor the 2 normal quack sounds. The and sounds are weighted to 300f each, and the sound is weighted to 1f. This means that the sound will play about 1 out of every 601 quacks: Position The position of a sound determines how loud the sound will be played in relation to the screen location. It also controls how the sound will play louder on one side of the sound output to hint at the direction of the sound. Position is not a property of , rather it is the 2nd parameter of . It is optional, and when not provided the sound will play normally with no panning or volume dampening. Active Sounds With sounds in video games, most of the time it is completely sufficient to use the \"Fire and Forget\" approach. \"Fire and Forget\" is a video game programming term that refers to starting some action and letting it run it's course without having any way of adjusting it after starting it. For most sound effects, there is no need to stop the sound early or adjust the volume or pitch, since they are usually so short that it would not be worth the effort. There are, however, situations that warrant tracking the sound as it is playing and adjusting it dynamically. The most common usage of this functionality is long sounds and looping sounds. tModLoader refers to these sounds as \"Active Sounds\". The file can be used as a hand on guide and reference to active sounds. It is highly recommended to use to experiment with the item in game. can be seen as a companion guide to this wiki section. To properly use active sounds, first we need to familiarize ourselves with the following classes: SlotId Previous examples in this guide have shown using the method to play a sound, but haven't shown doing anything with the return value of the method. The method actually does have a return value. The return value of is a instance. The returned instance can be stored as a class variable to retrieve the instance of that sound at a later time. Using the method, a can retrieve the corresponding to act on it. ActiveSound The class corresponds to a single instance of an actual that is currently playing. Mod code typically will use a or to retrieve a to act on it. Using , a can be used to retrieve an from a . It is more common to use the approach, however, as multiple instances of an entity playing the same would cause the incorrect to be retrieved. SoundUpdateCallback The 3rd parameter of , an optional parameter, is a delegate. Modders can pass in a method that returns a bool and takes a single parameter that will be invoked as the sound updates each tick. This callback is the main mechanism for dynamically altering sounds, but the sound can be altered in other methods as suitable to the design of the code. Panning Sound or Changing Sound Location Now we can use what we have learned so far for the most common usage of \"Active Sounds\": dynamically adjusting the location of a sound. When an NPC or projectile makes a sound, usually the sound is quick enough that the player does not notice that the sound does not move with the NPC or projectile, but if the sound is long, it is more noticeable if it doesn't pan correctly. To adjust the location of the sound, we can retrieve the and modify it's properties. Panning Long Sound Example Stopping a Sound If something interrupts the source of a sound, the sound can be stopped early. To do this, follow the same logic as before, but call the method on the . This can be done in any relevant place in the code. Changing Sound Volume In the same manner, the field on the instance can be changed to dynamically adjust sound volume. Changing Sound Pitch In the same manner, the field on the instance can be changed to dynamically adjust sound volume. SoundUpdateCallback Approach The SoundUpdateCallback approach explained in the looping sounds section is also a good approach. It allows all the sound logic to be contained in a single place. Looping Sounds The techniques discussed so far are sufficient for long sounds, but for looping sounds they can potentially cause sounds that continue playing until the game is closed. For example, a sound set to loop might be started, but then an exception or other buggy code causes the entity tracking the \"Active Sound\" to be inactivated. The sound, without anything to tell it to stop, will obediently keep playing forever. It is for this reason that when dealing with looping sounds, modders should always use the parameter of . In fact, many might find the approach more convenient than using the approach explained earlier for non looping sounds. To make a looping sound, simply add to the that will be played. SoundUpdateCallback Example Using a delegate as a parameter to , the provided method will be called every game update, allowing the sound to update position and other properties. The return value of the delegate controls if the sound should be stopped. The following example shows a projectile playing a sound that updates its position every update. The sound will be stopped when the projectile is no longer active, but other logic can be used as well. Note: when dealing with s tracking a sound, the instance is required in order to avoid rare edge cases. The examples in show the proper way to use them. For , checking should be sufficient. For other situations, make sure the logic allows the sound to properly stop at some point. Adapting Vanilla Code or Code From Past tModLoader Versions Previous versions of tModLoader and code taken from decompiled Terraria do not use the same approach to playing sounds. To use code using old approaches, you'll need to fix the code. For example you might find code like or , but attempting to use this code in a mod will result in errors such as . To fix these, you'll want to look up the sound on the , find the row corresponding to the parameters you have, and change it to use the entry instead. There might be some slight discrepancies, for example \"NPC Hit 50\" corresponds to and \"NPC Killed 18\" corresponds to . Rely on good judgement and if you still get errors. Here is a simple example: Now, we open up the wiki and find the entry with the ID of 12: With this information, we can update our code: Sometimes vanilla code uses for the 2nd and 3rd parameters. These parameters represent a null position, so you can safely ignore them. Sometimes you also see a as the \"Style\" parameter for a sound that only has 1 entry on the wiki. You can ignore those as well: Sometimes there are 2 numbers (a \"Type\" and a \"Style\"), these will show up on the wiki as a number followed by another number in parenthesis. Now, we open up the wiki and find the entry with the ID of 4 and style of 7. This will appear as on the wiki: With this information, we can update our code. Also, since the second parameter of is a now, we can pass in the position directly rather than passing in and coordinates separately: Rarely, old code set volume or pitch offset. To fix these, use the syntax shown in the section above. To adapt old code from your mod, you'll need to make a as taught in the section above. Finding Sounds For many mods, reusing sounds that come with Terraria is a great idea. Terraria comes with over 700 sounds, but it can be difficult to remember or find a specific sound. There are several approaches to finding a Terraria sound to use. 1. Extract all the sounds and play them in your media player 2. Find a sound from an item or npc you remember 3. Consult the source code to find the code that plays a specific sound Extract The Terraria sound files are .xnb files, you cannot play these files on your computer directly. can extract the Terraria sound files and save them as .wav files that you can easily load into VLC or whatever media player you have on your computer. Playing them all one after the other can be a quick way to find a unique sound to use. Find a Sound on the Terraria Wiki If you consult the , you can find and play any sound. The internal name column corresponds to the field you would use. Use this approach if you know a specific enemy or item makes a sound and you want to find that sound. Mod Testing Mods Some mods can help find and play existing sounds: has an option to log sounds, allowing you to see what code is causing sounds to play and also see modded sound paths as well as sound types and sound styles. It also has tools to test volume and pitch customization and generate sound playback code that you can paste into your mod. Source Code (Expert Prerequisites needed) By searching or using the or number, you can easily find sounds corresponding to what you want. Not all sounds played in Terraria are just , , or data, so you must use this approach if you wish to find sounds that are played under special circumstances. For example, you may wonder about the quack sounds that ducks play on occasion. Searching the source for the NPCID of Duck, 362, you will find one of the results shows nested within the condition that it is daytime and a 1 in 200 chance. We can now use this information to implement a new duck correctly. We'll have to change this code to fit the tModLoader approach, so change it to Spread Sheets Look up UseSound, HitSound, and DeathSound of vanilla Items and NPC here: Note: The spread sheets are currently out of date, so you'll have to convert the number it says to a field. For example, if the of an item says \"20\", you'll have to change that to . Find Sounds from other Sources If you want to find a sound on the internet, try to look for sounds that are legally free to use. Common Errors The name SoundID doesn't exist in the current context Add to the top of your source file. The name SoundEngine doesn't exist in the current context Add to the top of your source file. The type or namespace name 'SoundStyle' could not be found (are you missing a using directive or an assembly reference?) Add to the top of your source file. \"Ensure that the specified stream contains valid PCM mono or stereo wave data.\" Run your .wav through using . For reference, the following are the allowed parameters for Wav files: 1. Must be a PCM wave file 2. Can only be mono or stereo 3. Must be 8 or 16 bit 4. Sample rate must be between 8,000 Hz and 48,000 Hz Relevant References Not covered in Basic level Music Music is handled in a separate manner."},{"path":"螺线翻译tml教程/1-基础/14-Basic-UI-Element 基础-UI元素.md","filename":"14-Basic-UI-Element 基础-UI元素.md","title":"14-Basic-UI-Element 基础-UI元素","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Purpose This will explain the bare minimum that is required to draw a simple UI element (button) on the screen. Drawing one element has multiple steps and understanding these are required to build larger UI aspects. High Level Process This image explains the general classes and process you will follow to draw a simple button on the screen. Notice you aren't drawing the UI element on screen until the very last step. Making a Button Making a button is fairly straight forward. You'll want to make a new class and inherit from UIElement from vanilla code. Notice a few things: I named my class after the element it will be. This will be a button that displays a play symbol spriteBatch.Draw is using a vanilla texture (the play button texture itself) The Vector2 parameter you feed spriteBatch.Draw uses the screen coordinates the player can see, not world coordinates. The UI element is set to spawn in the middle of the screen with a little offset so that it's not right on the player Place the Button in a UIState/Canvas The correct terminology (and class) is UIState. However, I think it's easier to think of the next piece as a canvas an artist draws on. You can place hundreds of buttons on this if you really wanted to. You would need to let your buttons accept custom starting coordinates in its constructor however. Right now, it would draw all of the hundreds of buttons in the same spot. For a lack of a better idea, we'll call this state/canvas that the button will go on a menu bar even though it will only hold one button for now. Notice the following: Only one of our newly made play buttons is used, and it's using whatever default it has back in the the PlayButton class (drawn in center of screen) We must Append() the playButton to the UIState/canvas for it to show up when we draw it later Drawing the UIState/Canvas to the Screen Now comes the fun part. We currently have a button that is placed on a MenuBar UIState/canvas. Now we'll make a copy of that to give to the user interface class, and then tell the game to draw it. Think of the MenuBar UIState/canvas as the original and the user interface as the copy, or the MenuBar as a stamp and user interface as the ink. The following code is required to go in your class file that inherited from . First, we need to annotate the class with to allow the mod to load on servers without erroring. We do this to make sure that UI code is not executing on servers. UI code on servers will cause errors because textures, fonts, and other graphical assets can't be loaded in that context. Next, we'll declare a variable of UIState we made above which holds our single button. Next, we'll declare a variable of the UserInterface that will use the MenuBar later. We did not need to create this class or inherit from it. In Load(), let's set the two above to actual instances, then feed the MenuBar to the UserInterface. If you don't Activate() the UI element here while the mod is loading, you will crash once the game starts. It will throw a Object reference not set to an instance of an object error. I'm unclear on the next part but assume it's needed so here it is. And finally, we end with the most complicated part. I was told all of this code is required and cannot explain to you how it works. Essentially this is where the drawing actually occurs after we've fed the UserInterface everything it needed. If you do not use this code, your entire UI will disappear! Results At this point, your screen should have a button just like this. Notice it's not a menu bar... yet. You'd simply add and arrange more UIElements to it in the future. Ok, so it might not be the most exciting thing in the world, but you should now be able to iterate off of this idea and make whatever elements you'd like. To quickly understand what you can do with the UIElements, create a new class, inherit from it but do not add anything yet. Right click within the class brackets, click quick actions and then auto generate overrides. That will allow you to figure out what actions you can take. Notice that Draw() showed up! Since it looks like Draw() is drawing a sprite batch, you should right click on SpriteBatch and peek its definitions to get more ideas. If you look closely, you'll see that we could have called Draw() in our UIElement code many different ways. Medium Level Example Finally, if you'd like more hand holding then check out Example Mod's and study how they implemented some UI elements . Keep in mind the three classes we discussed above and you should be able to figure it out. You'll notice they use other classes in place of that aid in the implementation of certain UI pieces ( and ) Thanks to Scalie and absoluteAquarian for helping me figure this out."},{"path":"螺线翻译tml教程/1-基础/15-Basic-glowmask-guide 基础-高亮层指引.md","filename":"15-Basic-glowmask-guide 基础-高亮层指引.md","title":"15-Basic-glowmask-guide 基础-高亮层指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In this guide we will go over glowmasks, what they are and how to apply them. What is 'masking', and how is it used in Terraria? First, you need to know what a 'mask' is before you can understand what a glowmask is. Masking in art is commonly used for protecting a selected area from change during production, in Terraria we are doing almost the same. By applying a glowmask in Terraria, we are not really masking any part of the original sprite (like how you would do in art), instead we have a separate sprite containing the pixels we want to mask. This sprite is then drawn on top of the original sprite, with its color not influenced by light, creating a glow effect. What does a Terraria glowmask look like? Here is an example of a weapon, and its glowmask: | Normal sprite | Glowmask sprite | |: :|: :| | | | You can see that in the glowmask, we are only displaying the pixels we want to mask, any other pixels are removed. Since glowmasks are used to draw parts not influenced by light, it is most often the pixels of parts that would be lit up (or give light themselves) in real life that stay in the glowmask sprite. What can glowmasks be applied to? A glowmask can be applied to virtually anything you want, be it an npc, projectile, item, or even an armor the player is wearing. For equipped gear (and also weapons being held), you would use PlayerLayers which is beyond basic and thus not covered in this guide. How do I 'apply' a glowmask? Vanilla has its own 'system' for glowmasks in place, however you can not make use of this system as it does not accommodate for modded content. Also, the word 'apply' should be loosely taken as you don't really apply your glowmask to the original sprite, instead we will be drawing the glowmask separately from the original sprite. How do I draw my glowmask? For drawing your glowmask on top of the original sprite, you will want to use the appropriate Post Draw hook. This will ensure the glowmask draws on top of the original sprite. You can also opt for complete manual drawing by overriding the appropiate Pre Draw hook, this requires more manual work however and is not recommended unless required because of something else. It is common to suffix sprite names with Glow or Glowmask as a naming convention. Here is an example of using PostDrawInWorld to draw a glowmask for an item that is dropped in the world: You don't have to use this code as it only serves as example. Generally there is just a few steps you need to follow when drawing a glowmask: Make sure you draw the glowmask sprite, not the original sprite Make sure to draw with Color.White or at least a color that is fully opaque Achieve opaqueness by increasing the alpha channel closer to 255. (lowering closer to 0 will achieve transparency) Remember that XNA Colors take bytes for their RGBA channels, so the values range between 0 and 255 Make sure to draw with a center origin (if required) You can get the center origin with: Make sure the original sprite and the glowmask sprite have the same size Better to cache Texture2D requested with ModContent.Request, e.g. request it beforehand and save into variable, and use that variable instead"},{"path":"螺线翻译tml教程/1-基础/16-Basic-JSON-&-ModConfigs 基础-JSON文件和模组配置.md","filename":"16-Basic-JSON-&-ModConfigs 基础-JSON文件和模组配置.md","title":"16-Basic-JSON-&-ModConfigs 基础-JSON文件和模组配置","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction Before we begin, it's important that you understand what a config is and how a 'ModConfig' is handled. First of all, config stands for 'configuration' and with that we often mean a 'configuration file'. There are many formats for configuration files, in tModLoader we use a language called JSON for ModConfigs. What is JSON? JSON stands for JavaScript Object Notation and we will delve a bit deeper into the meaning and heritance of this name. JSON is a language used to store data in a specific format and it is used for data interchanging. JSON is often preferred over other languages because it is lightweight, flexible, and unstructured (meaning it supports any structure!) Although certain other languages like XML (.xml) or YAML (.yml) provide more features they are not as lightweight. JSON was derived from JavaScript, although it has adapted into many languages by now. In fact, all JSON really is, is JavaScript objects. JSON is the official internet media type ( ) and files use the file extension. How does JSON work? JSON is comprised of data objects consisting of attribute value pairs and array data types. If you know how a is built, JSON files will be very simple for you. Let's get right to it, here is a JSON sample showcasing its basic data types: As you can see, the sky is the limit! In JSON you'll be storing basic data types: strings, numbers, booleans, arrays, booleans and also null values. The above example showcases all basic data types and also in ways they can be combined. Next we will go over important remarks. Important remarks Take a good look at the above example. The most important aspect of JSON is its key value (or: name value) pairs. It boils down to: a specific key matches a certain value. (notation: ) Unlike a language such as C (which uses a compiler), you do not specify the data type, it is parsed automatically. What is also important is that each element should be separated with a comma, apart from every last element. You are free to include a comma for last elements, but it is not required. To familiarize yourself with JSON it is recommended to fiddle a bit with it using which is a JSON validator. JSONLint will tell you if your JSON is valid, and if not it will tell you where it went wrong and why it went wrong. How do modders utilize JSON for Terraria modding? With tModLoader mods, modders don't directly use JSON. Modders can make ModConfig classes which use JSON to store configuration info. See ExampleConfig.cs for more information on ModConfig. If you'd like to inspect JSON files from ModConfig added by mods you use, these can be found in the (Windows: ) folder as a file. This file will only show deviations from the default values, so it might just be an empty file with only as its contents. It isn't usually useful to look at the files directly, but you could get some insight from them."},{"path":"螺线翻译tml教程/1-基础/17-Basic-Netcode 基础-联机同步.md","filename":"17-Basic-Netcode 基础-联机同步.md","title":"17-Basic-Netcode 基础-联机同步","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Looking to learn how to write and send your own ModPackets? Read our . Introductory Terraria is frequently played with many players on a server. Ensuring that your mods work well with friends is something that should not be an afterthought. Test early and often in multiplayer as you develop your mod. In this guide, we will go over how to make your mods multiplayer compatible, and hopefully show you it is not as difficult as it may seem. Main Concepts The following are main concepts key to understanding how Terraria works in multiplayer. 1. When you play Terraria, your application is considered and called a \"Client\" 1. During multiplayer, your client and other players' clients connect to a \"Server\" 1. While connected to this server, the connected clients need to communicate well together through the server, so that things happening in the game are synchronized between these clients. In essence: network packets are sent across clients to make sure the game is in sync for all players. This happens all the time in multiplayer play, even in vanilla. Clients CANNOT send or receive things DIRECTLY from other clients the server has to act as a middleman. Testing Netcode/Multiplayer compatibility You can test multiplayer by hosting a server and having others join your server. The mod should automatically be synced from your computer to them even if you do not update version in build.txt. You do not need to publish to the workshop each time to test like this since the mod is coming directly from the server. Testing multiplayer locally If you want to test alone, you can do this be launching 2 tModLoader clients on your computer. Usually Steam will only allow you to launch the game once, but nothing prevents manually launching the game a 2nd time. To launch an additional client, open up the tModLoader and double click on the file ( for non Windows users). This will launch the 2nd client. You'll want to be in windowed mode instead of fullscreen. From there, have the first client \"host and play\" and use \"join via IP\" on the 2nd client. Use as the IP address on the 2nd client. If you need to debug code running on the server, you'll want to but select the \"Terraria Server\" launch target instead of \"Terraria\". If you do this, you'll need to manually launch 2 clients to connect to that server via \"localhost\". Do note that with 2 clients, the game might not update as frequently when the program is not in focus, so you might need to ignore certain apparent issues. Automatic Syncing (non ModPacket) Terraria handles many network syncing things for us, we just have to use them right. NPC / ModNPC With NPC, any non deterministic decision must be synced to the clients. The Server is the owner of all NPC. As seen in , we use to trigger the NPC syncing code. Terraria will sync position, life, and other data from the server to the clients whenever has been set to true. We can use and to sync extra data needed by all clients rather than . This extra data will always be synced whenever the npc itself is synced. Video Example of Desync Issue As mentioned in , non deterministic decisions must be synced. This video shows the desync issue that happens if the random choice values in AI code are not synced properly. Notice how the slime on either client teleports to the correct position the server sends to the client when the NPC is synced at regular intervals: https://github.com/user attachments/assets/27b289c0 37a6 47e8 9e35 ea6f641612f0 Here is the correct behavior without the desync issue: https://github.com/user attachments/assets/f2bdcea4 8fe6 4eba aa0d 0d36ade9a16d Projectile / ModProjectile Projectiles operate the same way as NPC, with the exception that the owner of a projectile is not always the Server. Projectiles spawned by players are owned by that player/client, while all other projectiles such as NPC spawned or World spawned projectiles are owned by the server. In the case of client changes, the flag will sync the client's data to the server and the server will relay that to the other clients. An example is . The AI will check and then set if the position has changed due to the client players mouse position. World / ModSystem World data should only ever be changed on the server. Whenever something important happens in the world, such as the Noon command on the server console, a Boss being defeated, or a random invasion triggering, World data is synced from the server to the clients. Whenever world data is synced, each is also synced via and . We can trigger a network sync of world data by calling on the server, as seen in when we set . Try to only do this when necessary. Item / ModItem / GlobalItem Items are also synced. Use and to sync data. Follow decompiled source code if you need to do anything unorthodox, most mods won't need to do anything such as triggering manual syncing. When Items are synced, only a very select subset of the fields are synced, this is why changing default values such as in something like is not recommended. Use for that. Items sync automatically in most relevant situations, such as when the item is dropped or transferred, but one situation that may require special consideration is when an item changes while in a players inventory that will have an effect on how the player behaves or how the item behaves when used. Without the syncing, the item could behave differently when observed by other clients. The method can be called to trigger a resync of this inventory or equipment item. shows this in action. As the local code changes how the item behaves, the code ensures the changes are synced so that the behavior is consistent for all clients. ModTileEntity Owned by the server. Sent to clients when a client first visits the \"chunk\"/\"section\" of the world where it resides. Changes are applied on the server and synced from the server to client. code can manually trigger a sync by sending the message, this will cause the current values to be sent to all clients to keep the data in sync. See for an example. Note how the setter triggers to be sent, keeping clients in sync. Player / ModPlayer Player data is very large, so special data syncing is used to minimize how often and which Player data must be synced. See , , and in the and to learn their purpose and see them in use. Vanilla data such as inventory slots, health, position, and selected item are all synced automatically, so changing those in code will automatically sync to the server and be relayed to the other clients. Every client's accessories are updated on each client, so there is no need to sync the effects equipped accessories apply either. Biome flags will be synced automatically. Failure to use and will lead to desync and many other problems, they are very important to get right. CopyClientState and SendClientChanges and are responsible for ensuring that the server and remote clients are kept in sync with a local client's changes. If there is data that must be present on the server and remote clients to run the game logic correctly, that data must be synced. The following diagram shows how they work together. First, is used to create a snapshot of the data. Next, the rest of the game update happens. During this time item usage, UI interactions, or many other things can happen, potentially changing data. Next, is called and that snapshot is used to compare the current values against the snapshot values. If any changes are detected, the mod makes a and sends the changed data to the server. The server receives that data, applies it to the local instance of that player's , and relays it to all other clients with a new . All other clients receive that data and apply the contained data to the local instance of that player's . Hooks in Multiplayer You'll want to be aware of where various \"hooks\" are executed. For example, some hooks only run on the server, like . Some hooks only run on clients, like . Some hooks run on the server and clients, like . Some hooks only run for the client that \"owns\" the entity, which we refer to as the \"local client\", such as . When a hook differentiates between the local client and other clients, the other clients are referred to as \"remote clients\". The has mentions of \"where\" each hook is called for many of the methods, but if it is not mentioned you can make an educated guess or test using the debugger or logging. It can be assumed that all hooks are called in single player as well unless they are specific to network syncing. There are many things to keep in mind in regard to hooks in multiplayer, here are some common ones. Hooks that run everywhere usually need to produce the same results everywhere, meaning that data used in the logic potentially needs to be synced in some manner. Hooks that run on all clients sometimes should only run code on the local or owner client, for these checking or some equivalent might be necessary to limit where code runs. Code that runs only on clients should not be used for gameplay effects, for example don't use drawing methods for gameplay purposes since they won't run on the server. If something runs on the server and clients, an or check can be used to limit execution to either clients or the server. Improving & beyond pre defined hooks Many examples can be found in ExampleMod for packets. For example you can use the Notepad++ \"Find in files\" feature and look for in the ExampleMod folder. Make sure 'Match case' and 'In all sub folders' are checked. You'll find all locations in which a packet is created and likely sent. If you feel you want to delve even deeper to learn how to send ModPackets and optimize your networking more, read our ."},{"path":"螺线翻译tml教程/1-基础/2-Basic-Recipes 基础-合成表.md","filename":"2-Basic-Recipes 基础-合成表.md","title":"2-Basic-Recipes 基础-合成表","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Basic Recipe Recipes can be added to the game in 3 places. In , , and . Where you add your recipes is up to your organizational preferences, but do note that the method cannot be used everywhere as is, use where it is not possible. Recipes consist of Ingredients (Items consumed to craft the result), Tiles (Tiles you need to stand by), and Results (Item created). The \"Material\" tooltip is automatically added to every item that is used in at least one recipe as an ingredient, and should not be manually added. Basic Recipe Structure Required Using Statements First, make sure that you have the following using statements in the .cs file. These using statements will let us access recipe related functions: Create Recipe and Assign Recipe Result To start a recipe we create an instance of the class. We do this through the method or the method. When creating a recipe, we need to assign the recipe result type and result stack. The method assumes that the recipe results in the current , so only the stack size is needed. The stack size is optional and defaults to 1: In class, we type \"Recipe.Create\" to use the method. Here are various examples, showing vanilla and modded ingredients as well as default stack sizes and custom stack sizes: In class, we also use : In class, we can use to create a recipe that doesn't have this as a result: Add Recipe Ingredients Now, we add the ingredients. These are the items we want the recipe to be consumed when the recipe is crafted: AddIngredient also takes an optional argument for specifying a stack size: The previous examples added vanilla items to the recipe by referencing the ItemID class. With a capable IDE such as Visual Studio, you will find autocomplete and intellisense very useful, but you can also . We can also add modded items added by this mod. There are several ways we can do this. Go for whatever approach you like. The 1st approach is the cleanest. All of these methods can add the stack parameter. These examples all point to the class in the namespace: If you are in a class, you can also use that ModItem directly in a recipe: Add Crafting Stations Next, we can specify the crafting stations. This follows the same patterns as items. You can . If you want the item to be crafted by hand, you should skip this step. Register Recipe Finally, we need to tell tModLoader that our Recipe is complete and add it to the game: Using Vanilla vs Modded Ingredients and Tiles As a recap, vanilla items and tiles use the and classes, while modded items and items use the and methods: Full Basic Recipe Example Here are a few full basic recipe example. This first example resides in a ModSystem class. The recipe takes 1 Chain and 10 Stone Blocks, it is crafted at a workbench and anvil, and the resulting item is 1 AlphabetStatueA. This example is in a class. This recipe crafts 3 of the ModItem from 5 s: Chain Syntax The code in this guide is quite wordy. Using the chaining syntax, we can reduce the verbosity of our code. This approach may be more pleasing to the modder. Only the final line has a semi colon. Recipe Groups Recipe Groups allow a single ingredient to be satisfied from a selection of similar items. The most common example of this is using Iron Bar or Lead Bar to craft a recipe. Recipe Groups are discussed in Conditions In addition to ingredients and crafting stations, recipes can also have conditions. Each condition must be satisfied for the recipe to be able to be crafted. Water, Honey, Lava, Shimmer Water, Honey, Lava, and Shimmer are not technically Tiles, so to make a recipe require standing next to those, use one of the following: Note that is also satisfied by Sinks, so don't add the Sink tile separately. Other Vanilla Conditions The page lists all other vanilla conditions. Use them in a similar manner. Custom Condition Mods can also use custom conditions, those are discussed in the . Multiple Recipes With multiple Recipes in the same AddRecipes, make sure not to re declare your variable name. The following will cause errors: You can name your variables recipe1, recipe2, and so on, but a cleaner approach would be to just reuse the same variable: If you are using the , then simply do the same approach for each recipe on subsequent lines. Making an \"upgraded\" vanilla tile As an aside, you may want your ModTile to count as, say, a workbench or anvil. To do this, add the following to your : Complete Examples Here are 2 complete examples, one showing recipes added in a class more suitable for recipes involving that , and the other showing adding recipes in a class more suitable for recipes involving vanilla items. Technically the recipes can go in either location, but for organization purposes it is sometimes nice to have recipes in ModItem classes. ModItem Example ModSystem Example Remember that in , we must pass in the recipe result item type. Common Errors Error CS0117 'ItemID' (or TileID) does not contain a definition for 'MyModItem' You tried to use the vanilla item syntax for adding a ModItem, read this tutorial again. Error CS0103 The name 'recipe' does not exist in the current context You forgot to declare your first recipe as . Make sure the first recipe in your code starts with Error CS0128 A local variable named 'recipe' is already defined in this scope Read above. My recipes aren't in game Check that your AddRecipes method has override not virtual. No suitable method to override Make sure you are only overriding AddRecipes in Mod, ModSystem, or ModItem. The crafting station or ingredient shown in game doesn't match my recipe code This is most likely because you mistakenly passed in an into or a into . By using the wrong ID class, you have accidentally referred to the wrong ID. Relevant References Not covered in Basic level There are other aspects of Recipes that will be covered in more advanced guides: Intermediate Allows a single ingredient to be 1 of a large group, like how most recipes involving wood can take Boreal Wood or Pearl Wood. (\"any wood\") Intermediate Edit existing recipes or disable existing recipes Intermediate Customize where in the crafting list a recipe will appear. Intermediate Customize which recipe is used for decrafting via the shimmer liquid. Intermediate Allows recipes to require custom conditions met in order to be crafted. Intermediate Allows a recipe to conditionally consume less ingredients than usual, such as what Alchemy Table does. Intermediate Allows running code after a recipe is crafted. Intermediate Use Items or Tiles from other mods in your Recipe."},{"path":"螺线翻译tml教程/1-基础/3-Basic-Autoload 基础-自动加载.md","filename":"3-Basic-Autoload 基础-自动加载.md","title":"3-Basic-Autoload 基础-自动加载","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Autoload is a mechanism whereby tModLoader makes some assumptions about your mod in order to simplify the amount of work the modder has to do in their mod. In this Basic guide, we will focus on how Textures are autoloaded because that is the primary interest of beginner modders. Items, Projectiles, and NPC all need a texture to work correctly. Any one of these without an associated texture will cause your mod to be unable to load. tModLoader can't magically know which texture file you want associated with which thing, but it can make an educated guess based on the pattern it knows. This is the pattern: Take the Mod Sources path: Add the Namespace of the class, replacing '.' with ' ': Add the classname of the class, then append '.png': In more concise terms, look for the .png file with filename matching the classname of the thing in the folder designated by the namespace of the class. Basically, just make sure the .cs file and .png file exist in the same directory and that the class in the .cs file matches the filename of the .png file. It is a good idea to also make sure the .cs file matches the classname and .png filename as well. Also, you must make sure that the folder path from the Mod Sources folder matches the namespace (with '.' becoming ' ' in the folder structure.) A visual explanation: Extra Textures In addition to the normal texture that a piece of content might require, there are other textures that will be autoloaded for specific types of content. Listed here are the most common examples of this. Accessory items with textures that draw on the player have annotating the class. These items require a separate texture post fixed with the equip type, such as or , for example. Town NPC and Boss NPC classes annotated with and will autoload textures post fixed with and textures respectively. These are the textures drawn to the minimap. Tiles with set will autoload textures post fixed with containing the smart interact outline texture. Mounts and minecarts will need a texture. Extra textures post fixed with (drawn behind the player), (drawn in front the player), or will be autoloaded. At least one will be necessary for a functioning mount. Music Music files need to be in a folder or subfolder of a folder named \"Music\" to be autoloaded as music. Modders can use for any music file that does not meet that condition. Background Background texture files need to be in a folder or subfolder of a folder named \"Backgrounds\" to be autoloaded as background textures. Modders can use for any texture file that does not meet that condition."},{"path":"螺线翻译tml教程/1-基础/4-Basic-Ammo 基础-弹药.md","filename":"4-Basic-Ammo 基础-弹药.md","title":"4-Basic-Ammo 基础-弹药","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click What is Ammo? Ammo is a system that links Weapon items, ammo items, and projectiles together. The basic idea is this: Weapon items have set to an AmmoID, Ammo items that weapon should use have set to that same AmmoID, and that Ammo item has set to the particular projectile that will be shot by the weapon when the ammo is used. As an example, let's consider and . The has and has and . When the player is shooting their , Terraria looks in the player's inventory and searches for items with matching 's . If an ammo item is found, the ammo item's projectile is spawned and the ammo is consumed. As a convention, AmmoIDs match the ItemID of the first ammo item. For example, AmmoID.Arrow and ItemID.WoodenArrow are both equal to 40. All other arrows have . How do I use vanilla ammo for my weapon? To use vanilla ammo, simply set Item.useAmmo to the correct AmmoID. For example, in ExampleMod has . How do I make a vanilla ammo? To make an ammo that belongs to a vanilla ammo class, simply set Item.ammo to the correct AmmoID. For example, has set in it's SetDefaults method. In addition, the ammo item must also define the projectile that the ammo shoots. shows this example: How do I make a new ammo class? A new ammo class can be made by designating one of your ammo items as the AmmoID. For example, Example Mod shows us a new \"ExampleCustomAmmo\" ammo class. The item has to designate it as a the defining ammo of the ammo class. has to match the pattern we have established with vanilla ammo items. Any further ammo would have and any other weapons using that ammo would have . How can I make a new ammo class out of vanilla items? Use a GlobalItem class to set and to a new projectile that you've made. Note that using vanilla items to make new items runs the risk of conflict with other mods, so use it sparingly to maintain compatibility and to prevent your players from getting confused. Weapons using Multiple Ammo Types or Ignoring Specific Ammo Items The hook allows weapons to supplant the normal ammo choosing logic. A common usage is to allow a weapon to use multiple ammo types. See for an example of this as well as additional notes. Manually Consuming Ammo Ammo is typically consumed by weapons via the game logic, but there are situations where the modder might need to manually choose and consume ammo. The most typical example of this is held projectile weapons. These include Vortex Beater, Phantasm, Celebration Mk2, and Phantom Phoenix. TODO"},{"path":"螺线翻译tml教程/1-基础/5-Basic-Projectile 基础-弹幕.md","filename":"5-Basic-Projectile 基础-弹幕.md","title":"5-Basic-Projectile 基础-弹幕","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click What is a Projectile? Before you start modding a projectile, you should be aware of the difference between items and projectiles. Items are the objects that can be stored in your inventory, whereas projectiles are the objects that are shot from weapons or enemies, for example. What uses Projectiles? Many items in Terraria are functional due to projectiles, including guns and bows (the bullets and arrows respectively), lasers, bombs and other thrown items, and most magic weapons. Some other items you might not think to be projectiles include; grappling hooks, flails, spears, pets, summons, drills, and yoyos. A lot of enemies spawn projectiles as well. Making a Projectile To create a projectile in Terraria, you must first create a class that \"inherits\" from . To do so, make a .cs file in your mod's source directory (My Games Terraria tModLoader ModSources MyModName) and then open that file in your text editor. Paste the following into that file, replacing with the internal name of your item and with your mod's foldername/namespace. (A common mistake is to use apostrophes or spaces in internal names, don't do this, the computer won't understand.) Now that you have a .cs file, bring in your texture file (a .png image file that you have made) and put it in the folder with this .cs file. Make sure read so you know how to satisfy what the computer expects for its filename and folder structure. I can't find my Projectile Remember that Items and Projectiles are different. A common mistake is modders will make a projectile and not understand that they need to make something use that projectile. For example, for a throwing knife weapon, you need to make both an Item and a Projectile. Ammo items need a unique projectile associated with it as well. You don't always need both and item and a projectile, such as if the projectile is spawned by an NPC. The easiest way to test a projectile is to make an item and set to the projectile. For example, . See ExampleMod for many examples of Projectiles spawned by Items, they are in separate folders, but they are easy to find. SetDefaults The most important part of a Projectile is the method. is where you set values for the projectile, things like the hitbox width and height, if the projectile is friendly or hostile, and which AI the projectile will use. See to see what values commonly set in mean. You can also view vanilla projectile values by visiting . Many examples of different projectiles can be found in Projectile.damage A commons mistake is setting in , this does not work, as the damage value a projectile has is always overwritten by the value passed into when the projectile is spawned. Usually the item or the npc spawning the item will determine the damage. DrawOffsetX, DrawOriginOffsetY, DrawOriginOffsetX These are fields related to properly centering a hitbox to a sprite. Read for more info. Other Hooks/Methods The lists many other hooks/methods you will want to use to make your projectile unique. For example, if you'd like to apply a debuff when the projectile hits an enemy, you would use . To do something when the projectile hits a tile, use . See the documentation and usages in ExampleMod to see how to properly use them. What is AI The AI of a projectile is the most important aspect of a projectile, it controls how the projectile moves and acts after it is spawned. It is easiest for new modders to first rely on AI code already used in other vanilla projectiles by assigning and . The number you assign to must be the aiStyle number used by the projectile you are using for . This is called mimicking a vanilla projectile. As you desire more advanced movement, you'll realize that mimicking vanilla projectile AI is very limited. We will discuss mimicking and custom AI below. Using Vanilla AI We can use vanilla AI to prototype our projectiles. Let's make a boomerang. Using the same as the vanilla projectiles that move like a boomerang, we can make a boomerang. You can look up boomerang projectiles in and you will discover that boomerangs all use of 3: We can now use in our code. (You can change 3 to to make the code more readable.) To make this boomerang even easier, we can use , which will copy all the other defaults as well. Doing this, you will get a projectile that almost behaves the same way as the vanilla projectile: You'll notice that the dust aren't being spawned. We can fix this by using . is used to further narrow down . Each is shared between many different projectiles. If we want to use a specific behavior of a particular type of projectile, we need to set . Here is how our copy of EnchantedBoomerang looks after assigning as well: Here is the resulting code. That dust is cool, but if you want to change the color of that dust or any other small thing, you can't rely on and . To change things, you'll need to consult the guide to tweak existing code or read on to learn how to do AI code from scratch. Remember, using and is a prototyping tool , anything remotely interesting in a mod would likely need to write their own AI code or adapt vanilla code. Custom AI This section will discuss elements you can incorporate into your AI. Remember to set back to 0 if you are using to copy other projectile defaults. All code for custom AI goes into the method. Timers Many projectiles use timers to delay actions. Typically we use or as those values are synced automatically, but we can also use class fields as well. Here we count to 30, or in other words, half a second. Gravity Gravity doesn't actually exist for projectiles, every projectile that moves with gravity actually just has code in their AI. To implement gravity, simply add a small value to : Delayed Gravity Arrows and Throwing Knife projectiles all wait several frames before being affected by gravity: Wind Resistance By reducing multiplicity, we can easily implement wind resistance. Combine with a timer to have this effect conditionally. Rotation Constant Rotation We can increase in to rotate like a boomerang. Face Forward Rotating in the direction of travel is often used in projectiles like arrows. If your projectile faces right, you don't need to add (found in Microsoft.Xna.Framework). If your projectile points up, you'll need to. spriteDirection If your sprite is upside down when shot to the left, you'll want to set this: See for an explanation and example. Dust Spawn dust in AI for a visual effect. Randomizing placement, , and frequency is visually pleasing. Here is the Enchanted boomerang dust spawn (aiStyle 3, AIType ProjectileID.EnchantedBoomerang): Dust Trail A dust trail can be accomplished by spawning 1 dust every AI update. Lighting Modders have many different definitions of lighting. If you want to add particles, see the Dust section. If you want the projectile texture to be un affected by darkness, see . If you want the projectile to give off white light, you can set (or any number between 0 and 1) in . Finally, if you want to give off color light NOT from spawned dust, light that lights up nearby tiles, use Lighting.AddLight inside your method: Sound Repeating Sound The field will automatically decrease each frame. Checking that it is 0 and then setting it to a value and playing a sound will result in a repeating sound. This example is from the boomerang aiStyle (3). Splitting/Spawning Projectiles The Crystal Bullet and the Scourge of the Corruptor projectile (EatersBite) both spawn new projectiles when they die. We typically see spawning projectiles in or , but we can do it in as well. When spawning projectiles, we need to be aware of Multiplayer Compatibility and be sure to only spawn projectiles when is true to prevent issues. Scaling down Projectile.damage is typical. See to see the parameters and usage with multiplayer in mind. Homing Homing projectiles work by finding a target and then adjusting velocity to point towards the target. To find a target, usually is iterated over to find the closest enemy . Once the target is determined, is adjusted to point towards the of the target. This adjustment can be gradual or immediate, depending on the desired projectile flight characteristics. More logic can be added to the homing logic to influence how accurate and abrupt the homing behaves. showcases a basic homing projectile. Follow Mouse To follow the mouse, we write code in to check and adjust to move towards the mouse. This code must only run for the owner of the projectile using a check for . Failure to do this will lead to desync as the projectile is influenced by each users mouse locally. Other clients do not know the projectile owner's mouse position, so the resulting velocity and position changes are synced using . , despite not currently being updated to work on current tModLoader, shows the required code to properly implement a projectile that follows the mouse. Held Projectile Held projectiles are projectiles that appear to be held in the players hand similar to how a weapon item is held. As a projectile, it is easier to customize the behavior that it is if it were an item. The most prevalent example of held projectiles are drills, but many other weapons such as spears, shortswords, whips, and flails are commonly implemented as held projectiles. To implement a held projectile, you'll need an item that \"shoots\" the projectile. That item needs to set . In the projectile, code will check to see if the item is still being used. If it is, the projectile will be set to match the players position and item rotation. serves as an example of a held projectile and shows all the required code to implement a held projectile. Player Owner If a projectile was spawned by a player, we can use to retrieve that . Once we do that we are free to access any player data needed. Not every projectile will be spawned by a player, make sure to only access the player if the projectile is only spawned by a player. Incorrect usage of will cause issues especially in multiplayer. Fade In/Out Many bullets fade in so that when they spawn they don't overlap the gun muzzle they appear from. You can set the projectile to spawn transparent with in . Then, in , you can decrease that transparency each update. shows using both fading in when spawning and fading out when despawning. Animation/Multiple Frames Projectile animation, switching which frame of the sprite to draw, happens in . Make sure to set in first. You can set to whatever frame you want to be drawn. Do not attempt to use a .gif file for the texture, that will not work and it is not how animation is done. Looping/Cycling You can use and to implement a looping animation. Example: Examples AiStyle 1 Projectile AiStyle 1, also known as , used for many simple projectiles in the game, is over 3000 lines long. If you have tried to adapt this AI using the guide, you might have been frustrated. Here is brief outline of that AiStyle without all the ProjectileID specific code: As you can see, the Projectile AiStyle of 1 without all the ProjectileID specific code is only a few lines of code, and matches up with the fade in and rotation examples above. Limited Projectile Count Boomerang weapons are limited to spawning 1 or maybe a few projectiles at a time. This isn't part of the projectile code, but rather a behavior of the item spawning the projectiles. The item usually checks how many projectiles owned by the player are in the game world and prevents the item from being used if it is greater than the desired limit. The following code is an example of this typical effect in a spawning a specific : Bounce and OnTileCollide Many projectiles bounce when colliding with a solid tile. This behavior is technically not part of the as it happens in a method called . By default, when a projectile collides with a tile, the velocity is quickly reduced so that the projectile will come to a stop and the projectile will be killed. By overriding and returning , we can avoid that logic and implement our own logic. If we return , we can add additional logic while keeping the vanilla logic. The most common use of this is to allow your projectile to bounce. Some projectiles bounce realistically by losing some velocity, while others bounce unrealistically and maintain their original speed in a new direction. Some projectiles have limited bounces, this is done usually through taking advantage of to count down bounces. When overriding , killing the projectile, spawning tile collision dust, and playing collision sounds are all things that might need to be implemented. OnTileCollide Examples shows off limited bounces, tile collision dust, tile collision sounds, and bouncing while preserving the velocity completely. shows off multiple random collision sounds and returning true to keep the original collision logic. shows off spawning a small eruption of secondary projectiles. is similar to ExampleBullet.cs except the velocity is scaled by , thereby slowing the projectile down on every bounce. shows off more dynamic examples of dust and bounce behaviors derived from the flail state and velocity. It also shows off an additional behavior of spawning a sparks visual effect. This dynamic behavior provides the signature feel of Flail weapons. With the above examples, you can craft the tile collision behavior you want. If you are attempting to clone a vanilla projectile behavior, search for the number or the projectile number to find the relevant code. The example in the adaption guide shows this and other thought processes required to find vanilla code fragments not covered by the code. Custom Drawing Sometimes the default drawing behavior is not what we want. We can override or to manually draw a projectile to customize it further. Afterimage Trail An \"afterimage trail\" is when a projectile draws a faded copy of itself trailing behind it. (See also the .) We can implement an afterimage trail by telling the game to remember previous projectile positions and then manually drawing the projectile at those positions. The following code is relevant code from : In this code, first we make sure and have appropriate values, see their documentation for more information. Next, in we iterate over the entries in reverse and draw the projectile sprite with color values faded depending on their \"age\". The for loop makes sure not to draw entry 0, since that corresponds to the current position and will automatically be drawn since we are returning from this method. Iterating in reverse, from oldest to newest, is important. It makes the overlapping draws look correct: Modders can experiment with changing the draw scale as well. Afterimage Trail with and and can be used to facilitate a afterimage trail that needs and information. Afterimage Trail with There is no to remember previous values of , but with some math a previous animation frame for a cycling animation can be calculated as follows: https://github.com/user attachments/assets/2307462e b0f1 4195 a14c b52268bd8dfc Glowmask A file named will automatically be used as a glowmask texture for this projectile, meaning it will draw at full brightness over the normal texture. PreDraw/PostDraw Examples Here are some examples of custom drawing to learn from: uses to draw an afterimage trail. shows off using to draw additional details over the existing sprite. uses to draw a line and individual whip segments. uses to draw the projectile texture manually to avoid fighting against vanilla projectile drawing oddities. uses to draw an \"energy sword\" effect similar to the 1.4.4 changes made to Night's Edge, Excalibur, and others. Drawing and Collision You may find yourself noticing that your projectile is hitting walls when it shouldn't or otherwise having a weird hitbox. First off, it is worth reiterating that and correspond to the hitbox of the projectile, NOT the sprite used. You almost never want or to be different, it should be square. You also never want to use since the vanilla drawing code doesn't really take it into account correctly. The drawing of the sprite attempts to overlay the hitbox with the sprite, the drawing of this sprite is influenced by various bits of math done in the method. Vertical Sprite Example Lets work through this example as we explore collision and drawing issues and work to solve them. Here is the sprite, it is 48x70 pixels: The important parts of this are as follows: Our goal is to have the yellow part of this projectile be the hitbox. The yellow area is 8 by 8 pixels, so we set and to 8 already. The code there sets the rotation to the velocity while adding 90 degrees of rotation, since the sprite we happen to be using faces up instead of to the right as is expected by the game. In this guide, we'll be using the mod to visualize hitboxes. This is very useful. Here we see the hitbox, the yellow square, doesn't match up with the tip of our sprite: https://github.com/tModLoader/tModLoader/assets/4522492/8efa67d9 5565 4076 b0af 5e1688dfde84 The math for what vanilla code is doing is a little confusing, but basically we need to set and to values that offset the drawing of our sprite in an attempt to properly place the sprite over the hitbox. If you are attempting this, either use to change the offset values in game or use to adjust the values in game. Another approach is to just measure it out on the sprite itself in your graphics program: Here we see testing various values with Modders Toolkit. Make sure to replicate these values in your code: https://github.com/tModLoader/tModLoader/assets/4522492/a21ae4df e79f 4878 84ff d8e30dd59583 After some experimentation or measuring, we know that adding to this will fix the positioning of the drawing relative to the hitbox. Lets now try to position the hitbox over the blue portion of our sprite. This time, lets use to accomplish this. In the clip below, you can see how quickly we can test out new values: https://github.com/tModLoader/tModLoader/assets/4522492/d17b18ad 1d4b 46fb 90ee dfa43789e484 As you saw, we added to position the hitbox lower on the sprite. Fixing upside down sprite problem You might've noticed that the sprite is upside down when fired to the left. Remember that in our , we have this line of code: . If we rotate our sprite to the left, then it is upside down. We can fix this with . will flip the drawing of the sprite horizontally. To implement this, simply add to the code after the line. No fix: Fixed: Horizontal Sprite Example Things change a little if your sprite is oriented horizontally. Here is our new horizontal sprite, which is now 70x48 and oriented horizontally, pointing to the right instead of up as before: Once again, we can see that the hitbox doesn't line up: https://github.com/tModLoader/tModLoader/assets/4522492/50312b6e ecc8 46fe b356 f50b9164290e Unlike the vertical example, this time we set directly instead of adding additional 90 degrees. After some experimentation, we arrive at the following for a hitbox on the tip: These values are a bit odd because of some math Terraria is doing, so here is the algorithm for calculating them: Here is a diagram: If you don't like fighting against the vanilla projectile rendering code, you can always draw the projectile yourself as seen in Fixing upside down sprite problem again With the vertical sprite, using works because it controls a horizontal flip of the projectile sprite. Using a horizontal sprite, a horizontal flip makes the sprite move facing backwards: To fix this, we need to adjust the offsets dynamically and conditionally add 180 degrees or Pi to the rotation. Here is the code: Hopefully these answers can help you solve your projectile hitbox and drawing issues."},{"path":"螺线翻译tml教程/1-基础/6-Basic-Minion-Guide 基础-召唤物指引.md","filename":"6-Basic-Minion-Guide 基础-召唤物指引.md","title":"6-Basic-Minion-Guide 基础-召唤物指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic Minion Guide In this guide we will go over minions, what makes them work, and show basic AI code snippets that most of them share. Introduction A minion is, first of all, a projectile. Not to be confused with a boss minion such as the Brain of Cthulhu Creeper, which is an NPC. That means you are going to extend the class provided by tModLoader. Then, you need a weapon that you use to summon it with, therefore extending . The last thing being the thing that allows the minion to stay alive and to be able to be unsummoned: A . To summarize: This sounds like much, but it really isn't. The majority is going to be the same as the examples (latter two classes) and most of your own code is going to be in the which dictates how your minion behaves. The only 'confusing' part is understanding how all those classes mesh together. Therefore in the accompanying all these classes are in the same folder/file for easier organization. It is highly advised to use an for this guide, because you will see the relationship between the classes easier. ModBuff This class is responsible for the minion to be actually summoned and stay alive, aswell as being able to be unsummoned by right clicking the icon. In addition to that, the buff reapplies itself, guaranteeing infinite duration. If you forget to implement the code, it might lead to your minion still being alive after canceling the buff the buff being active even though your minion is not summoned It will be the same code for most of the minions you will create, just replace in the provided example accordingly. You can see the full code . ModItem This is your weapon that you use to summon the minion. Mandatory It is for the most part similar to other weapons, here are some notable differences for : Notice how there is no and usually associated with the bottom two lines. It is because buff time would be displayed on the item tooltip ('1 minute duration' for example, which doesn't make sense because minion duration is infinite), and the minion has its own movement code rendering shoot speed useless in most cases. This is needed so the buff that keeps your minion alive and allows you to despawn it properly applies. You can see the full code . ModProjectile This is your actual minion file where most of your code will be. It is advised to read up on the whenever you have projectile specific questions or problems. Mandatory (For mandatory right click targeting code, see ) First of all we need a bunch of code that makes the projectile classify as a minion. Defaults In : In : Contact Damage If your minion is supposed to headbutt into enemies (dealing contact damage), you need these two hooks: And in , you need to set to the boolean that says if the minion has a target or not (more on that below). This is needed so the minion doesn't damage target dummies while idling. 'Active Check' In , the first code you write should always be this, just replace accordingly: This is technically all you need for your minion to now be summoned properly. But it doesn't do anything, how do we actually make it do something? Minion AI There are two ways minions can attack: Directly dealing contact damage to the enemy, or shooting other projectiles at it. There are also two ways a minion can move: Affected by gravity, or not. The showcases the simplest type of minion: contact damage + flying (and not colliding with tiles, which makes it even easier). Even a simple minion requires a fair bit of code to do its job properly. Most of the time it boils down to the same few general 'operations' it performs. These are: General behavior (determining idle position, overlap with other minions etc.) Targeting (enemy to attack based on conditions) Movement and Attack Animation and visual effects If your minion does something more complex, you may want to look into designing your AI with states in mind. An example for an NPC that uses states is , same concepts can be applied to a minion. The following code is all written inside the hook (short for ). General Behavior Tasks falling under this category include: Setting up certain variables Aligning itself to other minions (notice how most minions reorder themselves behind you) Teleporting back to the player if the player or the minion got too far away from each other You probably want your minion to be close to you if it isn't fighting? Then you need to give it an 'idle position' where it goes to if there are no suitable targets. Such an idle position might be: Above the player Behind the player, in the line of summoned minions Here is a mix between the two: is its place in the summoned minion list. For further movement, we will also create these variables: For more things that can be done here, look at region. Now we can move on to the important bits: Actually doing something! Targeting NOTE: In 1.4, you can simply use Minion FindTargetInRange in most cases Your minion wants to attack things, so it needs to know what to attack and most importantly, what not to attack. We first create a few variables that we need: We start by iterating through all NPCs in the world, and check if they are even able to be targeted: In there you can now write whatever conditions you want related to the NPC and your minion, such as (examples): You can combine them for example as follows: Once we find a target, we update our search variables, to make sure that we only search for the closest NPC. After finding a target, if your minion deals contact damage, you also need to set its friendly status properly. In combination with this makes sure to only damage things if it has a target. Intermission: Targeting If your summon weapon should support right click targeting, you need the following code before the regular target finding loop: And this in your : Finally, the full code can be seen in the region. Movement And Attack The minion should ideally move with you when it's idle, and move towards enemies when it can. How do we do that? This here provides a simple formula if you want to fly from to . For minions that move on the ground, it is more complicated (more on that at the end). is self explanatory: its desired speed when it's flying straight. is how 'slow' the minion accelerates towards its . Higher values means it will turn 'slower', lower values means its movement will be more twitchy. should be the of its destination (enemy target or idle position), while should preferably always be . We can put this simply into code if we consider (then we use as the , else we use as ), and some nifty checks with distances that we calculated earlier so our minion doesn't 'glue itself' to its destination. For the following movement technique (and shooting) you will need timers, will help you out. If your minion is supposed to dash (like deadly sphere), that means a timed, high increase in velocity in a certain direction, combined with an additional slowdown for a certain time. Since is kept simple, this isn't covered there. Because minions that do contact damage 'attack' while moving, but minions that shoot don't, we need proper shooting code. This isn't in but in at the end of , . (Note: has not been ported to 1.4 ExampleMod yet. Adjust the code accordingly.) You can see the full movement code in region. Animation And Visual Effects Your minion is moving, but not animating (assuming you have a spritesheet for it), so it looks bland. Here is a simple 'cycle through all frames from top to bottom at a given frequency' code snippet. is a variable the game provides that you can use for animation (counting the number of ticks before changing to another frame). is the number of the image (from top to bottom, starting at 0) in your spritesheet. Visual effects can be whatever you desire. Some are more complicated to implement than others. Here are a few easy ones: Lean towards its direction in the x axis: Create light: Create dust: Other things are mentioned in the . You can see the full code . FAQ I want my weapon to summon two minions at the same time, like the Optic Staff 1. In your , set to 0.5f. 2. In your , in the hook, spawn another projectile via . I want to summon a projectile that occupies more than one minion slot, or more than one minion (total summoned minion slots bigger than 1) If applicable, see the above answer. Additonally, in your , , assign this the number of minion slots that will be summoned with a single use of the weapon: And in your hook: My minion should be running on the ground instead of flying Coordinating movement with minion states like staying close to the player, jumping at enemies, flying when too far away from the player etc. is more advanced and isn't covered in this guide. Consider the points below. My minion isn't going through platforms when an enemy is underneath it If your minion is not flying, you want to use the hook. You might want to have , and others be fields in your instead of inside , so you don't need to do the target finding code again here (see ). If you do that, make sure to reset them back to their defaults in so everything resets itself. I want to do something exactly like vanilla/something not shown in the examples Your best bet is taking a look in vanilla source code yourself, the guide is found . I want to make something like the Stardust Dragon Some of its code (mainly the replacing/adding new segments part) is very hardcoded. Most you can do is summoning all segments necessary at once."},{"path":"螺线翻译tml教程/1-基础/7-Basic-Dust 基础-粒子效果.md","filename":"7-Basic-Dust 基础-粒子效果.md","title":"7-Basic-Dust 基础-粒子效果","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic Dust Dust is the name we give those tiny particles that add visual elements to weapons and other things. Dust are completely visual and should never be used as a gameplay element. This is because the amount of dust spawned by Terraria is dependent on the capabilities of the computer. Each dust has an image and an associated behavior. For example, some dust are affected by gravity, some aren't. Some dust randomly move as if caught in wind flurries, while others move straight. These behaviors are all programmed into the dust. Using Dust To use dust, simply call one of the Dust spawning methods. These are listed below. is most commonly used, but foregoes the randomization of spawn position and can be useful. Also note that returns the index of the dust in the array while the other 2 return the instance directly. Here are some examples: Some notes: , , and define a rectangle from which the dust will randomly spawn. The only difference between spawning vanilla dust and modded dust is replacing 4th parameter, which is usually just a number or entry, with . You can omit optional parameters if you want. Special Patterns Use your knowledge of to spawn a number of dust at the same time or over several game updates to make special patterns using dust. Finding Vanilla Dust To find vanilla dust, please consult the image below. Note that it is read left to right, starting from 0. Each row is 100 dust long and each row is actually 3 frames of the same dust, meaning there are 3 rows total. This diagram should help explain how to read the image. A list of all of the dusts can also be found on the . Some vanilla dust do not have official names, so tModLoader has added names for them. If an internal name is not listed on the official wiki, consult to find the name of the missing dust. The easiest way to try out Dust, however, is to download and use the Dust spawning tool to find the dust you need. Video of Dust Tool: https://github.com/tModLoader/tModLoader/assets/4522492/0d42395f 3b38 43c6 9693 c096ce71ac7c ModDust While vanilla dust are all 10x30 pixel images comprising 3 frames of animation, can be any size and any amount of frames. See ExampleMod for many different dusts."},{"path":"螺线翻译tml教程/1-基础/8-Basic-NPC 基础-NPC.md","filename":"8-Basic-NPC 基础-NPC.md","title":"8-Basic-NPC 基础-NPC","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click What is an NPC An NPC is a \"non player character\", in Terraria these are enemies, critters, townspeople, and rarely projectiles disguised as NPCs that you can damage (imp fireball, dark caster's water sphere). This page is very incomplete; For other NPC related pages, visit the wiki search bar Spawn projectiles If you want your hostile to spawn projectiles, first of all make sure the projectile you spawn is hostile and not friendly, so that it won't damage other hostile NPCs and so that it will damage players and friendly critters. This code usually goes in the hook. It shows the most common scenario: shoot one projectile from the NPC directly towards the targeted player (usually the nearest): You can emit the code if you already have it in your . You want to couple this usually with a , and if you want to spawn it some other way, showcases a few variants you can transfer over (logically, don't copy its code into the NPC, it won't work). Visit the documentation for more info. Frequently Asked Questions The NPC never spawns or disappears if spawned in manually This can happen if you accidently wrote instead of in . The NPC has much higher stats in hardmode This occurs if the base stats like damage, defense, and lifeMax are comparably small (equivalent to Blue Slime for example). Add in . The spawned projectile deals no damage/disappears immediately Make sure the parameter in is set to . A common misconception is setting it to , which is not what the game expects. The owner exists to determine for what side/client to execute various logic on, such as dealing damage or handling projectile disappearing. The spawned projectile deals way too much damage In expert mode, NPC.damage is scaled up by 2 (by default). Various NPCs also scale in damage again once reaching hardmode (important if you use NPC.damage to spawn the projectile with). In addition to all of that, hostile projectiles gain an automatic x2 damage, with another x2 added for expert mode. If you want to counteract that, halve the damage before spawning the projectile, and again in expert mode."},{"path":"螺线翻译tml教程/1-基础/9-Basic-NPC-Drops-and-Loot 基础-NPC掉落与掉落物.md","filename":"9-Basic-NPC-Drops-and-Loot 基础-NPC掉落与掉落物.md","title":"9-Basic-NPC-Drops-and-Loot 基础-NPC掉落与掉落物","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic NPC Drops and Loot This guide will teach the basics of dropping items when enemies are killed. Please note that this page only applies to 1.3 tModLoader. NPC Loot in 1.4 tModLoader is completely different, see ModifyNPCLoot usages in ExampleMod for examples and . Basics We use the NPCLoot method in either our ModNPC class or our GlobalNPC class to specify the items the drop from enemies. ModNPC.NPCLoot() vs GlobalNPC.NPCLoot() There are 2 places we can put NPC loot code. If our mod adds an NPC and we want specific drops for that NPC, please put the relevant code in that ModNPC class. If we want to add drops to vanilla NPC, put code in a GlobalNPC class. If we want to add drops to all NPC, such as how Dungeon Chest keys or Souls drop, put the code in GlobalNPC. Remember, organization is key for maintainability of your mod. Item.NewItem Throughout this guide you will see the method being called. See to see the parameters. This method spawns an item into the game world. The item is spawned centered into the area specified by the parameters. How do I specify my item? In the examples below, we drop a vanilla item: . This can be swapped for an item from your mod by replacing that with Drop 1 item all the time The following shows the most basic example. This code will drop 1 Bee Gun every time this ModNPC is killed. Additional drops We can add additional drops by adding other lines of code. Stack Size If we wish to drop more than one item in a stack, specify the number to drop. Drop Per Player or Instanced //TODO per player Instanced If you want an item to drop like boss bags do (one per player, clientside (other players won't see the drops that belong to other players)), use the method: The last two parameters are stack size, and if an interaction is required between the NPC and the player for it to drop. Randomness Most of the time, we don't want an item to drop all the time, but rather with a small chance. We can use a random number generator to give our items a chance to drop. We will use to do this, usually . Random Chance If we want a 1 in X chance, the following code is recommended. Note that the method returns a number from 0 to max 1. In the following example, the returned value possibilities are: 0, 1, 2, 3, 4, 5, and 6. (Never 7!) Also, don't change the 0. Random Stack Remember, Main.rand.Next(int) could return 0 and doesn't return max value, so use one of the following. Specific Chance Sometimes, a 1 in X ratio might not be what we want. We can even do specific percentages. Other Conditions There are times we want to check other conditions, such as expertMode or current biome. Using Conditions We can add conditions to our NPCLoot code using logical operators such as AND (&&) Double Expert Mode Drops The following is an example of doubling expert mod drops. You can do it however you want, just make sure the logic is sound. Different Expert Mode Drops If you want to be more specific with your expert mode conditions, or any other condition, use an if else statement. Biome or Location The following shows the code for how vanilla drops Soul of Light. Note that this example is more suitable for a GlobalNPC class rather than an NPCLoot class since it add drops to all NPC that die in the biome/zone. Custom Biome Replace in the above example with . Player who killed NPC Sometimes we want to do something for the player who attacked the NPC last. NPC has a lastInteraction field that will default to 255, meaning no player has damaged the npc. It is possible for an NPC to die with lastInteraction still being 255 if townNPC or traps deal all the damage to the NPC. Because of this, usually code meant to reward or affect the player who killed the NPC might look something like this, falling back on FindClosestPlayer if needed: Random Choice Many times we want to drop a random item from a set of choices. There is the naive way and a better way. The above code could also be replaced with a switch statement. A better way: This second method is a lot easier to maintain. You can also assign different weights to different choices. This usage is probably more Advanced or Expert level, but I thought I'd mention it. One more way: What about Vanilla NPC? If you would like to have an item drop from a vanilla NPC, all the same ideas apply except that instead of putting our code in our ModNPC class, we put code in a GlobalNPC class and use an if statement to filter out npc drops we don't want to affect Special Cases Some vanilla bosses require special conditions to detect when they are killed and ready to drop their loot. Eater of Worlds: The Twins: Other approaches NextBool There is a NextBool method you can use if you want to use it rather than comparing a random number to 0 Not covered in Basic level BlockLoot Let us know."},{"path":"螺线翻译tml教程/1-基础/9-Basic-NPC-Drops-and-Loot-1.4 基础-NPC掉落与掉落物-1.4.md","filename":"9-Basic-NPC-Drops-and-Loot-1.4 基础-NPC掉落与掉落物-1.4.md","title":"9-Basic-NPC-Drops-and-Loot-1.4 基础-NPC掉落与掉落物-1.4","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Basic NPC Drops and Loot This guide will teach the basics of dropping items when enemies are killed. Please note that this page only applies to 1.4 tModLoader. NPC Loot in 1.3 tModLoader is completely different, see for details. Basics Terraria maintains a database of rules that dictate the items that each NPC type drops. This database is populated during mod loading. This data can be viewed by the user by visiting the Bestiary. We use the method in either our class or our class to register the rules that dictate the items that drop from enemies. In addition, all bag items that drop items are also structured in a similar manner through . Why did loot change from the old system? The 1.3 system of loot relied solely on code to dictate the drops and as such the resulting item drops for a particular NPC could not be reliably determined. The new system maintains a database of rules that helps populate the Bestiary feature as well as facilitate mods tweaking item drops. For example, in 1.3 it was impossible to add an item to a set of item drops without risking breaking other mods. The new system allows item drops to be much more reliably adjusted. IItemDropRule Every item drop rule is an instance of the class. There are many varieties of which will be explained later. Each rule has logic that dictates the item, stack size, and chances of the item dropping. ModNPC.ModifyNPCLoot() vs GlobalNPC.ModifyNPCLoot() vs GlobalNPC.ModifyGlobalLoot() There are 3 places we can put NPC loot rules. If our mod adds an NPC and we want specific drops for that NPC, please put the relevant code in the hook in the class. If we want to add drops to specific vanilla NPCs, put code in the hook in a class. If we want to add drops to all NPC, such as how Dungeon Chest keys or Souls drop, put the code in . Drops added to all NPC are called global rules and do not show in the Bestiary. Remember, organization is key for maintainability of your mod. How do I specify my item? In the examples below, we drop a vanilla item: . This can be swapped for an item from your mod by replacing that with Full Example This example shows the basic file layout. The actual rules will be taught in below. Although the following examples exclude the using statements typically found in code for brevity, the following using is required for drop rules and drop conditions: There may be other missing using statements necessary for these examples which will not be written here. Adding Drops to a ModNPC Adding Drops to a Vanilla NPC Special Cases Some vanilla bosses require special conditions and rules to detect when they are killed and ready to drop their loot. Eater of Worlds: The Twins: Adding Drops to all NPC (Global Rule) Prerequisite Knowledge Chance (Denominator and Numerator) The chance of an item is usually shown the the user as something like 25%, but in code, it is represented as a fraction. Fractions are composed of a numerator, the top number, and a denominator, the bottom number. For example, the fraction corresponds to 25%. Many loot rules only use a denominator and assume a numerator of 1, but there should be other options available to construct a loot rule with a non 1 numerator. Luck // TODO: what is luck? how does it affect drops? Which rules are affected? Typical Item Drop Rules Now that you know where to put item drop rules, now we will learn how to make actual rules. Many rules have multiple ways of creating them. The most common approach is to use the static helper methods in the class, but you can also directly create the rules with the underlying class. Each of the rules described below must be registered to the loot database. For example, if the rule you wish to use is , then the code you will end up writing will be . Drop a Single Item Or: This rule will drop the item at the chance given by the parameters provided. The stack size of the drop can also be controlled: Drop One of Many Items or or This rule will drop 1 item from a selection of item options. This is typically what bosses use to drop one out of their set of boss weapons. The situation is a bit more complicated with bosses since they usually conditionally drop boss bags. Read the LeadingConditionRule section for more info. Drop a Single Item with a Different Expert Mode Chance or Many useful items drop more frequently in expert mode. Conditionally Drop Items or By passing in a , an item drop rule that only drops items when certain conditions are met can be constructed. Drop items if other Rule not chosen See for information on branching rules. Drop items like The Twins This requires a custom condition, see below. You can look at the code of as a guide for how to implement. Drop stack of item one by one like Lunar Fragments See for an example of using . Boss Bag See below Instanced or Per Player // TODO Etc // TODO: Add other common rules here Conditions (IItemDropRuleCondition) Many drop rules allow for an to be provided. This object dictates what conditions are needed for the drop to occur. Common conditions include current events, bosses defeated in the world, normal vs expert mode, current biome, and so on. // TODO: Biome, Boss downed, Expert Custom Condition You can create your own condition if needed. See in ExampleMod and the usages of it for an example of custom conditions. First Time Boss Defeated Condition Plantera has a guaranteed drop of the Grenade Launcher and 50 149 Rocket I. Here is that code: From this setup, the rules dictate that when not in expert mode, if it is the first time killing Plantera, then the Grenade Launcher is guaranteed to drop. When it is not the first time, one of the 7 rules will drop. The important part is the condition. This code is shown below: The important part is the method, which simply checks (meaning it can drop when the boss hasn't been defeated), which is how the game tracks Plantera being defeated in the world. Crucially, NPC drops are calculated before boss flags like are set to true, that allows this to work. This same approach can be used for other vanilla and modded bosses. Only exists in the code, but a modder can create a for any other boss by using the appropriate . Modded bosses can also be done in the same manner, except tracked with the Chaining Rules Rules can be chained together to form more complex item drop logic. For example, one of the Queen Bee drops is 1 of 4 options. 33% chance Hive Wand, 11% chance for each of Bee Hat, Bee Shirt, and Bee Pants. To form this logic, the following code is used: First, the HiveWand is dropped with 33% chance but only if the world is not expert. Chained to that item drop rule via the method is a rule that drops one of the 3 bee vanity set items with a 50% chance. The rule chained via is only used if the original rules condition was met but the random chance failed. Since there is a 66% chance that the 50% chance will be attempted, the final chance is 33% chance for one of the bee vanity items, or 11% chance each. Other options for chaining include and . runs if the original rule succeeds and runs if the conditions failed. Using a rule called , a set of rules can be nested under a single rule rather than repeating the same conditions for each rule. This code defines a rule where is dropped with a 25% chance and 10 to 30 are dropped with a 50% chance, but only if not in expert mode. Other common patterns are dropping a full armor set at once, or a weapon with its special ammo. The approach is similar. Common Mistakes One common mistake is accidentally adding chained rules as normal rules. This results in the conditions seemingly not working. This is an easy mistake to make. Lets take the / example from earlier. If the modder writes the following, the condition is seemingly ignored: The issue here is that the is actually not added as a drop rule. The method returns the rule being chained, resulting in the 2 rules being added directly by accident, and therefore ignoring the condition. When using , , or , make sure to use them as statements separate from and only add the once after all the chained rules have been chained to it. Full Boss Example In Terraria, bosses drop different items depending on the game mode. In expert mode, a boss bag is dropped for each player. In normal mode, the items that would come out of a boss bag except expert only items are dropped instead. This example shows this pattern. You can view the code on the and the corresponding code on the , below is a minimal example to showcase it: Consulting vanilla drop code If you are curious how various vanilla drop rates correspond to code, it would be beneficial to read the decompiled code. All vanilla drops are found in the class. Use the find tool with the NPCID number of the NPC you are interested in to find relevant snippets of code. Example // TODO: example of finding a particular rule from the code Player who killed NPC // TODO: This section is still 1.3 approach Sometimes we want to do something for the player who attacked the NPC last. NPC has a lastInteraction field that will default to 255, meaning no player has damaged the npc. It is possible for an NPC to die with lastInteraction still being 255 if townNPC or traps deal all the damage to the NPC. Because of this, usually code meant to reward or affect the player who killed the NPC might look something like this, falling back on FindClosestPlayer if needed: Editing drops You can edit drops as well. See to learn more. Not covered in Basic level Let us know."},{"path":"螺线翻译tml教程/1-基础/EX0-Basic-tModLoader-Usage-Guide 基础-tModLoader用法指引.md","filename":"EX0-Basic-tModLoader-Usage-Guide 基础-tModLoader用法指引.md","title":"EX0-Basic-tModLoader-Usage-Guide 基础-tModLoader用法指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Learn the basics of using tModLoader for both players and modders If you run into problems, see the Installing tModLoader Installing Mods Mods are files with the \".tmod\" extension. The most common way to get mods is through the in game Steam workshop menus. This will work for GOG users as well. From the main menu, click and then . You can then search and find mods to download. Alternatively you can visit the directly and subscribe to mods on that website. It is highly recommended that you visit the website and/or read the description of mods you want to download. Many mods change game mechanics so familiarizing yourself with the changes will help avoid confusion. If you manually download a mod, you can place it in the folder. Note that this mod will not auto update and will appear as purple in the mods menu to remind you that it is manually installed. Manually installing mods is mostly useful for users helping to test a mod, normal users should always use the workshop approach. Enabling Mods Use the menu to set the mods you wish to use, then click back to reload. Playing with non tModLoader users tModloader will not connect to non tModLoader Terraria servers. If you want to play together, you must either use Terraria, or your friends must install and launch tModLoader. Think of them as 2 completely separate games. You can learn more about running a modded server . World and Player Backups Modding games is inherently prone to bugs, and bugs could cause your world or player to be unplayable. Because of this, tModLoader maintains multiple backups of your world and player files. The player backups are in and the world backups are in . (Replace with the corresponding to your tModLoader version.) If you find that you can't load a world or player anymore, you can roll back to a previous save by restoring the files from one of these backups. You'll lose some progress since the last save, but it is better than losing everything. Restoring a Backup In the backup folder, you'll find many zip files. The files are named with the date of the backup followed by the name of the player or world. These instructions will show the process for restoring a world backup, but the process is exactly the same for a player backup, except for folder and file names. For example, if your folder has the files and , then you have 2 backups of the world \"CoolTown\", one from February 21st, and one from February 19th. If the current \"CoolTown\" isn't loading in tModLoader, you can attempt to restore backups in reverse chronological order until it finally works. First, let's make a backup of the current world files that aren't working. You want to do this since the issue could be a broken mod you are using, and you'll want to be able to restore to the latest save if that is the case. Find and , copy and paste them to a safe location, something like should be fine. Make sure you have \"File Name Extensions\" visible, so you are sure you are backup up the and files instead of the and files. If you can't find these files, you might have the world on the cloud, if so, move the world off the cloud first, then follow the steps. Now that you have a backup of the latest save, open the newest .zip file for the world backup you wish to restore from the folder and copy the files to the clipboard. Navigate back to the Worlds folder and paste. Make sure to say \"replace files in the destination\" when asked. Now, open tModLoader and attempt to load the World. If it succeeds, great, if it fails, try again with the 2nd most recent backup. You can use cheat mods like or to restore lost items, if you wish. If you can't get backups to load, your issue is likely a broken mod. You can for hints as to which mod is erroring, or come to for help. Paths Here are some useful default paths: Install In Steam right click on in the library, then hover over and click on . The folder that opens is the install folder. Video instructions https://github.com/tModLoader/tModLoader/assets/4522492/0dac7f15 520e 434e b180 5c584583ddf3 If you use GOG, the game is installed wherever you installed it. The install instructions instruct the user to install tModLoader to a folder next to the Terraria install folder. The default locations are listed in the next sub section. If you have a desktop or start menu shortcut, you can right click on it and select to open the install directory location directly. Default Install Locations Steam: Windows Install: Linux Install: or Mac Install: GOG: Note: These locations are only suitable if the Terraria folder exists in the same location because tModLoader must be installed next to Terraria. Windows Install: or Linux Install: Mac Install: Saves Every major version of tModLoader uses it's own save folder. Replace in the next section with the one that matches the version you are currently on. Windows Saves: (This is typically found in ) Linux Saves: or Mac Saves: Cloud Steam keeps a local copy of cloud data on the computer. This is useful if you need to copy cloud players or worlds from Terraria or tModLoader to the local saves. tModLoader data will in the tModLoader sub folder: Windows Cloud Saves: Browser Cloud Access: Mods Your manually installed mods are stored in a subfolder of the folder called . Workshop mods are stored in , but you shouldn't touch the folder and instead unsubscribe in steam. Logs The Logs are found in a subfolder of the folder called . If you are sharing logs for support with game breaking issues, please post all log files. Just and/or (if relevant) is sufficient if the issue happens in game."},{"path":"螺线翻译tml教程/1-基础/EX1-Basic-tModLoader-Usage-FAQ 基础-tModLoader用法常见问题.md","filename":"EX1-Basic-tModLoader-Usage-FAQ 基础-tModLoader用法常见问题.md","title":"EX1-Basic-tModLoader-Usage-FAQ 基础-tModLoader用法常见问题","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Table of contents The Cloud File Provider is Not Running System.IO.IOException: The cloud operation was unsuccessful System.IO.FileNotFoundException: Could not find the file ...tModLoader Mods Basic Troubleshooting Information This guide will attempt to help users fix many common issues. Please search through this document for the error you are experiencing. You can use to use your web browser to search this page for a word (such as an exception name or error message). If you can't find anything relevant, please try all the suggestions in . If nothing there helps, you can pursue direct support in the . Do note that this guide mostly concerns issues with tModLoader itself. If you have an issue with a specific Mod or combination of Mods, see Note on tModLoader 64 bit Please do not attempt to install \"tModLoader 64 bit\" into tModLoader, it is no longer useful and will prevent the game from launching correctly. If you have previously installed it and are experiencing issues, your first troubleshooting step is to do a . You will also need to clear out the by following . Note on Piracy If you pirated Terraria, we can't help you. tModLoader won't work. Please don't bother us by asking how to get it to work. General Troubleshooting Steps These steps should be followed if your specific issue is not found in the later sections of this guide. Switch to Stable tModLoader or to Preview tModLoader If you are on a version of tModLoader, there is a greater possibility of tModLoader breaking, so you should switch back to tModLoader (The beta branch) to see if that solves your problem. Conversely, sometimes bugs are fixed in versions, so you can switch to the from to test and see if the upcoming monthly release has a fix for your issue. Switching tModLoader branches In Steam, right click on , select , select , then select or in the dropdown. Ignore the access code section. Close the Properties window, you should see tModLoader downloading an update, once it finishes you can launch it. Video instructions: https://github.com/tModLoader/tModLoader/assets/4522492/bfcacae5 00e2 4488 a778 d2cf214299af If you switched to a version and your issue is resolved, remember that is mostly for mod makers and testers and you may find that some mods you use are now broken. The fixes being tested in versions will arrive in tModLoader near the start of each month (unless there is an extended preview window). If you can avoid the issue, waiting until the start of next month might be better than staying on a version. Verify Game Integrity Verifying game integrity will restore all files installed by tModLoader in the install folder to their original state. In Steam right click on in the library, then click on click on . Click on . This should start a download of the now missing files. Once that is done, try tModLoader again to see if you issue is resolved. If it isn't, or you are on GOG, follow the instructions. Verify integrity of game files video instructions https://github.com/tModLoader/tModLoader/assets/4522492/650c43d3 1bac 49e9 aa5e 32aa91f076cf Verify Game Integrity Terraria tModLoader loads files from the Terraria install folder. Do the same steps above but for Terraria. If you joined the or Terraria beta branch make sure to first switch back to the beta branch. Fresh Install A fresh install solves many issues preventing the game from launching. After doing a fresh install, do not place any other files in the install directory. First, open up the . Make sure you opened the install folder, not the saves folder. The saves folder has folders named \"Players\" and \"Worlds\" while the install folder has folders such as \"tModLoader Logs\" and \"LaunchUtils\". Now that the install folder is open select all the files and folders and delete them all . Next, reinstall tModLoader: Steam install: In Steam right click on in the library, then click on click on . Click on . This should start a download of the now missing files. In the install folder, you should see the files start to appear again. GOG install: Install as normal, to the same folder as before. Fresh Install Terraria tModLoader loads files from the Terraria install folder. Do the same steps above but for Terraria. If you joined the or Terraria beta branch make sure to first switch back to the beta branch. Disable All Mods If you are experiencing an issue, it is useful to confirm whether the issue is caused by a Mod or by tModLoader. Usually the cause of issues can be determined by reading the error messages in game or by , but if not, disabling all mods and confirming that the issue still happens or doesn't happen is useful. First, visit the mods menu and click (if your issue is preventing you from getting to the main menu, you can either hold the shift key while the game is launching to skip loading mods or find \"enabled.json\" in the Mods folder in the saves folder and delete it). Close tModLoader and launch it again. Attempt to replicate the error you experienced before. If the error still happens, it is a tModLoader issue and you should try . If the error doesn't happen, you will need to use the to identify the mod causing the issue. After Disable All Resource Packs Resource packs can cause issues, disabling all resource packs and then testing again can rule out the resource packs as being the issue. To disable resource packs, you can visit the menu and disable all packs. If you can't get to that menu, close the game, open up in a text editor, find the \"ResourcePacks\" section, then change all true to false, save the file. Reset config.json The holds user preference information. Sometimes a buggy value in it can cause issues. You can delete or rename the file to reset preferences to default values to test if it was causing your issue. Open up and find . Rename to . Renaming it lets you restore it later if you want. When you launch tModLoader, you should see the menu, if you don't, you might have edited the wrong file. If doing this doesn't change anything for your issue, you can close tModLoader and rename the file back to after deleting the newly generated . You can do the same for the file if your issue is related to keyboard, mouse, or gamepad issues. Flowchart Sometimes a mod is causing issues, but you can't tell which mod is the problem. Use this flowchart to diagnose and determine the bad mod: Reading client.log Simple Explanation Most bugs in tModLoader will appear as errors logged to the file. Read the file to find mods that are potentially causing bugs. Close tModLoader, then reopen tModLoader and repeat the steps necessary to trigger the bug. Open the file in a text editor, such as notepad. The file is found in the To easily open the folder copy to the clipboard with and paste it into the address bar in the file explorer with . Press enter and the file explorer will go to the folder. If a window pops up asking \"How do you want to open this .log file?\", find Notepad in the list, click it, click OK. Scroll down until you see the first exception in the file. It should look like the image below. Look for indentation followed by the word \"at\", these lines are the details of the exception. Each exception like this in the log is caused by a bug. Look through the exception to find the names of mods you have enabled. The first word after \"at\" on the lines and before the period is where the names of mods involved in the exception will be shown. Words like \"Terraria\", \"Microsoft\", and \"MonoMod\" can usually be ignored. In this example, the mod named \"GadgetGalore\" in the exception and is likely a broken mod. If there are multiple mod names in a single stack trace, either mod could be at fault, or both, you'll have to do some testing. After finding a mod in an exception, disable it the next time you launch tModLoader and see if the same bug triggers. Repeat the above steps if there are additional mods that are causing bugs. If you need help reading your client.log, you can ask for help in the support forum channel on the . Complicated Explanation Many errors you might experience while playing tModLoader can be identified by reading the file. (If you are experiencing an error that only happens in multiplayer, you'll need to read both and ). By properly reading the log file, you can identify if an issue is caused by a bug in tModLoader or a bug in a mod you are using. Since tModLoader updates to new versions every month, a mod that worked yesterday might be broken today. In any case, the logs are a good place to find the issue. If you are experiencing a bug, first make sure all mods are up to date, then close tModLoader and reopen it. This will reset the log and make it easier to read. Once you experience the bug, close tModLoader and open the log file. The log file is the file found in the . Open the file in a normal text editor like notepad if it doesn't have a file association already. Next, you'll want to look through the file looking for words like \"error\" or \"exception\". Using to use the Find feature of your text editor. You'll typically want to focus on the earliest error you can find in the log file. Errors that come after earlier errors might be caused by those earlier errors, so fixing the earlier errors might fix the later errors. Once you find the word \"error\" or \"exception\", you should see something similar to this: In the above excerpt from , we can see an error is being logged. The error begins at line 41, with a brief summary on line 42 shown in blue. After the error summary, there will be a \"stack trace\" that shows where in the code the error is happening. Take note of the indentation of the lines of the stack trace, shown in green. This indentation is very useful for quickly finding errors logged in the log file rather than using . Next, you'll want to look through the stack trace for the names of mods you have enabled. The first word after \"at\" on the lines and before the period is the key word you'll want to look at. Words like \"Terraria\", \"Microsoft\", and \"MonoMod\" can usually be ignored, you want to find the mod or mods that show in the error. In this example, we see a mod named \"GadgetGalore\" in the stack trace and can make the assumption that it is the cause of the error. If there are multiple mod names in a single stack trace, either mod could be at fault, or both, you'll have to do some testing. Now that we found a mod that is erroring, you can disable the mod and try again. Not every error logged in the logs will an actual bug, so some experimentation may be required. If you need help reading your client.log, you can ask for help in the support channels on the . Getting Support If everything in this guide fails to solve your issue, you may need direct support. Support issues fall into two categories: and tModLoader Support If you need basic support to get the game running, see , otherwise start at GitHub Issue Tracker If your issue is not solved by this guide and you still need help first check and search for your issue to see if it has already been reported. If you find your issue, please add a :thumbsup: reaction to the issue to help us prioritize issues. To add the :thumbsup: reaction, click on the smile icon on the top right, then click on :thumbsup:: It might also be useful to add a comment to the issue with and other useful information you can provide to help identify the cause of the issue. There might also be a workaround in the comments that you can follow to fix the issue on your end. Discord Support If you do not find your issue in the issue tracker, you should visit the channel on the . Discord is a free chat service you can access in your browser. We will not provide support for support issues here on GitHub. Once you find the channel, make a new thread and describe your issue. You'll also need to post all your logs by opening up the and dragging the files into the chat. Someone there should be able to help you. Post logs to Discord video instructions https://github.com/tModLoader/tModLoader/assets/4522492/3f4efa43 753f 4733 b630 ba85e711340c Mod Issues If a specific mod is causing your issue, you should visit the . Read the and see if the mod maker has a preferred contact method for bugs, such as a or . If there is one, use it. If not, making a comment on the workshop page with your issue should let the creator know. If the bug is game breaking, you will have to disable the mod or wait for it to be fixed by the author. It has been detected that this mod was built for This message is a boiler plate message, it is purely informational. If the version starts with , then you are trying to load a legacy mod and it won't work, you need to delete the mod and find it or a replacement on the current mod browser. If the version starts with , then you should look at the next paragraph in the error message for the real error. If multiple mod names show up in the error, it may be a mod incompatibility. The author will be able to figure it out. JITException If you see this, the mod might be out of date. tModLoader updates every month and sometimes those updates will break mods. If it is the start of a month, the author might just be slow in updating. You will have to disable this mod until it is fixed. If you manually installed a mod, the mod will be purple on the menu and you should delete it and use the workshop version. Launch Issues Some users have reported issues when Terraria or tModLoader are installed on an external drive. If you are having issues not mentioned below, please try installing on your normal hard drive. hostpolicy.dll error Follow the instructions in the section. Windows Version N and KN are missing some features / unable to load mfplat.dll You will need to download the Windows Media Pack, as it wasn't shipped with your Windows installation. Follow this . You'll need to expand the \"Replies\" section to see the 1st answer. Users have reported that if installing the feature doesn't solve the issue, following the \"method 2\" steps mentioned in the same post, the \"Enabling Media Playback from an elevated Command Prompt\" instructions, worked. Black windows appears and closes but nothing else There are a variety of issues that can cause this issue. If none of these suggestions work, please come to the Launch tModLoader Manually Sometimes launching manually can bypass certain launch issues. Open up the and double click on \"start tModLoader.bat\". If this works, you should still try to fix the issue through other steps here or in since launching this way is inconvenient. If, when you try this, an error message shows \"Windows cannot find '[InstallFolderHere]/start tModLoader.bat'. Make sure you typed the name correctly, and then try again.\", then somehow your Windows has been corrupted and has a bad file association for files. This issue will prevent your computer from running any file, which might affect other programs, so it would be good to fix. Users have reported that following the steps in have worked for them. If the window immediately closes, one reported cause of this is the command prompt itself being broken. Try opening the command prompt from the start menu. If you can not do that, your computer is in a broken state and that will need to be fixed before attempting anything else. One user reported that their computer had a bad value in their registry, they followed to remove the bad registry value. If this isn't the case, you'll need to google for some other fix to command prompt not launching. Fresh Install Follow the and steps. This may seem like a lot of effort but it solves a large portion of issues. Delete folder Deleting the folder in the might help. If the issue persists, check that your antivirus isn't quarantining any of the files. The folder should have items in it. If it doesn't, ensure that your OS is 64 bit and install the listed for your OS before deleting the folder and trying again. Note: If your console window indicates that it is having trouble downloading dotnet on GOG, then you can manually download and place it in the folder in the . The file should be named . Delete the folder once again and try launching again. If you are still having issues, and or the mentioned files are not all there, you can manually install the included dotnet. Delete the folder, then make the folder again and open it. In a separate file explorer window, open the file, you should see 2 folders and 3 files contained within. Drag all of those folders and files into the folder you created earlier. If you are still having issues with dotnet, some users have reported that installing the to their computer after deleting the folder fixed the issue. Our guess is that the full installer fixes some issues that were preventing our installer from working. If you are still having issues after a reinstall, make sure \"Run this program as an administrator\" is not set on . Check \"Run this program as an administrator\" setting instructions Open the folder and right click on and select . Click on the tab. Look for a checkbox and make sure it is unchecked. Click and try running the game again. Check Natives.log In the , open up . If it says \"An assembly specified in the application dependencies manifest (Microsoft.NETCore.App.deps.json) was not found\" or something similar, double check that you followed all the steps in Delete folder suggestion above. If it says \"System.AccessViolationException: Attempted to read or write protected memory.\", follow the and steps. If it says \"Assertion failed: !FAILED(hr) && \"Failed to find supported audio format!\"\" or \"Assertion failed: !FAILED(hr) && \"Failed to activate audio client!\"\", follow the Change audio devices section of . If it says \"./LaunchUtils/ScriptCaller.sh: exec: line 83: C:/Program Files (x86)/Steam/steamapps/common/tModLoader/dotnet/dotnet.exe: Invalid argument\", follow the steps. If it says \"Fatal error. System.AccessViolationException: Attempted to read or write protected memory. This is often an indication that other memory is corrupt. at System.Globalization.CompareInfo.IcuCompareString(System.ReadOnlySpan'1 , System.ReadOnlySpan'1 , System.Globalization.CompareOptions)\", then open up in the install folder and add before the line and save. If it says \"Could not load ICU data. UErrorCode: 2\" follow the instructions in the bullet above. If it says \"Assertion failed: 0 && \"Effect output format not supported\", file C: Games Terraria tModLoader FNA lib FAudio src FAudio.c\" then disable the TerrariaAmbiance mod or adjust your selected output device output rate to be 48000 Hz or 44100 Hz. If the file is completely empty, you may have to try many different suggestions on this page. The most recent report of this issue was fixed by reinstalling or fixing the install as mentioned in the and then restarting the computer. Another recent report of this issue was caused by an attached USB controller. In this user's specific case they had Xbox 360 Controller Emulator (x360ce) installed. The issue came from a related driver from mayflash, specifically a driver located in . Disconnecting the controller fixed the issue. It may be possible to update this driver, but that was not tested. If nothing else works, you might need to come to and ping jopojelly with a minidump file. The instructions for that are shown below. Collect Minidump Instructions A minidump file can be generated to provide tModLoader developers more information about a bug causing a silent crash. A silent crash is a crash that has no errors in any of the log files. There is no need to follow these instructions for crashes that have errors reported in any of the log files. Expand for Minidump Instructions To do this, download https://download.sysinternals.com/files/Procdump.zip and extract the zip into the tModLoader install folder. Make a folder called in the install folder. Open a command prompt in the tModLoader folder by typing in the file explorer address bar and then pressing enter. This will open a command prompt, make sure it's your install folder: In the command prompt, type and then press enter: The game should start loading and then crash at the point where it crashes. Once it does, check the folder for a file. This is the file you'll need to upload to the Discord forum post (you can just drag and drop it into Discord). Make sure to also ping jopojelly, a tModLoader developer, for help for this particular issue. If you don't have a file, then we can investigate further on Discord. Disable Proton Do not use Proton on Linux, it will not work. If you did, you'll have to after disabling Proton for tModLoader. If you made players and worlds while launched with Proton, you'll need to move them to the correct save directory to use them once again. To do this, find the Proton save location by opening up . You can take all of the files, or just the files you want, and copy them over to . Check launch.log Open up found in the . If the word \"FAudio\" shows up in your log, you might want to try the If after applying the workaround, you see \"Unable to load DLL 'FAudio' or one of its dependencies: The specified module could not be found. (0x8007007E)\", then one possibility is you didn't follow the instructions to replace all of the files with the files from the .zip and only replaced the FAudio.dll file. All the files need to be copied over. Disable RGB Keyboard Features Even if you don't think you have RGB keyboard, this can help. Follow the instructions. Restart Computer Restarting the computer solves many issues tModLoader users face. It may seem trite, but it works, give it a try. \"Terraria is out of date\" or \"Terraria is on a legacy version\" If you get a message saying \"Terraria is out of date, you need to update Terraria in Steam\", then follow the steps. If you get a message that \"Terraria is on a legacy version, you need to switch back to the normal Terraria version in Steam for tModLoader to load\", then follow the steps after switching back to the normal Terraria beta branch. To do this, right click on Terraria in Steam and select , click on , then select in the dropdown menu. An error occurred while updating tModLoader (missing executable) This is usually solved by restarting the computer after confirming that you have switched to the branch for tModLoader and verifying game integrity, and following the next section. Failed to start process for tModLoader: \"The system cannot find the path specified\" This is caused by previously installing . First do a if you haven't already, then right click on in and select . Make sure is completely empty, then close the window. Failed to start process for tModLoader: \"The operation completed successfully.\" 0x0 We've seen this reported when the file association for files was broken. Open up the install folder and look at the file. The icon should look similar to this: If it doesn't, the file association for files has been changed. This shouldn't happen, you might want to scan for viruses. After that, you'll want to use Google to figure out how to fix the file association for your Windows version. Failed to Load Asset (AssetLoadException) This is usually caused by your Terraria install being out of date. First, launch Terraria and confirm that it is updated to the by looking in the bottom right corner. Next, follow the instructions. If this doesn't solve the issue, it might be a mod causing this issue. Texture2D creation failed! Error Code: Not enough memory resources are available to complete this operation. (0x8007000E) This means your computer has run out of video memory, or VRAM for short. This is not the same as free disk space or normal PC memory (RAM), with the exception of non dedicated graphics accelerators in laptops being able to use the latter to compensate for small or non existent amounts of VRAM. Here's some tips that may help: Task Manager's tab can show you VRAM usage and other graphics information. Close programs like browsers, perhaps even Discord as an extreme measure, and try again. Skip loading mods by holding left shift while the game is opening. Texture2D creation failed! Error Code: The GPU will not respond to more commands, most likely because of an invalid command passed by the calling application. (0x887A0006) This is the same as . It has been reported that using OpenGL or Vulkan by following the instructions in the has solved this issue for some users. NoSuitableGraphicsDeviceException: Could not find d3dcompiler 47.dll If you are on Windows 7, you'll need to install the . Restart your computer after running and finishing the installer. NoSuitableGraphicsDeviceException: Could not create swapchain! Error Code: The parameter is incorrect. (0x80070057) This is related to the capability of your graphics card. You can try updating video drivers, or you can try using OpenGL or Vulkan instead by following the instructions in the . System.DllNotFoundException: Unable to load DLL 'vcruntime140.dll' or one of its dependencies: The specified module could not be found. (0x8007007E) If you have this issue, the download site should open in your web browser automatically. Click to download the installer and run it to install these libraries. This should fix the issue, you may need to restart the computer. If it doesn't fix the issue, and try again. You'll want to click on the X64 download. ( ) System.BadImageFormatException: An attempt was made to load a program with an incorrect format. (0x8007000B) Most reports of this issue have been solved by reinstalling or fixing the install as mentioned in the . (WIP solution, investigate more.) Multiple extensions for asset This is caused by an incompatible resource pack. Currently some resource packs are incompatible with tModLoader. To fix this, open up in a text editor, find the \"ResourcePacks\" section, then change all to , save the file. Now tModLoader should launch again. The issue will be fixed eventually, thumbs up the to prioritize this issue being fixed. System.Threading.SynchronizationLockException Solution. Disable BitDefender or disable the Safe Files feature of Bit Defender. Some more info has been collected . Enabling mods freezes the game/Setting controls doesn't work properly. This is most likely related to your antivirus blocking access to the folder in the Documents directory. See the for the process (but do this with the folder instead of the exe) Disk Write Error If you try to install tModLoader through Steam and it gives you a message with \"Disk Write Error\" in it, it is usually caused by Avast. Disable it temporarily and install tModLoader. Controlled Folder Access Controlled Folder Access is a Windows 10+ security feature intended to prevent ransomware. It is a useful feature, but it will get in the way of tModLoader saving files to the Documents folder where game save files are typically installed. If you have this feature enabled, you can add an exception to tModLoader to allow it to work. You can also just disable the feature completely, but don't do that unless you know what you are doing. Adding an exception The easiest way to add an exception for tModLoader is to press on the error, then click on the notification that appears: If the notification doesn't appear within 5 seconds, you can visit the action center at the bottom right corner of the screen and find it there. If it is not there, search \"Controlled folder access\" in the start menu, click it, then click \"Block History\" Click on the first result: Click when asked \"Do you want to allow this app to make changes to your device\": You should now see information explaining that \"dotnet.exe\" was blocked from accessing the (The saves folder is typically ): Click and then : You will once again be asked \"Do you want to allow this app to make changes to your device\", click : tModLoader should now be able to create the save files it needs. Launch the game again. If you followed the directions and still can't solve the issue, a last resort is to tell tModLoader to save to the instead. You can do this by creating a file in the . See the instructions below. savehere.txt save location workaround If you are unable to get the game to launch because of file access issues caused by OneDrive issues, Controlled Folder Access issues, or any other file system issue, there is a final workaround option available that will tell tModLoader to save to the instead of the folder. By saving in the install directory, all complications resulting from saving in can be avoided, but it should be known that this will mean that OneDrive will not sync and backup your files, if you were relying on that feature. Steam cloud saves will still work (players and worlds), but mod configurations and other miscellaneous files will not be backed up as they would if you were using OneDrive to do that. To do the , create a file in the . The video below shows how. savehere.txt video instructions https://github.com/tModLoader/tModLoader/assets/4522492/3c925905 0a4a 4a55 a664 6ddd8dddd995 System.UnauthorizedAccessException: Access to the path is denied. This issue can be caused by your antivirus or windows security settings. If you're using Windows Security (formerly Windows Defender) and are getting this error, then you will need to add \"dotnet.exe\" to your whitelist, for further instructions on how to do this continue reading below. First, follow the instructions in the section above, if that doesn't work then follow the steps below. Adding \"dotnet.exe\" to your whitelist Right Click Windows Security in your system tray and select \"View Security Dashboard\" Left Click \"Virus & threat Protection\" From there, Left Click \"Manage settings\" under \"Virus & threat protection settings\" Scroll down until you find the \"Controlled folder access\" section, and then left click \"Manage Controlled folder access\" Left Click \"Allow an app through controlled folder access\" Left Click \"Add an allowed app\", and select \"Recently blocked apps\" Scroll through the list until you find \"dotnet.exe\", and click the + and then close, after this you're done! (If you cannot find \"dotnet.exe\" on your list, then continue with the below steps) Back in the \"Add allowed app\" selection, left click \"Browse all apps\" Navigate to the and then navigate to and select \"dotnet/dotnet.exe\", then press . This will add the file to your whitelist. Done! Unable to load shared library libSDL2 2.0.0.dylib or one of its dependencies on Mac This has been reported to be an issue when manually downloading the tModLoader zip to install for a GOG user. When downloading files on Safari, the file is tagged by the OS as being from the internet. Users can use the command in a command prompt to clear the flag on the files mentioned. If you have more information about this particular fix, please update this section. No Logs Folder If you are having a launch issue and can't find the logs folder, it has been reported that some antivirus like Comodo are the cause of the logs folder not being generated. This issue has been reported alongside \"SteamAPI.Init failed. Try logging out of Steam and restarting it.\" errors. Another possibility is that you have 2 tModLoader install folders accidentally and are looking in the wrong place for the . Audio Issues IAudioClient workaround Try the . Audio Troubleshooting Audio issues are particularly hard to identify, try these troubleshooting steps if your issue is not listed. For each of these make sure tModLoader is closed while you try these changes: Fresh Install Manually installed wave banks can cause issues, following the and steps will ensure that those files are removed. You might not remember manually installing wavebanks, but other things like installing could do this incidentally. Disable All Resource Packs Follow the instructions. Change audio devices For example if you are using headphones, switch to your speakers. If you don't have speakers, try plugging some in. Try launching tModLoader. Check audio output rate Try changing your audio output rate to be less than or equal to 48000 Hz. The most common output rates are 44100 Hz and 48000 Hz. Rates greater than 48000 Hz may cause crashes while certain mods are enabled. To do this, right click on the speaker icon in the notification area, click \"Sounds\", navigate to the \"Playback\" tab, click on your current playback device and click properties, navigate to the \"Advanced\" tab, then adjust the output rate in the \"Default Format\" section. Voicemeeter If you have Voicemeeter installed and see \"Failed to initialize audio client\" or \"WASAPI\" errors, try changing your A1 A5 to different devices. Even if you change the Stereo Input to a different device, it will still cause device issues if the Default A1 is having issues. Unplug Controllers Some controllers have speakers in them that might be causing issues with our audio playback code, try unplugging them and then launching tModLoader. Reset config.json Follow the instructions. Try the IAudioClient workaround Windows: Try the . Mac No Audio Hardware Try replacing Natives with vanilla Terraria files Replace all files found in with their vanilla copies (libFAudio, libSDL2, libSDL2 2.0.0 at minimum) From To Set Volume to 0 If audio issues prevent the game from launching, open up and find , open the file in a text editor. Find \"VolumeMusic\", \"VolumeAmbient\", and \"VolumeSound\". For each of these, change the number to . Save the file. If this works, the issue is audio related, other steps in this guide might be able to restore audio so you can turn the volumes back up. Multiplayer General Multiplayer Troubleshooting Steps Before looking here for support, first make sure multiplayer works in Terraria itself. If Terraria multiplayer doesn't work, then you'll need to first troubleshoot that issue. There are guides for both and multiplayer on the official Terraria wiki that go over port forwarding, IP addresses, and other necessary steps and terminology. This FAQ only lists multiplayer issues specific to tModLoader and expects that any general networking issues have already been resolved. Additionally, if you are looking for information on how to setup a multiplayer server, then read . Finally, the has most of the multiplayer specific instructions, read that page first and then come back here if your issue is not solved yet. Lag TODO: Disable mods, verify where issue is coming from. One user reported that their anti virus, \"360 Security Guard\", was causing extreme lag. They disabled it to fix the lag. Not Responding When the game stops responding, that is indicative of the game logic being stuck in an infinite loop. This type of issue can be very hard to diagnose. A capable programmer can use a minidump file to investigate the cause of the issue. If the issue is in a mod, hopefully that modder will fix their mod, if it is in tModLoader we can work on fixing it. Minidump Instructions If your tModLoader stops responding and goes white, you can provide us with a minidump file and it will help us debug the issue. Expand for Minidump Instructions To do this, download https://download.sysinternals.com/files/Procdump.zip and extract the zip. Open a command prompt in that folder by typing in the file explorer address bar and then pressing enter. This will open a command prompt: Next, open task manger by pressing ctrl shift escape. Click Details, then scroll down to the dotnet.exe that is Not Responding: Take note of the PID. In this image, it is 20680, but yours will be different. Go back to the command prompt and type , except change 20680 to your number. After a few seconds it will be done: Back in the file explorer, you can see the .dmp file: Find some way of uploading this file to us on the Discord support channel. We have nitro boosts so you should just be able to drag and drop the file into the support thread. Can't Click on Anything If you find that you can't click on anything, you might have a broken . Follow the steps pertaining to . Load Mod \"A Mod is crashing when I try to open tModLoader\" You can skip loading mods by holding shift while tModLoader is loading until it reaches the main menu. Visit the menu to disable or delete the mod. If you need to directly delete a mod, you can unsubscribe on the . If you need to delete a manually installed a mod, open up the tModLoader and delete the offending .tmod file. Begin cannot be called again until End has been successfully called (Also applies to \"Cannot access a disposed object\" errors) This error is an error usually caused by an unhandled error in a mod. This makes it hard for users to know which mod is broken. Much of the time this error will only happen after reloading mods (improperly unloaded Texture2D references), but it can happen due to other errors (for example, dividing by zero.) As a user of mods, it can be hard to figure out which mod is causing the issue. To determine the broken mod, follow the steps in . The mod causing the error causing this crash should be in the last or second to last entry. If you find a mod mentioned in one of those errors, that is likely the mod causing the error. If in doubt, ask in support forum on the . As a last resort, use the . OutOfMemoryException This error means that tModLoader does not have enough RAM to load all the mods that you are trying to load. Large mods that add lots of items are the main culprit. You may have to cut down on the number of large mods you are trying to load at the same time. You can also try loading Small or Medium worlds instead of Large. Another possibility is that you have other large programs running. If you can close them, do so. Press to bring up the Task Manager. In the Task Manager's Processes tab, look for processes that take up a large amount of memory. Anything taking more than 100,000 K is a good candidate. tModLoader lists 6 GB of RAM as the minimum system requirements, but that minimum will increases depending on the mods enabled. Viewing Mods that use a lot of Memory: If you are curious which mods are using your limited Ram, you can enable the \"Show Mod Memory Estimates\" option in . After enabling the setting, you will have to exit to the main menu and then close and reopen the game for the setting to take effect. Visit the Mods menu, make sure you enable and reload the mods you are curious about, and you should now see colorful graph at the top that shows how much memory each mod is using. Use this information to disable mods that take too much ram compared to how much you enjoy the content. Players/Worlds Load Failed! When a world fails to load, usually this is caused by a buggy mod. To test this, disable all mods and see if the world loads. If that works, slowly add a few mods at a time and attempt to load the world. Eventually the world won't load again and you can reload mods once again to isolate the mod causing the world to not load. Once you figure out which mod is causing the world to not load properly, you'll want to seek out help from the mod creator, see for information on how to find mod specific help. \"(LaterVersion)\" on player or world This means that you migrated a player or world from a version of Terraria newer than the version of Terraria your version of tModLoader was built for. When Terraria updates, it takes a while for tModLoader to update, you'll have to be patient and wait for tModLoader to update to use that player or world. \"(Unknown error)\" on player This means that tModLoader can't load the player for some reason. We are constantly looking into causes of this. To fix this issue, you'll need to . If you notice that your player consistently corrupts after restoring backups, it may be a broken mod. You can try , someone may be able to diagnose the issue. \"HELP, all my players and worlds are gone!\" tModLoader saves are kept separate from vanilla Terraria saves. You can copy back and forth between save locations, but be aware that you will lose Modded Tile and Items if you use tModloader worlds/characters in vanilla. Solutions: To copy from Terraria to tModLoader, use the button in the tModLoader player and world select menus. Note that if tModLoader is currently not up to date with Terraria, the players and worlds will be too new to open. Also note that files stored on the cloud will not show up, you'll need to take the file off the cloud first, see below. To migrate a player or world from tModLoader to Terraria, you'll need to copy from the folder to the Terraria saves folder. (The Terraria saves folder should be the parent folder of the tModLoader folder.) For example, copy .wld files in to , and the same for the .plr files in the corresponding folders. For players you'll also want to grab the folder with the same name as well, since those are the maps. Getting Players or Worlds from the Cloud You may notice that your player or world isn't in the folder, or maybe only .bak files are in the folder. This means that you have put that player or world onto the cloud. There are 2 ways to get the files. The first option is to open Terraria or tModLoader and simply click the button and then follow the above instructions. The second option is to copy the files from the local copy of cloud files steam keeps around and place them in their respective folder. These are found in the \"Cloud storage limit reached, unable to move to cloud\" tModLoader shares the cloud storage space with Terraria (the total quota is about 950 MB). Exceeding this limit on Terraria + tModLoader combined will make you unable to move players and worlds to the cloud until sufficient storage is available. Easiest way to free up room is to \"un cloud\" worlds, they take up the most space. You can check how much storage is used in Steam: Right click , below the section it says the amount of available storage. In the rare case where you used tModLoader cloud storage feature before steam release (0.11.7), you won't be able to get rid of these \"orphaned\" files the normal way. Try this method: . Another method to delete orphaned files is to download and use it to delete files in the \"ModLoader\" folder. Mod Browser \"Mod Browser Offline\", \"I can't download mods\" Steam workshop sometimes goes offline for maintenance, try in a few hours or the next day. Can't download mod, Mod download progress bar stuck at 0.0 bytes The reasons for such an error are varied, but there are a few things you can try. First, open up the file. This file will typically be located at: (Windows), (Mac), (Linux). Once the file is open, scroll down to the bottom to see the most recent steam log messages. You'll likely see errors related to the mods that couldn't download. Try to make sense of the errors if possible and act on them if you know what they mean. For example, it might mention that you are out of hard drive space, in that case clean up some files or move the tModLoader install location. Another thing to try is repairing the Steam Library folder. To do this, navigate to and then select the library location tModLoader is installed to in the drop down. Next, click the icon and select . This process will attempt to fix any permissions or other issues in the steam library folder and should take a minute or so. Some users have reported issues when tModLoader is installed on a portable hard drive or even hard drives other than the default drive. If you are in this situation, try moving tModLoader to the main hard drive. To do this, right click on tModLoader in the Steam library and select . Click on and then and select a different location. Can't redownload mod If you find that you can't redownload a mod in game, you'll need to close the game, then visit the . There, find the mod you are interested in and subscribe. If you are already subscribed, unsubscribe and then subscribe again. Finally, restart steam by fully closing it (Steam Exit), then launching it again. You may also need to follow the steps to force steam to redownload mods you subscribed to. If the previous steps don't resolve it, the following may: if you get the Item is/was already installed message and/or a red next to the mod name, do the following if the instructions provided by TML don't work: 1) Delete the mod in Mods Menu first. 2) Close the game 3) Unsub, sub, and unsub in Steam 4) Close Steam fully 5) In SteamApps/Workshop, delete appworkshop 1281930.acf 6) start steam 7) start the game Save Data File Issues Windows 10+ OneDrive By default, Microsoft has forced OneDrive on to the 'My Documents' folder, which can mess with some games when improperly configured. Error Message: The Cloud File Provider is Not Running Also applies to error message: System.IO.IOException: The cloud operation was unsuccessful Also applies to error message: System.IO.FileNotFoundException: Could not find the file ...tModLoader Mods Basically, these errors mean that the game is unable to save the files because OneDrive is either misconfigured or offline. The solution is usually to fix OneDrive, but uninstalling OneDrive is also an option. Just be aware that disabling/uninstalling OneDrive means the automatic backups and file sync enabled by default will no longer be active. This is a drastic option and not recommended unless you know what you are doing. If enabling OneDrive is not fixing your issue and you don't want to uninstall OneDrive, the is another option to get the game working. Solution 1: Uninstall OneDrive. Note: Only follow these instructions if you actually want to get rid of OneDrive from your computer. On Windows Searchbar, search Programs, and select 'Add or Remove Programs' Uninstall OneDrive. Problem solved. Solution 2: Get OneDrive up and running Follow the instructions in to turn on OneDrive. Then turn off 'Documents' syncing in Manage Access menu And/or turn on 'Always keep on this device: Unable to find my tModLoader 1.4.3 save data OR Auto migration of files failed. Do this for files on your computer, referencing example of copying files from 'default' to 1.4.3: For Steam Cloud related files, unfortunately, there isn't a quick fix. Please download your files manually per https://www.howtogeek.com/428491/how to download your save games from steam cloud/ Config.json Corrupted Attempt to Port from X to Y aborted, the Z file is corrupted. You basically have a corrupted file, which is preventing tModLoader from knowing which version of tModLoader was last launched. If you are new to tModLoader or have played tModLoader 1.4.4 (anytime since August 2023), simply delete the file in the . Otherwise, if you know the last tModLoader you played was the 1.4.3 version, replace in the with the one provided here: . After doing one or the other, relaunch the game. If you get the same error, you deleted or replaced the wrong file. Double check the folder paths to make sure you are modifying the correct file mentioned in your error, not the one found in the Terraria folder. Example of File Location Migration Failed As tModLoader updates to new major versions, sometimes players saves are moved from one folder to another to ensure a smooth transition to the next major version of tModLoader. Sometimes this process fails for one of a variety of reasons. In these cases, it is up to the user to move the files or fix the issue and try again. When launching 1.4.4 for the first time, tModLoader will move files from ( ) to ( ), preserving 1.4.3 saves. tModLoader will then move files from ( ) to ( ), allowing users previously on the preview version of 1.4.4 to continue using their players and worlds on the stable version of 1.4.4. Try again The most common issues relate to OneDrive. If your folder is in OneDrive, follow steps in the section to ensure OneDrive is properly setup and running. After that is all working, try launching tModLoader again, this time the migration should succeed. Manually Port If tModLoader is still unable to migrate files, then a user can do it manually. First, create the , this will be the or depending on the file path shown in the error message. Next, copy the files and folders from the saves folder to the . The can be determined by checking the section to see which should be copied into the you just created. If this fails, you might have some corrupted files that need to be deleted first. Illegal Filenames Rarely, the tModLoader saves folders might contain files or folders that can't be deleted or moved by normal means. First, restart the computer and try again. If the file or folder still can't be moved or deleted, it might have an illegal filename. Examples of illegal filenames are files ending with or folders ending with a space. Due to bugs in mods or tModLoader, these files can rarely be created. The instructions in are all options for deleting these files and folders. If the issue was a folder in the Players folder ended with a space, take the opportunity to rename the corresponding and files to remove the space from those files. Feel free to come to if you need help with this issue. Linux / Steam Deck / Mac tModLoader is designed to run as a native Linux application. It is fully featured as a native program, and as such, does not require Proton. Unfortunately, due to unknown causes, tModLoader doesn't work with Proton. Compatibility Options This is one of the rare applications where you will need to set Compatibility Options to 'None'. STEAM DECK: If you don't see the None option, you can install 'Steam Play None' to forcibly add the option. Fails to launch the native build Click Start in Steam but does nothing If the section of deleting 'dotnet' folder in this FAQ does not fix the issue, it has been reported that the following might, via 3612: Install from nixpkgs and create a symlink from the store binary to your TML installation. Ex: Flatpak, Steam Deck Steam, and related sandboxed applications If you want to develop mods, these will conflict with doing so. You will need to launch the game outside of Steam, using either 'Non Steam Game' library option or launching it from the terminal. Building Mods on Steam Deck Due to how the Steam Deck is setup, the setup to build mods requires a bit of additional effort. You'll need to follow the following instructions to install the dotnet 8 SDK to your system. These instructions differ from typical Linux dotnet SDK install instructions. These instructions have been lightly tested and are subject to updates and revisions as we learn more about how to properly use the Steam Deck. Steam OS updates could potentially revert this install, requiring the user to revisit these instructions after an OS update if mod building no longer works. Install dotnet SDK via dotnet install script: Note: This approach will install the in the user's home directory. This method should persist through Steam Deck OS updates, but it might not persist. 1. Make sure you have launched tModLoader at least once on this Steam Deck recently. 2. On the Steam Deck, switch to Desktop Mode (Steam Power Switch to Desktop). You should now be in the desktop environment. Plugging in a USB keyboard now will help in the coming steps. 3. Open up Steam and right click on tModLoader, then select \"Manage\", then \"Browse Local Files\". This will open up the tModLoader install folder in the file manager. 4. Navigate into the folder. Right click anywhere in the file manager and click \"Open Terminal Here\". This will open up , the default terminal program. 5. Next, we will install to the system. Do this by running the command in the terminal we just opened. This should run for a bit and then display \"Installation finished successfully\". 6. Having installed , it is not yet accessible by tModLoader. To do this, we need to make sure it is added to our . We do this by editing our bash configuration files. Open up in a text editor (by default this is a program called ) and add the following 2 lines to the middle of the file and then save the file: export DOTNET ROOT=$HOME/.dotnet export PATH=$PATH:$DOTNET ROOT:$DOTNET ROOT/tools If you can't find the file, open up the Dolphin file manager and click on . is the same as . Next, look for greyed out files beginning with a , these are hidden files. If you do not see any, you'll need to click the options dropdown in the top right and check . You should now see the hidden files. 7. Next visit the Steam properties for tModLoader. To do this, right click on tModLoader in Steam, select \"Properties\", and then find the \"Launch Options\" box in the \"General\" tab. Type in the following for the launch options and close the window: (This step is technically only necessary for supporting tModPorter in Game Mode and can be skipped if desired. This will be unnecessary in 2025.01 and later.) 8. Launch the game and visit the menu, you should now see a listing of your mods, if any, rather than the note mentioning installing the . This approach should allow you to mod when launched in Game Mode, Desktop Mode, or even when manually launched through . Install dotnet SDK via pacman: For the sake of completeness, it should also be mentioned that the dotnet sdk can technically be installed at a system level via . This approach requires disabling the read only nature of the operating system. This is a bit dangerous. Additionally, the install results in an outdated SDK version that is incompatible with building mods. The steps to do this are not listed here because they do not result in a working solution at this time. Arm64 Linux Workaround (This workaround is 1.4.3 only, it will not work on 1.4.4) At this time, the Steamworks.NET library used by tModLoader doesn't support ARM in it's managed code. Please use the 20.1.0 Release build on by to download a replacement Steamworks.NET.dll. Please install the ARM64 Linux Steamworks.NET.dll by replacing the existing .dll in Libraries/Steamworks.net/20.1.0/lib/netstandard2.1 System .NET SDK Could Not Be Found, No Sandboxing If the application is sandboxed, see the appropriate section here. If not, attempt the following steps: 1) In a terminal check \"which dotnet\" command result. You should see information on what the system dotnet install is, and a path of \"/my/path/dotnet\" 2) Create a text file at path /etc/paths.d/dotnet with contents \"/my/path/dotnet\" Try running again. If this doesn't work, reach out in the Discord for further guidance Other Issues Steam Game Recording is a feature that won't work with tModLoader out of the box due to its unique launch sequence. As a workaround, you can manually use the \"Record Manually\" setting and the Start/Stop recording shortcut keys. Monitor for any progress on the matter. RGB Keyboard Bug (Port 53664) Networking issues ( , , ) addressed to port are caused by RGB keyboard support bugs. You can attempt to repair the installation of your keyboard software, or disable the feature. Even if you don't think you have RGB keyboard, this can help. Close tModLoader. Open up and find , open the file in a text editor. Find the \"UseRazerRGB\", \"UseCorsairRGB\", \"UseLogitechRGB\", and \"UseSteelSeriesRGB\" entries and change \"true\" to \"false\" for each of them, then save the file and finally attempt to open tModLoader. Low FPS There are many things you should try: 1. First, make sure none of your mods are throwing errors in the log. See to see how to check logs for error messages from mods. 2. Second, Check that the game is running on your Dedicated Graphics Card. For some reason, Windows like to try to run tModLoader on the integrated GPU. 3. Next, confirm that the issue happens even with 0 mods enabled. 4. Try changing \"Frame Skip\" settings 5. You can try a different graphics options. To do this, close the game and then in Steam, right click on , select , and then find the box. Type or into the box and close the window. Launch the game and check your frame rate. Do these same steps to try the other option. If these have no effect, remove them in the same manner. Having issues where OpenGL worked previously? Try removing it and seeing if the default runs better now. 1. If you are using the GOG version of the game, you can edit and change the 3rd line to , save, then test by launching the file. 6. If using Steam, you can try the following: Disable animated avatars in Friends List settings Disable the steam overlay in In Game settings Launch Steam in \"compact mode\" 7. Try Host&Play instead of singleplayer. 8. Try Lighting overhaul mods to see if one better uses your computer resources. 9. Try Optimizerarria resource pack from Terraria Workshop 10. Try reducing Graphics: Disable waves, Disable Backgrounds, quality Low 11. If using Retro or Trippy lighting modes, try zooming in from 100% to something like 102%. At 100% zoom Retro and Trippy lighting modes counterintuitively need to do a lot more work due to how the code is organized, any greater value than 100% works. 12. Come to . Ghost Mouse If your mouse is invisible and still highlights buttons, you might be running into an issue with \"Monect Virtual Controller\". If your has \"Monect Virtual Controller\" in it, follow to uninstall that. Plugging in a separate controller has also been reported to fix this problem if you don't have \"Monect Virtual Controller\". Another solution is to close the game, then edit , found in , in a text editor and change the \"InvisibleCursorForGamepad\" and \"SettingBlockGamepadsEntirely\" settings to and then save the file. Game not launching, Webroot antivirus The Webroot antivirus has a false positive on the file included in tModLoader, you'll need to remove it from the Webroot antivirus quarantine. Keyboard delay Reported to be fixed by disabling \"Game Optimization\" in their Norton antivirus. Console stays open on Windows 11 If the console stays open even after you've reached the main menu: Open up Windows Settings System For developers Terminal Set it to Windows Console Host. No mini map The game will disable the mini map when it detects a mini map related error. This may be caused by a mod throwing errors. To revert this, go to and toggle the map option to . If the issue happens frequently, it may be worthwhile to investigate your and try to identify which mod is causing the errors."},{"path":"螺线翻译tml教程/1-基础/EX2-Basic-tModLoader-Modding-Guide 基础-模组开发指引.md","filename":"EX2-Basic-tModLoader-Modding-Guide 基础-模组开发指引.md","title":"EX2-Basic-tModLoader-Modding-Guide 基础-模组开发指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"这篇教程已经更新至1.4 如果你需要1.3版本的老教程, 请点击 译注:这篇不提供翻译 你需要做的第一件事情是决定你希望用哪款程序写代码 基本上是两个选择， 文本编辑器 或者 IDE 如果你对二进制逻辑和设计的概念完全陌生，你可能想先从文本编辑器开始，这样可以掌握基础知识，并能够处理简单的代码，而不会被IDE的界面和工具弄得手忙脚乱。 对于其它更多的情况，你会更想使用 集成开发环境IDE 集成开发环境（IDE）是一种软件，它为特定编程语言提供了一个便利的界面，而我们需要用到的编程语言是C 一款IDE可以做文本编辑器能作到的任何事情，因为文本编辑器是IDE的一个部分 你还需要按照 安装\".NET 8.0 SDK\" 这篇教程会让你熟悉tModLoader模组开发，并帮助你制作第一个模组 在此之前，请先阅读参考 你的第一个模组 为了入门，我们会先制作一个非常简单的模组，让你熟悉tModLoader的模组是怎么创造的。 生成一个模组框架 首先，我们会用tModLoader来创建一个基础模组框架 打开tModLoader，然后打开\"创意工坊\"目录，打开\"开发模组\"目录 点击\"创建模组\"按钮，然后填充那些输入框 比如， ， ， 以及 (可选) (译注：依次是 模组内部名 、模组显示名、模组作者署名 以及默认的模板剑 类名 (如果不填写就不会生成模板剑)) 最后，点击\"生成\" 如果有报错信息弹出就照着提示信息修改 否则你会回到模组源码目录 [!注意] 如果你想制作一个后续发布到创意工坊的模组 它需要一个独特的 模组内部名 而不是 . 这需要一个和创意工坊上已有模组都不一样的内部模组名 否则你将无法发布 如果你需要给一个已经存在的模组重命名的话，可以参考 模组框架内容 点击\"开发模组\"中的\"打开源码文件夹\"按钮以打开 文件夹 你也可以在你的文件浏览器中导航到 以打开 文件夹 接下来打开你的模组所在的文件夹，如果你照着教程填写信息，那里会有个叫作 的文件夹 这个文件夹包含了所有和这个模组相关的代码 目前，这里应该会有由模组框架生成器添加的9个基础文件。 以下是对这些基础文件的解释： 1. [模组内部名].cs 这个就是 类 它是对于所有模组的核心文件， 在每个模组中有且仅有一个 类 对于简单的模组，这里面可能没多少内容，但是这个类里可以发生许多全局性的事件(译注：我没太看懂，后续再改()) 2. description.txt 包含了模组的描述文本，在游戏的模组目录里点击 按钮以查看 3. description workshop.txt 这包含了会显示在 上的模组描述内容 这个文件的内容可以以 编写，以给你的模组制作一个更令人印象深刻的主页来让用户对它更感兴趣 一个展现BBCode 格式有哪些可能的例子是 模组的创意工坊页面 4. build.txt 包含 版本, 作者, 以及模组的显示名 也可以包含一些其它的 是必要的 5. icon.png 在游戏中显示的80x80图标 你可以制作一个更详细或者更高分辨率的 图标版本在Steam 创意工坊页面中使用 这个文件最大会是512x512 6. icon small.png 在图鉴的模组筛选器以及模组配置列表中会使用到的30x30小图标 为了和已有图鉴图标的风格融洽，你可以添加一个40%不透明度的黑影在图标右下方 可以参考 作为示例 如果你不修改这个文件，这个现有的文件不会使用，在图鉴中会显示一个\"?\" 7. [模组内部名].csproj 一个给Visual Studio调试你的项目的项目文件 调试是一个极其有用的手段，需要一定的学习成本 不要删掉这个文件 8. Properties/launchSettings.json 和 相关联，包含了到tModLoader文件的路径，用于调试 不要删掉这个文件，你后续会用到它 9. Content/Items/[物品名].cs 一个简单的剑类物品 这是一个示例，教你怎么制作 类 10. Content/Items/[物品名].png 相应的贴图 11. Localization/en US Mods.[ModName].hjson 包含了你的模组内容的英文本地化文本 它目前包含了那把示例剑的显示名和物品描述，这个文件会随着你的新内容的添加字段添加一些条目. 参考 了解关于本地化的更多内容，以及如何给其它语言制作本地化 学习如何构建模组 我们现在有个准备好用于构建的模组 启动tModLoader然后打开\"创意工坊\"目录 打开\"开发模组\"目录 你会看见你刚创建的模组的条目 现在点击\"构建并重新加载\"按钮 如果没有出现任何错误，你的模组会出现在模组目录当中！ 现在在游戏中，造一个工作台，挖十块土u 你就可以看见你能造一把新的剑了！ 哇，简直是非常Amazing啊！但是50伤不是很够的样子. 我们现在开始我们第一次实打实地编程，打开 文件 找到写着 的那一行，然后把50改成100 现在保存文件! 记住不要弄混你在基础 先决条件课里学的语法 接着，打开 文件 这是显示我们的英文物品名和物品描述给用户的地方 将 修改为 , 然后修改 条目为 , 最后保存那个文件 记住在default mod中使用的 条目是多行的 (在这里了解更多 ) 这就是为什么它看起来和 条目如此不同 这里包含 在开头和结尾的条目会被替换成 因为我们只需要一行 (译注：中文的可以 复制粘贴 (不要直接改)这里英文的文件，将en US改为zh Hans，记得去掉最后那个 副本，然后就可以写中文的内容了，如果在游戏中出现乱码就在vs的 高级保存选项 里保存为utf 8带签名编码，vs的高级保存选项参考 还有就是记得确保你中文的条目在英文那边都有) 接着在游戏里，再次重新构建并加载然后获得那把剑，你应当看到它新的攻击值，新的物品名以及新的物品描述 最后，你的模组被打包为了一个 文件叫作 在 文件夹中 如果你想你的朋友玩你的模组，但是还不想发布它，就可以在这里找到你的模组发送给你的朋友，放到一样的目录下. (或者你可以发布到创意工坊然后设置为 \"仅朋友可见\" 来确保它某种程度上还是私有的，这个方法可以在你发布更新的时候让你的朋友自动更新你的模组) 做点小实验 现在你可以修改其它物品的一些数值进行你的小实验 记住，你需要保存你的改动然后点击 以在游戏中看见你的改动 接下来的步骤 现在你有个拥有一把简单的剑的简单模组，是时候学点别的技术了 可以慢慢了解你想做的东西并开展你的实验 如果你需要其它模组开发者的帮助，可以打开论坛或者[Discord] (https://discord.gg/tmodloader) (译注 以及 和相应的交流群921853970) (译注 以及 和相应的交流群960277607) 你最好用原版已有的概念表达你的问题，比如，如果你好奇熔火之怒是怎么把木箭变成燃烧箭的，你应当提问\"怎么像熔火之怒那样只在使用木箭为弹药的时候改变它的弹幕？\" 用这样的方式提问是最有效率的 继续阅读以了解更多关于tModLoader以及如何进步的内容 我该怎么在我的模组里引用其它文件的内容？ 其中一个模组开发者会问的第一个问题是如何让一个自定义武器发射一个自定义弹幕，或者其它类似的行为需要在你的模组中由一个类引用另一个类 为了实现这个，我们需要使用 函数 其中的\"Something\"可以是\"Item\", \"Projectile\", \"NPC\"等等 比如，如果你想你的 发射一个特定的 在你的 函数在写 相比之下，发射一个原版弹幕是这样写 或者其它类似的 Note that when attempting to reference a modded class, you need to add a \"using statement\" referencing that classes namespace. For example, if you write in a class, and the class is in the namespace, you need to add to the top of the .cs file. A good IDE will for you. More examples of referencing modded content Here are more examples of referencing modded content. In all of these cases we are doing the same process, accessing a modded content ID through the appropriate method and using it where a content ID is expected. We use this values either is either as a method parameter or to assign a variable. In all of these cases there would also be appropriate using statements as well. You are not expected to understand the code below, it is just showing various examples of the pattern to give you a feel for how modded content is accessed and used in code. How do tModLoader 'hooks' work? Firstly, they are technically not hooks. We simply call them hooks because it is easy. A 'hook' is a function you can use as a modder. Which hooks are available depends on the class you're working in. For example your class has a , which is a function special to the class. Every one of these functions is , this means the function has a basic implementation but can be overridden by the modder if desired. This means when you want to use a hook, you override it, this is why the word is replaced with . Since the virtual (partial) implementation is overridden, that implementation will be lost. To see the standard implementation of hooks you should see the . Hooks are basically opportunities for mods to run code. Each hook is \"called\" at an appropriate time in the update loop of the game. For example, there is a hook called , this hook is called each time the game determines that the weapon item should shoot a projectile. The modder \"overrides\" the \"hook\" by writing code and that code will be executed when the weapon item shoots a projectile. Hook Usage Example Let's imagine you want to do something while an item is in the inventory, similar to how the Cell Phone item works. First, we open up the source documentation and search for the . Having found this page, use to search the page for something related to what we want. In this case, searching for and reading the results, you might find the method. The documentation tells us that this \"hook\" lets us make things happen when this item is in the inventory, which is what we want. To use this hook, we copy the method signature into our ModItem class. If you remember from above, we must change \"virtual\" to \"override\". We also must remember to trim the method name down. This code is in the ModItem class, so we can get rid of \"Terraria.ModLoader.ModItem.\". Finally, make sure you tell the computer what this class is. We do that by adding to the top of our .cs file. After adding opening and closing curly braces, we finally have our hook ready to write code in: We can greatly simplify the process of overriding hooks by using . Now that we have a hook in our class, we can add code inside it. The code we write will depend on the effects we wish to achieve. ExampleMod and the guide can be helpful for finding similar snippets of code to experiment with. Index and Type There are two big concepts that both correspond to integers. These two usages of integers can be inadvertently mixed up by new modders leading to code that compiles but is buggy. In Terraria, all content has a unique identifier called a . This is an integer that lets the game uniquely identify different bits of content. For example, the type of the projectile is the number . We can use a projectiles to run code that should affect only projectiles of that type. For example, if we use the hook, we can check and then run some Shuriken specific code, such as applying a debuff to the npc. Item, NPC, Projectile, Dust, and many more varieties of content in Terraria all operate using a identifier to identify the various varieties of content. The second concept is . In Terraria, the game uses various arrays to hold all the active content in the world. For example, the array holds all the instances of all the projectiles currently in the game world. Each knows it's own index within that array by the field. Both and are integers, leading to a situation where new modders can make a big mistake using one or the other incorrectly. For example, a modder might make the mistake of thinking would retrieve the active Shuriken projectile, but it won't, it'll return whatever projectile is at that index. As a modder goes through different guides and examples, they will see proper usage of and . This diagram illustrates this point, showing how and are separate concepts while showing how they are stored in an array: How are modded classes setup? tModLoader provides a number of classes you can use to create your own mod content. You will base your own classes off of these by using what's called or . To keep this simple, it basically means your class will use one of ours as its base. For example, your items will be based on ModItem: , where the denotes it inherits from the ModItem class, which is present in the Terraria.ModLoader namespace. (if you come from Java, this is the same as ) This means everything we made for becomes available to you in your class, such as the hook. Note that you can only derive from one class, so a cannot be a and so forth. Learning from Example Mod Example Mod is a mod made by the tModLoader developers to show off various modding capabilities. It would be wise to enable Example Mod and play around with it for a while. Use a mod like to spawn in its various items and find something it does that you want to learn. Next, download the Example Mod source code. To do this, download and then find the ExampleMod folder within. Take that folder and place it in the ModSources folder next to the TutorialMod folder. You can also quickly look something up by exploring . The \"Go To File\" search field at the left of the screen can be used to quickly find a specific file. Try typing \"sword\" into the search and you can see how you can quickly find relevant files. Find the thing you are interested and try to understand it. Hopefully it is easy to understand. You can also change things in your copy of Example Mod and build Example Mod in game to experiment. Once you can handle modifying simple things in Example Mod or Tutorial Mod, you should be comfortable with the mod building process. Feel free to explore other guides or help for the next steps. Learning in steps If you are new to modding, you are probably also new to programming itself and possibly the C language. It is recommended to start with easy things and work your way up the ladder of difficulty. One of the easiest things to do would be a sword that can be swung to deal damage as shown above, and one of the hardest would be to create a fully functional boss fight. Here is a few suggestions to get started: First, try to familiarize yourself with how tModLoader works. Read the section 'How do tModLoader 'hooks' work?' Next, try modifying the tutorial sword to deal more damage, have more knockback, faster speed etc. You can also make it shoot things by setting , and control the speed with You need to understand that modding is programming, it is C and it is being familiar with the vanilla code. This means you should definitely follow free online courses to get a better understanding of the C language or programming itself. A useful resource might also be the (Unfortunately, much of this guide is broken due to broken links.). To get more familiar with the vanilla code, use our guide. If you feel confident enough, try making your own projectile and having your sword interact with it. With more confidence, you can start trying other things, such as making an enemy NPC. Here is a few things that would be considered difficult for most modders, and it is advised you start with easier things before attempting these: A fully functional boss Comprehensive UI Code abstraction Modding info for entities, and interacting with it Completely custom AI for a projectile, NPC, pet... etc. Slowly learning There are many resources available so you can become a better modder. First of all, this wiki. On the right side of this page you can find the wiki menu, which houses links to various different tutorials and guides that you can use. These are all separated into their own difficulty level, from basic being the easiest and expert being the hardest. Another source of information is the , but it is not very active. Many modders collaborate and ask questions on the , if you are struggling with anything or have any questions, please come by! And lastly, a variety of helpful tools and guides is available on the of this wiki. Modding tips and guidelines Naming convention Internal names do not support whitespaces, this means you need to name without spaces. People commonly just omit the spaces: but sometimes you'll also see . The former is called and the latter is called . / is preferred because of how tModLoader automatically populates localization entries. Remember to use short and descriptive names; if you are making a sword it is likely you should use 'Sword' in the name. Naming convention mostly depends on who your work with/for (if you are employed etc.), if you work on your own it is obviously down to your personal preference. Good to note that is similar to , but often you'll find with camel case that the first letter may be lowercase or capitalized and each subsequent concatenated word is capitalized such as and . Keeping code tidy and organized Though this is a more advanced topic (part of design patterns, which might be covered in expert tutorials later), it is useful to make sure you abstract your code properly. More on this in the code abstraction guide. For beginners, take this tip: after you've programmed something and it is finished, look at your code and ask yourself what is happening in every place. Now you should ask if the code is tidy. Try to find repeating parts of code and give it a dedicated method. Next, try to separate parts of your code by their logic and give them their own method as well, providing a useful descriptive name (see the previous tip) so it becomes easy to identify what that part of code is doing. This is a brief summary of a part of code abstraction. 给你的代码写注释 并不是什么时候都能很容易看出你的代码在干什么 又或者，你希望给你自己或者协作者写个笔记 你可以像这样写个单行注释 或者你可以像这样添加一整个注释块： 对于初学者，相当建议添加尽可能多的注释 甚至是对于哪些你认为你已经理解得很好的内容 这会在长期来看帮助你 你也许会隔几个月重新回到项目，但是忘记某处代码是怎么工作的 对于富有经验的开发者，下一个挑战是使用尽可能少的注释 你的代码应当在写得足够简明，让其它人能只读代码就理解它的行为 顺带一提，不同的语言使用不同的方式注释 比如 和 ，对于C ，它使用上面展示给你的方式 发布你的模组 一旦你的模组是在工作状态，你就可以将你的模组发布到Steam 创意工坊 这能保证你的模组对其它订阅了你的模组的tModLoader用户可用 有关于这的更多信息"},{"path":"螺线翻译tml教程/1-基础/EX3-Basic-tModLoader-Modding-FAQ 基础-模组开发常见问题.md","filename":"EX3-Basic-tModLoader-Modding-FAQ 基础-模组开发常见问题.md","title":"EX3-Basic-tModLoader-Modding-FAQ 基础-模组开发常见问题","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"\"Terraria.ModLoader.Mod.GetTexture(String name)\" error This is the 1.3 error of the below. \"Terraria.ModLoader.Exceptions.MissingResourceException: Expected resource not found\" error This error means that tModLoader can't find the Texture that you have specified. You may be thinking, \"Where did I specify the Texture to use?\", and to answer that, you should read the page. If you are making an equipment item, such as armor, vanity, or accessories, pay special attention to the \"Extra Textures\" section as well, equipment items need 2 separate textures. Now that you read about Autoloading, you now know that the texture is derived from the namespace and classname of the class. If you don't know what namespace and classname are: Imagine a class named in the namespace in a file named which resides in the folder alongside the texture file . The texture the modder assumed would be used: The texture autoload will actually look for: Lets go through the problems a novice modder will run into here: Expecting the .cs filename and .png filename have to match. Not true, the classname needs to match the texture filename. It is helpful, however, to keep the .cs filename and the class the same. Expecting the folder path of the .cs file to matter Not true, the namespace of the class within the .cs file matters for autoloading the texture correctly. It is helpful, however, to match the namespace structure to the folder structure. Seeing the error, the novice modder will take the following steps: Keep .cs filenames, classnames, and .png filenames consistent. Make sure your base namespace and Mod Sources folder are equal Make sure your namespace and folder structure match: ExampleMod.Items.Weapons becomes A visual explanation: 'ClassName.MethodName(Parameters)': no suitable method found to override This means that the parameters you provided for the method do not match the parameters of the virtual method you are trying to override. This is most often the case for modders attempting to override hooks and finding outdated code samples from old tutorials or AI. For example, you might have copied from an outdated example, but is the correct updated method parameters for the current version of tModLoader. Another common mistake is taking code from one class, such as a class for example, and pasting it in another class directly, such as a class. While many methods are present in both base classes, their parameters will usually differ and the method parameters and the code within need to be adjusted to accommodate that. Virtual methods or \"hooks\" require that the parameters match the existing method parameters provided by tModLoader, it is a template that must be followed and extra or changed parameters will not work. The fix is easy, either look up the correct parameters in the and use them or delete what you have and use your IDE to . \"Sequence contains no matching element\" error This means your Mod doesn't contain any class extending from Mod. If you went through the you should notice that one of the files has . Make sure you have 1 and only 1 of these classes in your mod. \"error CS0234: The type or namespace name 'X' does not exist in the namespace 'Y' (are you missing an assembly reference?)\" This usually happens when your code has namespaces or classes that conflict with vanilla Terraria classes or namespaces. For example, if you happen to have a namespace named Projectile, and try to use Projectile.NewProjectile, the computer will be confused if you are referring to the Terraria.Projectile class or something in your Projectile namespace. The easiest solution is to not name your namespaces the same as vanilla classes. For example, ExampleMod has namespaces named Dusts, Projectiles, and Items as to not conflict with vanilla classes of Dust, Projectile, and Item. Error CS0103: The name 'X' does not exist in the current context This means you have a variable name that the computer doesn't understand. Basically you invented something and the computer has no idea what you are talking about. Imagine your friend said \"Hand me the Flobulizer\", but you have no idea what that is and have never heard that word before. It is the same with the computer. You might tell the computer to \"give player the Chilled debuff\", but the computer has no idea what \"player\" is. To fix: google some tutorials on c variables and learn how variables work, then make sure to declare the variable before attempting to use. Error CS0246: The type or namespace name 'Player' (or Item, Projectile, etc) could not be found (are you missing a using directive or an assembly reference?) This is because the computer doesn't know what the Player class is. You need to tell the computer where Player is found. Do this by adding \"using Terraria;\" to the top of the file so the computer knows how to find the Player class. (Another common one is Vector2 and Color, which needs \"using Microsoft.Xna.Framework;\") Error CS0103: The name 'ItemID' (or ProjectileID, NPCId, etc) does not exist in the current context This is because the computer doesn't know what the ItemID class is. You need to tell the computer where ItemID is found. Do this by adding \"using Terraria.ID;\" to the top of the file so the computer knows how to find the ItemID class. 'LocalizedText' does not contain a definition for 'SetDefault' If you are porting an old mod, refer to the for how to resolve these errors in the entire mod. This error means that you are using outdated code (pre 1.4.4). Remove or comment those lines, then when you compile the mod, edit the generated localization. You can learn more about localization files and the workflow . You must add a reference to assembly 'Relogic, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null If you are using Visual Studio, you might need to add a Error CS0161: 'ExampleItem.UseItem(Player)' (or some other hook): not all code paths return a value Some methods return values. When using tModLoader hooks, you need to be aware that methods return values and not returning a value is an error. For example, UseItem has the method signature of: , and that there tells us that we have to return a bool value. Consult the to know what value to return. System.Threading.ThreadStateException: FNA3D graphics functions must be called on the main thread [1.4 only] If you get this issue, this means you are performing graphics tasks (such as disposing or premultiplying textures) in places that are not ran on the main thread (such as and ). To get around this, wrap your code in this: C 6 issues: \"An attempt was made to load an assembly from a network location...\" This is related to Windows blocking downloaded files. What happens is the downloaded tModLoader zip file is marked as \"blocked\" or \"downloaded from the internet\", and when you use the default windows unzipping process, all unzipped files are also marked as well. Those files need to be unblocked to properly function. The easiest way to do this is to first unblock the tModLoader download and then install tModLoader again. Do this by pressing selecting the zip file in the file explorer and pressing the shortcut \"alt enter\" or right clicking on the file and selecting Properties. Then simply click unblock and then press Ok. Windows 7 and 8 might look different: Since installing over a previous installation is very easy, this is the recommended process. If you'd rather do it manually, open your Terraria install folder and view the properties of all the files tModLoader installs and unblock each file. This includes the Terraria.exe and all the files in the Mod Compile folder. TileObjectData.AddTile Issues Make sure you call after all of your statements regarding . Misordered code involving these statements will break Terraria."},{"path":"螺线翻译tml教程/2-中阶/0-Intermediate-Prerequisites 中阶-先决条件.md","filename":"0-Intermediate-Prerequisites 中阶-先决条件.md","title":"0-Intermediate-Prerequisites 中阶-先决条件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Intermediate Prerequisites Before consulting any of the Intermediate level guides, please read below so you are prepared for Intermediate level concepts. Please also make sure that you have gone through the Basic Prerequisites and corresponding Basic level tutorials related to things you are interested in. Upgrade from Text Editor to an IDE In Basic, we used a Text Editor to write some simple code, but using an IDE (Integrated Development Environment) is extremely recommended for anyone attempting anything in the Intermediate level guides. We recommend installing the latest . It is free and fully featured. If you aren't on Windows, or prefer Visual Studio Code, we recommend installing Installation Follow the guides linked above to install the selected IDE and other corresponding prerequisites. IntelliSense One of the main reasons we use an IDE is to take advantage of IntelliSense. IntelliSense refers to the capability of the IDE to suggest variable and method names to us as we type. This is important because we need to type things correctly for the computer to understand us. For example, if we wanted to reference the \"Cloud in a Bottle\" item in code, we need to write exactly. Without an IDE, we might make an assumption on the correct spelling and capitalization and type instead. This will result in an error. Our IDE will automatically suggest the correct variable name, saving typing and time. Here is a video showing how IntelliSense also shows parameter names for methods we are calling: https://github.com/tModLoader/tModLoader/assets/4522492/0e682781 5094 4a1d bb7f 40634f26816b This was a short exploration into IntelliSense. Please see the dedicated for more information and examples. IntelliSense is extremely important. Usage The guides for your selected IDE ( or ) have sections for creating a mod and opening your mod's source correctly. Please follow those guides to properly open the source code for your mod. It is important to open the source code in the manner explained in those guides. Failure to open your mod's source code correctly will result in your IDE being only as useful as a normal Text Editor. Advanced As you make mods, eventually you will need to learn more advanced techniques. The guide will prepare you for that by teaching how to access and read the Terraria source code. The is another great resource to learn about useful IDE features such as Edit and Continue, Debugging, and Breakpoints. Inheritance Please Inheritance is used everywhere in tModLoader modding. If you look back on our sword we made during Basic, you'll notice that our sword inherits from . Hooks A \"Hook\" is a method that is made available to modders so that they can achieve special effects for their mod. Hooks are virtual methods that modders override if they wish to use them. Documentation Learning to read is essential to modding. For example, has an example that overrides the method. We see from the method signature that returns a . The that we return has special meaning, but we won't know unless we look it up. Open up the Documentation and search for \"Shoot\" and then click the result, and then the sub result for the ModItem class. You will be taken to a description. Read the description and learn what the parameters and return values represent. Looking back on that code, you should now see how the hook manages to prevent the game's default behavior of spawning the projectile by using the Shoot hook. Virtual and Override You may notice that the documentation lists all the hooks as virtual, but all the ExampleMod code has override. This is because we override virtual methods when we inherit from them. again if you've forgotten. Vanilla Texture File Reference Looking at vanilla texture files and seeing how they are laid out is very useful, especially when you start animating NPC. Terraria stores textures in files that we can't open normally. The best option is to just extract all the Texture files to files and keep them around in a folder so you can look at them whenever you need to. Instructions: Download and run it. Fix the path if needed, then click . Finally, use the folder icon for to specify where you want to keep the extracted files. I suggest creating a folder in the ModLoader folder so you can easily find it: . You can uncheck the options other than if you'd like. Now, click and wait for it to finish. From now on, if you are curious how many frames an NPC has, you can simply find the png file corresponding to the NPCID and view it in your image viewer. Alternatively, you can also find Terraria sprites on , but they may or may not be the original layout, dimensions, or filenames. Use the website only if you need a quick reference, the best option is to extract your current Terraria textures directly."},{"path":"螺线翻译tml教程/2-中阶/1-Intermediate-Recipes 中阶-合成表.md","filename":"1-Intermediate-Recipes 中阶-合成表.md","title":"1-Intermediate-Recipes 中阶-合成表","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Prerequisites Recipe Groups Recipe groups allow you to create a recipe that accepts any item out of a list of specified ingredients. For example, all varieties of wood are in the vanilla \"Wood\" Group. Instead of creating 8 separate recipes to use each type of vanilla wood, we would create 1 recipe that uses the \"Wood\" recipe group. Mods can also add recipe groups to simplify their recipes. Using Existing Recipe Groups Vanilla groups consist of: \"Wood\", \"IronBar\", \"PresurePlate\", \"Sand\", \"Fragment\", \"Birds\", \"Scorpions\", \"Squirrels\", \"Bugs\", \"Ducks\", \"Butterflies\", \"Fireflies\", \"Snails\", \"Dragonflies\", \"Turtles\", and \"Fruit\". To use a vanilla recipe group, simply add the following instead of a similar line: Note that, like with , the parameter for providing an explicit stack count is optional and defaults to 1. New Recipe Groups You may have noticed that aside from \"Wood\" and \"IronBar\", there aren't many useful vanilla recipe groups. Luckily, we can make our own recipe groups. Let's imagine we want to make a recipe that used a Magic Mirror or Ice Mirror as an ingredient. Without recipe groups, we would have to do this: In this example, it isn't too bad, but imagine you have 10 or 20 similar items that you'd like to use for your recipe it would get unmanageable very quickly. To solve this, first, we must add a new recipe group. We do this in a class by overriding the method: As seen above, first we construct the group, then we call with the desired name. As a convention, please use for recipe groups that mainly concern items or usages specific to your mod. If you are using vanilla items to make a group that could conceivably be used by other mods for the same purpose, use , where is the earliest item to be added to the game in the group (smallest ItemID value). For example, if you were adding a group for SilverBar and TungstenBar, use SilverBar because that was the first item added to the game. Doing this allows multiple mods to collaborate seamlessly. If Mod A adds a SilverBar group, and Mod B adds a similar group but with a 3rd SilverBar variant, the game will seamlessly merge the recipegroups, allowing all recipes using the groups to allow all variants. As a note, is just the word \"Any\" in the selected language and requires the using directive at the top of your code. The syntax here is a little difficult for newcomers (as it makes use of ), so please follow it exactly. As a note: use instead of for s. Next, we need to use the . We do this just like with vanilla recipe groups, except our recipe group's name will be different: Complete Example Note that the name used in is identical to what we defined when registering our modded . Editing Vanilla Recipe Groups In some situations, you may want to add your own items to existing recipe groups. In this example, we will add another wood type to the \"Wood\" recipe group. Note that checking is not necessary , but it will prevent errors if some other mod completely removes that recipe group for one reason or another. This can also be used for . Custom Conditions In the , using existing conditions in recipes is taught. Custom conditions can also be used in mods. The most common custom condition for mods would likely be a condition for if the player is in a custom . To do this, use the method and pass in a new instance of the class. Within the class constructor, a localization key and a method with no arguments that returns a bool will need to be provided. In this case, we will use the method to query if the local player is in our . This example only allows the recipe to be crafted if the player is in the : This approach works well for effects used in a single recipe, but adding the same code to many different recipes will be messy and error prone. The solution to this is to reuse the . It is recommended to place all instances in an appropriately named static class so that they can easily be referenced for any recipe that would use it in your whole mod. Static class with shared instances: Using a from the static class. This code can be used in any recipe in any file, provided the correct using statement is used: The condition description will be shown to the user if they look at the recipe from the Guide's recipe help or a mod like . Shimmer Decrafting By default, the first recipe that results in an item will be the recipe used to decraft that item. This behavior can be customized with conditions. The comments and examples in teach how to customize to shimmer decrafting feature. Custom Item Consumption Recipes don't always consume all the items used as ingredients. For example, all recipes that use as a crafting station will be subject to the . All ingredients have a 1/3rd chance to not be consumed. Note that the modder still needs the full amount of ingredients to craft the item, they just might not be consumed. Modders can make their own custom recipe item consumption rules and apply them to individual recipes. This is done by the method. The modder provides a delegate (The delegate is of the Type) that will run when the item is being crafted, for each ingredient. That delegate has the ability to adjust the amount of each item that is consumed. In this example, we add a recipe that will not consume the item. This is done by adding a delegate that will set the amount to 0 if the ingredient being checked is . This approach works well for effects used in a single recipe, but adding the same code to many different recipes will be messy and error prone. The solution to this is to reuse the delegate. It is recommended to place all delegates in an appropriately named static class so that they can easily be referenced for any recipe that would use it in your whole mod. Static class with shared delegates: Using a delegate. This code can be used in any recipe in any file, provided the correct using statement is used: The Alchemy Table effect uses a bit of advanced logic. First, the Alchemy Table tile itself uses to act like . This means it will satisfy the crafting station requirement for recipes requiring . The code also sets the bool to true, indicating that the player is under the effects of the alchemy table. Finally, the code applied to each of the potion recipes does the following to check for the bool and give each item a 1/3 chance to be consumed: To adapt this to a modded situation, modders might need to use a bool or something like as the condition instead of the bool. As demonstrated, modders can do advanced logic in code. Remember that your users will not know about these effects unless it is communicated to them. The Alchemy Table item tooltip, for example, tells the player \"33% chance to not consume potion crafting ingredients\". Custom Recipe Craft Behavior We can use the method to run code after the recipe is crafted. This is not done for any vanilla Terraria content, but it can be useful for advanced features added by mods. Similar to the approach shown for using , we want to store these methods statically so they are easily reusable. The following example is a trivial example, but should give an idea about what can be done. This example randomly spawns fireworks projectiles and the confetti item into the players inventory when the recipe is crafted. You can test this out by crafting the item in ExampleMod: Ordering Recipes Recipes can be placed before or after specific recipes to group them with similar recipes. To do this, use the , , , or method. By default recipes will be placed at the end of the recipe listing. and take an and are simple to use: and take a specific , which allows more complex logic. One potential use is to place a recipe between 2 recipes with the same result. Editing Recipes We can edit vanilla recipes or recipes from other mods from within a method. Basically, we iterate over the recipes to find the recipe we want to tweak, then modify ingredients, tiles, or even disable the recipe entirely. Complete Example This code removes the \"Chain\" item from all vanilla recipes. The second half of this example finds and disables an exact recipe. Do not remove entries from , that will break many things. Cross Mod Recipes If you wish to use items or tiles from other mods in your recipes, you need to plan ahead. Read for an idea of some considerations you'll need to keep in mind. For example, the mod you are referencing might change the item name in an update to their mod, breaking your mod in the process. Another issue is planning for the other mod not being enabled. In that case, you might want to skip the recipe altogether or plan an alternate recipe. The example below shows the alternate ingredients approach. As you can see, this recipe takes 's item if is enabled and exists in that mod, and the current mod's and vanilla's if is not enabled. If you have opted to only load your mod if the other mod is enabled, you can simplify the logic since the other mod will always be available if you are using . Common Errors : no suitable method found to override has to go in the class, not your class. Relevant References"},{"path":"螺线翻译tml教程/2-中阶/2-Intermediate-Guide-to-AI 中阶-AI编写指引.md","filename":"2-Intermediate-Guide-to-AI 中阶-AI编写指引.md","title":"2-Intermediate-Guide-to-AI 中阶-AI编写指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following guide aims to teach some of the common ways of creating AI for npcs. Most things can be used interchangeably between projectiles and npcs, just replace npc with projectile and vice versa. Some things cannot, and if there is a projectile alternative, it will be mentioned. To start, let's make a basic npc. This guide won't cover the things in set defaults, you can look at example mod and the to get an idea of what to put. Most of the AI we make will go into the AI hook, so override that. We now have a place to put our ai, but it doesn't do anything yet let's start by changing the npcs velocity. The velocity is a vector2(which is composed of 2 floats, x and y) corresponding to the x and y change of the npc every frame(60 times a second) in pixels after your ai happens. A velocity of 5,5 means left 5 and down 5 pixels a frame(Keep in mind in Terraria, adding to y goes down). Changing velocity is the most common way to make your npc move, and it's kept in between frames if I set it to 5,5 it will stay that way till something else changes it. Let's make the npc float upwards by changing the velocity. If you test this code you should see your npc fly upwards. You probably want your npc to do something more complex though, and to do that we need to start adding more things to our ai. //TODO gif of it in action Timers are covered in this , which you should read if you haven't already. Lets add a timer like this guide shows Every tick our npc is alive, our npc happens, increasing the timer. This allows us to make things happen based on how long our npc has been alive instead of just doing things every tick. Now that we have a variable to keep track of time we can make things happen on a timer with %. % computes the remainder after dividing its left operand by its right operand, and is useful for making things happen every x ticks like this This first tick our npc is alive, our ai method happens. First time increments, making it 1. Next velocity is changed, then the if statement is checked. The Time % 120 takes the remainder of the 2. in this case its the remainder of 1/120, which is 1. Finally we check if its equal to 0 with ==0. 1 isnt, so the code in the brackets runs. Finally, after our ai runs the npc moves based on its velocity. Since our velocity is 0, 5, it moves that many pixels, ending up 5 pixels upwards from where its started. 1/60 of a second later, our ai runs again during the next tick. This time, Time becomes 2(if your wondering why Time kept its value in between ticks, its because its a field its declared outside the method). Again, Time(2) % 120 is not 0, so our if statement doesn't activate. Finally our velocity is update again. Our ai continues to run every tick, and our npc will float upward due to its velocity. After 60 ticks its been a second. After 120 ticks, its been 2 seconds, and the code in our if statement will activate, since 120 goes into 120 one time with a remainder of 0. After 240 ticks or 4 seconds, the if statment will activate again, as 240/120 is 2 with a remainder of 0. This pattern of it happening every 2 seconds or 120 ticks will continue until the npcs dies. //TODO maybe gif with Time drawn above the npc Now we can make something happen periodically, but what good is that if we cant actually do something? One of the most common things people want bosses to do is shoot a projectile, which is simple call the NewProjectile method. But to spawn a projectile, you need to provide some information about the projectile to be spawned. Where should it start? should it do 15 damage or 500? Is it a wooden arrow or a projectile from another mod? The order for what information is filled out where is this: Note that there is a different overload with Vector2s instead of floats for x/y and Speedx/SpeedY. For consistency I will not be using it, but it is effectively the same. Float X is a float of the X coordinate to spawn at, Y is a float of the Y coordinate to spawn at(Where is our projectile?). SpeedX and SpeedY are both floats of the x and y velocity respectively to spawn with(What direction should our projectile go?). Type is the type of projectile(What projectile should be spawned?) This will either be a vanilla projectile ID, like or a modded one, like Make sure to be using either or your projectiles class' namespace respectively. Damage is self explanatory, remember that setting projectile.Damage in the projectile doesn't do anything, it has to be set here. //TODO iirc this is doubled and quadrupled in expert, check that Knockback is also self explanatory, but notice it's a float, so it can take decimals. //TODO explain what amount of knockback goes what distances. Owner, ai0, and ai1 are all optional parameters(see how they have = something after, which shows their default value) and can be safety ommited if you don't know to put. Owner is the whoami of the player that \"owns\" the projectile, or 255 for none. ai0 and ai1 are used to pass information to the spawned projectile, and have their own section later in this guide Seems like a lot, but thankfully it's much simpler to write This code fires a wooden arrow projectile straight up from the npcs center, with 50 damage and no knockback As you can see each parameter is filled out with the information about how to create the projectile. We want it to spawn at the npc's center's x and y coordinate, with the a velocity of 0, 50 or up 50 pixels a tick. It should be a Wooden arrow that doest 50 damage and 0 knockback. However, there, if you add this code into an ai, you may run into strange amounts of projectiles in multiplayer. The reason for this is due to how Terraria handles npcs in multiplayer. Imagine 2 people connected to a mutiplayer game, when your npc spawns. In this hypothetical game, your npc will created at 3 locations. On each client, and on the server. Each of these 3 locations will now run your ai code, just like it would be run in single player. On each client and the server, it moves exactly the same since the same ai is ran on each(unless something random is in . Then, the npc calls NewProjectile. On all 3 games the projectile is spawned, but then, all 3 sync their spawned projectiles to the other 2, and we end up with 3 on each each connected client and the server spawning the projectile. The solution? Dont shoot the projectile on the connected clients, then let NewProjectile sync them. We do this by checking which tells if we are in single player(equal to NetmodeID.SinglePlayer), a client(NetmodeID.MultiplayerClient), or a server(NetmodeID.Server). Finding a Target Now that we know how to shoot projectiles, let's make this attack harder to dodge by firing it at the player. To do that we need to find the players we want to target. For finding the closest near a npc, this is very easy. First call ,with true/false being if you want it the npc to change the sprite direction to face the target(it can also be left empty. This searches for a nearby play that can be target by the npc, then sets the player's whoami(whoamis will be covered in dpeth later, simply they are somethings place in their respective Main array) to npc.Target. We can then get the player with Main.Player[npc.Target] and store it in a player variable for use later. If we didn't want the closest but instead wanted some other condition checked, we could loop the Main.Player array to find a valid target. Additionally, if you are in a projectile and want to home in on a player target, this is one way to do it(keep in mind that TargetClosest isn't a thing for projectiles, that part at the start can be omitted). A better alternative to the above if you are shooting projectiles from a npc would be to pass the npcs target as an ai parameter(see the below section for how to pass information with ai parameters). With our player variable we can do tons of new things. One common thing people do is to fire a projectile or make the boss move towards the player. To do this first we get the direction to the player, and hold it in a Vector2 Shooting a projectile would look like this Hopefully you understand what everything there does. the Time variable keeps track of the number of ticks the boss has been alive. checks if that variable is a multiple of 120, which will be every 120 ticks or 2 seconds. and get the closest players and store it in a Player variable called target. then stores the velocity we want to fire our projectile with in a Vector2(In this case the direction to the player from our npc). Finally we spawn a projectile at the npcs center with the direction towards the player as velocity. If we wanted to instead fly to a location we would just set npc.velocity to a direction Vector2 like so: If we wanted a dash, we can just move the above code into a if statement like the projectile code. //TODO example + explain why Making Patterns Most of the time we don't want our npc to do just one thing, instead we want to have more then \"attack\" it can be doing. To do this you need to have a variable holding what attack is happening, so our npc can remember in between frames what it was doing. In this case we are using an to hold the current stage. Our first attack will correspond to 0, second to 1, etc. Then, at the start of each ai tick, we can use this to continue doing the attack we did last frame. In order to make this code cleaner, I separated each attack into its own method and used constants to represent the \"ID\" of each phase. These constants mean the same thing as the number they represent, except being easier to read. Its means a lot more when you see instead of . One other concern with having states is desync. When an npc has different things it could be doing at once, it is necessary that it is doing the same thing across all clients in multiplayer. The solution is to hold variables like our state in the npc.ai array. This array(of floats) is automatically synced in between clients, so our npc's state will always be the same across clients. The final change is to keep the code for each attack in its own method, then call them in ai. This is purely for organization, making it easier to read the code in the ai. Using WhoAmI and the Main. Arrays Sometimes we want to spawn a npc( it could also be a projectile or even a dust) and have it do something that requires finding the target, position or some other value from the npc that spawned it, or requires finding out if the spawned npc is alive/what it's hp is or some other property of a npc that isnt us. Every npc, projectile, dust and player active in the world(and some that aren't active) are all part of their arrays(arrays are like groups of one data type instead of just one. for example, Main.npc is 500 npcs all in one spot. To access one item in the array, you use array[x], where x is the Xth thing in the array). These are how the game keeps track of what things to update, draw sync, etc. They also serve another important function, allowing one thing to effect another thing through these arrays. These arrays are: //TODO get the rest of the lengths Main.projectile, which holds up to 499 projectiles + one dummy projectile(more on these later) Main.dust, holding 6000 Dusts and a dummy Main.npc Main.player, Holding 254 players + one dummy player When something is created, say a projectile via NewProjectile, a spot in its array(in this case Main.projectile) is given to it, and a new projectile object created for it there. When this projectile is created, its whoami is set to its place in the array. Additionally, the method to spawn it(NewProjectile) will return that place in the array. This happens for dust and npcs to. You can use this to modify the projectile after its fired like this: if looks a familiar to you before, its because you have already used something similar to get a player to target. But what if I want my spawned projectile(or npc) to have the WhoAmI of the \"parent\" that spawned it? This is one of the times we use those optional parameters of the spawning methods. If you look at either NewNPC/Projectiles parameters, you should see floats like ai0, ai1 etc. These are used to pass info to the spawned thing. Let's say I set ai0 to 15 in NewProjectile/NewNPC then in the projectile or npc, npc/projectile.ai[0] will be 15. And, more importantly if I set it to the WhoAmI of the parent, I can then get the parent with npc/projectile.ai[0]. You can also use the ai parameters to pass other info, such as the whoami of a target player, the amount of time left in an attack, etc. A common mistake modders make is to assume if something is in its array, and not null, its active in the world. This is not the case. If a npc(or projectile/dust/etc) dies, it remains in the array until its replaced by a new thing spawning. However, it will have npc/projectile/dust.Active set to false, stopping it from updating. If your loop these arrays yourself, look out for these inactive objects. Another thing to keep in mind is the \"dummy\" slots I mentioned earlier. These arrays have one extra slot at the end that is not updated, instead it hold a dummy object that doesn't do anything and should be ignored when looking through the arrays. When looping them, use Main.maxProjectiles and the other array counterparts to avoid the dummy slot. Making Phases You can make your NPC choose different attacks based on certain factors, and make your code overall more organized by making your phase choosing code in it's own method, then call instead of setting state in the attack. Let's look one phase from before, but this time make the state be set to a new phase we added if hp is below 50 by checking and before setting it Thing is, if we want it to transition after every attack, we would have to put this code in every single state in the first phase, which is a lot of unnecessary code and causes other issues. Instead we can make a method to change the phase, then call it in our phases. This way, we avoid having to put the same code over and over, and if we want to edit this code later(like adding another state or removing one) we only need to change it in one spot. Making a NPC Despawn To despawn a npc, you just need to set npc.active to false. Of course, you only want your npc to despawn under some conditions. The most common is to make a npc to despawn if there's nobody around to fight. To do this we need to check if a valid target exist, and if there isnt, we despawn. First we check if the current target is dead or if something else would cause us to want to despawn //TODO: despawning based on other conditions such as biome(if your reading this, you probably will just need to loop the player array then check if they are not in the biome with !player.desiredzone Projectile despawning happens automatically after TimeLeft runs out(which you should set in setdefaults). If you want to manually get rid of it call If you don't want the projectile to despawn after a certain amount of time, set projectile.TimeLeft to be greater then 1 in ai. Since ai is called every tick, it will always never drop to 0 and the projectile will never despawn(however this combined with no tile collide causes some strange side effects, like breaking queen be larva across the map, so use it sparingly). Animation NPC's and projectiles have different ways of animating, this part shows a npc. For a projectile change projectile.Frame instead of using the find frame hook. Both of these require a sprite sheet, split into each frame(way the npc/projectile can look) stacked on top of each other evenly. For example look at flutter slime from example mods sprite sheet: Each frame represents a way the npc can look, and your sprite sheets should also look like this. The sprite sheet I will be using looks like this: //TODO redo this to make it clear what frame number each one is + Gifs After making our sprite sheet like the one above, we need to register the amount of frames in it in the SetStaticDefaults hook When this happens, the game takes our sprite sheet and evenly cuts it up into however many frames we specified(in this case 4). //TODO Add a picture of sprite sheet as the game would separate it. Now, we need to change the frame in order to animate our npc. To do this, we need to override the hook, and change which frame of our sheet to draw. In the FindFrame hook, you may have noticed the one integer parameter, frameHeight. This is the height of one of our frames(if you have a 5 framed sheet thats 50 pixels tall, it will be 10) and should be mutplied by the frame you want to get what to set npc.frame.Y to. Setting npc.frame.Y to will be the 4th frame, setting it to (or just 0) will be the first frame, as thats the bottom of the frame we want to draw. In order to make code easier to read, instead of putting the frame number, like 5, you can assign constants that describe what each frame does. means a lot more to anyone reading then . If your code looks like the example above in the making patterns section, you can check you state variable just like you do in ai. In fact, we can use some logic very similar to ai to determine which frame we should be. This code shows making a different frame assuming your code looks like the example above. //TODO: complete example? Common behaviors Spawning A NPC Spawning npc is a lot like a projectile but instead you use NPC.NewNPC It's parameters are NewNPC(int X, int Y, int Type, int Start = 0, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, int Target = 255) Remember all the ones with a = after are optional, and you only need to put a value for if you know what you're doing. X and Y are self explanatory, and Type is just like in NewProjectile vanilla npcs would be NPCID.Name and modded is Start is almost never used. Its the index to start looking for a place in the array for the npc to be placed. If its set to 100, then its WhoAmI will be 100 or above. This largely has no practical use, and can be safely left at 0. ai0 ai3 are the same as in projectile their values are copied over to the ai array in npcs. Target is what npc.Target is set to in the spawned npc. Fire a burst of something You can make code execute more then once in ai with a for loop. If you want to make your projectiles inaccurate or not all fired towards one spot read the \"Changing Projectiles Direction\" section below, making use of the loop variable. Changing Projectiles Direction When Fired To change where the projectile is fired you need to affect the and (assuming you're still using the code from above, this is ToPlayer X/Y). There's a number of handy methods that you can use on a Vector2 to change it's contents. One of the most useful is or . This rotates the Vector2's contents, making it usefully for shooting ahead of a target or making a spread/shotgun pattern. Keep in mind it takes Radians not degrees so make sure to use if you have a degree measurement. Example usage shooting a circle of thing How Do I Spawn My NPC Like Vanilla Bosses Spawning your boss is simple, just call , with player being the person to spawn on. This even handles the \"boss has awoken\" in chat. How Do I Make my NPC/Projectile Give a Debuff To do this we need to override for npcs or for projectiles and call player(npcs) or target(projectiles).AddBuff(int type, int duration) Keep in mind that duration is in ticks. 60 = one second How do I Make Something Talk in Chat To print a message in chat, put Main.NewText(\"Text\", new Color(r,g,b)). R, G, and B are numbers 0 255 of the message's color. How do I Give my npc Drops Read How Do I Make a Worm Boss Worm bosses take significantly more code then this guide covers. Example mod shows an example of what worm code would look like here: Common Errors Remember google is your friend when trying to find how to fix an error. The Type or Namespace something Cannot be Found Keep in mind c is case sensitive Projectile is not the same as projectile. If \"Something\" is not from your mod This probably means you forgot an using. If you're on vs, it should automatically recommend them. If you're not, try looking around if it's in example mod and adding the usings it has. Adding Should cover most of them. If it doesn't and you can't find it make sure you haven't misspelled anything. If \"Something\" is from your mod, make sure it's spelled correctly. If it is, go to it's file and make sure you're using it's namespace. Cannot implicitly convert type 'float' to 'int'. An explicit conversion exists (are you missing a cast?) This means you tried to use a float(variable that can hold decimals) for something that uses an int(variable that only holds whole number). You can solve this easily by \"casting it\" by adding (int) before, but keep in mind this will cause everything right of the decimal point to be removed. You can get a rounded number with"},{"path":"螺线翻译tml教程/2-中阶/3-Intermediate-netcode 中阶-联机同步.md","filename":"3-Intermediate-netcode 中阶-联机同步.md","title":"3-Intermediate-netcode 中阶-联机同步","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introductory Before you continue this guide, you should read our guide first. Practical advice In general, you'll want to make your packets small so they can be sent across clients quickly and do not cause any problems in the network. Big packets or many packets sent will cause the network to clog up, and can cause lag or problems while playing the game. If a mod performs bad during multiplayer, this can be why. If a mod is actually buggy during multiplayer, it is often because they do not send packets at all and clients aren't synchronized. To help aid making packets small and minimizing the amount you need to send, you should try to make code deterministic whenever you can. Determinism means that code on clients align, and do not need further interaction between them to be in the same state. This means no networking between them needs to be done to ensure everyone gets the same result on their client. Ensuring determinism isn't always easy, but can easily be checked against when answering the following question: \"Will multiple clients be in the same state (or have the same result) when this code is ran for them individually, without any interaction between them?\" If the answer is yes, that means your code is deterministic enough. If all clients can reach this point at the same time, no more networking is needed to ensure the same result. Packet flows There are a couple of flows that can happen for network packets: Flow 1 : Client Server Client This flow is very common. A client sends a packet to the server, after which the server forwards this packet to all other connected clients (or specified ones). Flow 2 : Client Server This flow is also very common and is used when a client needs to instruct the server of a change. An example could be running a (chat) command that alters server behavior, so something that the server controls. Flow 3 : Server Client This flow is less common than the other 2 flows and is used to have the server instruct the client about something. It is common for this flow to occur in games when a client is out of sync and the server sends it information to come back in sync. ModPacket Making and sending a packet If you want to send packets in your mod, you will use the ModPacket class. This class is designed to send data in any of the designated flows described above. A very simple packet could look like this: Now you have written a packet with the string data \"Hello World!\". In order to send the packet to the server, call the function on ModPacket: You may already have realized we are now in flow 2: we are sending a packet to the server. It is now up to the server to do something with this packet. Receiving packets For receiving and reading packets, you'll have to override the method in your Mod class: is called whenever a packet is received from a client (if this is a server) or the server (if this is a client). whoAmI is the ID of whomever sent the packet (equivalent to the Main.myPlayer of the sender), and reader is used to read the binary data of the packet. So in order to handle packets sent by a client on the server you must make sure your mod is also running on the server. You'll obviously want to write this method more elegantly so you can handle different kinds of packets. It's very common to write an identifier for your packet so you can recognize what the packet is about. You can then read this type and execute the corresponding reading logic: Reading a packet Reading is just as writing, you'll have to call any of the appropriate read functions from the BinaryReader object. Very common are: , , and (reading a float). Writing and reading in the correct order It is very important that you remember that packets are FIFO : First in = First out. You must read the data in the order it was sent in . For example, let's consider a packet where you send a byte, and integer and then a float. We'll be using some arbitrary numbers alongside an id for the packet. You'll write and send the packet as follows: You must read the packet in the same order on the receiving end, so: Networking optimization Bad networking code can cause your mod to perform poorly in multiplayer play. Let's go over some concepts to ensure that doesn't happen. Under reading or over writing In general, you must remember to only send data you will actually use . If you send more data than you are reading, this is considered under reading or over writing. Essentially you are bloating the network with redundant data, data that you aren't using. Always make sure you are actually using all the data you are sending . Common data you usually don't have to send are calculated values, or instead parameters for a calculation . Consider that you have calculated a number on one client, and this number needs to go another client. You could choose to send the non deterministic parameters which you used to calculate the number, or you could choose to send the calculated number. For example, if we take simple multiplication for integers the latter choice would be best because we're sending just one integer vs two integers. In some cases however, you may end up with multiple results from these two parameters, in this case it may be better to send the parameters instead and calculate the values again on the other client. Sending packets at the right moment To not overflow the network with ridiculous amounts of packets you need to think about when it is the right time to send a packet. For example consider a packet notifying the death of a boss. You could choose to send a packet every frame with the health of the boss and check this value on the receiving end. However, the game updates at an interval that will cause you to send dozens of packets every second! You can imagine that packets holding a lot of data this way will bloat the networking and cause the game to perform poorly. Make sure you send a packet where it is supposed to be sent, in this case on death for the boss. ModNPC has a hook for this. In a lot of cases, you do not need to send packets at all; simply use one of the provided tML hooks. In the given example we could also just check if the running instance is a server in the death hook for the boss, and then run whatever logic we need. Usually there's a hook already available you can use for your logic. Our goes more in depth on this matter. But now you might wonder, when to send a packet then? Usually a good time to send a packet is with non deterministic behavior. Consider the boss again in a multiplayer game. You may have programmed the AI to semi randomly switch phases of the boss. In a multiplayer scenario this random switch should occur on the server, and at that point the server should send a packet to all clients informing them of the phase change. This way all clients will stay in sync because they are informed by the server. If the clients were to decide for themselves when to switch phases each client would turn out of sync with each other because they would switch at different moments. Modelling Send and Receive for ModPacket In general, it is easy to model how you should write and read data from a packet. You should read the data, in the same order it was sent . Consider the following scenario: In the above example we're showcasing how you can model/design your send and receive methods to handle all involved parties: both connected clients and the server. In the Send() method, we're sending a packet that contains a float and int value, to some specific target and ignoring the passed fromWho client. In the Receive() method, we're reading the packet data, and then doing something based on if we're a server or client. You'll see that we read the fromWho data dependent on the Main.netMode. This is because this part of the packet only exists when the packet was sent by the server, so we can only read it if we're a client. You can do this to access the client that originally sent the packet, instead of 256 as fromWho which signifies the server. If you compare Send() and Receive() closely, you'll see that the order of reading and writing aligns. At the end of the Receive() method, we call Send() again and pass 1 as toWho which signifies every connected client, except the fromWho client. This makes the server forward the packet to other clients. Conditionally if we're not a server (so we're a connected client), we can set the newly read values in some place where we actually need them. Good practice managing many packets If you work on a big mod, you might find yourself sending many packets which can become a hassle to manage without a proper setup. Recommended is to use a PacketHandler class that can make it easier to handle different packets. Feel free to use this class: This class takes care of some stuff for you, including writing the handler type and packet type. This will be useful when receiving packets, knowing where to forward to. You can inherit this base class, for example when making a handler for \"MyBossNPC\": If we go by the example earlier, you might want to sync the target of this boss. You can modify the class to reflect this. You'll need to make HandlePacket switch by the packet type, and call the appropriate handling method for that packet: The last thing you'll need to do, is actually call the appropriate PacketHandler class when your mod receives the packet. You can make a global class that handles this for you. In your mod class: In your new ModNetHandler class: With this setup, you can keep creating new PacketHandler classes to handle certain subjects in a more global way."},{"path":"螺线翻译tml教程/2-中阶/4-Intermediate-Git-&-mod-management 中阶-Git&模组管理.md","filename":"4-Intermediate-Git-&-mod-management 中阶-Git&模组管理.md","title":"4-Intermediate-Git-&-mod-management 中阶-Git&模组管理","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In this guide we will go over Git, what it is, how it works, and also how we can use Git for our mod source code. Foreword It is important to note that you will be making your source code public (and your mod 'open source') with this guide. If you do not wish to do so, you probably shouldn't follow along with this guide. (just read it) However, this guide will also explain how Git works so it may still be useful to you. Making your mod open source comes with many notable benefits, such as: Other people will be able to help you, this includes adding new features or content to your mod, as well as fixing bugs or generally improving code Get easy feedback using the GitHub issues system, people can make issue threads and provide feedback there Your mod will be allowed to be put on the Open source mods page on the wiki, giving your mod more visibility For more info, visit the page Provide more information using the GitHub wiki system, or even the Most information of this guide has been adapted from and making it available here, because their information is very clear compared to other sites. What is Git? Git is a distributed version control system. Every developer of the project has a working copy of the code and full change history on their local machine. These fully functional local repositories make it is easy to work offline or remotely. You commit your work locally, and then sync your copy of the repository with the copy on the server. This paradigm differs from centralized version control where clients must synchronize code with a server before creating new versions of code. Git is the most commonly used version control system. The very basics of Git Commits Every time you save your work, Git creates a commit. A commit is a snapshot of all your files at a point in time. If a file has not changed from one commit to the next, Git uses the previously stored file. This design differs from other systems which store an initial version of a file and keep a record of deltas over time. Commits create links to other commits, forming a graph of your development history . You can revert your code to a previous commit, inspect how files changed from one commit to the next, and review information such as where and when changes were made. Commits are identified in Git by a unique cryptographic hash of the contents of the commit. Because everything is hashed, it is impossible to make changes, lose information, or corrupt files without Git detecting it. Branches Each developer saves changes their own local code repository. As a result, you can have many different changes based off the same commit. Git provides tools for isolating changes and later merging them back together. Branches, which are lightweight pointers to work in progress, manage this separation. Once your work created in a branch is finished, merge it back into your team’s main (or master) branch. In this example, 'Some feature' is a feature made on a separate branch which can then later (when finished) be merged back into the master branch. This is useful for developing features of which you are not certain to be included in the final product. Staging and file states Files in Git are in one of three states: modified, staged, or committed. When you first modify a file, the changes exist only in your working directory. They are not yet part of a commit or your development history. You must stage the changed files you want to include in your commit (you can omit files that you wish to commit separately). The staging area contains all changes that you will include in your next commit. Once you’re happy with the staged files, commit them with a message describing what changed. This commit becomes a part of your development history. Staging lets you pick which file changes to save in a commit so you can break down large changes into a series of smaller commits. When you reduce the scope of your commits, it’s easier to review the commit history to find specific file changes. These were the basics of Git... Now let's move on to some tips when using Git. Further below we will discuss mod management with Git Commit frequently All the time when working on your code you should think about when it is time to make a commit. Remember that your commits are only local as long as you don't push your commits to the public repository. It's a healthy habit to commit as frequently as possible, not just for the sake of management but also the assurance that those specific parts of code changes are saved and now in place in the development history tree. Be descriptive, but stay concise Always make sure your commit names are concise. For example, if you've developed a new feature, just call it 'new feature: name' instead of 'feature name: it can do this, and potentially this and that'. If you want to be descriptive, use the description part of your commit. Make use of branches! Many people are afraid of branches, don't be! They are the most amazing thing ever. Many times, it is useful to use branches even when not for new features specifically. Check the next tip. Use branches and pull requests for code review It is very useful if you make use of the awesome tools Git/GitHub provides you. This is something we often use for tModLoader development, but you can use it as well if you develop your product with multiple people. You can make a new branch and commit your changes to it, then create a new pull request to master from that branch. With the new pull request, you can ask for feedback and code review from other collaborators! Benefits of using Git/GitHub Simultaneous development Everyone has their own local copy of code and can work simultaneously on their own branches. Git works when you’re offline since almost every operation is local. This means Git makes it much and much easier to work on mods with multiple people simultaneously, Faster releases Branches allow for flexible and simultaneous development. The main branch contains stable, high quality code from which you release. Feature branches contain work in progress, which you merge into the main branch upon completion. By separating your release branch from development in progress, you can manage your stable code better and ship updates more quickly. Built in integration Due to its popularity, Git is integrated into most tools and products. Every major IDE (like Visual Studio) has built in Git support, and many tools that allow you to manage continuous integration, continuous deployment, automated testing, work item tracking, metrics, and reporting feature integration with Git. This integration simplifies your day to day workflow. Strong community support Git is open source and has become the de facto standard for version control, and there is no shortage of tools and resources available for you to leverage. The volume of community support for Git compared to other version control systems makes it easy to get help when you need it. Git works with your team Using Git with a source code management tool can increase your team’s productivity by encouraging collaboration, enforcing policies, automating processes, and improving visibility and traceability of work. You may choose individual tools for version control, work item tracking, and continuous integration and deployment. Or, you can choose a solution like Visual Studio Team Services that lets you manage all of these tasks in one place. Pull requests Use pull requests to discuss code changes with your team before merging them into your main branch. The discussions you have in pull requests are invaluable to ensuring code quality and increase knowledge across your team. Visual Studio Team Services offers a rich pull request experience where you can browse file changes, leave comments, inspect commits, view builds, and vote to approve the code. Development policies Your team can configure Visual Studio Team Services to enforce consistent workflows and process across your team. to ensure that pull requests meet your requirements before completion. Branch policies protect your important branches by preventing direct pushes, requiring reviewers, and ensuring clean builds. Use for more streamlined issues and PR content. Get a free website for your project GitHub allows you to upload a website for free for your project. Check the system for more information. For tModLoader we utilize this system by providing source documentation using doxygen: License your work When you use Git, you can properly license your work. If you have no clue what license to use, check tModLoader mod management with Git Team development It is common that mods are created by a bunch of people rather than one. Git makes working together on your mod much easier and can provide a more streamlined development process for the team. Easy release tracking With Git, it becomes much easier to track your releases of your mod. If you use Git from the start, you will be able to go back to any release you ever made and check out the code you had at that time. Useful for mods that live for a long time. Literature https://docs.microsoft.com/en us/azure/devops/repos/git/gitquickstart?view=azure devops&tabs=visual studio https://git scm.com/book/en/v2/Appendix A%3A Git in Other Environments Git in Visual Studio"},{"path":"螺线翻译tml教程/2-中阶/5-Intermediate-modding-with-C#6 中阶-使用C#6开发模组.md","filename":"5-Intermediate-modding-with-C#6 中阶-使用C#6开发模组.md","title":"5-Intermediate-modding-with-C#6 中阶-使用C#6开发模组","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Please check the before following this guide. What is C 6? C 6 stands for version 6 of the c sharp language. By default, you will be compiling your mod using c sharp version 4. However, it is possible to compile your mod using c sharp version 6. In this guide we will go over how to compile using version 6, and which benefits it may include. How to compile in C 6 To enable version 6 compile, set languageVersion to 6 in your build.txt file: Ways to compile It is recommended to use your IDE to compile and debug your mod. You can view the on how to set this up. You can also compile using the in game menu, but sometimes this can introduce additional problems you won't have when compiling from your IDE directly. We will go over these issues later on in the guide. Why should I use C 6? In general, it is usually best to use the latest version of something. Our language version is not an exception, version 6 comes with many improvements over the old version. It is advised to check to see all the goodies. In general, c 6 has some neat QoL improvements we will cover below. Here is a full list of what c 6 introduced: Read only Auto properties: You can create read only auto properties that can be set only in constructors. Auto Property Initializers: You can write initialization expressions to set the initial value of an auto property. Expression bodied function members: You can author one line methods using lambda expressions. using static: You can import all the methods of a single class into the current namespace. Null conditional operators: You can concisely and safely access members of an object while still checking for null with the null conditional operator. String Interpolation: You can write string formatting expressions using inline expressions instead of positional arguments. Exception filters: You can catch expressions based on properties of the exception or other program state. nameof Expressions: You can let the compiler generate string representations of symbols. await in catch and finally blocks: You can use await expressions in locations that previously disallowed them. index initializers: You can author initialization expressions for associative containers as well as sequence containers. Extension methods for collection initializers: Collection initializers can rely on accessible extension methods, in addition to member methods. Improved overload resolution: Some constructs that previously generated ambiguous method calls now resolve correctly. Please do check the linked article above which explains everything in great detail. Many of these QoL will shorten your code, and/or make it more readable (as well as easier to work with!) Is it possible to compile in C 7? Compiling with C 7 is possible with releases after version v0.10.1.5 . To learn more about it, see the Most notable code improvements with C 6 for modders Expression bodied function members Any method you have, for example an overridden hook that only returns some value, can now be shortened as an expression bodied function members (pointer like functions) eg. Can be shortened to String interpolation You no longer have to use string.Format, instead use the new string interpolation: Can be shortened to Long list of issues when compiling with c 6 !! IMPORTANT !! Possible issues Note: most, if not all, of these issues have been solved since . If for some reason you are still on an older version, you can see below for various issues and possible fixes. You need to include System.Core in some way or form in your code to avoid a bug. System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. System.IO.FileNotFoundException: Could not load file or assembly 'System.Collections.Immutable, Version=1.1.37.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a' or one of its dependencies. The system cannot find the file specified. If you run into this issue, you need to add to your ModCompile folder. A newly distributed RoselynWrapper.dll needs to include this .dll for this issue to be resolved. Metadata file 'path FNA.dll could not be found OR another error mentioning FNA.dll To fix this issue, go to your ModCompile folder and look for the file. Copy this file one directory up (to the Terraria directory). You probably ran into this issue by compiling through the in game menu. Make sure you also reference System.Core as mentioned above. An error mentioning something about ReLogic.dll not being found or able to be accessed Go to your Terraria folder and look for and copy this file to your ModCompile folder, then rename it to If it now starts mentioning Mac/Linux, copy the file twice more and name them to and C 6 issues: \"An attempt was made to load an assembly from a network location...\" ."},{"path":"螺线翻译tml教程/2-中阶/6-Intermediate-modding-with-C#7 中阶-使用C#7开发模组.md","filename":"6-Intermediate-modding-with-C#7 中阶-使用C#7开发模组.md","title":"6-Intermediate-modding-with-C#7 中阶-使用C#7开发模组","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is C 7? C 7 is the seventh version of the c sharp language. It builds on the C 6 version of the Roslyn compiler. To learn more about C 6, see . How to build with C 7? tML version 0.10.1.5 or above is required. , As of v0.11, C 7 is the default, you can otherwise set your to because internally there are no changes in compiler between C 6 and 7. Most useful features Below is a list of features C 7 has to offer that are most useful when modding. Nested functions (Local functions) This is an awesome feature that allows you to break up larger methods into smaller chunks. Nested functions can be reused within the same method as well. These functions are in scope in the enclosing block. Inline out variables Note that the variables are in scope in the enclosing block, so that the subsequent line can use them. Many kinds of statements do not establish their own scope, so out variables declared in them are often introduced into the enclosing scope. This also allows \"discards\" as out parameters as well, in the form of a , to let you ignore out parameters you don’t care about: Pattern Matching Pattern matching is especially useful with . You can identify objects using their inheritance tree, this means you can identify them by parent types as well. Constant patterns E.g: Type patterns E.g: or: (reduced nesting like this is often favorable) Patterns in switch statements More information is available . Tuple types and literals New tuple types and literals are extremely useful and have you avoid defining your own tuples (in the form of Tuple and accessing by myType.Item1... Item2... etc.) or structs and instead use literals that are easily defined and can be deconstructed. Allows discarding too:"},{"path":"螺线翻译tml教程/3-高阶/0-Advanced-Prerequisites 高阶-先决条件.md","filename":"0-Advanced-Prerequisites 高阶-先决条件.md","title":"0-Advanced-Prerequisites 高阶-先决条件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Advanced Prerequisites Basically all the previous prerequisites. See Beginner and Intermediate prerequisite guides first. Advanced IDE Capabilities If you haven't already, now is the time to explore the capabilities of your IDE. Please see the guide to familiarize yourself with everything your IDE can do to improve your mod making productivity. Of particular note, make sure you are fully taking advantage of IntelliSense and that you know how to use the Debugger. tModLoader Source code You may need to decompile tModLoader to understand the correct way to do something, or to figure out the recommended approach to what you are doing. Anyone attempting to do Advanced level guides probably needs their own copy of decompiled . But wait, I found the code on Google! No. That code is bad and will not work. It has tens of thousands of decompilation errors. Just decompile it yourself, it is easy. Read on. Simple Way A simpler way is to download a recent release of (These instructions last tested with ILSpy 9.0), scroll down to \"Assets\", expand it if needed, and download the zip with \"binaries\" in its name matching your CPU architecture (most likely x64), unzip the it to a folder, and launch . (If you are on Linux or Mac, you will need to use instead of ILSpy. The following instructions should be mostly the same.) Then, to make adaption easier, go into tab, scroll down to the section and enable , and press . This will make it so instead of just it will say , making adjusting the code easier. Then use to open from the . In addition, you should also use to open , found in . You can drag the file in instead of if you want. Do the same for ( ) as well. Finally make sure tModLoader is selected on the navigation pane and then click and navigate to a convenient empty folder and press click (You'll want to choose a folder that you can easily find later, I suggest making a folder in the : ). This will take a minute or so depending on your computer. Once that is done, the folder that you saved the code to now has a file, opening this file should open Visual Studio if you have it installed (highly recommended). If you do not have Visual Studio installed, you'll have to navigate the files individually through file explorer. If you see \"Unknown result type (might be due to invalid IL or missing references)\" anywhere in the files, you most likely forgot to open and . There are a few drawbacks to the simple way. The biggest drawback is you can't debug tModLoader itself. This is an advanced technique, but if you wish to do this later, come back to these instructions and read the below. The other drawback is you might find the code to have decompilation errors. With the latest version of ILspy, these are very limited and easily fixed. Simple Way, Adaption Guide Extra Steps If you are following the guide, you may want to do one additional step before exporting the code. The default behavior for ILSpy is to omit qualifying member references. What this means is that code you find in , for example, would read as rather than . The second approach greatly simplifies adapting vanilla code, as it allows using a simple Find/Replace operation to convert the code into code suitable for pasting into our class. Without this approach, the code is very difficult to fix. To enable this second approach, go to and scroll down to the section. Find , make sure it is checked, then click . From now on ILSpy will output code with this extra text to greatly simplify adaption. Hard Way The best way to get the source code is to download the tModLoader repository and go through the . This will net you a completely functional solution that you can open in Visual Studio. This method will take more time and it's not usually required unless you need to debug Terraria code itself or contribute to tModLoader directly."},{"path":"螺线翻译tml教程/3-高阶/1-Advanced-Vanilla-Code-Adaption 高阶-源码参考.md","filename":"1-Advanced-Vanilla-Code-Adaption 高阶-源码参考.md","title":"1-Advanced-Vanilla-Code-Adaption 高阶-源码参考","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Vanilla Code Adaption This guide teaches how to navigate the jungle that is Terraria source code to find or adapt code. Why? Maybe you wish to customize an aiStyle, maybe you want to know how Magma Stone works, or maybe you want to mimic a vanilla effect. After following along through these examples, you will have learned enough to be able to work out how to adapt and re implement most other existing content. TL;DR Change code to the corresponding object, such as or If you are manually copying aiStyles, you can delete all code related to other types to make the code more readable For example, Projectile AiStyle 1 is 3500 lines of code, but can be pruned down to about 5 lines of code, see for that code. Use F2 to rename auto generated variable names ( , , etc) as you figure out what each variable represents The variables shown in this guide will likely not match the values you see in your copy of the source code due to Terraria updates how decompilation works. Obtaining Vanilla Source Code It is against the law to publish the decompiled source code, but anyone with a competent computer can decompile their personal copy of Terraria.exe no problem. Note that you may wish to end up with a decompiled tModLoader rather than a decompiled vanilla Terraria so that you know where tModLoader hooks are. See for more info on how to decompile tModLoader. For just adaption purposes, it might be easier to do via the \"Simple Way\" because it creates instead of , helping mass replace and with (tModLoader setup doesn't do that). After you have a copy of the source, open the file in Visual Studio so you can easily search the whole project. You can do this by opening the file directly from the file explorer or opening up Visual Studio and using to select the file. Visual Studio Code Instructions Expand for Visual Studio Code Instructions This guide expects the user to be using Visual Studio, not Visual Studio Code. This section lists the alternate instructions pertaining to using Visual Studio Code. Use these alternate instructions to convert the Visual Studio instructions found in this guide to instructions you can use in Visual Studio Code. Open Terraria.csproj To open the project, you'll need to use and then select the Terraria folder itself. Search Entire Project The option to search an entire project is separate from the normal find tool ( ). To search the entire project, press to bring up the tool. The \"Match whole word\" toggle is a button on the search bar. The results will be listed in this side panel, not a panel at the bottom. When clicking on a search result, the method and class are listed at the top of the editor panel: Find All References The option will be found in the right click menu still, but the keyboard shortcut is instead. The results will be in a panel to the left, not below. Go To Definition This is the same as in Visual Studio. Either press or hold and click to navigate to the definition of a member. Example: Armor Effects: Ninja Shirt A simple example for investigating vanilla code is figuring out how vanilla armor or accessories achieve their special effects. For this example, we want to know how Ninja Shirt achieves \"3% increased critical strike chance\". (Follow along for whatever effect you are interested in.) The first step is to find the . Searching , you will find where is defined: We now must search the entire project for \"257\", using the Quick Find tool ( , don't mistake the \"Search Solution Explorer as the search tool, that is different). Be sure to set \"Match whole word\" here to limit results, then select \"Current Project\" to search all files, and use the \"Find All\" button to find all results. In the results, you will see many references to \"257\", you must now trim down the results to find the relevant results. Clicking on a search result will navigate to that line in the file. The method name of the currently selected line of code is listed in the top right. You may find a result in , setting the default values for the result, but this code isn't responsible for the throwing damage bonus, so we must continue searching. Continuing down the list of results, you can skip the results in , as those probably relate to whatever is equal to 257, not the of 257. Finally, you will come to the results in and your screen will show this: Bingo! This looks right. Now we want to bring this code, , into our 's code. First, override the hook in your class. Next, paste the code in and you'll notice that your IDE is complaining about the code you just pasted. The code has \"this\", which refers to the Player instance. Our code is in , not , so trying to use \"this\" and modifying the value of the field won't work, since doesn't have a field. Luckily, the hook has a object passed in, so we change our code to . There is still an error, however. The error message states that \" is inaccessible due to its protection level\". This means that the code we are trying to use was hidden from modder use. This sometimes happens when tModLoader is changed to make Terraria more flexible and compatible with mods. If you are familiar with how damage classes are usually done in tModLoader mods, you'll know to change this line to to fix the issue. In most cases you will not run into issues like this and simply replacing with will fix the issue. Example: Accessory Effect: Magma Stone Another example. Search to find . Now search for \"1322\", you'll find a result in that does . (It is worth noting that this code is setting a bool field in the object and is exactly the same thing us modders would do in our .) Now we must investigate this \"magmaStone\" variable. Rather than searching the code using the find menu, this time we will use the feature of Visual Studio. is the keyboard shortcut: Now we go through the 9 results in search of what we want to know. 2 of the results are setting the bool to true and correspond to . 1 of the results sets the bool to false, this is akin to . The Results in and seem to be applying a buff to the target. Looking up 24 in shows us the buff is . These results correspond to ModPlayer.ModifyHitPvp and ModPlayer.ModifyHitNPC. The 6th result is in Player.ItemCheck and appears to be spawning some Dust. We know that Fire particles spawn when melee weapons are swung, so this code must correspond to that. How would you mimic this behavior yourself? We need to search nearby code and look for tModLoader hooks. tModLoader hooks have code like or , so lets search for that. Luckily, this result is right next to the hook! Now let's look in the ! As you can see, the documentation also agrees, this is the hook to use to spawn dust and other effects. The last 3 results are in . They do the same thing that earlier results did, but for melee projectiles instead of melee items. (Dust, Hit NPC, Hit PvP) The corresponding hooks we use to replicate this behavior is in: , , and . Remember to adapt the code you find to the context the hooks give you. Replace \"this\" with the correct object variable, \"Main.npc[i]\" with \"target\", and so on. Example: Projectile or NPC AI code This guide teaches how to adapt vanilla AI code for new uses. In Beginner level coding, we sometimes use vanilla aiStyles for our ModProjectiles or ModNPC. In Intermediate level coding, we take that a step further by setting to mimic the specifics of an aiStyle or even use or to add additional code to vanilla aiStyles for our particular thing. This is not always enough, so in this tutorial, we will learn how to investigate vanilla source code to find the information or code snippets we need to completely customize the things in our Mod. Example: Item and Projectile: Shadowbeam Staff clone Shadowbeam is a pretty neat weapon that shoots a projectile that bounces several times instantaneously. Lets make a weaker version of the Shadowbeam Staff and then attempt to customize the look of the projectile. Weaker Shadowbeam Staff clone The first step in our journey is cloning the vanilla item. This is seen a few times in ExampleMod, but below is the code. Huh, something is off, the staff isn't held right. Lets find the value of in ItemID.cs. We find that it is \"1444\". Lets now search the source for \"1444\". Out of these matching results, we see an NPC loot drop, prefix assignment, , , and 2 pieces of code that we haven't seen before. The one in sounds like it is related to achievements, so lets look at this last result. This last result is a switch statement. We follow the cases for the switch statement down until we find the code. Looks like we forgot to set to true. If you studied ExampleMod's , you would have already known about this. Lets add this to our code in and also take this opportunity to reduce the damage of our weapon: Now we have a working clone of Shadowbeam Staff that is weaker. Feel free to adjust and other fields to your liking. Shadowbeam Projectile AI Now that we have the Item working, you may think that modifying the color or number of bounces would be simple, but it is not. This is all hard coded into the AI of the Shadowbeam Projectile, so unfortunately we have to make a new and edit a copy of the vanilla AI code. Lets first investigate to find where the purple color of the Shadowbeam staff projectile comes from. First, lets look at the Shadowbeam Staff item's value. In , we see . Great, lets find that in ProjectileID.cs: Ah, notice that there is also a . ProjectileIDs with Hostile in their name usually refer to projectiles shot by enemy NPCs, be aware of this in your future source code exploration. Lets search the source for \"294\". Most of the 45 results are referring to the Item and Tile that share the ID of 45, but the 4 results in Projectile.cs seem promising. The first result shows us the . Of note is , what could that possibly be? As a spoiler, that is how the bouncing effect works. It lets the AI code execute 100 times each frame rather than once as normal. Without it, the instant bouncing effect wouldn't be easily possible. Also noteworthy is , we will have to find the code for this later. The second result is in a method called . If you remember, the Shadowbeam Staff loses damage as it penetrates enemies, this must be related to that effect. Hopefully you decompiled tModLoader instead of Terraria because you'll be able to find that the hook is called close to this code. Later we'll need to adapt this code into our replacement we make. The 3rd result is in . It is a bit hard to find, but the related tModLoader hook is . The 4th result is in , this is the code we'll need to adapt. Below you can see a neat feature of Visual Studio in action. Hover over the guidelines and you'll see a listing of the nested conditions that lead to this code. Notably, we see that this code is within an if statement checking . Now that we've found all the relevant code, now we need to investigate how the color is decided. This might be a good time to check what other projectiles use projectile aiStyle 48. Searching for reveals that HeatRay, UFOLaser, MagnetSphereBolt, and ShadowBeamHostile all also share aiStyle 48. We know that HeatRay is yellow, but Shadowbeam Staff is purple. Knowing this, we know that the code for the color must be within an if statement within the AI code. Going back to the 4th result, the result in the AI method, we look for anything that looks like code related to color. Ahah! We find the code and look up the 173rd dust in the : Yep, we've figured out why the Shadowbeam Staff projectile is purple, it is because dust 173 is spawned in AI. Let's remember to change this to spawn dust 178, a lime green projectile, for our modified clone. If you look at the rest of the code for aiStyle 48, you'll probably notice that there is nothing limiting the number of bounces. Through some trial and error, you'll discover that and are responsible. A of 300 would normally stick around for 5 seconds, but because of being 100, it actually only lives for 3 ticks/frames. Lets change to 200 for our weaker clone, this will shorten the reach of our weapon. Now that we've found all relevant pieces of code in the source code, lets make a clone of the vanilla ShadowBeamFriendly projectile. Lets first also remember to add in to our so our weapon won't shoot the vanilla projectile. We'll also need to change in to . Next, we need to copy over the AI code we found to our own AI method and remove anything related to other projectile types that we are not interested in. We also need to remember to remove the if statements originally checking for the projectile type we were interested in but leave the code from inside that if statement block. Remember, when adopting vanilla code, be sure to change and things to the correct thing, in this case . Also remember not to copy over since we will be copying over and editing the vanilla AI code instead. Also, rename things like num447 with the F2 button in Visual Studio. Below is the complete code after taking into account all the vanilla code: Vanilla: Our New Projectile: If you've been following along without just copying the code above, you would have noticed that dust 178 defaults to being affected by gravity. This is easily remedied by adding to the code. Well, we've done it, we've investigated and cloned a vanilla projectile AI. We've also done some very basic editing to the AI to change the color of the trail. We can do the same for other projectiles as well, search the source code, identify code we wish to customize, then copy and then edit the vanilla code into a new . Example: NPC: NPC clone with modified projectile (Hoplite) Exact Clone To start, lets make a basic clone of an NPC as seen in Party Zombie. Lets clone the Hoplite. After some searching, we discover in NPCID and use that for our basic clone. For simplicity, I will use the functionality ( ) The following is the code: Go in game and then use a mod with an NPC spawner like or and spawn your NPC. You'll notice that the sprite and behavior is the same as the original Hoplite. (Feel free to change the sprite later the normal way.) While underground, you'll notice that our Hoplite clone attacks with that javelin as normal. The goal of the rest of this tutorial is to change that projectile and other behaviors. Preparatory work for modifications Unfortunately, there is no easy way to change the projectile that is shot by our clone. Our clone, as seen in our method, simply clones the vanilla AI code. The projectile the vanilla AI will spawn to attack the player is hard coded into the AI method. The first thing we need is the . Once you have that, now we must find the AI code to copy. Find and see that its value is \"481\", now search for \"481\". The first find result that we need to locate in the find results is the result located in the method. Once we locate this, we can find out which GreekSkeleton/Hoplite is using: Great, we now know to search the source code for : Now follow the code into the method (by clicking on and pressing on your keyboard or holding and clicking on . This is the feature) and copy all the code and paste it into an AI method in our own class. (Be careful not to mess up the pairs) We will also set in (since the method would set that to 3) and delete since we don't want both our copy of the AI code and the vanilla code to run. Once we have copied the code into our AI method, we need to do the usual cleanup: Change and to everywhere they appear in the method: Before: After: Find and Replace: You'll probably notice that there are a lot of NPC type specific sections of code. If you want, you can clean up the code further by deleting sections of the code that would only run for other NPC, but if not, just leave it. Many errors will show up. Most of them can be solved simply by letting Visual Studio add the suggested using statements to our code. If you aren't using Visual Studio or you aren't seeing suggestions or errors, you need to fix that. Read the if you don't see suggestions. One error in this particular piece of code is , just change those to 0.3f: Before: After: If you test in game now, you'll notice that they behave very odd. This is because all the code that use to dictate Hoplite specific behavior is now inaccessible because does not equal 481 any more. Lets fix this. Use find to find all and replace checks for with . Doing this will keep 481 around which will make it easier to find in the next sections. Save and rebuild, then go in game. It works!...almost. Comparing Hoplite and our Hoplite clone, our clone has a little bit different behavior. Search again in the AI code we copied over for 481 and you'll find . This is falsely evaluating to true, so lets replace this with . Now test, and our clone is perfect. Now that we have laid the groundwork, we can now start modifying the AI code. Change Projectile Now lets change the projectile. First, make a hostile projectile or find some other projectile that you wish to use. Now we need to search the AI code to find how the code decides to spawn that javelin for Hoplite. This code being almost 4000 lines of code, we don't want to search blindly. Lets again search for and look for code that seems to either be spawning projectiles or deciding on a projectile to spawn. Most likely to have the results we need are lines with on them. Lets look at the first result: Ok, this is setting some local int to 100, but if you look later where that variable is used, it doesn't seem to be related to projectile spawning. Also, the of 100 is called , so this is likely wrong. The next few results are assigning float values, so they are likely not related. Finally, we come to a result that is setting a couple int variables. Looking up 508 in ProjectileID.cs, we find , which definitely sounds correct! Great! Lets change that to some hostile projectile and then use Visual Studio to \"Find all References\" so we can figure out what is: Ahah, using the VS hotkey of , we see that is passed in as the damage parameter of . Feel free to change that line as well. Lets test in game: Well, it all works. Results video: https://github.com/tModLoader/tModLoader/assets/4522492/7031a703 89b1 4ceb bd96 f0be412da07f Change Throw Distance, Accuracy, and Aim Looking at the code, we can find that and refer to and : Lets use to quickly make the source code more readable by renaming those variables, then search source for 481 again to find code specific to the original Hoplite. Going through the Find results again, you'll notice that one of the results seems to signify the NPC aiming above the head of the player, another seems to determine throw strength, and another seems to tweak the and to make the projectile a little inaccurate. I'll leave this as an exercise to the reader. Use to rename variables as you figure out their purpose to begin to understand little pieces of the AI code. Using rename to quickly make code readable video Note: This video shows using to rename variables for readability, it will not match the Hoplite AI code the above section is discussing. https://github.com/tModLoader/tModLoader/assets/4522492/5625a1b8 a57c 453a a8d1 f51e4bd668d3 Change Animation This guide will be done later if anyone expresses interest. Custom Flail Making a flail, you might have noticed that the range of the flail is hard to customize. (TODO) ExampleLamp Tile These are the exact steps to creating . Lamps are special because they can be turned on and off by wires. Up until now, no example existed in ExampleMod of this. First, we need to find the Lamp TileID in . We find that . Next, lets find a specific lamp style we wish to copy. Use to extract Tiles 93.xnb and then open Tiles 93.png in an image editor of your choice. We'll be modifying one of these lamps for ExampleLamp, but you'll want to just use Tiles 93.png as a guide in your mod. I like this one, so I'll crop the image and edit it to fit ExampleMod art style. I measured the top lamp and noticed that it was 54 pixels high (if we include the 2 padding pixels) and made sure to crop the selected lamp to that same height. The padding pixels can sometimes be confusing, just remember that most tiles are made from 16x16 pixel image patches. Make sure to save the file, then do the same for the Item image. I just looked up the ItemID on the . Turns out we used the Rich Mahogany Lamp as our guide, lets first do the by searching the source for 2087, the ItemID of Rich Mahogany Lamp. In our initial search, we found no results! Looking at ItemID.cs, we can see that RichMahoganyLamp is next to many other lamp items. Sometimes the source code uses ranges to apply code to many different item types. The lamp item furthest above is , lets search for 2082. This time we find the code we need for our : Here is what we end up with converting this code into a . We've added a recipe and replaced with the correct TileType. We've also removed since our tile only has 1 style: Now that the is done, lets do the . First we have to find all the lines of code we need in . First, read through so you are aware of all the various fields relating to tiles, such as , , etc. Now lets search for the TileID (93) in the source code. As always, there will be many results that are unrelated to what we want. Luckily, we find various Main.tileX results, lets add those to our . We can ignore Item.cs results, but Lang.cs shows adding a map entry. In our , we can utilize vanilla localized text by doing this: We got that color from another result: and looking at . Finally, there are other results, but lets go straight to the results: We can copy and paste this straight into our after we replace 93 with Type. We also don't need SubTiles, so lets delete those lines as well. Here is our so far: Lets take a look in game! https://github.com/tModLoader/tModLoader/assets/4522492/30d7164c c0bf 4ed1 9039 ab189f219c00 Looks like we have several problems still: We can't toggle it, we can't mine it to recover it, the flame texture is totally messed up, it isn't actually lighting up anything, the tile doesn't alternate orientation, and we are missing the tiny sparks that randomly spawn sometimes. Looking at these 6, we'll find results for 5 of these in the remaining search results. For the mining problem, just follow other tiles in ExampleMod. Toggle One of the results is in , this sounds like what we want. The corresponding tModLoader hook is . We can copy in the code and have Visual Studio suggest the correct using statements. Feel free to clean up the code by renaming variables. Lighting Another result seems to be modifying 3 variables based on tile style. This is probably related to the lighting because lighting uses red, green, and blue. Once again, we search nearby for a method and learn that is where this code belongs. Remember to clean up the code, removing all the code related to other tile styles. Sparks One of the find results is near a call to . This must be the sparks code. Searching for after this line shows us that is the hook we want to use. Copy this code in as well. Clean up the code and adapt it to fit our tile. Orientation One of the results is near code relating to . If you have looked at ExampleAnimatedTile, you would recognize this code. Migrate this code into . Flame Finally, the last relevant result relates to drawing the Flame texture. Looking at the code around this result, it becomes clear that uses hard coded TileIDs to draw different flame textures. We'll need to re implement this ourselves and delete from our code to get this working. The closest TileLoader result tells us that is the hook we will need to use. In addition to adapting this code, we will make a new Flame texture in our mod. Final Code and Result Here is the and result, see ExampleMod for the sprites. https://github.com/tModLoader/tModLoader/assets/4522492/d269da77 3e24 4e6c 9576 dfaa089ecad0"},{"path":"螺线翻译tml教程/3-高阶/2-Advanced-Angular-velocity-and-Linear-velocity 高阶-角速度和速度.md","filename":"2-Advanced-Angular-velocity-and-Linear-velocity 高阶-角速度和速度.md","title":"2-Advanced-Angular-velocity-and-Linear-velocity 高阶-角速度和速度","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Read the page before continuing. What is angular velocity used for? We can use angular velocity to accurately spin an object by its velocity, when implemented well it will work perfectly. You can also in fact spin non spherical objects by angular velocity if you wanted to, but you'd have to use an imaginable sphere as the base. Because the outcome is considered a scalar, it can be easily applied in any sort of speed. Angular velocity First, let's go over things you need to have some understanding of before continuing: Angles . What is an angle? How is an angle comprised? Where and when is it used? Vectors . What is a Vector and how and when is it used? You understand Vectors used in a 2D space. Radians . You understand radians. What are radians, and how do they relate to angles? Spheres/circles . What is a circle? You know and understand what makes a circle and how to work with one. Scalars/Pseudo scalar . You know what a scalar is. It may be useful to understand what a pseudo vector is, since the angular velocity is one. I will explain it here. A pseudo vector or axial vector is a mathematical object that, like a \"normal\" vector, has a direction and a magnitude but which, in contrast to an ordinary vector, is invariant under the axis of the underlying axis while an ordinary vector would be opposed to direction to become. We will start with angular velocity, then move to linear velocity. What is angular velocity? In physics, the angular velocity of an object is the rate of change of its angular displacement with respect to time. I suppose these words are too fancy for some, so let's break it down. You just need to understand the words . Imagine a spherical object like a ball, when this object moves it is also spinning or orbiting around its center. The angular velocity is a measurement between the relation of the spherical object's velocity and the spinning around its center. These rotations around the center are often called a , one revolution being a full spin around the center. We can look at the SI unit of angular velocity to make some more sense out of this, which is . We know a full circle is 2π, or 360 degrees. Because a revolution is a full spin, we can visualize this as: . If this looks confusing, think about the following: we have x amount of revolutions per second, every revolution equals 2π. This must mean we have 2π radians per revolution. So, this can be rewritten as the revolutions cancel each other out: , which I hope makes sense to you intuitively. To give an example before we move on, imagine doing 5 revolutions per second. We know a full spin is 2π radians, so 1 revolution is 2π radians. Meaning for every revolution, we are spinning 2π radians, so with 5 revolutions per second we're spinning 10π radians per second. This measurement of how fast we are spinning around the center point is what we call angular velocity , sometimes it's also called angular speed . The angular velocity here being and the angular speed being . Setting up Before we start spinning, we should setup a helper property for our angular velocity. Remember that our angular velocity is our revolutions per second, meaning the total amount of spins around the center per second. To relate this to our velocity, we need to find a way to make use of our velocity vector. We can do this by taking the magnitude (length) of our velocity. The magnitude is basically the 'size' of our vector, which is a scalar. If we multiply our magnitude with the total angular displacement of a full spin, we end up with: . This defines our angular speed. Let's implement: ( note that this showcases c 7 getters ) Because Terraria has useful helpers, you can replace 2π with for a constant value, which is much faster compared to continuously calculating (because TwoPi is a constant) Applying angular velocity You can apply the angular velocity in many different ways, as you can apply rotation in many different ways in Terraria. One way you can do it, is by adding the angular velocity to the rotation of the entity in the AI. This is useful for things like npcs or projectiles: . It is important that you add the angular velocity instead of setting it directly to it, because remember that it defines the angular displacement . If you work with something else, it is likely you should store your own angle variable. Then in any sort of update call, you can apply the same behavior as above. With custom draw code, you should pass the displaced angle to draw with. The following example assumes you have already applied above behavior somewhere. This means you've applied the angular displacement: . Understand that you will get glitching issues if you are nowhere updating the actual rotation by the angular displacement, but instead passing to the draw call. Drafting the linear velocity formula with math Angular velocity = angular speed, denoted by lowercase omega (w) = The formula of linear velocity: , next confine s: Where r is the radius and theta the angle. Now we can rewrite this with radians: , the 2π cancel each other out, leaving: So now we have: . Going back to angular velocity: . This formula should make sense, as we said earlier the angular velocity is the angular displacement with respect to time. This is exactly what is displayed here. So we end up with:"},{"path":"螺线翻译tml教程/3-高阶/3-Advanced-guide-to-custom-UI 高阶-自定义UI.md","filename":"3-Advanced-guide-to-custom-UI 高阶-自定义UI.md","title":"3-Advanced-guide-to-custom-UI 高阶-自定义UI","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In this guide you will learn about the various UI classes present in vanilla you can use to mod your own UIs. You should know about the following subjects before following this guide: Class hierarchy and inheritance Abstract / virtual and override Object oriented programming (in relation to class inheritance) Brief UI in Terraria consists of various classes, most notably: UIElement, UIState, and UserInterface. We will go over each class and its importance in the process of creating a UI. Object relation A custom UI is nothing more than a custom with its state set to a custom . In general, a UserInterface can have one active UIState (it can however hold a history of states, up to a cap, which you can go back to), that state is then currently shown in that UserInterface. UserInterface There is no reason to create a custom class that derives from . (Although you could, since the class isn't sealed) For most cases, simply declare a new field of type UserInterface in your ModSystem class. We will come back to this later. UIState A represents the state an interface is in. The class itself is very simple: it's actually a that spans across the entire screen width and height, allowing you to add an element anywhere on the screen. UIElement The represents a class that is any kind of UIElement that can be part of an interface. Vanilla examples are the classes , and . Each of which has a certain functionality to it. (Show a background panel, show an image or show a clickable button image respectively) You can make your own custom elements by deriving your class from UIElement. We will come back to this. Initial setup First, you need a class that inherits from , you can use an existing one or create a new one: Then you'll need a UserInterface and UIState. You can define these new fields in your ModSystem class: For your UIState, you should make a new custom class: Then create a field for it in your ModSystem class: Initialize the UI Because UI is something only to be seen by players, you shouldn't initialize UI on the server. This wastes resources and the server doesn't play the game nor see any graphics. Only initialize on the client. In your , initialize your UI: In your you can call any unload action you might need on your UI, and then set it to null: Unload on the UI as shown above is not recommended, as it in general is bad practice to make UI responsible for data. However, it is useful if your UI holds static references such as textures. Updating and drawing the UI Setting the state of your interface is nice, but the UI isn't magically called to update or draw itself. To do this you must override and : The above snippet will call .Update on your interface and propagate it to its state and underlying elements. The above snippet adds a custom layer to the vanilla layer list that will call .Draw on your interface if it has a state. This will make your UI actually draw and show up on screen. Set the InterfaceScaleType to UI for appropriate UI scaling. Notice that, in this case you're adding your UI layer below the \"Mouse Text\" layer, this means your UI will be drawn before that layer. You can add your custom layer next to other layers (vanilla or not) by looking for layers with other names. For a list of vanilla interface layers you can go . Showing the UI For testing purposes, it is recommended to add a hotkey or other easily accessible means to toggle the UI. To show your UI, you need to set the interface's state to your UI instance. You should do it by accessing the instance of your ModSystem and calling .SetState: This snippet will set the state to your UI, causing it to show. If you want to hide the UI, simply pass into the method call. You can see why it is useful to use a dedicated class for your UIs. It is useful to make helper methods for this, such as: And then simply call them: State history The interface keeps track of a state history. If you wish to go back to the previous state, you can call , which will activate the previous state in history if there is one. Keep in mind it will remove the activated state from the history, so you need to call .SetState or .AddToHistory to put it back. History holds up to 32 states, if you add a new state in history if there are already 32, the oldest 4 states are removed. The state history is useful if your interface's state is constantly changed, for example if a progressive UI (e.g. pagination or tabs) Adding elements If you activate your UI now, you might be confused since nothing shows. This is because your UI is empty. You can add any elements you want to the UIState, and they will then show up. In your MyUI class, override the method. For example add a new UIPanel to the state: 1) Override the OnInitialize method. This is called when we initialize the UI when our mod loads. 2) Create a new UIPanel instance. This is a vanilla class that will draw a vanilla styled backdrop on this element. 3) Set the width and height to something bigger so we can see it. 4) Append the panel to our UIState. Append is a method on the UIElement class and it allows you to add child elements to that element. Children are placed relative to that element. Since UIState covers the entire screen, our UIPanel will show up in the top left origin of the screen. Adding some text Let's spice things up by adding some text to our UIPanel. We can do this in the same fashion, but this time appending the element to our panel variable: 1) Initialize the UIText. 2) The UIText element is now a child of the UIPanel element. The text should show in the UIPanel. Centering element Most of your time will be spent perfecting placement of elements in your UI. You will be messing with various fields on the UIElement class: Centering an element is a common use case for modders. Centering an element relative to it's parent is easy. To center the text in our UIPanel, we can use HAlign and VAlign, and set both to 0.5f: This is basically setting our horizontal and vertical alignment to 50%, centering our element. Header like text We can use these alignment tricks to perfectly align our text like a header, if we want. We can set HAlign to 50% to horizontally center our text, we can either set VAlign to a low value or a fixed absolute value by setting the Top position. The latter is recommended: 1) Set the horizontal alignment to 50% 2) Set the Top position to 15 pixels. The text should be 15 pixels down relative to the UIPanel. Remember you could use VAlign for this, but it will scale as your UIPanel changes size. This may screw up things as you change the UIPanel's size. Centering the UIPanel Your UI probably still shows in the top left corner of your UIState. Most modders will want their UI show up in the center of screen. Because UIState spans across the entire screen size, we can use the HAlign and VAlign trick to center our UIPanel: 1) This is a neat trick to set both fields to the same value. This trick however will not work if you change how your UIState spans across the screen, or if your UIPanel isn't appended to the UIState itself. Beware of the parent of your UIPanel and align it accordingly. Interaction with UIElements The most common interaction modders want is doing something when an item is clicked, such as a button. Let's add a button to the UI with an interaction: 1) Initialize a new UIPanel. Because there is no UIButton class (only UIImageButton), we will use UIPanel and UIText for this. 2) Set the top position slightly below our header. 3) Add the new OnClick event. It is important to note events will propagate through the parent child chain. This means if we click the UIText, the click event will end up in our UIPanel (button) as well because it is the parent. For this reason we only have to add the handler to the UIPanel. 4) Set the text alignment so it centers in our button panel. 5) Append the text to our button. The button is appended to our background pannel. OnButtonClick currently does nothing. Let's change our text. In order to do this, we must make our button text a field on class level instead of scoped to just the OnInitialize method: Now we can access text in our OnButtonClick method: Events There are many events like OnLeftClick, here is a list of them: Preventing mouse clicks from using selected item By default, UI won't prevent mouse clicks from causing the player to use their currently selected item. To implement this behavior, the bool must be set to true. This should be done in a method. The logic should be applied to the lowest parent that makes sense. Do not apply this to the UIState itself since UIState covers the whole screen, but rather apply it to the panels or containers added to the UIState. Preventing scroll wheel from shifting selected Hotbar item By default, UI won't prevent the scroll wheel from shifting the selected Hotbar item. To implement this behavior, the method should be called. This should be done in a method. The logic should be applied to the lowest parent that makes sense. Do not apply this to the UIState itself since UIState covers the whole screen, but rather apply it to the scrollable lists or panels added to the UIState or other containers. Tooltip on hover Another useful interaction modders commonly want is showing a tooltip when hovering an element. This can be done by overriding the DrawSelf method and checking if the mouse hovers the element (Note that if you override DrawSelf you also need to call base.DrawSelf in it), and then change Main.hoverItemName. Let's show this tooltip if we hover the button: (you'll need to make button a field on class level just like we did with the text) Do note that this way of modifying mouse text only works if Main.hoverItemName is set before the \"Vanilla: Mouse Text\" GameInterfaceLayer is actually rendered. This will be the case if you did not modify the ModifyInterfaceLayers implementation proposed at the start of this wiki page. If you are displaying UI above this layer, Main.hoverItemName = [...] should be moved somewhere that gets called earlier, but if possible past all update method calls as vanilla ones may delete your text content. Interactions when the UI shows or hides Override the methods .OnActivate() and .OnDeactivate() to do things when your UI activates or deactivates respectively. For example activate can be used to retrieve most recent data to fill the UI, deactivate can reset variables that store this data. Use deactivate to make your UI fresh for its next activation and so it holds less items in memory while it is not used. (Ideally set things to null to unallocate memory) Custom UIElement Making your own element is easy. You will have to make a custom class that inherits the class. The OnInitialize, OnActivate, OnDeactivate, DrawSelf and Update methods will be the staple methods to override. A trivial example is making our own custom button class to facilitate what we do above. Let's start with the basics: first define what our class is and should do. The button class must show some text and be clickable, when clicked an assigned action can be performed. Good, now that we know the use case for the class, we can model it: There's a lot going on, let's see: 1) We define variables our custom button needs. 2) A public property that we can use to get and set the text backing field. More on this in point 8. 3) Simply return the text of our uiText, or and empty string if it is null. (not initialized yet) 4) Our constructor. We must pass a text and click action. Text is of type object, modelled after the UIText class. 5) Create a new UIPanel as the base background. We set the size to Fill, which is equal to calling Set(0, 1f); 1f stands for 100%, so in this case we will stretch the UIPanel as big as we make this element. 6) Create a new UIText that we align centered in our UIPanel. 7) Register the click action to just the UIPanel. Remember that click actions on children propagate through the parent child chain, so the click event will end up on our UIPanel OnClick handler. 8) By updating the UIText's text during Update, we can make our text changes thread safe and avoid errors if we edit the text while it is being drawn. 9) Recalculate forces this element and its children to recalculate sizes, padding etc. You should do this if the contents change, such as the text in this case. We can copy the min width and min height as they are calculated from the UIText class in this case during Recalculate(). Now we can use this class, instead of what we did before:"},{"path":"螺线翻译tml教程/3-高阶/4-Advanced-Detouring-Guide 高阶-函数重定向指引.md","filename":"4-Advanced-Detouring-Guide 高阶-函数重定向指引.md","title":"4-Advanced-Detouring-Guide 高阶-函数重定向指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Prerequisites You should know . You should know . What and why Sometimes when trying to implement a feature, we won't be able to just override a hook provided by tModLoader. However, if we could somehow 'override' an existing vanilla method, we would be able to produce the effect we want. This is basically what detours are. tModLoader provides an API for detouring vanilla methods, providing many events for us to subscribe to. They follow the pattern: examples: A few things to note here: only prefixes the class, never the namespace or method Methods with overloads are affixed with the method signature to tell them apart, only when the method actually has overloads Nested types, like , have their detour events on the parent All of these events are how we detour vanilla methods. How To detour one of them, we use a hook somewhere, we'll be using for this example, but you may prefer to put it somewhere else, a or if it's related to the other code there. So, we Now, we just pick something to detour. You will usually find out what you need to detour by looking through vanilla code. For this example, we will write a detour that triples the buff time of any buff, excluding flask buffs and debuffs. If we search through vanilla code a little, we will find that the method does this. We're going to use a feature of Visual Studio, but any proper IDE should also have this functionality. If we type out our event followed by to subscribe a method, we will see this: This is a handy feature of (most) IDEs, which allows you to quickly generate a method with the correct parameters. If we go ahead and press tab, we will see this: This allows us to rename our subscribed method to whatever we want, you can leave it if you want. I like naming my methods after what they do rather than what they're detouring, so we will use this for this example: First thing's first, let's go ahead and make it to avoid capturing any instanced stuff from our class ( ). Now, we have a couple more parameters than the vanilla method. This and . This is a common pattern you'll see in detours, the first parameter is how we call the vanilla method and the second parameter is the object this method is being invoked on (note: won't be here when detouring static methods, as there is no instance to be passed). As you may already be able to tell, these follow the pattern: and Additionally, any parameters passed to the existing vanilla method are after these 2, in this example we have and , but other methods you detour might have more or less. So, let's actually implement something All this will do is call , which will call the vanilla method for us, then returns the result. This is the exact same as not having the detour at all. Let's go ahead and actually do something We've added a little bit of logic here if our buff isn't a debuff, a flask buff or a buff that shouldn't have its time increased, return triple the result from . And that's it... our detour is finished! If we go ahead and test this out, we'll see that a 10 minute mining potion provides 30 minutes of buff. This is just one example of how you can use detours, and it's an extremely basic one. What about... Unsubscribing If you understand events, you'll know we usually need to unsubscribe from them, otherwise our methods stay subscribed when they shouldn't be. tModLoader handles unsubscribing for us behind the scenes, so we don't need to do it. Multiple mods subscribing to the same event You can actually test this out yourself detour the same method multiple times, place some logs in there by calling and see what happens when you switch up the order of your detours. You should see that the last method subscribed is called first, and if you remove the call, only the last method is called. Basically, when you call it actually calls the next subscribed method, ending with the vanilla method. So, if your mod is loaded before another mod that detours the same method, their will call your detour, and your will call the vanilla logic. If it's the other way around, your calls their detour, their calls the vanilla logic. Constructors These are detourable too. is the instance constructor, is the static constructor. Detouring methods without a provided event This is common if you want to detour methods from other mods. It's out of scope for this guide, but explains it in detail. Common mistakes Detouring inlined methods Compiled C programs are ran by a Common Language Runtime (CLR). In simple terms, the CLR, while running the program, will look for optimisations it can make that will make the program run faster. One of the optimisations it will make is inlining a method call removing the method call entirely and replacing it with the actual body of the method instead. If methods are inlined, we can't detour them, as the method is never called for our detour to be called. It's impossible to tell whether or not methods will be inlined, however small methods (<10 lines of code) are highly likely to be inlined. When detouring small methods, do a quick test first to see if the method is being inlined before writing your full logic. Capturing objects If we use instanced properties/fields in our detour, we open the door to accidentally capturing those objects. This can cause issues, as we capture these objects from the dummy instance created by tModLoader, then continue to use them each time our detour is run. If we capture the property, it won't be the same as the we might be passed in our detour. The way around this is just making our detour method static, and using the provided parameter to access instanced data. Ex: Here, we're accidentally capturing that bool, allowed by our detour method being instanced. If we throw a in there, we'll see this error: So, let's fix it up to use the passed instance. Note: If you're subscribing a method created via lambda syntax ( ), you can still add the keyword before the parameters declaration ( ). However, the actual method generated by the compiler is not guaranteed to be static . For more information, see"},{"path":"螺线翻译tml教程/4-专家/0-Expert-Prerequisites 专家-先决条件.md","filename":"0-Expert-Prerequisites 专家-先决条件.md","title":"0-Expert-Prerequisites 专家-先决条件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Expert Prerequisites Basically all the previous prerequisites. See Beginner, Intermediate, and Advanced prerequisite guides first. IDE is absolutely required Without an IDE, your chances of success in these tutorials is slim. Once again, we recommend installing the latest . It is free and fully featured. Visual Studio Code is also possible, and can also provide Intellisense and debugging functionalities. Debugging You must know your way around the debugger. You need to know how to use breakpoints and inspecting values in break mode. The guide for setting up Visual Studio correctly is . The very best setup for debugging is when you also have the tModLoader source, this way you can step through the code as it shifts between tModLoader code and your mod's code. tModLoader Source code You may need to decompile tModLoader to understand the correct way to do something, or to figure out the recommended approach to what you are doing. Anyone attempting to do Expert level guides needs their own copy of decompiled tModLoader.dll. The best way to get this is to download the tModLoader repository and run setup. This will net you a completely functional solution that you can open in Visual Studio. Another way is to download ilspy, explained in . Experience By far the most important is experience. A college degree (in Computer Science), previous mods you have made, and a knowledge of c will all help you tackle Expert level topics."},{"path":"螺线翻译tml教程/4-专家/1-Expert-Cross-Mod-Content 专家-跨模组内容.md","filename":"1-Expert-Cross-Mod-Content 专家-跨模组内容.md","title":"1-Expert-Cross-Mod-Content 专家-跨模组内容","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Read First When inter operating with other mods, there are several things to note. The biggest thing to note is that the Mod you wish to interact with may or may not actually be loaded. Calling methods, accessing fields, or trying to use Items from mods that aren't loaded will cause problems. You can avoid the issue altogether if you make your mod \"strongly\" depend on the other mod, but this means that your mod can't be loaded without the other mod present. An alternative to a strong dependency is a weak dependency. Weak dependencies are the most difficult to do correctly but also the most powerful. A 3rd option is less powerful than the other 2 but much easier and relies on Mod.Call, a simple way of passing messages between mods. This option requires the mod you wish to operate with to support it. A 4th option is using reflection, and is a bad approach. A 5th option is for simple things like recipes. These options are explained from simplest to strongest below. Simple Cross Mod content. Recipes, Items, and Tiles (Intermediate) The easiest form of cross mod content is utilizing items or tiles in recipes, shops, or drops. The first thing to note is that the mod may or may not exist. To determine if it exists, we first ask tModLoader for the Mod object. The object is now either or a valid reference to the class of . There are two ways to determine whether a mod is loaded when using , you can either use the boolean value returned by the method or check if the instance is null. In this example, it's easier to check if the method returned . We will add an item to our Town NPC's shop. As you can see, we can use the object and invoke the method to get the for the item. We then use to retrieve the item type for that item. The 2nd example shows using to get the in one step instead. Note that corresponds to the internal name of an item, so it may be necessary to ask the other modder so you can get the correct internal name of the items you wish to use. See below for more approaches. Also be aware that if the mod you are referencing changes the internal name, your mod will break until you fix it. It is recommended that mods expecting cross mod content refrain from changing fields, methods, and namespaces other mod expect to remain consistent. Similar code can be used for NPC loot and recipes. Recipe Example See for a recipe example. NPC Loot Example Selectively Loading Content Example We can selectively load or not load content based on other mods being enabled. This can be useful to avoid content overlap or to facilitate cross mod content. To do this, simply check if the mod is enabled in the method: Determining Internal Names If you use the mod and enable the setting, then use the hotkey while hovering over a modded entity in game, you can determine the internal name of that entity. Another approach is setting a breakpoint after the method call and inspecting the resulting object. For example, you could inspect the dictionary to find the property of the you are interested. Another mod you can use is : Enable everything in its config and it tells you the internal name of entities when hovered over. Call, aka Mod.Call (Intermediate) Call is a method that requires cooperation from both the Called mod and the Calling mod. The Called mod will publish details on the variety of messages they accept and Calling mods wishing to inter operate with those mods conform to the message format to send messages to the Called mod. To teach this concept, we will inter operate with a popular mod utilizing Call: (This mod lets us add our mod's town NPCs to an extended housing panel which lists their conditions. Very useful for players to know when a Town NPC can move in). First, we will find a place to get the Calls in the first place. The mod has a where the calls are explained. Reading this page, we find 1 message that we can send to Census. The page also instructs us to do in , but this could be different for other mods. We now use the same technique as we did earlier and call to check if the mod is loaded. We must also make sure to follow the message format perfectly or risk errors. Let's now do the code as if we wanted to add Census support for ExampleMod: Now, if we build our mod, we will see that our town NPC is added to the housing panel even if it hasn't moved in yet. is very useful, and is a very easy way for mods to communicate with each other. For info on how to implement receiving so other mods can interact with your mod, see the source code for Census or other open source mods. A fully commented showcase of calling other mods' Mod.Calls (including the most popular mod utilizing Call: Boss Checklist) and how to organize them can be found . Strong References, aka modReferences (Expert) Strong references are easy, but prevent your mod from being loaded if the referenced mod isn't loaded. Strong References represent a hierarchy of mods where it would make no sense for the referencing mod to be enabled without the referenced mod. To begin, let's imagine we want to reference ExampleMod. First, add a line of \"modReferences = ExampleMod\" to your . You may want to specify a as well. Second, make sure ExampleMod is downloaded and enabled. Third, we can code as normal, doing whatever you want. As an example, let's make a hotkey that sets Abomination and Purity spirit to defeated. First, we should add a using statement: . Next, in our , where hotkeys should be processed, we can do this: This example is extremely simple, but all manner of things can be done with a mod reference. Calling methods, accessing public variables, using the generic versions of and , and so on. Access Modifiers If you find that you cannot access a specific class, method, or field, but others are working, that member might have a non public access modifier. If you are unfamiliar with the meaning of access modifiers such as private and public, please read the to familiarize yourself. Something being non public can either be an intentional design decision by the author of the mod you are referencing, or an oversight. Ask the mod author to update the mod to fix the issue if it is an oversight. Visual Studio Steps To properly code in Visual Studio, VS needs a reference to the file contained within the file. Use the menus in tModLoader to extract the mod and find the files ( ). If no file is extracted, the mod author has chosen not to allow it to be unpacked, so ask them nicely for it. By default, these end up in the folder of the with a filename of . We recommend using this folder for referencing mod files as it will simplify collaboration while avoiding other issues. Do not place mod files inside your mod's source folder, it will end up packaged into the and bloat the file. If you do not want to use the recommended location and insist on keeping the mod in the mod's source folder, you'll want to use to ignore the file or the folder the file is in. Make sure that folder is not the folder, or you'll run into other issues. Add the reference by right clicking in the solution explorer, then clicking , then , then the button, then navigate to the .dll and finally clicking and then . You will also need to save the changes to the project, should work to do that. Visual Studio Code Steps All the information in the Visual Studio Steps except how to actually add the reference applies to Visual Studio Code as well. To add the .dll reference in Visual Studio Code, first navigate to the solution explorer and then click on the file entry. This will open the file for editing. In the file text you should see an section nested under the section. If you do not, you can manually type it as shown or use the button in the Mod Sources menu to regenerate the file. Next, we need to add a section. We will now need the filename of the .dll file, if you are unsure of the filename open up the folder in your file browser and find the .dll file. Next, type the following, replacing the mod name, version, and file path as appropriate for the mod .dll file you are referencing: The file should look like this in the end. Be sure to save this file, then verify it works by attempting to access the classes in the mod and seeing if autocomplete is working correctly. You can also verify by seeing if autocomplete will suggest the namespace. You can also expand the section and look for the mod name. It should be there, but if it has a ⚠️ icon, you made a typo that needs fixing. If it is there without that icon it should be working. Mod Documentation If the mod you are referencing included documentation, you should be able to see those as well when working with those classes. Read for more information. Weak References, aka weakReferences (Expert) Weak References have the same capabilities as Strong references, but they don't have the restriction that the referenced mod must be enabled to work. They do, however, necessitate much more careful programming. The process is largely the same, but instead of a \"modReferences = ExampleMod\" line in there is a \"weakReferences = ExampleMod\" line. You may want to specify a as well. Weak References necessitate careful programming. For example, if you have the code in a method that is called, but ExampleMod isn't loaded, the game will crash. With Weak References, you have to make sure that variables and classes that might not be loaded are never seen by the virtual machine as it runs the c code. Some examples: In this example, the game will crash. You might think that the check for being would prevent the game from crashing, but what happens is the .Net runtime will try to understand all the code mentioned in this method as it is invoked, and since it can't make sense of , it will crash. Here is a solution that does work, moving the potentially unresolvable code to a property, effectively preventing the runtime from ever having to know about unless that mod is actually loaded: The attribute is required and is explained in the below. Weak References are hard, but a neat thing to do. Many things, however, are much better off handled with . I hope this guide will help you choose the best approach to cross mod content. In this specific example, ThoriumMod provides the documented on its . Inheritance When inheriting from a class in a referenced mod, the class must be annotated with the to prevent a crash if the reference mod is not loaded. Visual Studio Steps Weak References also require the file to work properly in Visual Studio. Read the instructions in the Strong References section above. Testing You may mistakenly think that your weak reference is working because you disabled the weakly referenced mod and your mod still loads. This is a false positive. To properly test weak references, you must disable the referenced mod and then close and re open tModLoader. Recommendations The best practice is to put all code that directly uses a weakReference (potentially optional one), in a separate class. You can annotate the class with so the whole class is excluded from the JIT process. This can simplify logic and ensure that the JIT (Just In Time) compiler never has to resolve unresolvable references when they aren't available, preventing a crash. shows this approach. Also note how the methods of this class are only called if MagicStorage is loaded. Another approach for self contained logic is a class using to prevent the from autoloading if the referenced mod doesn't exist. Using and overriding and checking is also an option. No References, aka reflection (Expert) Using to do cross mod is not ideal. For one, reflection relies on strings for accessing classes and fields of the target mod. As the target mod updates and changes, your mod will fail as well unless you program defensively. This option is not cooperative and can be inefficient. It is a poor choice, but is useful when avoiding dependencies and is necessary when accessing private members of other mods. It is much better if you work together with the author(s) of the other mod(s), so they can open up their mod for modifications you want to make with your mod. Using Github together is your best bet! JIT Considerations tModLoader inspects all classes and methods of each mod as it loads. This will cause issues for mods weakly referencing members of other mods. To avoid this issue, modders need to annotate members with special . JITWhenModsEnabled excludes a class/method/property from the load time JIT inspection, preventing a load crash. The page has more info about this topic. ExtendsFromMod If you are inheriting from a base class in the mod you are weakly referencing, you can use the attribute to specify that the mod should not be autoloaded or considered at all when mods inspect other mods. Here is an example: If your class depends on another mod being loaded, but not necessarily inheriting from classes in that mod, you can still use to prevent it from being loaded. If you're having issues with using reflection to iterate types in your assembly elsewhere, make sure you're using tModLoader's instead of directly using . This stops your code from trying to load potentially unloaded types. Minimum Reference Version It is useful to limit referenced mods to a minimum version. For example, if the content of the referenced mod that you wish to interact with was added in v2.0, we would only want to attempt to access that content if the user is loading v2.0 or higher of that mod. Attempting to access content or classes that do not exist in the referenced mod will lead to loading errors or bugs. Strong and Weak References For strong and weak references, we can add the minimum version to the or line in . We simply add and then the version number to the mod name. For example \"weakReferences = ExampleMod@2.0\" would specify that ExampleMod must be v2.0 or higher. This version qualifier prevents your mod from loading with older versions of the referenced mod. Make sure to update this value whenever your mod references a feature added in a newer version of the mod. Mod.Version We can check the version of a referenced mod in code for more dynamic behavior. This is particularly useful for manually implementing a minimum version check for mods not using the strong or weak dependency approaches. are sometimes updated in mod updates as well, so checking a referenced mod's version ensures that you do not attempt to use an unsupported if the user is loading an older version of that mod. Dependency Mod Considerations There are several things an author of a mod intended to be used as a dependency should keep in mind. Read this section if you are making a library mod or a content mod you expect other mods to expand on. Access Modifiers Declaring appropriate access modifiers is an important step for preparing your mod to be used as a dependency of other mods. If you are unfamiliar with the meaning of access modifiers such as private and public, please read the to familiarize yourself. Mods should use to exposed classes and members to other mods while using and for things that are not intended to be accessed. You should also try to keep the names of classes, fields, and methods that are unchanged in updates to your mod. The s and parameters as well should remain unchanged. The reason for this is any mod depending on your mod will break if it was using any of those changed things, and your users will be disappointed because they can no longer continue their playthrough. Some might refer to these public members as the \"public API\" of a mod. On the other hand, it is perfectly fine to change and members in updates, since no mod should be accessing them directly unless they are deliberately bypassing the design of how your mod operates. Library Mod When making a library mod, you'll want to expose as only the methods those mods should be using. This makes is easier for those authors to know how to use your library. If you need to change the parameters of a method, consider keeping the current method around and annotating it with . The parameter being will force dependent mods to update to the new method the next time they build the mod, but the mod will still work as is as long as the obsolete method still has the functionality. This approach is used in tModLoader as well, see for more information about marking methods as obsolete. Content Mod For content mods, dependent mods will likely want to access all of the content classes directly, such as . This will make it easier to make recipes using your items and reuse projectiles and other content from your mod. For this reason, we suggest that content classes are declared as . Mod.Version The intention of is to indicate how \"big\" of changes had occurred since the previous release. If your mod needs a complete redesign, it should most likely be accompanied by a change in the number of the . For example, changing to would indicate that the mod has changed significantly and likely has a new \"public API\". ModType A can greatly simplify loading content from other mods. The is a great resource for learning about implementing a custom . Mod.Call Exposing a API can be useful, see the information in the . Documentation Including documentation directly in your mod means that modders will see that documentation in their IDE. Be sure to read to learn how to include documentation in your mod. Wiki A developer facing wiki can be useful, especially for library mods. A wiki can include information for using the , inheriting from base classes, and other things. The is a good example of a such a wiki. Inheritance If you expose a class with the intention of it being inherited in other mods, there are a few small things to be aware of, especially if you have classes other mods might inherit from: ModType.Mod refers to the the class belongs to, this is not necessarily your mod when other mods are inheriting from content in your mod! For example, calling will return the localization entry when called on content from your mod, but will return the localization entry when called on content from other mods inheriting from your class. This behavior is desired in some situations, and undesired in others. If this is not what you intend, be sure to use in these situations. It is up to you as the author of the dependency mod to ensure that the logic in your code works as intended for content in your mod and from other mods inheriting from your classes."},{"path":"螺线翻译tml教程/4-专家/2-Expert-Shader-Guide 专家-着色器指引.md","filename":"2-Expert-Shader-Guide 专家-着色器指引.md","title":"2-Expert-Shader-Guide 专家-着色器指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Please read the beforehand. New to modding? Then you should not follow this tutorial Original: https://forums.terraria.org/index.php?threads/a beginners guide to shaders.86128/ Introduction Shaders are extremely powerful and, provided you know what you are doing, lightweight tools to create fancy visuals. However, they are also quite complex, and the implementation barrier is rather high. The purpose of this guide is to help remedy this, and provide an introductory course for writing your very own shaders for Terraria modding. [[https://i.imgur.com/GZ4aAqa.gif|inline]] What is a shader? Very generally speaking, a shader is a piece of code that creates or modifies rendering output. In layman's terms, this basically means \"code that makes pretty things\". In game development, we primarily use two types of shaders: vertex shaders and pixel shaders (also known as fragment shaders). Vertex shaders are used to modify 3D models, for instance to move or deform them. Pixel shaders are used to modify the actual pixel output of your screen. They often work in tandem with vertex shaders, but can also function perfectly well on their own, as we see in Terraria. An important thing to understand about shaders is that they're not executed just once, but \"for every X\". A vertex shader applied to a 3D model will run its code for every vertex (point) of that model. A pixel shader applied to a texture will run for every pixel that that texture is covering (which, yes, can cover the entire screen). This might be confusing at first, but you'll get the hang of it after writing a few passes. Because Terraria doesn't contain any 3D models (sort of), it doesn't use any vertex shaders. It does use pixel shaders, which can be broadly divided into three groups: 1. Armor shaders : primarily consists of player dyes, but also contains some miscellaneous effects such as (part of) the Pillar force field and the water shader. 2. Screen shaders: consists of screen filters, such as the Celestial Invasion and Blood Moon tints. 3. Tile shaders: consists of tile paints. Internally, these are known as Pixel Shaders, but to avoid confusion with the containing set I refer to these as Armor Shaders instead. Implementing your own tile shaders is rather complex, and in my personal opinion shouldn't be done to begin with unless you know Terraria's engine (and more importantly, its limitations) inside out, so you'll be limited to making armor shaders and screen shaders. There is a fundamental difference between how these two shaders work, as well as their parameters, but their basic structure remains the same. Shader structure Terraria shaders consists of three parts: parameters, passes and techniques. Passes and techniques aren't really used to their full capability, so all you really need to know that for the purposes of writing shaders for Terraria, a pass is a single function that modifies the pixel output, and all passes are contained within a technique. If we take the vanilla dyes as an example, every dye uses a pass to change the appearance of an armor piece, accessory or mount, and all of these passes are contained within a single technique. A parameter is information passed from outside (i.e. Terraria) into the shader, such as the color the shader should use. It allows you to make multiple effects from a single pass (all basic color dyes use the same pass, just with a different color parameter). When you create your own shader and want to use Terraria's pre existing shader system (which you should), your shader needs to contain all the parameters the default shaders does: if not, Terraria will attempt to set parameters that don't exist, causing a crash. Armor shaders and screen shaders do not use the same set of parameters, so they will be discussed individually in their respective chapters. You can find blank examples of both armor and screen shaders attached to the bottom of this post. Armor shaders Terraria's armor shaders modify how a specific texture is drawn. The most obvious example of this are the various dyes that can be applied to armor pieces, accessories and mounts, however they can also be used to apply entirely shaded visuals to blank textures (think of the Pillar's force field: that is entirely a shader). The parameters of the armor shader are as follows: Screen shaders [[https://i.imgur.com/pjpwfxO.png|inline]] Terraria's screen shaders modify the contents of the entire screen rather than a specific texture. The most common application of screen shaders is to give the screen a certain tint, but they can be used for other effects as well, such as distortion effects, overlays or simply turning the screen upside down, if for whatever reason you'd want to do that. Screen shaders should not be confused with custom skies, such as the meteors that fall in the background at a Solar Pillar: those have nothing to do with shaders, and are not covered in this guide. Screen shaders are significantly more complex than pixel shaders, so unless you're trying to do something very simple like tinting the screen, I advise you to start with armor shaders first. This guide doesn't contain any examples of screen shaders because most of the information about armor shaders carries over. The parameters of the screen shader are as follows: How to write a shader Now this is all fine and dandy, but how do you actually go about writing a shader? In this chapter, I'll show you some examples of shaders and what they do. Basic shader To start of with, a shader file in XNA (the framework Terraria uses) has the extension . Apart from that, it works like any other text file, so you don't need any special software to start writing shaders. Let's start with some armor shaders. To start off, let's write the absolute smallest working shader possible. That's quite a lot to unpack. The parameters you already know, so let's look at the middle bit. What we have here is a single pass. Now, you might recognize that the in front of means that that is the return type. The indicates where this return type should be stored, namely in the COLOR0 register of the GPU. Put two and two together, and what this means is that this pass writes a color value consisting of four floats (red, green, blue and alpha) to the GPU. As for , this means you're declaring a parameter equal to what's in that COLOR0 register. So what this pass does is take the value of COLOR0 and put it in COLOR0. Not very useful, as you might imagine. We'll move on to something more useful in a bit, but let's first take a look at that last part of the shader: All this really does is compile the technique, by in turn compiling all the the passes we want it to contain. Every time you create a pass, you'll have to add it to the technique if you want to use it in Terraria. Also, make sure you use , or you'll get compatibility problems. I'll leave out the parameters and techniques from now on to keep the code snippets short, but obviously you still need those if you're going to compile. Okay, so let's make something more useful. Right now, we're writing the contents of a register to that same register, which is entirely useless. What we want to do for starters is to just draw the texture. To do so, we have to make some adjustments. So two things happened here: one, we added as a parameter, and two, we added something called To understand either of these, you first have to remember what I mentioned in the introduction: a pixel shader is executed for every pixel that the texture covers (not every pixel of the texture, but if you're drawing sprites at a scale of one that basically amounts to the same thing). Now, you can probably tell that takes the value of the TEXCOORD0 register just like did, but what does the value actually mean? Basically, it represents the coordinates of the current pixel relative to the texture. This might sound complex, but hopefully this image clears it up: So, imagine the shader running on this texture. It will start in the top left corner, in which case will be equal to (0, 0). Halfway through the first row, it'll be (0.5, 0). In the dead center of the texture, it will be (0.5, 0.5), and at the bottom right corner it'll be (1, 1). What does do then? Simply put, it samples the color data of at position . And because the shader runs for every pixel, and updates accordingly, essentially it's tracing the texture pixel by pixel. So what this pass does is nothing short of simply drawing your texture. There's a problem, however, in that you are overwriting the contents of the color register. This can sometimes be useful when it is intentional (screen shaders generally do this), but it can also cause issues, especially if you're overwriting transparency. So usually, you want to multiply whatever your result is with the content of the register before writing to it: Sampling will form the basis of almost all of your passes, but doesn't do much by itself. Let's introduce some parameters. Parameters & Swizzles Now we can draw our sprites, but that's not really any different from what the game already does: we want a custom effect. Say, for instance, we want to tint our sprite. If we didn't know any better, we might try to do this: Here, we're using our parameter from our parameter list, but there's a problem: is a , but is a , and you can't multiply those with each other. What we want to is multiply the red, green and blue channels of our texture with the value of the parameter, so instead we do this: The line is equal to: This member access is what we call a swizzle. We use to refer to color data, but sometimes you're working with positions, in which case makes more sense. Therefore, you could also do this: This is exactly the same as the previous line, it's just syntactic sugar. You can even mix them up in the same line. What you can not do, however, is mix them up in the same swizzle: Anyway, let's get back to our original pass. Let's pass in pure red and see what happens: Not bad. Let's look at a slightly more complex example: What we do here is calculate the luminosity (brightness) of each pixel, and then multiply our color with it. This prevents large dark patches where your tint complements the color of the texture. The result: Getting creative with coordinates While we can already can do rather nice stuff, it's all rather uniform. To add some variety, we can work with our coordinates to get something nice. Let's make a simple gradient: If you remember the image above that explained how coordinates work, you might be able to guess what happens here: the leftmost pixels will be black, and will brighten to their original color. I had to slightly enhance the result for clarity, but it would look something like this: Simple, right? You can even combine two gradients into opposite directions: Alright, so that's horizontally. Let's try it vertically! Hm, that doesn't look right. If you look very closely, you might be able to see that the bottom of the robe is getting slightly brighter, but surely it should be fully bright at that point? What's going on? The problem here is that coordinates are relative to the texture you are drawing, not the frame you are drawing. As you might know, every armor set in Terraria is twenty frames long, so the y coordinate at the end of our first frame is only 0.05, rather than 1. This is especially evident once you look at a walk cycle: To solve this, we want the y coordinate to be 0 at the beginning of our current frame and to be 1 at the end. Fortunately, there's a (relatively) simple formula for that: You can work out exactly what this does in your own time, but it \"shrinks\" the coordinates to encompass just a single frame, and then shifts the origin to the active frame. Now, let's try this again: Yep, that's much better! Passing time (That might be the absolute worst pun I've ever made) Now, there's a good chance you're here not for the boring gradient stuff, but because you want to make animated shaders, and you'd be right too! Actually, making an animated shader is deceptively easy: all you have to do is use the parameter. However, the main problem is using it correctly. Say I were to do this: Now, this would just increase the brightness until infinity (well, until one hour has passed, at which point it would reset, but that's still a long wait), and that's not really helpful. Instead, most dyes use a sine function to turn raw time into a sine wave. This will give you a nice and predictable scalar to use: As you might know, a sine wave... well, waves... between 1 and 1. In this particular case, that negative range isn't really useful, as negative colors just display as black. If we wanted to remove that negative range and just bounce between 0 and 1, we could do this: Apart from sine waves, there's another, less useful but still nice way to establish pattern, and that's by using , which gets the fractional component of a number. When used with , you get a nice sawtooth pattern, ranging from 0 to 1 exclusive. Okay, one more. What happens if we combine coordinates with time? Cool stuff, that's what: Becase we're adding to , our 'split point' (where the results of jumps from 0.99 back to 0) keeps shifting to the left, giving us a nice radar like effect. Want to speed up or slow down the shift? Simply multiply by a scalar: Making some noise Finally, we'll take a look at how we can use noise to pep up our dyes a bit. Most dyes have a rather geometric feel to them, and sometimes that can be very nice. However, if you want to add some randomness (perceived or otherwise), you can use a noise map. Several dyes already do this: the stars in Twilight Dye, the sand in Shifting Sands Dye and the... eh, vortex... in Vortex Dye are all created through use of a noise map. The applications of noise are very diverse, and I won't touch upon them all. However, one of the more common applications is to use it as an overlay. For that to work, we do have to do quite a bit of work, though. The first problem you have to solve is the different pixel ratios: because coordinates range from 0 to 1 regardless of how large an image is, using one set of coordinates for both images will not cover the same amount of pixels if the images aren't the same size, which results in ugly stretching: To convert texture coordinates to noise coordinates, you can use this formula: This gets the Cartesian coordinates of the pixel you want and then determines the coordinates that will get you that pixel. In practice, that would look like this: You can then do all sort of things with it (most of them ugly): If you simple want to sample the noise map for a pseudo random scalar, you can dispense with all this: just sample with the normal coordinates, and it should work just as well. These are pretty much all the building blocks you need to make your own shaders. While there are some more neat tricks you can pull off, this should be sufficient to get you going. Compiling your shader Once you have finished writing a shader, you'll need to compile it before you can use it. There are two ways to do this: the most straightforward is to use an application that can compile .fx files into .xnb such as ( ), or (Required for shader model 3). The second way is to build them with a XNA application. Using fxcompiler or EasyXnb is very simple: just put the files you want to compile into the same folder as the exe, run it, and you're done. Move the .xnb files to your mod folder ( YourModName/Effects is a good place to put them) and you're done. If you build them with a XNA application, they will end up in your bin folder. A additional option is to use the Modders Toolkit Shader Tool. The Shader tool allows live testing and development of your shader in game. More info can be found on the . Using your shader How to use your shader largely depends on what kind of shader it is, but first and foremost you'll have to load them first. You do this in the function of your : You can also load your shader in the loading methods of your content or classes. For example, shows loading the dye shader and binding it to the dye item all within the dye's class. It is much preferred to keep the shader loading code in the class that will use it. Also note the slight difference in syntax, is used instead of . For dyes, this is entirely sufficient: equipping your dye item will show the dye. Simple, right? For filters, you'll have to activate them when appropriate. Activating (and deactivating) a filter is very simple: For an example of how you can put filters to use, check out my other guide for a shockwave filter: https://forums.terraria.org/index.php?threads/tutorial shockwave effect for tmodloader.81685/ Tips & Tricks I've already given most of my trade secrets away by now, but there are a few tidbits left that might be able to help you if you get stuck. 1. Mask your sprite when necessary Sometimes, your shader will fill up the transparent parts of your sprite as well. You can generally remedy this by multiplying your color by the alpha of your sample (unless you've overwritten it, which you shouldn't really be doing do). See the examples with noise maps above for an... well... example. 2. Be efficient Shaders are executed many times per frame. Make sure they're as fast as possible, or at the very least not any slower than necessary. Personally, I think that extends to all code, but I seem to be in the minority on that front. 3. Be mindful with flashing effects Certain people who suffer from epilepsy can get an epileptic insult from flashing effects. Be mindful of this, and if your mod does end up containing content that may trigger such insults, give due warning. 4. Experiment! Many of my dyes are the result of sheer mucking about. Don't be afraid to push the envelope (without blowing up your GPU, that is), you might be pleasantly surprised. That's all I have to say. If you have any questions about anything in this thread, feel free to ask them here! Armor shader template Screen shader template"},{"path":"螺线翻译tml教程/4-专家/3-Expert-IL-Editing 专家-IL编辑.md","filename":"3-Expert-IL-Editing 专家-IL编辑.md","title":"3-Expert-IL-Editing 专家-IL编辑","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"New to IL Editing? Then read this guide first. Introduction This guide explores IL editing. IL editing is an expert level technique that can be very powerful. With IL editing, mods can essentially edit code anywhere in the Terraria code base without relying on tModLoader hooks. IL editing stands for Intermediate Language editing, essentially we are editing compiled code on demand. This can be useful for very obscure methods that don't warrant a tModLoader method. With IL editing, it is crucial that your code employs defensive programming techniques to properly anticipate the potential of other mods attempting to modify the same area in the code. IL editing is powerful, but always try to utilize the tModLoader hooks if possible as they can facilitate multiple mods better than IL editing. If you aren't scared yet, read on. Limitations Be aware that the Common Language Runtime (CLR) will in line short methods at runtime, these methods cannot be edited using these techniques. What counts as short isn't well defined, but things like Properties are likely candidates. Prerequisites We will use the compile functionality to help design our patch. You will fail if you don't know how to debug. Familiarity with finding things in the Terraria source code is very helpful. Visual Studio or similar IDE is required. Code Layout You can put patches anywhere you want, but or any of the methods are good candidates. Example Hive Pack Upgrade Goal The goal that this guide will work toward is making the various bee related items stronger when wearing an upgrade to the . Various items will spawn bees as weapons. If the player is wearing the Hive Pack, will be true and spawned bees will have a random chance of spawning as GiantBee instead. To implement our Hive Pack upgrade, we need to modify the code referencing to give it a chance to spawn a Beenade as well. Here is how Bee weapons currently work while the Hive Pack is equipped: https://github.com/tModLoader/tModLoader/assets/4522492/6ca23d26 ce33 4089 8f92 fd09b1d4487f Notice how about half of the bees spawn as GiantBees. Original Method Lets first look at the original method to see what changes we'll want to make to the IL code. Start up dnSpy and add the dll by going to File Open and then browsing to tModLoader.dll. Expand the tabs for TModLoader, tModLoader.dll, Terraria, and finally Player. Scroll down and click on the method. How did I know this was where I need to look? Experience. I followed the logic of the bee weapons in decompiled code and found that is the method that makes the decisions I want to modify. If you are reading this, you probably have already identified a method that you wish to change since you are resorting to IL editing. By now you should see this: This is the C code for this method. If you look in , you'll see that 566 is and 181 is . Our plan is to change the chosen projectile to (183) with random chance. This is how the code we want would look: This is great, but what now? First, lets use dnSpy to look at the IL Code for this method. In the Menu Bar, click the dropdown combo box and switch from C to IL. This is what we see: Lets make sense of this now by following along. Be sure to hover or click on individual instructions to open the .aspx) directly from dnSpy: Hopefully this annotated IL Code can help you make sense of things. If you are confused, it might be worth your while learning about stacks and other things related to how computers run instructions. Now that we've gotten an idea about the original method, let's use dnSpy to see how our changes will look. In dnSpy, right click on the method and click . In the window that pops up, make the changes we decided on earlier and then click Compile. You'll see some errors if you are missing assembly references or bad code. First off, we need to add and to the code. Then, we need to add the missing references for Relogic and ExamplePlayer. You'll find ReLogic.dll in . You'll find ExampleMod.dll in if you used the Extract Mod tool in game or if you have built the mod in Visual Studio. Add both of these dlls to dnSpy via \"Add Assembly Reference\": Now that we have fixed the errors, click \"Compile\" and the window will close and you'll be back to the IL Code. Switch back to C view and you might be surprised to find your changes aren't exactly maintained in the C view. The logic is all the same, it is just the layout of our code has moved various pieces about. Do not worry, however, as our approach for this patch is to find the in the instructions and add our instructions right before that. This can still be done even though the instructions have moved around a little in our temporarily modified copy of the instructions. Switching back to the IL view, lets find the code between and . This code now contains the instructions for our if statement and returning 183. Lets annotate these instructions now: By annotating the new IL code, we can see that our logic is neatly contained all before the original code. Now lets work on the patch code. Finally! Patch Code Since this IL editing will be fairly straightforward, we will detail 3 separate approaches to this patch. Hopefully the repetition will give insight into different ways to approach IL editing. The full code can be explored on . Common Ideas The first concept to explore is loading our patch. Since this patch pertains to a new ModItem in our mod, lets add the patch to . Simply override and type and then allow Visual Studio to generate the HookBeeType method for us. If Visual Studio doesn't understand class, make sure to add a dll reference to the MonoMod and TerrariaHooks dlls found in . Next, we begin writing code. To start, we wrap the entire patch method in a try catch, in case there are errors during the patching. In the catch part, write . This dumps the IL to a file to help us debug the patch if it fails. Next, we create a Cursor by writing . A Cursor allows us to navigate the IL codes in a well organized manner. We need to use Cursor methods such as and to navigate to the correct index within the list of IL instructions. We can't rely on hard coded indexes because we need our patch to work properly when multiple patches edit the same method, or when different builds of tModLoader slightly change the IL instructions. Designing robust patch code is expected, as this is an Expert level technique. After creating a cursor, we need to advance the cursor to be pointing at the area of code we desire to edit. As we have discovered through compiling in dnSpy, we want to insert our code between the code that sets to true and the code that returns 566. We can write to advance the cursor to the next IL instructions that matches the OpCode of with the operand of . If such an instruction is not found, an error will be thrown by the method, which will then be caught by the try catch we wrote earlier, which will dump the IL. Approach 1 Modifying Evaluation Stack This first approach is the simplest. In this approach, we can take advantage of the fact that while is a single line in c , in IL instructions, it consists of 2 instructions, the first pushing 566 to the stack, and the 2nd returning from the method. By taking advantage of this, we can insert instructions in between those 2 instructions to achieve our desired behavior. In effect, we are changing to . The first line of code here moves the cursor down: . The cursor was pointing at the instruction pushing 566 to the stack earlier, so increasing the index places the cursor right on the ret OpCode. After this, we call on the cursor with an OpCode, which places the specified OpCode at the current cursor index and pushes all the other instructions down, similar to List.Insert. The instruction we provide is Ldarg 0, which will push the current Player instance onto the stack because this is a non static method. At this point, the stack consists of the Player at the top and an int with the original return value below that. With an int and Player on the stack, we can now use to write C code for the rest of our patch, greatly simplifying things. The generic types provided to the Delegate need to match up with the current stack, in order from bottom to top (oldest to most recently pushed). In this case, we will be using a which takes 2 parameters and returns 1 parameter. The 2 input parameters must be and as those match the current stack. The output type will be because it will go onto the stack after the int and Player are popped off. When our patch began, there was an int on the stack, so we need to make sure the stack is still the same when our patch completes so we don't crash the game. In our delegate, we simply put our conditional and use the provided original return value and Player instance to drive our logic. Here is the complete code: Approach 2 Labels and Branches This next approach is very similar to approach 1, but aims to show how branching works via labels. If you remember from our exploration of the IL code above, IL instructions often use the OpCodes to conditionally jump to different instructions. When we make if statements in c , the compiler implements those as jumps to different areas of code. With IL editing, we can define Labels that our branching code can jump to. The code is below. We can see that in effect, this approach more similarly matches the typical c code approach by more closely mimicking the behavior of an if statement inserted before in the original code. While this is a simple example, using labels and branching may prove a useful skill. Approach 3 Direct OpCode This final approach finally uses the output straight from dnSpy that we generated earlier. Seeing that our changes in the c code of the method were neatly contained in a block of IL instructions nested between setting makeStrongBee to true and returning 566, we can simply insert those new instructions between those instructions directly. To do this, we take the output of dnSpy and line by line replace each instruction with equivalent patch code. For example, for , we can write . We can use to slim down the code to . We still need to generate new labels for the branch instructions, and we need to be aware of the expected values and cast appropriately. For example, to convert to code, we need to read the documentation and see that the OpCode expects an int8, which is an sbyte. The code would be , failure to cast correctly will crash the game. The next thing to be aware of is that you need to pass in MethodInfo and FieldInfo classes rather than calling the method or field directly. For example, to adapt , you might make the mistake of writing , but that won't work. You need to use regular reflection techniques to retrieve a FieldInfo, like this: . Note that using helps avoid spelling mistakes. This example will also show how to retrieve a generic version of a MethodInfo. Having converted all the IL instructions to patch code, making labels, and applying those labels to the instructions that need it, our patch is complete. This direct approach is useful if you don't quite understand how the stack works and are willing to write a bit more tedious code. Results The full code can be explored on . Lets watch a Bee weapon in action after applying our patch: https://github.com/tModLoader/tModLoader/assets/4522492/44a205f8 5e32 4330 ab1b bce7671614ff As a reminder, . Example Lava Frog Statue Spawn See for another IL editing patch example. This example is much trickier as the method we want to patch is very large. The example is well commented and shows a more complex example of instruction targeting. Accessing Instanced Data There is a pitfall that many modders run into when making IL edits or detours. The pitfall is they try to access instanced data within the detour or IL edit code by accessing the current class fields directly. If you find that the code within your IL edit or detour always seems to be seeing the default values of fields in your class, this is likely the issue. This does not work as expected because the IL edit or detour belongs to the template instance of the content, not the actual instance being acted upon. To fix this issue, simply make sure your IL edit or detour method are , then fix the code to access the correct instance. For players, this would be via the method. For other content there are other suitable approaches. Going further"},{"path":"螺线翻译tml教程/tModLoader文档/.tmod-File-format .tmod文件格式.md","filename":".tmod-File-format .tmod文件格式.md","title":".tmod-File-format .tmod文件格式","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"tModLoader saves mod files in a custom format denoted with a .tmod extension. This file is produced once tModLoader compiles a mod, and it includes the mod assemblies, resources (such as images or sounds), libraries and any other miscellaneous data the modder chose to include within their mod. The file format is relatively simple, and its layout has been described below. Note: Each data element has been written with its corresponding method. If you are writing a .tmod file parser in a language not in .NET, remember that the strings are saved like so: | Value | Data | Description | | | | | | Length | 4 bytes | This is a 7 bit encoded integer describing the length of the string. Search up 7 bit encoded ints if you are unfamiliar with them | | String | [Length] bytes | The actual UTF 8 string, consisting of [Length] bytes | From here on out, any mention of string will refer to the layout above. Structure of a .tmod binary file: | Value | Data | BinaryReader method | Description | | | | | | | Header| 4 bytes | BinaryReader.ReadBytes(4) | The first 4 bytes of the file are ASCII characters which spell out 'TMOD'. If the header is invalid, then the file isn't a .tmod file / it's corrupt | | Version | String | BinaryReader.ReadString() | The version of tModLoader that the mod has been built for | | Hash | 20 bytes | BinaryReader.ReadBytes(20) | The SHA1 computed hash of the .tmod file | | Signature | 256 bytes | BinaryReader.ReadBytes(256) | The signature of the .tmod file, used by the mod browser | | File data length | Unsigned 32 bit integer | BinaryReader.ReadUInt32() | The amount of bytes left in the file after all the previous data has been read. Those remaining bytes are used in computing the hash found earlier in the .tmod file | | Mod name | String | BinaryReader.ReadString() | The internal name of the mod stored in the .tmod file | | Mod version | String | BinaryReader.ReadString() | The version of the mod stored in the .tmod file | | File count | Signed 32 bit integer | BinaryReader.ReadInt32() | The amount of files stored inside the .tmod file | | [File count] file entries | String, Signed 32 bit int, Signed 32 bit int | BinaryReader.ReadString(); BinaryReader.ReadInt32(); BinaryReader.ReadInt32() | The string is the name of the file, including its path. The first int is the uncompressed length of the file in bytes, the second int is the compressed length of the file in bytes. Repeat reading the file entries [File count] amount of times to get them all | | [File count] file data | [File entry compressed length] bytes | BinaryReader.ReadBytes( [File entry compressed length] ) | This is where all the actual file data is stored (in the same respective order as the file entries). Each file entry's compressed data length represents the amount of bytes you need to read in order to obtain its data. For example, if the first file entry has a compressed length of 34 bytes, read 34 bytes to get its data. Then if the second has a length of 89, read 89 bytes. Repeat doing this until you reach the end of the .tmod file | Having successfully parsed the .tmod file, you now need to decompress each file's data as tModLoader typically compresses most of the files using the DEFLATE algorithm. (If you're on .NET, a particularly good library for decompressing the data would be Ionic.Zlib). A file is considered compressed if the file entry it is associated with has an unequal compressed length and uncompressed length."},{"path":"螺线翻译tml教程/tModLoader文档/Mod-Loading-Steps 模组加载顺序.md","filename":"Mod-Loading-Steps 模组加载顺序.md","title":"Mod-Loading-Steps 模组加载顺序","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following page lists the order in which tModLoader loads mods and their content. This page may become outdated if tModLoader updates. As such, every section of this page will contain a link to the file(s) the information came from. Additionally, this page is not comprehensive. Your best resource for a specific load time issue is looking around in tModLoader's source yourself, specifically . tl;dr The most important load order steps. 1. Call subclass constructor. 2. Load mod configs (if content autoloading enabled). 3. Load mod content (if content autoloading enabled). This also calls on all autoloaded content. 4. Load gores, music, backgrounds, clouds (if respective autoloading enabled). 5. Call , then . 6. Call (and by extension, . 7. Initialize . 8. Call , then . 9. Set up the bestiary. 10. Set up NPC and item drop tables. 11. Set up recipes groups. 12. Add recipes. 13. Call . 14. Call . Mod Load Order Sources: See also: When tModLoader loads mods, it sorts them by internal name, and then resorts them such that the following conditions are satisfied for each mod MOD: MOD will load before any mod included in the field of MOD's . MOD will load after any mod included in the field of MOD's . MOD will load after any mod included in the or fields of MOD's as long as those mods aren't included in . Before these conditions are fulfilled, mods are sorted by internal name. Do NOT rely on the initial name based sorting: Mods may be moved around arbitrarily to fulfill the conditions above. If you need your mod to load before/after another mod, use / . For an example, take the following snippet for the mod MOD: MOD will load before because it's included in . MOD will load before because it's included in , even though is also in . MOD will load after because it's included in and not in . MOD will load after because it's included in . As a special exception, tModLoader's internal (which handles unloaded content, among other things) is always loaded first, and is inserted into the mod load order after mods are . Content Load Order After mods are sorted, all mods are loaded. Several steps happen atomically using : All substeps are performed for one mod before moving onto the next mod. Steps that occur like this will be marked as such. Loadable Types Sources: Several sections below mention \"loadable\" types. A type is considered loadable if it passes the following checks: 1. If the type has the attribute, it is considered not loadable if any of the mods listed in said attribute are not loaded. 2. If the type extends from a type that is not loadable, then it is also considered not loadable. 3. If a type is nested inside of a type that is not loadable, or if it is constructed from a generic type definition that is not loadable, then it is also considered not loadable. 4. If a type implements any interfaces that are not loadable, then it is also considered not loadable. 5. Passing all these checks, the type is considered loadable. 1. Instantiation Sources: The first step is instantiation , wherein all enabled mods' assemblies are loaded into memory. This step happens atomically . In order: 1. The mod is verified : The mod's assembly name must match its internal name, the mod must have at least one loadable type whose namespace begins with the internal name, and the mod must have at most one loadable subclass of . 2. An instance of the mod's subclass (or of if no subclass exists) is created. 3. The following fields on are filled: ; ; ; ; ; ; . This step is where your subclass's constructor is called, and is a good spot to assign any field on that isn't autofilled in substep 3 (e.g. , , etc.). 2. Content Loading and JITting The next step is content loading , wherein all of a mod's content and systems load. This is also the step in which the mod's assembly is JITted . These two steps happen at the same time: JITting begins before the first mod begins loading, and must finish before moving onto pre setup. Content Loading Sources: This step happens atomically . In order: 1. is set to , allowing content to be added to the mod. 2. The mod autoloads all loadable subclasses of (ordered by internal name) that return in . 3. The mod prepares to load assets by calling . 4. The mod attempts to autoload all content: 1. The mod loads all localization files and registers all found localization keys. 2. All localization keys starting with are added to the game tips list. 3. is auto assigned. 4. If is : Load all content by calling on a new instance of the content's type. This is where and are called! By extension, this is where , , , and are called (in that order). 5. If not on a dedicated server: Load all asset only gores, music, backgrounds, and clouds if , , , and (respectively) are . 5. is called. 6. is called for every known in the mod. If you try to add a new during this step, tModLoader won't call on it! 7. is set to . At this point, no more content can be added to a mod. Autoloadable Content Sources: A type is autoloadable if: The type is loadable. The type implements the interface ( does this, so any subclasses also do it). The type is not abstract. The type contains no unbound generic parameters (e.g. is not autoloadable). The type has a parameterless constructor (even if it's private). The type either doesn't have the , or the attribute allows loading. JITting Sources: See also: JITting occurs on a set of methods from all of a mod's loadable types. Specifically, a method is JITted if all of the following conditions are true: 1. The method's containing type is . 2. The method's containing type passes the mod's . 3. If the method's containing type is nested or generic, the parent type / generic type definition also must pass the mod's . 4. The method must not be abstract, must not contain generic parameters, and must be declared on the type it is being JITted on (i.e. don't JIT a non overridden virtual method on a subclass). By default, a type or method passed a mod's if all attributes on that type/method return in , or if the type/emthod has no attributes. tModLoader provides the following subclasses of for use: : Member is never JITted. : Member is only JITted if the specified mods are also enabled. Be aware that you can make your own subclasses of and if you need more control. 3. Before Setup Sources: Some steps are taken between loading content and setting it up. Namely: 1. All content arrays are resized. This includes all ID sets. 2. If the player was using a modded resource set, it is restored here. 4. Setup Content Sources: The next step is setup . This is an incredibly simple step: is called for every loaded in the mod. In most cases, the subclass will call here, alongside some extra work specific to each . Check out each if you need to see what specific extra work it does. This step happens atomically . 5. Extra Setup Some extra work done after is called, but before . In order: 1. is re initialized. After this step, it will now contain all modded data, as well as any changes made to vanilla content in . loads NPC instances first, then projectiles, then items, then NPC bestiary rarity stars. 2. Some tile merging data is setup (see and ). 3. Mount based buff data is setup (see ). 6. Post Setup Content The final step performed on all mods is post setup content . This is the step often used for cross mod compatibility. This step happens atomically . In order: 1. is called. 2. is called for every known in the mod. 3. All requested mod assets ( ) are loaded (see ). 7. Final Setup Sources: Many things happen after is called, including (in order): 1. Many s have a \"final setup\" phase that is called here. This includes caching localized text, setting up globals, setting up hooks added by mods, etc. 2. is called. 3. The bestiary is set up. This is where is called. 4. Item drop rules are set up. This is where , , and are called. 5. Recipes are set up. This is the \"Adding recipes…\" step in loading, and is where the following methods are called (in order): , , , , , , , , . 6. If the player was using a modded menu or boss bar style, it is restored. The few steps above are only highlights; please see the end of for the full list. Final Notes Once again, this guide may become outdated as tModLoader updates; the best way to check load order is to read through yourself (preferably in an environment that lets you jump to method definitions)."},{"path":"螺线翻译tml教程/tModLoader文档/Terraria.Player.Update()-Execution-Order Player更新函数执行顺序.md","filename":"Terraria.Player.Update()-Execution-Order Player更新函数执行顺序.md","title":"Terraria.Player.Update()-Execution-Order Player更新函数执行顺序","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This wiki page serves to act as a reference for most of the technical aspects of the method. If you want a full reference, decompile tModLoader via the tool (see: ). The update \"tasks\" are listed in logical order, using numbered lists to indicate relevance. 1. is invoked if the player is this game's client ( ) and it's not a server player ( ) 1. is invoked if the player is this game's client ( ) and the world is The Constant ( ) 1. Ground/Air Speed Stat Resetting is set to is set to ( ) is set to is set to and are set to is set to is set to 1. (the variable responsible for preventing minecart movement if not on a minecart track) is cleared if the player's mount is inactive or not a minecart 1. is set to 1. (a variable used for sideways pulley movement) is set to 1. If the player is holding the Portal Gun or has recently exited a Portal Gun portal ( ), is set to 1. Wet Movement Checking 1. If is set 1. If is set: is reduced to is reduced to 1. Otherwise, if is set: is reduced to is reduced to 1. Otherwise, if (a variable set to when the player is holding a Trident and not in a mount/minecart) is set: is reduced to is reduced to is increased to is increased to If the player is holding the UP movement key ( ): is reduced to is reduced to 1. Otherwise: is reduced to is reduced to is increased to is increased to 1. If the player has the Distorted debuff: is set to 1. is incremented by 1. If the player is this game's client ( )... 1. The quick grapple timer for gamepads is handled 1. The preview shown before placing a tile is reset ( ) 1. (a variable used to track if the player can use DD2 sentries outside of the event) is set if is set 1. handling Player receives a Slice of Cake from the Party Girl if they talk to her during a naturally occurring party 1. The timer is decremented 1. (a variable used to track when the player can spawn the \"ghost\" projectiles from the Spectre set bonus) is decremented by 1. handling If the world is in normal mode and is less than , it is incremented by . It is then capped at Otherwise, if is less than , it is incremented by . It is then capped at 1. is invoked 1. If the player is on a mount and that mount is the Rudolph mount (Reindeer Bells), light is spawned on the player's center 1. Other Client Checking 1. is cleared 1. If the player is not this game's client ( ) and they're outside of the world bounds, is set NOTE: due to becoming a struct in 1.4 tModLoader, the additional checks for if the player is an unloaded world section fail. 1. If the player is considered \"out of range\": , and are set to is invoked is invoked // TODO: finish docs LockOnHelper::Update() The lock on system is a hidden mechanic in Terraria that's usually gatekept behind gamepad usage. Activating the system and selecting a target NPC causes the effective cursor location to be snapped onto the target NPC's center for weapon aiming purposes. This method handles checking if the system can be used, updating timers for the arrow visuals and finding valid targets. DontStarveDarknessDamageDealer::Update(Player) While in complete darkness for at least 5 seconds, the player starts receiving 50 damage every second. In order to be considered \"in darkness\", the following is evaluated: 1. Retrieve the light value at the player's center 1. Convert the light value into a 3D vector, where the range of each component is between and , inclusive. For comparison, a color value of is converted into 1. If the length of that vector is less than , then the player is considered \"not safe\", aka in darkness. Player::ResizeHitbox() This method updates the player's Y position to account for , a property that either uses if the player is on a mount or if the player is on a Step Stool, or if neither are the case. Player::UpdateBuffs(int) This method is responsible for updating the remaining time for all of the player's active buffs as well as applying their effects. 1. If the player is currently hitting NPCs with the Life Drain item ( ) and they're this client's player ( ), The Life Drain (ID 151) buff is granted for 2 game ticks 1. If the world is The Constant ( ), is invoked 1. For each active buff on the player (buff index = ): 1. If the player is this client's player ( ) and the buff's remaining time can decrease ( ) is decremented by 1. The following buffs are checked in order. If the current iterating buff matches any of the following, its affects are applied: 1. Obsidian Skin (ID 1) is set (Prevents lava damage) is set (Prevents receiving the Burning debuff) is set (ID 24 = On Fire! debuff) 1. Any mount buff ( ) is initialized with the buff's mount data is set to 1. Star in a Bottle (ID 158) is incremented by 1. Sharpened (ID 159) is increased by 1. Sugar Rush (ID 192) is decremented by is incremented by 1. Cerebral Mindtrick (ID 321) is increased by is increased by 1. Regeneration (ID 2) is incremented by // TODO: finish explanation Player::UpdateFrame() // TODO Player::UpdateStarvingState(bool) // TODO"},{"path":"螺线翻译tml教程/tModLoader文档/build.txt build.txt文件.md","filename":"build.txt build.txt文件.md","title":"build.txt build.txt文件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click About You can create a build.txt file in the top level of your mod's source directory to give it build properties. These properties are used during the building process of your mod and include information about the mod. Properties in this file may remind you of .ini files, where every key has a name and value , delimited by an equals ( ) sign. Note: Capitalization matters in this file! Bad capitalization will lead to errors during the build process. White spaces do not matter. However, each property must be on its own line, list items must be separated by commas, and property names must be on the left side of the equals sign. Available properties | Property | Description | Default | | : | : | : | | displayName | The name used when the mod is displayed | | author | The author used when the mod is displayed Contributors (additional modders that can publish updates) Note that the author field is just a display value, it doesn't actually control anything. If you are working with others and wish to allow them to publish updates for this mod to the Steam workshop, you can add them as a contributor by clicking \"Add/remove Contributors\" on the workshop page of the mod after it has been published. Be extremely careful with adding contributors, only add contributors you can absolutely trust. | | version | The version used when the mod is displayed. Must be 2 to 4 numbers separated by periods. The value must be in the following format: (e.g. 1.2.3.4) These are not decimals , for example is the same as . Also, is greater than because . and are both not allowed because they need to be 2 to 4 numbers. | | dllReferences | A list of dll references the mod has aside from the dlls of other mods. Do NOT include mods here. Name references by their file name without the extension. You must place the dll files in a folder in the top level of your mod source. | | modReferences | A list of other mods that the mod depends on. This mod will require the dependency mod to be enabled for this mod to be enabled. Name mods by their file name without the extension. See to learn how to properly use this. | | weakReferences | A list of mods that the mod will build against and can natively interact with, but don't necessarily have to be enabled. Basically optional modReferences, but require the modder to be a little more careful in programming to avoid binding errors. See to learn how to properly use this. | | noCompile | Whether the mod should compile source code when being built or use a .dll file pre compiled by the mod maker. By default this will be false if you do not include this property. The precompiled dll file must be named \"ModName.dll\", where is your mod's name. | false | homepage | A link to the home website of the mod. This will be listed alongside the steam workshop page in the More Info menu. | | hideCode | If true, the unpacked mod that results from using the extract mod option will not include .dll files (compiled code), .pdb files (help with error messages) or .xml files (documentation). These files are essential to allowing cross mod functionality so this option shouldn't be true if you intend to allow mods to properly interop with your mod. | false | | hideResources | If true, the unpacked mod that results from using the extract mod option will not include resource files, such as .png files and .wav files. Use this if you would like to have your sounds and images freely available to other modders to view. If you use , this will also include those .cs files. | false | | includeSource | If true, the unpacked mod that results from using the extract mod option will include .cs files, provided is still false. Use this if you would like to share your code freely. If you are truly interested in community support for your mod, consider using to allow others to contribute code to your mod. | false | | buildIgnore | A list of file patterns to ignore during the build and packaging processes. To exclude a single file, simply write the filename: , . To exclude a folder, write . | , files and folders beginning with , , , and are excluded by default. If is , , , and files will also be excluded. | | side | The ModSide that controls how this mod is synced between client and server. See for more information. | Both | | sortAfter | A list of other mods that this mod will be forced to load after. The last mod in the list alphabetically is the one this mod will be loaded after. Only affects loading if this mod would normally be loaded before those other mods. Automatically happens with mods listed in the list. Name mods by their file name without the extension. | sortBefore | A list of other mods that this mod will be forced to load before. This property can be considered the opposite of the property. Name mods by their file name without the extension. | playableOnPreview | If false, the mod will refuse to load on a preview version of tModLoader if loaded from the workshop. This can be used for mods that want to avoid bug reports from preview users or want to publish to preview without spoiling new content. Most mods shouldn't need to use this. | true | translationMod | If true, this mod will be treated as a mod providing translations for another mod. The mods listed in are the mods this mod translates. The explains this in more depth. Translation mods will have their localization files automatically updated with localization entries from the translated mod when they are loaded together, enabling translation mod authors to easily update translations to the latest update. This will also cause a special icon to be shown in the Mods menu and adds a to allow users to more easily find translation mods. | false | modSource | Used internally by tModLoader to allow mod source code to exist outside of the normal folder. See the \"How to use\" section on to learn how to use this feature. |"},{"path":"螺线翻译tml教程/tModLoader文档/description.txt description.txt文件.md","filename":"description.txt description.txt文件.md","title":"description.txt description.txt文件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"You can create a file in the top level of your mod's source directory. This file is a plain text file that contains a short description of your mod. In game, it will appear in the Mods menu when the More Info button is selected. The description file is handled as plain text and thus any formatting (such as markdown) will not be handled. Including a is very important and helps players find mods they are interested in. description workshop.txt An additional file, , can optionally be included. If present, the content of this text file will automatically be placed on the mod's Workshop page when uploading or updating the mod instead of the . The regular will still be displayed in game. can be included in the which Steam will parse."},{"path":"螺线翻译tml教程/原版代码文档/Useful-Vanilla-Fields 实用原版字段.md","filename":"Useful-Vanilla-Fields 实用原版字段.md","title":"Useful-Vanilla-Fields 实用原版字段","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This is a quick list of the most common vanilla fields and a small description to what it does when changed. Index| | | | | | | | Item Fields See Main Fields For and other Tile related fields, see . expertMode; bool If true, means that the world is in expert mode. hardMode; bool If true, the world is currently in hardmode. rain; bool If true, it is currently raining in the world. bloodMoon; bool If true, it is currently a blood moon going on. spawnTileX, spawnTileY; int The X and Y coordinates of the world spawn tile. npcShop; int If greater than 0, the player currently has an NPC shop opened. NPC Fields See Player Fields armor; Item[] Represents the primary equip slots of the player (not counting pet, mount and hook slots that are on a separate page). 0 2: Armor (Head, Chest, Legs), 3 7 + extra slots (up to 9): Accessories, 10 12: Vanity Armor (Head, Chest, Legs), 13 17 + extra slots (up to 19) Vanity Accessories. dash; int Enables a dash ability depending on the value of the variable. 1 = Ninja Master Gear Dash. 2 = Eye of Cthulhu Shield Dash. 3 = Solar Armor Dash. endurance; float (%) Damage reduction modifier. 0 means no reduction, 1 is max reduction (minimum of 1 damage taken). immune; bool Gives the player immunity. He cannot be hurt by being hit. immuneAlpha; int Set to 0 to prevent blinking when immune. immuneTime; int Represents the time in ticks the player is be immune for (use with the immune bool). inventory; Item[] Represents the inventory, including hotbar, coin, and ammo slots. Coin slots are 50 53, while Ammo slots are 54 57. Main.maxInventory = 58 items total lifeRegen; int Increases the player's life regen. The number is applied over 2 seconds. lifeRegenTime; int Increases the player's life regen, but in a different way. magicCrit; int The player's magic critical chance. magicDamage; float (%) The player's magic damage. manaCost; float (%) Lower the value to lower the mana cost of spells. You can augment it too to make them cost more mana. manaRegen; int Increases the amount of mana the player regenerates. The amount is added over 2 seconds. manaRegenBonus; int Increases the speed at which the player regenerates mana. maxMinions; int The maximum allowed number of minions, default value is 1. maxRunSpeed; float The maximum movement speed that the player can accelerate to. meleeCrit; int The player's melee critical chance. meleeDamage; float (%) The player's melee damage. meleeSpeed; float (%) The player's melee swinging speed. minionDamage; float (%) The player's minions damage. minionKB; float (%) The player's minions knockback strength. moveSpeed; float The player's movement speed. Caps at 1.6. noKnockback; bool If true, the player isn't affected by knockback. noFallDmg; bool If true, the player isn't affected by fall damage. numMinions; int The current number of minions. Set via projectiles flagged as minion. rangedCrit; int The player's ranged critical chance. rangedDamage; float (%) The player's ranged damage. runAcceleration; float The speed at which the player achieves their maximum movement speed. runSlowdown; float The speed at which the player slowdowns when they stop moving. slotsMinions; float The current filled slots of minions. Set via projectiles flagged as minion. Some minion projectiles only count as half a minion slot (think Retanimini and Spazmamini). statDefense; int The player's defense. statLifeMax; int The base amount of max health. Do not change it unless you know what you're doing, Use statLifeMax2 instead. For example, this is the variable that Life Hearts increase. It is permanent and is saved automatically. statLifeMax2; int The temporary max health of the player. For example, this is used for things like accessories or potions. It is temporary and resets upon world load. statManaMax; int Similar to statLifeMax, but modifies mana instead. statManaMax2; int Similar to statLifeMax2, but modifies mana instead. thrownCrit; int The player's throwing critical chance. thrownDamage; float (%) The player's throwing damage. wings; int Set to the wingSlot value of the currently equipped wing item. Mainly used for visual wing feedback (dust spawning, etc). wingsLogic; int Set to the wingSlot value of the currently equipped wing item. Used to determine wingTimeMax and additional wing mechanics. wingTime; int The current wing time. Is substracted from when the player uses their wings. Defaults to wingTimeMax when grounded or grappled. wingTimeMax; int Determines the player's max flight time with wings when not mounted. Defaults to 0. Projectile Fields See Worldgen Fields crimson; bool If true, crimson was generated for the world. Check if false for corruption instead."},{"path":"螺线翻译tml教程/原版代码文档/Useful-Vanilla-Methods 实用原版函数.md","filename":"Useful-Vanilla-Methods 实用原版函数.md","title":"Useful-Vanilla-Methods 实用原版函数","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This is a collection of vanilla methods that are useful when modding. This list is meant as a quick reference to the most commonly used methods, but with more advanced mods it is highly recommended to add Terraria as a reference to your IDE since this list isn't exhaustive. Item See Projectile See Dust public static int NewDust(Vector2 Position, int Width, int Height, int Type, float SpeedX = 0f, float SpeedY = 0f, int Alpha = 0, Color newColor = default(Color), float Scale = 1f) Spawns a dust in the world. Lighting public static void AddLight(int i, int j, float R, float G, float B) Adds light to the world at the tile coordinates provided. Player public void QuickSpawnItem(int item, int stack = 1) Spawns an item right on a player, a simple alternative to Item.NewItem. public bool HasItem(int type) Determines if the player has the specified item in their inventory. Example: public void AddBuff(int type, int time1, bool quiet = true) Adds a buff to a player. public int FindBuffIndex(int type) Returns 1 if the player doesn't have the buff, and an index (0 to 21) if the player does. NPC public static int NewNPC(int X, int Y, int Type, int Start = 0, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, int Target = 255) Spawns an NPC in the world. Example: public void AddBuff(int type, int time, bool quiet = false) Adds a buff to an NPC. Example: public int FindBuffIndex(int type) Returns 1 if the NPC doesn't have the buff, and an index (0 to 4) if the NPC does. Example: Main public static void PlaySound(int type, int x = 1, int y = 1, int Style = 1) Plays a sound. Type is the category and style is the sound within that category. x and y give the sound a position, but can be left as 1 for center. public static void NewText(string newText, byte R = 255, byte G = 255, byte B = 255, bool force = false) Prints text messages to the console. WorldGen public static void TileRunner(int i, int j, double strength, int steps, int type, bool addTile = false, float speedX = 0f, float speedY = 0f, bool noYChange = false, bool overRide = true) Useful for spawning ores during worldgen. This method has a lot of vanilla tile specific code, but should still work. i and j are coordinates, type is the tile to place. public static void OreRunner(int i, int j, double strength, int steps, ushort type) A safer version of TileRunner. Vanilla uses this method for the hardmode ores. Only tiles in the TileID.Sets.CanBeClearedDuringOreRunner or Main.tileMoss arrays will be replaced, keeping chests, trees, and special tiles safe from being overwritten."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Ammo-IDs 原版-弹药ID表.md","filename":"Vanilla-Ammo-IDs 原版-弹药ID表.md","title":"Vanilla-Ammo-IDs 原版-弹药ID表","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following is a list of constants found in the class. s are used to define ammo classes, groups of items that all work with the same weapons. s are based off of the of the first ammo item in that class. For example, the has a value of 97 and the for Bullet also has a value of 97. All other Bullets in the game set their to , and all weapons that use Bullet ammo set their to . For ModItems, please follow this numbering convention as well to avoid ID overlap. | Ammo | ID/Type | : | : | None | 0 | | Gel | 23 | | Arrow | 40 | | Coin | 71 | | FallenStar | 75 | | Bullet | 97 | | Sand | 169 | | Dart | 283 | | Rocket | 771 | | Solution | 780 | | Flare | 931 | | Snowball | 949 | | StyngerBolt | 1261 | | CandyCorn | 1783 | | JackOLantern | 1785 | | Stake | 1836 | | NailFriendly | 3108 |"},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Class-Changes 原版-类改动.md","filename":"Vanilla-Class-Changes 原版-类改动.md","title":"Vanilla-Class-Changes 原版-类改动","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Item Properties public ModItem modItem The ModItem instance that controls the behavior of this item. This property is null if this is not a modded item. Methods public ItemInfo GetModInfo(Mod mod, string name) Gets the ItemInfo instance (with the given name and added by the given mod) associated with this item instance. public T GetModInfo (Mod mod) where T : ItemInfo Same as the other GetModInfo, but assumes that the class name and internal name are the same. public void CloneDefaults(int type) Allows you to copy the defaults of a different type of item. Projectile Properties public ModProjectile modProjectile The ModProjectile instance that controls the behavior of this projectile. This property is null if this is not a modded projectile. Methods public ProjectileInfo GetModInfo(Mod mod, string name) Gets the ProjectileInfo instance (with the given name and added by the given mod) associated with this projectile instance. public T GetModInfo (Mod mod) where T : ProjectileInfo Same as the other GetModInfo, but assumes that the class name and internal name are the same. public void CloneDefaults(int type) Allows you to copy the defaults of another type of projectile. NPC Properties public ModNPC modNPC The ModNPC instance that controls the behavior of this NPC. This property is null if this is not a modded NPC. Methods public NPCInfo GetModInfo(Mod mod, string name) Gets the NPCInfo instance (with the given name and added by the given mod) associated with this NPC instance. public T GetModInfo (Mod mod) where T : NPCInfo Same as the other GetModInfo, but assumes that the class name and internal name are the same. public void CloneDefaults(int type) Allows you to copy the defaults of another type of NPC. Player Methods public ModPlayer GetModPlayer(Mod mod, string name) Gets the ModPlayer instance (with the given name and added by the given mod) associated with this player instance. public T GetModPlayer (Mod mod) where T : ModPlayer Same as the other GetModPlayer, but assumes that the class name and internal name are the same. public void VanillaUpdateInventory(Item item) Gives the item's effects to the player as if it were in the player's inventory. This works for both vanilla and modded items. public void VanillaUpdateEquip(Item item) Gives the item's effects to the player as if the player has it equipped. Note that for accessories, you must call both VanillaUpdateEquip and VanillaUpdateAccessory. This works for both vanilla and modded items. public void VanillaUpdateAccessory(Item item, bool hideVisual, ref bool flag, ref bool flag2, ref bool flag3) Gives the item's effects to the player as if the player has it equipped in an accessory slot. Note that for accessories, you must call both VanillaUpdateEquip and VanillaUpdateAccessory. This works for both vanilla and modded items. public void VanillaUpdateVanityAccessory(Item item) Gives the item's effects to the player as if the player has it equipped in a vanity accessory slot."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Content-IDs 原版-内容ID表.md","filename":"Vanilla-Content-IDs 原版-内容ID表.md","title":"Vanilla-Content-IDs 原版-内容ID表","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"IDs Terraria uses numbers to reference various pieces of content in the game. Each of these numbers usually has a corresponding ID name. Modders can use these ID names to easily reference vanilla content. For example, a modder can type to spawn an Iron Bar item at the players location. is confusing, however, so the modder can type instead. There exist ID classes for many different types of content, such as Items, Projectiles, Tiles, and so on. Using any ID class requires at the top of the file. Do note that the values of these IDs overlap. Both and have a value of . It is important to make sure you are using the correct ID class for the type of content you are attempting to use. Mixing these up will result in bugs. For example, would spawn the item instead of the item. This page lists info on using different types of IDs and links to the official Terraria wiki for the actual values. On these lists, there is typically an column corresponding to the actual ID name that a modder can type to get the numerical value. These lists can be useful for a quick reference, but don't waste your time looking up each ID while making your mod. We expect modders to be using to automatically type out these IDs. Typically the IDs mirror the English name of the items, so autocomplete should be sufficient for modding. On rare occasions you might not find the ID you are looking for, if that is the case you can use the wiki links to discover the actual ID name. Also note that if Terraria recently updated and tModLoader has yet to update, the newly added ID values corresponding to content added in the most recent updates will not exist in tModLoader. The has links to many listings of content IDs. The rest of this page will go into more depth about content IDs commonly used in tModLoader modding.. Searching Websites You can use the shortcut to open up your browsers find function. Once it is open, type your search term and the matching results will be highlighted. Count Most ID classes have a field corresponding to end of the listing of IDs. You can iterate from to in a loop if you need to run some code for each piece of content. Search Many ID classes have a field that has methods that can be used to retrieve ID names from the corresponding number value, and vice versa. This can be useful for making debugging tools. Modded internal names can also be retrieved in the same manner, but remember that modded IDs can change between game reloads. If you are trying to track content between game sessions, use classes like . Sets Contains in many ID classes is an inner class called , these classes store data corresponding to the content. For example the set tracks which tiles have outlines, hinting to the game to load and draw the outlines when the tile is hovered. Modders typically assign to these in methods. For example, a modder would write in the method of their class to tell the game that this tile has outlines. See ExampleMod for various usages of other Sets. Item IDs Some common items with not obvious names: is actually , is actually , and is actually . As a reminder you use these values either by writing or just , do NOT write : Projectile IDs Projectile IDs are typically used in methods to spawn projectiles into the world. Many projectiles have multiple versions with or attached to the name of some of the duplicates. These indicate that the projectile is either or , use the one that matches the damage behavior you intend. If there isn't a version of the projectile you need, you may have to make your own version as a . Projectile AI Style IDs Projectile AI styles (use for ) do not have official names. Included in tModLoader is the class which gives names to each. NPC IDs Negative IDs represent NPCs that share a with an NPC with a positive NPC. If you need to differentiate between these variants, you'll need to check to determine which variant is being checked. NPC AI Style IDs NPC AI styles (use for ) do not have official names. Included in tModLoader is the class which which gives names to each. The official wiki has another listing with more detailed descriptions. Use both pages to find the information desired. Tile IDs Tile IDs represent the type of tile. Tile IDs correspond to the at a coordinate. Many furniture tiles listed have a number in the column, this corresponds with the concept explained in the . For example, most chests in the game are listed as the Tile ID of 21, but have different / values to differentiate them. The wiki does not list the internal names, those can be found on the page. Wall IDs Wall IDs are used in . Many walls have 2 variants, an unsafe and a safe variant. Safe variants are player placed walls that don't have the same enemy spawning properties of the unsafe variants. Buff IDs Use these in methods like and . Note that many buffs only affect players or enemies, but not both. If Terraria doesn't have a way to give a buff to an enemy, it likely isn't programmed to work with NPCs. The same is true for buffs that aren't ever applied to players. Dust IDs Due to their nature, dust are hard to identify, use the guide to find Dust IDs. Sound IDs Sound IDs can be used to play specific existing sounds in a mod. The goes over how to use the Sound ID information on the wiki to find and play specific Terraria sounds. Achievement Identifiers The lists the vanilla achievements. When positioning a , you'll need the internal name to reference the correct vanilla achievement. While that wiki page does not list their internal names, the internal names can be derived by taking the name of the achievement, removing punctuation, capitalizing all letters, and replacing spaces with underscores. For example, \"Ooo! Shiny!\" would become \"OOO SHINY\". A complete listing is provided below. Vanilla Achievement Identifiers These are all of the vanilla achievements in order: others here..."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Interface-layers-values 原版-UI界面层.md","filename":"Vanilla-Interface-layers-values 原版-UI界面层.md","title":"Vanilla-Interface-layers-values 原版-UI界面层","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This is a list of the vanilla interface layers stored in the layers parameter within , in the order that they appear. In order to use those, write your code like this: | Interface layer | Description | | : | : | | Vanilla: Interface Logic 1 | Handles logic related to mouse input while using items held on the cursor. | | Vanilla: MP Player Names | Draws other players' names, distances, health text, and head icons. | | Vanilla: Emote Bubbles | Draws emote bubbles for NPCs and players as well as the NPC chat bubble when hovering over an NPC. | | Vanilla: Entity Markers | Draws the minion targeting marker for manually targeted NPCs. | | Vanilla: Smart Cursor Targets | Draws the targeted tile highlight when placing or breaking with smart cursor. | | Vanilla: Laser Ruler | Draws the mechanical ruler tile grid. | | Vanilla: Ruler | Draws the ruler lines and sets the ruler text value but doesn't draw the text itself. | | Vanilla: Gamepad Lock On | Draws indicators for NPC lock on. | | Vanilla: Tile Grid Option | Draws the radial tile grid overlay for the tile grid option. | | Vanilla: Town NPC House Banners | Draws NPC home banners and handles logic for manually kicking out NPCs from their home. | | Vanilla: Hide UI Toggle | Handles logic for hiding UI based on the hide UI toggle. | | Vanilla: Wire Selection | Draws and handles logic for the wire selection radial menu and wire mode cursor preview. Also draws the golf swing power gauge and golf ball indicator arrow. | | Vanilla: Capture Manager Check | Draws and handles logic for camera mode. | | Vanilla: Ingame Options | Draws and handles logic for the ingame options menu. | | Vanilla: Fancy UI | Draws Fancy UIs such as the Achievements UI, Virtual Keyboard UI, and Mod Config UI. | | Vanilla: Achievement Complete Popups | Draws ingame notifications for Achievements and Join Requests. | | Vanilla: Entity Health Bars | Draws health bars for NPCs and other players. | | Vanilla: Invasion Progress Bars | Draws invasion progress bars and boss health bars. | | Vanilla: Map / Minimap | Draws the ingame minimap. (Doesn't draw the fullscreen map or overlay map) | | Vanilla: Diagnose Net | Draws network diagnostics. | | Vanilla: Diagnose Video | Draws rendering diagnostics. | | Vanilla: Sign Tile Bubble | Draws the sign chat bubble when hovering over a sign. | | Vanilla: Hair Window | Draws the stylist hairstyle menu. | | Vanilla: Dresser Window | Draws the dresser menu. | | Vanilla: NPC / Sign Dialog | Draws dialogue menus for NPCs and signs. | | Vanilla: Interface Logic 2 | Handles logic related to inventory colors. | | Vanilla: Resource Bars | Draws health, mana, and breath bars, as well as buff icons. | | Vanilla: Interface Logic 3 | Handles logic for when the player inventory is closed. | | Vanilla: Inventory | Draws and handles logic for everything inventory related. | | Vanilla: Info Accessories Bar | Draws and handles logic for PDA informations. | | Vanilla: Settings Button | Draws and handles logic for the Settings button. | | Vanilla: Hotbar | Draws and handles logic for the hotbar. | | Vanilla: Builder Accessories Bar | Draws and handles logic for builder accessory toggles. | | Vanilla: Radial Hotbars | Draws and handles logic for the radial hotbar and radial quickbar. | | Vanilla: Mouse Text | Draws ruler measurement text and handles logic for setting mouse text. | | Vanilla: Player Chat | Draws the chat. | | Vanilla: Death Text | Draws the death text overlay. | | Vanilla: Cursor | Draws the cursor. | | Vanilla: Debug Stuff | Does absolutely nothing. | | Vanilla: Mouse Item / NPC Head | Draws items held on the cursor, also draws and handles logic for manually moving NPC homes. | | Vanilla: Mouse Over | Draws sign text and handles logic for hovering over resource bars, NPCs, players, and dropped items. | | Vanilla: Interact Item Icon | Draws custom cursor icons and the currently selected item in the inventory. (Doesn't draw items held on the cursor) | | Vanilla: Interface Logic 4 | Draws gamepad instructions, any pending mouse text, and handles logic related to interacting with NPCs using smart cursor. |"},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Item-Field-Values 原版-物品字段值.md","filename":"Vanilla-Item-Field-Values 原版-物品字段值.md","title":"Vanilla-Item-Field-Values 原版-物品字段值","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"When learning to create mod items, it is beneficial learn the effect of various item properties by seeing how vanilla items achieve their desired effects. Below is a listing of the properties set for each vanilla Terraria item. Be sure to check out to learn what each field represents. For example. If you wanted your mod item to use the sound that the \"Flower of Fire\" makes when used, you would find the entry in the pages below and see that \"Flower of Fire\" has a use sound of 20. Now, you can say \"item.UseSound = SoundID.Item20\" in the SetDefaults method of your mod item and it should make the same sound."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Item-Sorting-Priorities 原版-物品排序优先级.md","filename":"Vanilla-Item-Sorting-Priorities 原版-物品排序优先级.md","title":"Vanilla-Item-Sorting-Priorities 原版-物品排序优先级","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"When you use the sorting feature in storage (for example, sorting a chest), the items will be sorted based on their sorting priority in . When making a custom item, this value is set inside of , using (requires ). For example, if you wanted your item to have the same sorting priority as a platinum bar (Item ID: 706), which has a sorting priority of 59, you would write this in : Here is a full list of vanilla sorting priorities, according to item ID (anything not on the list has a value of 1 ): (Item ID: Sorting Priority) 11: 48 12: 44 13: 56 14: 52 19: 57 20: 45 21: 53 22: 49 56: 62 57: 63 86: 64 116: 60 117: 61 174: 69 175: 70 177: 39 178: 41 179: 40 180: 38 181: 37 182: 42 364: 77 365: 81 366: 85 381: 78 382: 82 391: 86 520: 71 521: 72 547: 75 548: 76 549: 74 575: 73 699: 46 700: 50 701: 54 702: 58 703: 47 704: 51 705: 55 706: 59 880: 65 947: 90 999: 43 1006: 91 1104: 79 1105: 83 1106: 87 1184: 80 1191: 84 1198: 88 1225: 89 1257: 66 1329: 67 1508: 93 1552: 92 3261: 94 3380: 68 3456: 97 3457: 96 3458: 98 3459: 95 3460: 99 3467: 100"},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-NPC-Field-Values 原版-NPC字段值.md","filename":"Vanilla-NPC-Field-Values 原版-NPC字段值.md","title":"Vanilla-NPC-Field-Values 原版-NPC字段值","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"When learning to create mod NPCs, it is beneficial learn the effect of various NPC properties by seeing how vanilla items achieve their desired effects. Below is a listing of the properties set for each vanilla Terraria NPC. For example. If you wanted your mod NPC to use the sound that the Vultures makes when hit, you would find the entry on the spreadsheet below and see that \"Vulture\" has a \"soundHit\" of 28. Now, you can write \"npc.HitSound = SoundID.NPCHit28\" in the SetDefaults method of your mod NPC and it should make the same sound when hit by a player."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Projectile-AIs 原版-弹幕AI.md","filename":"Vanilla-Projectile-AIs 原版-弹幕AI.md","title":"Vanilla-Projectile-AIs 原版-弹幕AI","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This is a reference for vanilla AIs to the aiStyle used. Projectile ID | aiStyle | 1 | 1 2|1 3|2 4|1 5|1 6|3 7|4 8|4 9|5 10|6 11|6 12|5 13|7 14|1 15|8 16|9 17|10 18|11 19|3 20|1 21|2 22|12 23|13 24|14 25|15 26|15 27|8 28|16 29|16 30|16 31|10 32|7 33|3 34|9 35|15 36|1 37|16 38|1 39|10 40|10 41|1 42|10 43|17 44|18 45|18 46|19 47|19 48|2 49|19 50|14 51|1 52|3 53|14 54|2 55|1 56|10 57|20 58|20 59|20 60|20 61|20 62|20 63|15 64|19 65|10 66|19 67|10 68|10 69|2 70|2 71|10 72|11 73|7 74|7 75|16 76|21 77|21 78|21 79|9 80|22 81|1 82|1 83|1 84|1 85|23 86|11 87|11 88|1 89|1 90|24 91|1 92|5 93|2 94|24 95|8 96|8 97|19 98|1 99|25 100|1 101|23 102|16 103|1 104|1 105|19 106|3 107|20 108|16 109|10 110|1 111|26 112|26 113|3 114|27 115|27 116|27 117|1 118|28 119|28 120|1 121|29 122|29 123|29 124|29 125|29 126|29 127|26 128|28 129|28 130|19 131|30 132|27 133|16 134|16 135|16 136|16 137|16 138|16 139|16 140|16 141|16 142|16 143|16 144|16 145|31 146|31 147|31 148|31 149|31 150|4 151|4 152|4 153|19 154|15 155|32 156|27 157|27 158|1 159|1 160|1 161|1 162|2 163|33 164|16 165|7 166|2 167|34 168|34 169|34 170|34 171|35 172|1 173|27 174|1 175|26 176|1 177|28 178|1 179|10 180|1 181|36 182|3 183|14 184|1 185|14 186|37 187|38 188|23 189|36 190|39 191|26 192|26 193|26 194|26 195|1 196|14 197|26 198|26 199|26 200|26 201|17 202|17 203|17 204|17 205|17 206|40 207|1 208|26 209|26 210|26 211|26 212|19 213|20 214|20 215|19 216|20 217|20 218|19 219|20 220|20 221|41 222|19 223|20 224|20 225|1 226|42 227|43 228|44 229|44 230|7 231|7 232|7 233|7 234|7 235|7 236|26 237|45 238|45 239|45 240|2 241|10 242|1 243|45 244|45 245|45 246|1 247|15 248|1 249|2 250|46 251|46 252|20 253|8 254|47 255|48 256|7 257|1 258|8 259|1 260|48 261|14 262|13 263|18 264|45 265|1 266|26 267|1 268|26 269|26 270|1 271|13 272|3 273|13 274|18 275|1 276|1 277|14 278|1 279|1 280|12 281|49 282|1 283|1 284|1 285|1 286|1 287|1 288|12 289|1 290|48 291|50 292|50 293|51 294|48 295|50 296|50 297|51 298|52 299|1 300|2 301|3 302|1 303|16 304|2 305|52 306|2 307|36 308|53 309|28 310|33 311|1 312|1 313|26 314|26 315|7 316|36 317|54 318|2 319|26 320|3 321|55 322|7 323|1 324|26 325|1 326|14 327|14 328|14 329|56 330|2 331|7 332|7 333|3 334|26 335|2 336|1 337|1 338|16 339|16 340|16 341|16 342|19 343|57 344|1 345|1 346|14 347|2 348|1 349|1 350|1 351|58 352|14 353|26 354|10 355|1 356|59 357|1 358|60 359|28 360|61 361|61 362|61 363|61 364|61 365|61 366|61 367|19 368|19 369|20 370|2 371|2 372|7 373|62 374|1 375|62 376|1 377|53 378|14 379|63 380|26 381|61 382|61 383|3 384|64 385|65 386|64 387|66 388|66 389|1 390|26 391|26 392|26 393|67 394|67 395|67 396|7 397|16 398|26 399|68 400|14 401|14 402|14 403|7 404|69 405|70 406|60 407|62 408|1 409|71 410|72 411|10 412|10 413|10 414|10 415|34 416|34 417|34 418|34 419|73 420|73 421|73 422|73 423|62 424|1 425|1 426|1 427|20 428|20 429|20 430|20 431|20 432|20 433|48 434|74 435|1 436|1 437|1 438|1 439|75 440|1 441|76 442|1 443|77 444|78 445|75 446|7 447|79 448|80 449|1 450|14 451|81 452|82 453|76 454|83 455|84 456|85 457|?? 458|?? 459|1 460|75 461|84 462|1 463|6 464|86 467|1 468|1 465|88 466|88 469|1 470|16 471|2 472|1 474|1 473|14 475|35 476| 1 477|1 478|1 479|1 480|14 481|13 482|87 483|14 484|1 485|1 486|7 487|7 488|7 489|7 491|9 492|90 490|89 493|4 494|4 495|1 496|91 497|2 498|1 499|26 500|67 501|2 502|8 503|5 504|2 505|35 506|35 507|1 508|1 509|20 510|2 511|92 512|92 513|92 514|93 515|14 516|16 517|16 518|94 519|16 520|2 521|29 522|29 523|95 524|96 525|97 526|98 527|17 528|17 529|17 530|17 531|17 532|1 533|66 534|99 535|100 536|101 537|84 538|14 539|102 540|103 541|99 542|99 543|99 544|99 545|99 546|99 547|99 548|99 549|99 550|99 551|99 552|99 553|99 554|99 555|99 556|99 557|99 558|99 559|99 560|99 561|99 562|99 563|99 564|99 565|104 566|36 567|105 568|105 569|106 570|106 571|106 572|1 573|102 574|102 575|107 576|1 577|1 578|108 579|108 580|88 581|1 582|109 583|2 589|2 584|110 585|1 586|111 587|1 588|16 590|112 591|101 592|1 593|1 594|1 595|75 596|107 597|29 598|113 599|2 600|75 601|1 602|114 603|99 604|115 605|1 606|1 607|116 608|117 609|20 610|20 611|75 612|117 613|62 614|113 615|75 616|1 617|118 618|119 619|29 620|29 621|2 622|1 623|120 624|117 625|121 626|121 627|121 628|121 629|122 630|75 631|122 633|75 632|84 634|1 635|1 636|113 637|16 638|1 639|1 640|1 641|123 642|84 643|123 644|112 645|1 646|7 647|7 648|7 649|7 650|124 651|125 652|7 653|67 654|126 655|25 656|127 657|127 658|128 659|129 660|1 661|1 662|1 663|130 664|131 665|130 666|131 667|130 668|131 669|68 670|126 671|1 672|132 673|133 674|133 675|1 676|1 677|134 678|134 679|134 680|1 681|16 682|1 683|135 684|1 685|1 686|1 687|136 688|137 689|137 690|137 691|138 692|138 693|138 694|139 695|139 696|139 697|140 698|141 699|142 700|143 701|144 702|144 703|144 704|145 705|75 706|1 707|140 708|142 709|1 710|1 711|1 712|1 713|146"},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Projectile-Field-Values 原版-弹幕字段值.md","filename":"Vanilla-Projectile-Field-Values 原版-弹幕字段值.md","title":"Vanilla-Projectile-Field-Values 原版-弹幕字段值","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"When learning to create mod Projectiles, it is beneficial learn the effect of various Projectile properties by seeing how vanilla projectiles achieve their desired effects. Below is a listing of the properties set for each vanilla Terraria Projectile. For example. If you wanted your mod Projectile to not collide with tiles like the Vilethorn, you could find the Vilethorn on the spreadsheet and find that the Vilethorn projectile sets tileCollide to false. From this, you learn that you can set your own projectile to not collide with tiles by setting tileCollide to false."},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-Tile-IDs 原版-物块ID表.md","filename":"Vanilla-Tile-IDs 原版-物块ID表.md","title":"Vanilla-Tile-IDs 原版-物块ID表","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following is a list of constants found in the Terraria.ID.TileID class. Simply use your browsers find function (ctrl f) to find the correct TileID . Most tile ids will be the English name of the tile, but there are exceptions. If you can't find the tile here, look them up on the and then find the TileID entry below. As a reminder you use these values either by writing or just , do NOT write : | Tile | ID/Type | | : | : | | Dirt | 0 | | Stone | 1 | | Grass | 2 | | Plants | 3 | | Torches | 4 | | Trees | 5 | | Iron | 6 | | Copper | 7 | | Gold | 8 | | Silver | 9 | | ClosedDoor | 10 | | OpenDoor | 11 | | Heart | 12 | | Bottles | 13 | | Tables | 14 | | Chairs | 15 | | Anvils | 16 | | Furnaces | 17 | | WorkBenches | 18 | | Platforms | 19 | | Saplings | 20 | | Containers | 21 | | Demonite | 22 | | CorruptGrass | 23 | | CorruptPlants | 24 | | Ebonstone | 25 | | DemonAltar | 26 | | Sunflower | 27 | | Pots | 28 | | PiggyBank | 29 | | WoodBlock | 30 | | ShadowOrbs | 31 | | CorruptThorns | 32 | | Candles | 33 | | Chandeliers | 34 | | Jackolanterns | 35 | | Presents | 36 | | Meteorite | 37 | | GrayBrick | 38 | | RedBrick | 39 | | ClayBlock | 40 | | BlueDungeonBrick | 41 | | HangingLanterns | 42 | | GreenDungeonBrick | 43 | | PinkDungeonBrick | 44 | | GoldBrick | 45 | | SilverBrick | 46 | | CopperBrick | 47 | | Spikes | 48 | | WaterCandle | 49 | | Books | 50 | | Cobweb | 51 | | Vines | 52 | | Sand | 53 | | Glass | 54 | | Signs | 55 | | Obsidian | 56 | | Ash | 57 | | Hellstone | 58 | | Mud | 59 | | JungleGrass | 60 | | JunglePlants | 61 | | JungleVines | 62 | | Sapphire | 63 | | Ruby | 64 | | Emerald | 65 | | Topaz | 66 | | Amethyst | 67 | | Diamond | 68 | | JungleThorns | 69 | | MushroomGrass | 70 | | MushroomPlants | 71 | | MushroomTrees | 72 | | Plants2 | 73 | | JunglePlants2 | 74 | | ObsidianBrick | 75 | | HellstoneBrick | 76 | | Hellforge | 77 | | ClayPot | 78 | | Beds | 79 | | Cactus | 80 | | Coral | 81 | | ImmatureHerbs | 82 | | MatureHerbs | 83 | | BloomingHerbs | 84 | | Tombstones | 85 | | Loom | 86 | | Pianos | 87 | | Dressers | 88 | | Benches | 89 | | Bathtubs | 90 | | Banners | 91 | | Lampposts | 92 | | Lamps | 93 | | Kegs | 94 | | ChineseLanterns | 95 | | CookingPots | 96 | | Safes | 97 | | SkullLanterns | 98 | | TrashCan | 99 | | Candelabras | 100 | | Bookcases | 101 | | Thrones | 102 | | Bowls | 103 | | GrandfatherClocks | 104 | | Statues | 105 | | Sawmill | 106 | | Cobalt | 107 | | Mythril | 108 | | HallowedGrass | 109 | | HallowedPlants | 110 | | Adamantite | 111 | | Ebonsand | 112 | | HallowedPlants2 | 113 | | TinkerersWorkbench | 114 | | HallowedVines | 115 | | Pearlsand | 116 | | Pearlstone | 117 | | PearlstoneBrick | 118 | | IridescentBrick | 119 | | Mudstone | 120 | | CobaltBrick | 121 | | MythrilBrick | 122 | | Silt | 123 | | WoodenBeam | 124 | | CrystalBall | 125 | | DiscoBall | 126 | | MagicalIceBlock | 127 | | Mannequin | 128 | | Crystals | 129 | | ActiveStoneBlock | 130 | | InactiveStoneBlock | 131 | | Lever | 132 | | AdamantiteForge | 133 | | MythrilAnvil | 134 | | PressurePlates | 135 | | Switches | 136 | | Traps | 137 | | Boulder | 138 | | MusicBoxes | 139 | | DemoniteBrick | 140 | | Explosives | 141 | | InletPump | 142 | | OutletPump | 143 | | Timers | 144 | | CandyCaneBlock | 145 | | GreenCandyCaneBlock | 146 | | SnowBlock | 147 | | SnowBrick | 148 | | HolidayLights | 149 | | AdamantiteBeam | 150 | | SandstoneBrick | 151 | | EbonstoneBrick | 152 | | RedStucco | 153 | | YellowStucco | 154 | | GreenStucco | 155 | | GrayStucco | 156 | | Ebonwood | 157 | | RichMahogany | 158 | | Pearlwood | 159 | | RainbowBrick | 160 | | IceBlock | 161 | | BreakableIce | 162 | | CorruptIce | 163 | | HallowedIce | 164 | | Stalactite | 165 | | Tin | 166 | | Lead | 167 | | Tungsten | 168 | | Platinum | 169 | | PineTree | 170 | | ChristmasTree | 171 | | Sinks | 172 | | PlatinumCandelabra | 173 | | PlatinumCandle | 174 | | TinBrick | 175 | | TungstenBrick | 176 | | PlatinumBrick | 177 | | ExposedGems | 178 | | GreenMoss | 179 | | BrownMoss | 180 | | RedMoss | 181 | | BlueMoss | 182 | | PurpleMoss | 183 | | LongMoss | 184 | | SmallPiles | 185 | | LargePiles | 186 | | LargePiles2 | 187 | | CactusBlock | 188 | | Cloud | 189 | | MushroomBlock | 190 | | LivingWood | 191 | | LeafBlock | 192 | | SlimeBlock | 193 | | BoneBlock | 194 | | FleshBlock | 195 | | RainCloud | 196 | | FrozenSlimeBlock | 197 | | Asphalt | 198 | | FleshGrass | 199 | | FleshIce | 200 | | FleshWeeds | 201 | | Sunplate | 202 | | Crimstone | 203 | | Crimtane | 204 | | CrimsonVines | 205 | | IceBrick | 206 | | WaterFountain | 207 | | Shadewood | 208 | | Cannon | 209 | | LandMine | 210 | | Chlorophyte | 211 | | SnowballLauncher | 212 | | Rope | 213 | | Chain | 214 | | Campfire | 215 | | Firework | 216 | | Blendomatic | 217 | | MeatGrinder | 218 | | Extractinator | 219 | | Solidifier | 220 | | Palladium | 221 | | Orichalcum | 222 | | Titanium | 223 | | Slush | 224 | | Hive | 225 | | LihzahrdBrick | 226 | | DyePlants | 227 | | DyeVat | 228 | | HoneyBlock | 229 | | CrispyHoneyBlock | 230 | | Larva | 231 | | WoodenSpikes | 232 | | PlantDetritus | 233 | | Crimsand | 234 | | Teleporter | 235 | | LifeFruit | 236 | | LihzahrdAltar | 237 | | PlanteraBulb | 238 | | MetalBars | 239 | | Painting3X3 | 240 | | Painting4X3 | 241 | | Painting6X4 | 242 | | ImbuingStation | 243 | | BubbleMachine | 244 | | Painting2X3 | 245 | | Painting3X2 | 246 | | Autohammer | 247 | | PalladiumColumn | 248 | | BubblegumBlock | 249 | | Titanstone | 250 | | PumpkinBlock | 251 | | HayBlock | 252 | | SpookyWood | 253 | | Pumpkins | 254 | | AmethystGemsparkOff | 255 | | TopazGemsparkOff | 256 | | SapphireGemsparkOff | 257 | | EmeraldGemsparkOff | 258 | | RubyGemsparkOff | 259 | | DiamondGemsparkOff | 260 | | AmberGemsparkOff | 261 | | AmethystGemspark | 262 | | TopazGemspark | 263 | | SapphireGemspark | 264 | | EmeraldGemspark | 265 | | RubyGemspark | 266 | | DiamondGemspark | 267 | | AmberGemspark | 268 | | Womannequin | 269 | | FireflyinaBottle | 270 | | LightningBuginaBottle | 271 | | Cog | 272 | | StoneSlab | 273 | | SandStoneSlab | 274 | | BunnyCage | 275 | | SquirrelCage | 276 | | MallardDuckCage | 277 | | DuckCage | 278 | | BirdCage | 279 | | BlueJay | 280 | | CardinalCage | 281 | | FishBowl | 282 | | HeavyWorkBench | 283 | | CopperPlating | 284 | | SnailCage | 285 | | GlowingSnailCage | 286 | | AmmoBox | 287 | | MonarchButterflyJar | 288 | | PurpleEmperorButterflyJar | 289 | | RedAdmiralButterflyJar | 290 | | UlyssesButterflyJar | 291 | | SulphurButterflyJar | 292 | | TreeNymphButterflyJar | 293 | | ZebraSwallowtailButterflyJar | 294 | | JuliaButterflyJar | 295 | | ScorpionCage | 296 | | BlackScorpionCage | 297 | | FrogCage | 298 | | MouseCage | 299 | | BoneWelder | 300 | | FleshCloningVat | 301 | | GlassKiln | 302 | | LihzahrdFurnace | 303 | | LivingLoom | 304 | | SkyMill | 305 | | IceMachine | 306 | | SteampunkBoiler | 307 | | HoneyDispenser | 308 | | PenguinCage | 309 | | WormCage | 310 | | DynastyWood | 311 | | RedDynastyShingles | 312 | | BlueDynastyShingles | 313 | | MinecartTrack | 314 | | Coralstone | 315 | | BlueJellyfishBowl | 316 | | GreenJellyfishBowl | 317 | | PinkJellyfishBowl | 318 | | ShipInABottle | 319 | | SeaweedPlanter | 320 | | BorealWood | 321 | | PalmWood | 322 | | PalmTree | 323 | | BeachPiles | 324 | | TinPlating | 325 | | Waterfall | 326 | | Lavafall | 327 | | Confetti | 328 | | ConfettiBlack | 329 | | CopperCoinPile | 330 | | SilverCoinPile | 331 | | GoldCoinPile | 332 | | PlatinumCoinPile | 333 | | WeaponsRack | 334 | | FireworksBox | 335 | | LivingFire | 336 | | AlphabetStatues | 337 | | FireworkFountain | 338 | | GrasshopperCage | 339 | | LivingCursedFire | 340 | | LivingDemonFire | 341 | | LivingFrostFire | 342 | | LivingIchor | 343 | | LivingUltrabrightFire | 344 | | Honeyfall | 345 | | ChlorophyteBrick | 346 | | CrimtaneBrick | 347 | | ShroomitePlating | 348 | | MushroomStatue | 349 | | MartianConduitPlating | 350 | | ChimneySmoke | 351 | | CrimtaneThorns | 352 | | VineRope | 353 | | BewitchingTable | 354 | | AlchemyTable | 355 | | Sundial | 356 | | MarbleBlock | 357 | | GoldBirdCage | 358 | | GoldBunnyCage | 359 | | GoldButterflyCage | 360 | | GoldFrogCage | 361 | | GoldGrasshopperCage | 362 | | GoldMouseCage | 363 | | GoldWormCage | 364 | | SilkRope | 365 | | WebRope | 366 | | Marble | 367 | | Granite | 368 | | GraniteBlock | 369 | | MeteoriteBrick | 370 | | PinkSlimeBlock | 371 | | PeaceCandle | 372 | | WaterDrip | 373 | | LavaDrip | 374 | | HoneyDrip | 375 | | FishingCrate | 376 | | SharpeningStation | 377 | | TargetDummy | 378 | | Bubble | 379 | | PlanterBox | 380 | | LavaMoss | 381 | | VineFlowers | 382 | | LivingMahogany | 383 | | LivingMahoganyLeaves | 384 | | CrystalBlock | 385 | | TrapdoorOpen | 386 | | TrapdoorClosed | 387 | | TallGateClosed | 388 | | TallGateOpen | 389 | | LavaLamp | 390 | | CageEnchantedNightcrawler | 391 | | CageBuggy | 392 | | CageGrubby | 393 | | CageSluggy | 394 | | ItemFrame | 395 | | Sandstone | 396 | | HardenedSand | 397 | | CorruptHardenedSand | 398 | | CrimsonHardenedSand | 399 | | CorruptSandstone | 400 | | CrimsonSandstone | 401 | | HallowHardenedSand | 402 | | HallowSandstone | 403 | | DesertFossil | 404 | | Fireplace | 405 | | Chimney | 406 | | FossilOre | 407 | | LunarOre | 408 | | LunarBrick | 409 | | LunarMonolith | 410 | | Detonator | 411 | | LunarCraftingStation | 412 | | SquirrelOrangeCage | 413 | | SquirrelGoldCage | 414 | | LunarBlockSolar | 415 | | LunarBlockVortex | 416 | | LunarBlockNebula | 417 | | LunarBlockStardust | 418 | | LogicGateLamp | 419 | | LogicGate | 420 | | ConveyorBeltLeft | 421 | | ConveyorBeltRight | 422 | | LogicSensor | 423 | | WirePipe | 424 | | AnnouncementBox | 425 | | TeamBlockRed | 426 | | TeamBlockRedPlatform | 427 | | WeightedPressurePlate | 428 | | WireBulb | 429 | | TeamBlockGreen | 430 | | TeamBlockBlue | 431 | | TeamBlockYellow | 432 | | TeamBlockPink | 433 | | TeamBlockWhite | 434 | | TeamBlockGreenPlatform | 435 | | TeamBlockBluePlatform | 436 | | TeamBlockYellowPlatform | 437 | | TeamBlockPinkPlatform | 438 | | TeamBlockWhitePlatform | 439 | | GemLocks | 440 | | FakeContainers | 441 | | ProjectilePressurePad | 442 | | GeyserTrap | 443 | | BeeHive | 444 | | PixelBox | 445 | | SillyBalloonPink | 446 | | SillyBalloonPurple | 447 | | SillyBalloonGreen | 448 | | SillyStreamerBlue | 449 | | SillyStreamerGreen | 450 | | SillyStreamerPink | 451 | | SillyBalloonMachine | 452 | | SillyBalloonTile | 453 | | Pigronata | 454 | | PartyMonolith | 455 | | PartyBundleOfBalloonTile | 456 | | PartyPresent | 457 | | SandFallBlock | 458 | | SnowFallBlock | 459 | | SnowCloud | 460 | | SandDrip | 461 | | DjinnLamp | 462 | | DefendersForge | 463 | | WarTable | 464 | | WarTableBanner | 465 | | ElderCrystalStand | 466 | | Containers2 | 467 | | FakeContainers2 | 468 | | Tables2 | 469 | | DisplayDoll | 470 | | WeaponsRack2 | 471 | | IronBrick | 472 | | LeadBrick | 473 | | LesionBlock | 474 | | HatRack | 475 | | GolfHole | 476 | | GolfGrass | 477 | | CrimstoneBrick | 478 | | SmoothSandstone | 479 | | BloodMoonMonolith | 480 | | CrackedBlueDungeonBrick | 481 | | CrackedGreenDungeonBrick | 482 | | CrackedPinkDungeonBrick | 483 | | RollingCactus | 484 | | AntlionLarva | 485 | | DrumSet | 486 | | PicnicTable | 487 | | FallenLog | 488 | | PinWheel | 489 | | WeatherVane | 490 | | VoidVault | 491 | | GolfGrassHallowed | 492 | | GolfCupFlag | 493 | | GolfTee | 494 | | ShellPile | 495 | | AntiPortalBlock | 496 | | Toilets | 497 | | Spider | 498 | | LesionStation | 499 | | SolarBrick | 500 | | VortexBrick | 501 | | NebulaBrick | 502 | | StardustBrick | 503 | | MysticSnakeRope | 504 | | GoldGoldfishBowl | 505 | | CatBast | 506 | | GoldStarryGlassBlock | 507 | | BlueStarryGlassBlock | 508 | | VoidMonolith | 509 | | ArrowSign | 510 | | PaintedArrowSign | 511 | | GreenMossBrick | 512 | | BrownMossBrick | 513 | | RedMossBrick | 514 | | BlueMossBrick | 515 | | PurpleMossBrick | 516 | | LavaMossBrick | 517 | | LilyPad | 518 | | Cattail | 519 | | FoodPlatter | 520 | | BlackDragonflyJar | 521 | | BlueDragonflyJar | 522 | | GreenDragonflyJar | 523 | | OrangeDragonflyJar | 524 | | RedDragonflyJar | 525 | | YellowDragonflyJar | 526 | | GoldDragonflyJar | 527 | | MushroomVines | 528 | | SeaOats | 529 | | OasisPlants | 530 | | BoulderStatue | 531 | | MaggotCage | 532 | | RatCage | 533 | | KryptonMoss | 534 | | KryptonMossBrick | 535 | | XenonMoss | 536 | | XenonMossBrick | 537 | | LadybugCage | 538 | | ArgonMoss | 539 | | ArgonMossBrick | 540 | | EchoBlock | 541 | | OwlCage | 542 | | PupfishBowl | 543 | | GoldLadybugCage | 544 | | LawnFlamingo | 545 | | Grate | 546 | | PottedPlants1 | 547 | | PottedPlants2 | 548 | | Seaweed | 549 | | TurtleCage | 550 | | TurtleJungleCage | 551 | | Sandcastles | 552 | | GrebeCage | 553 | | SeagullCage | 554 | | WaterStriderCage | 555 | | GoldWaterStriderCage | 556 | | GrateClosed | 557 | | SeahorseCage | 558 | | GoldSeahorseCage | 559 | | GolfTrophies | 560 | | MarbleColumn | 561 | | BambooBlock | 562 | | LargeBambooBlock | 563 | | PlasmaLamp | 564 | | FogMachine | 565 | | AmberStoneBlock | 566 | | GardenGnome | 567 | | PinkFairyJar | 568 | | GreenFairyJar | 569 | | BlueFairyJar | 570 | | Bamboo | 571 | | SoulBottles | 572 | | TatteredWoodSign | 573 | | BorealBeam | 574 | | RichMahoganyBeam | 575 | | GraniteColumn | 576 | | SandstoneColumn | 577 | | MushroomBeam | 578 | | RockGolemHead | 579 | | HellButterflyJar | 580 | | LavaflyinaBottle | 581 | | MagmaSnailCage | 582 | | TreeTopaz | 583 | | TreeAmethyst | 584 | | TreeSapphire | 585 | | TreeEmerald | 586 | | TreeRuby | 587 | | TreeDiamond | 588 | | TreeAmber | 589 | | GemSaplings | 590 | | PotsSuspended | 591 | | BrazierSuspended | 592 | | VolcanoSmall | 593 | | VolcanoLarge | 594 | | VanityTreeSakuraSaplings | 595 | | VanityTreeSakura | 596 | | TeleportationPylon | 597 | | LavafishBowl | 598 | | AmethystBunnyCage | 599 | | TopazBunnyCage | 600 | | SapphireBunnyCage | 601 | | EmeraldBunnyCage | 602 | | RubyBunnyCage | 603 | | DiamondBunnyCage | 604 | | AmberBunnyCage | 605 | | AmethystSquirrelCage | 606 | | TopazSquirrelCage | 607 | | SapphireSquirrelCage | 608 | | EmeraldSquirrelCage | 609 | | RubySquirrelCage | 610 | | DiamondSquirrelCage | 611 | | AmberSquirrelCage | 612 | | PottedLavaPlants | 613 | | PottedLavaPlantTendrils | 614 | | VanityTreeWillowSaplings | 615 | | VanityTreeYellowWillow | 616 | | MasterTrophyBase | 617 | | AccentSlab | 618 | | TruffleWormCage | 619 | | EmpressButterflyJar | 620 | | SliceOfCake | 621 | | TeaKettle | 622 | | PottedCrystalPlants | 623 | | AbigailsFlower | 624 | | VioletMoss | 625 | | VioletMossBrick | 626 | | RainbowMoss | 627 | | RainbowMossBrick | 628 | | StinkbugCage | 629 | | StinkbugHousingBlocker | 630 | | StinkbugHousingBlockerEcho | 631 | | ScarletMacawCage | 632 | | AshGrass | 633 | | TreeAsh | 634 | | AshWood | 635 | | CorruptVines | 636 | | AshPlants | 637 | | AshVines | 638 | | ManaCrystal | 639 | | BlueMacawCage | 640 | | ReefBlock | 641 | | ChlorophyteExtractinator | 642 | | ToucanCage | 643 | | YellowCockatielCage | 644 | | GrayCockatielCage | 645 | | ShadowCandle | 646 | | LargePilesEcho | 647 | | LargePiles2Echo | 648 | | SmallPiles2x1Echo | 649 | | SmallPiles1x1Echo | 650 | | PlantDetritus3x2Echo | 651 | | PlantDetritus2x2Echo | 652 | | PotsEcho | 653 | | TNTBarrel | 654 | | PlanteraThorns | 655 | | GlowTulip | 656 | | EchoMonolith | 657 | | ShimmerMonolith | 658 | | ShimmerBlock | 659 | | ShimmerflyinaBottle | 660 | | CorruptJungleGrass | 661 | | CrimsonJungleGrass | 662 | | Moondial | 663 | | BouncyBoulder | 664 | | LifeCrystalBoulder | 665 | | PoopBlock | 666 | | ShimmerBrick | 667 | | DirtiestBlock | 668 | | LunarRustBrick | 669 | | DarkCelestialBrick | 670 | | AstraBrick | 671 | | CosmicEmberBrick | 672 | | CryocoreBrick | 673 | | MercuryBrick | 674 | | StarRoyaleBrick | 675 | | HeavenforgeBrick | 676 | | AncientBlueBrick | 677 | | AncientGreenBrick | 678 | | AncientPinkBrick | 679 | | AncientGoldBrick | 680 | | AncientSilverBrick | 681 | | AncientCopperBrick | 682 | | AncientObsidianBrick | 683 | | AncientHellstoneBrick | 684 | | AncientCobaltBrick | 685 | | AncientMythrilBrick | 686 | | LavaMossBlock | 687 | | ArgonMossBlock | 688 | | KryptonMossBlock | 689 | | XenonMossBlock | 690 | | VioletMossBlock | 691 | | RainbowMossBlock | 692 | | Count | 693 |"},{"path":"螺线翻译tml教程/原版代码文档/Vanilla-World-Generation-Steps 原版-世界生成顺序.md","filename":"Vanilla-World-Generation-Steps 原版-世界生成顺序.md","title":"Vanilla-World-Generation-Steps 原版-世界生成顺序","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following is a list of the names of the world generation steps in order. Use these names to select world generation steps to either remove or position custom world generation steps while utilizing . Don't count the steps and use that hard coded index to modify world generation, other mods that execute before your mod might have already modified the list and the index could be off. | World generation step | : | Reset | | Terrain | | Dunes | | Ocean Sand | | Sand Patches | | Tunnels | | Mount Caves | | Dirt Wall Backgrounds | | Rocks In Dirt | | Dirt In Rocks | | Clay | | Small Holes | | Dirt Layer Caves | | Rock Layer Caves | | Surface Caves | | Wavy Caves | | Generate Ice Biome | | Grass | | Jungle | | Mud Caves To Grass | | Full Desert | | Floating Islands | | Mushroom Patches | | Marble | | Granite | | Dirt To Mud | | Silt | | Shinies | | Webs | | Underworld | | Corruption | | Lakes | | Dungeon | | Slush | | Mountain Caves | | Beaches | | Gems | | Gravitating Sand | | Create Ocean Caves | | Shimmer | | Clean Up Dirt | | Pyramids | | Dirt Rock Wall Runner | | Living Trees | | Wood Tree Walls | | Altars | | Wet Jungle | | Jungle Temple | | Hives | | Jungle Chests | | Settle Liquids | | Remove Water From Sand | | Oasis | | Shell Piles | | Smooth World | | Waterfalls | | Ice | | Wall Variety | | Life Crystals | | Statues | | Buried Chests | | Surface Chests | | Jungle Chests Placement | | Water Chests | | Spider Caves | | Gem Caves | | Moss | | Temple | | Cave Walls | | Jungle Trees | | Floating Island Houses | | Quick Cleanup | | Pots | | Hellforge | | Spreading Grass | | Surface Ore and Stone | | Place Fallen Log | | Traps | | Piles | | Spawn Point | | Grass Wall | | Guide | | Sunflowers | | Planting Trees | | Herbs | | Dye Plants | | Webs And Honey | | Weeds | | Glowing Mushrooms and Jungle Plants | | Jungle Plants | | Vines | | Flowers | | Mushrooms | | Gems In Ice Biome | | Random Gems | | Moss Grass | | Muds Walls In Jungle | | Larva | | Settle Liquids Again | | Cactus, Palm Trees, & Coral | | Tile Cleanup | | Lihzahrd Altars | | Micro Biomes | | Water Plants | | Stalac | | Remove Broken Traps | | Final Cleanup |"},{"path":"螺线翻译tml教程/原版代码文档/杂项/Item-Class-Documentation Item类 文档.md","filename":"Item-Class-Documentation Item类 文档.md","title":"Item-Class-Documentation Item类 文档","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Item Class Documentation This page lists common methods and fields pertaining to the class. This page is useful for understanding what to use in . Only common fields and methods are listed. The should be consulted for a full listing of methods and fields not listed here. You can also see the names and documentation for these methods and fields directly in your once it is setup correctly. Index| | | | Fields and Properties You can assign these fields to give your various values. Typically you'll want to refer to this page when writing code for . Be sure to visit to see what values vanilla items use for these fields. All fields listed are public unless otherwise noted. | Field | Type | Default Value | Description | | | | | | | | int | 0 | Value is the number of copper coins the item is worth (aka, cost to buy from a merchant). Setting it to 10462 would mean the item cost 1 gold, 4 silver, and 62 copper. The sell price of an item is one fifth of its value. Value also influences reforge costs with the goblin tinkerer. For convenience, you can also use the method for setting values: You can also use the method if you would rather think about an items value the other way. Both and would set the value to 1055. | | | int | 0 | The use style of your item: 1 for swinging, 2 for drinking, 3 act like shortsword, 4 for use like life crystal, 5 for use staffs or guns | | | bool | false | Whether the player can turn around while the using animation is happening. | | |bool | false| Whether the item is in continuous use while the mouse button is held down. | | | int|0 | The hold style of your item: 1 for holding out (torches and glowsticks) 2 for holding up (Breathing Reed) 3 for a different version of holding out (Magical Harp) | | | int|100 | The time span of the using animation for the item. Recommended to be the same at useTime as this is only the animation. Blocks use 15. Default value is 100. Terraria runs at 60 frames per second, so 15 is 1/4th of a second. | | |int |100 | The time span of using the item in frames. Blocks use 10. Default value is 100. Weapons usually have equal useAnimation and useTime, unequal values for these two results in multiple attacks per click. See . | | |int | 0| A delay in frames added at the end of the using animation for the item, during which the player wont be able to use any items. | | |bool |false | Whether the item is consumed after use. | | | int|0 | Range from 1 to 13. Check wiki link for respective colors: https://terraria.wiki.gg/wiki/Rarity. You can use for convenience: , | | |int | 1| The maximum number of items that can be contained within a single stack. | | | int |0 | The width of the dropped item's hitbox in pixels. | | |int | 0| The height of the dropped item's hitbox in pixels. | | | float | 1f | The size multiplier of the item's sprite while the item is being used. Also increases range for melee weapons. | | | int | 1 | The ID of the tile this item places on use. | | | int | 0| The style of the tile being placed. Used for tiles that have a different look depending on the item used to place them. | | | int | 1 | The ID of the wall this item places on use. | | |LegacySoundStyle | null | The sound that your item makes when used. Ex: | | |int | 1| The base damage inflicted by the item. | | |float | 0f| The force of the knock back. Max value is 20. | | |int | 0 | The ID of the projectile that is fired by the item on use. If this weapon uses useAmmo, then this value is ignored as the projectile will be decided by the ammo item, but shoot should still be 10 by convention. | | | float| 0f| The velocity in pixels the projectile fired by the item will have. Actual velocity depends on the projectile being fired. If your weapon is shooting projectiles and they are stationary, change this to something like 10f. Throwing Knife uses 10f. Held projectiles like Vortex Beater use shootSpeed to determine how far away from the player to hold the projectile. | | | bool |false | If true, the item's using animation will not deal damage. Set to true on most weapons that aren't swords. | | |bool |false | Whether the item is an accessory. | | | bool | false | The type of damage this item deals, if it is a weapon. | | | int | 0| These 3 correspond to the power, but axe power is multiplied by 5, so adjust accordingly. | | |int |0 | The amount of defense this item provides when equipped, either as an accessory or armor. | | | int |0 | The base critical chance for this item. Remember that the player has a base crit chance of 4. | | | bool | false| If true, the item's sprite will not be visible while the item is in use. | | | int | AmmoID.None (0) | The ID of the ammo used by this item. See | | | int | AmmoID.None (0) | The ID of the ammo class this item is part of. See | | |bool | false | If true and the item is ammo, the item will not count as ammo for certain ammo specific behavior, such as the tooltip mentioning the item is ammo, or ammo items going into ammo slots first when picked up. Used for the Coin items, Ale, and Wire. | | | int | 0 | The amount of mana this item consumes on use. | | |bool | false | Used for items that have special behavior when the attack button is held. | | | bool | false | If true, this item will inflict potion sickness on use. Also determines whether the item cannot be used when the player has potion sickness, and if the item can be used with the Quick Heal key. | | | int |0 | The amount of life this item heals on use. | | | int |0 | The amount of mana this item heals on use. | | | int |0 | The ID of the buff given by this item on use. To have a potion give multiple buffs, assign one buff here and in , call for the remaining buffs you wish to give. Make sure to set as well or the buff will instantly disappear. | | | int |0 | The duration in ticks of the buff given by this item on use. | | |bool |false | Signifies that this item is an expert mode item. | | |int | 0| Correspond to fishing power of bait or poles respectively. | | |bool |false | Whether this item's tooltip will mention it is a quest item. | | | bool |false | Whether this item will show wires when held. | | | bool | false | If this item is a an ingredient in any recipe. Automatically assigned. | | | sbyte| 1 | These values indicate which equipment slots the accessory or armor will show. These slots correspond the the textures that are shown while equipped. tModLoader automatically will assign your item the correct values based on the AutoloadEquip attribute. | | Field | Type | Default Value | Description | | | | | | | |bool |false | | | |ItemTooltip|null | | | |bool |true | If false, this item is empty regardless of other values set. | | | int|0 | | | | bool|false | | | | bool|false | | | | Color|Transparent| Draws the item sprite with a colored tint. Gel and Sharkfin use this to spawn different colored items from the same ItemID. needs to be used to sync this if not done in SetDefaults. | | |byte |0 | | | | bool|false | If true, the accessory won't give any effects unless the world is in Expert mode. | | | bool|false | If the item has been marked as favorited in the inventory. | | | bool|false | | | |short | 1 | | | |short | 1 | | | |bool |false | | | |bool |false | | | |int | 0| | | |short |0 | Spawns the specified NPCID. | | |int |0 | | | |int | 1| Specifies which mount to equip when the item is used. See | | |int |0 | Don't use. | | |bool |false | | | |byte |0 | | | |byte |0 | | | |int |0 | | | | bool|false | | | |int? |null | Use in to assign a custom price for an item regardless of the value field. Use with to use a custom currency rather than coins. See | | |int | 1 | Used in conjunction with to specify a custom currency. See and | | |int |1 | Current stack of the Item. | | |int | 1 | Specifies the use range of a Tool | | |int |0 | | | |int |0 | This is the ItemID, automatically set. | | | bool|false | | | | bool|false | Specifies that an armor is a vanity item. | | | bool|false | | | |int|0 | | | | | | | Static Fields Static fields are accessed by the classname, not the instance. For example, we write to check if an item is marked as a staff. Set these values in . | Field | Type | Default Value | Description | | | | | | | | bool[] | false | Indexed by ItemID. This makes the useStyle animate as a staff instead of as a gun. See . If the staff doesn't rotate, make sure is not 0. | | | | | | tModLoader Only | Field | Type | Default Value | Description | | | | | | | | ModItem | null | The ModItem instance that controls the behavior of this item. This property is null if this is not a modded item. | | | internal GlobalItem[] | new GlobalItem[0] | Do not touch. Use | | | | | | Methods Remember that static methods are called by writing the classname and non static methods use the instance name. vs public static int NewItem(int X, int Y, int Width, int Height, int Type, int Stack = 1, bool noBroadcast = false, int pfix = 0, bool noGrabDelay = false, bool reverseLookup = false) Spawns an item in the world. Commonly seen used in ModNPC.NPCLoot. X, Y, Width, and Height are commonly derived from the npc. This method should not be called on multiplayer clients. If you need to spawn items from client code, use , it handles the multiplayer syncing code needed. Example: public static int NewItem(Rectangle rectangle, int Type, int Stack = 1, bool noBroadcast = false, int prefixGiven = 0, bool noGrabDelay = false, bool reverseLookup = false) This alternate method signature can simplify code. Example: tModLoader Only public GlobalItem GetGlobalItem(Mod mod, string name) Gets the GlobalItem instance (with the given name and added by the given mod) associated with this item instance. public T GetGlobalItem (Mod mod) where T : GlobalItem Same as the other GetGlobalItem, but assumes that the class name and internal name are the same. public T GetGlobalItem () where T : GlobalItem Same as the other GetGlobalItem, but assumes that the class name and internal name are the same, as well as the Mod. This is the one you should use 99% of the time. public void CloneDefaults(int type) Allows you to copy the defaults of a different type of item."},{"path":"螺线翻译tml教程/原版代码文档/杂项/NPC-Class-Documentation NPC类 文档.md","filename":"NPC-Class-Documentation NPC类 文档.md","title":"NPC-Class-Documentation NPC类 文档","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"NPC Class Documentation This page lists methods and fields pertaining to the class. This page is useful for understanding what to use in and . Only common fields and methods are listed. The should be consulted for a full listing of methods and fields not listed here. You can also see the names and documentation for these methods and fields directly in your once it is setup correctly. Index| | | | Fields and Properties You can assign these fields to give your various values. Typically you'll want to refer to this page when writing code for and . Be sure to visit to see what values vanilla npc use for these fields. All fields listed are public unless otherwise noted. | Field | Type | Default Value | Description | | | | | | | | int | 0 | The width of the npc hitbox | | | int | 0 | The height of the npc hitbox | | | int | 0 ( 1 for ModNPC) | Determines which AI code to run. Many NPC share the same AI code by having the same aiStyle. ModNPC can utilize vanilla aiStyle values in addition to ModNPC.aiType to mimic vanilla behavior to some degree. If you wish to further customize the AI of a ModNPC, you should read . If you are using completely custom AI, set this to 1 since an aiStyle of 0 will face the player automatically, which may interfere with your logic. | | | int | 0 | The amount of damage this NPC will deal on collision. Usually npc.damage is scaled by some factor when NPC spawn projectiles with Projectile.NewProjectile in AI code. For example, passing in as the Damage parameter. | | | int | 0 | Stores the value of at the end of SetDefaults. Useful for scaling damage in AI code. | | | int | 0 | How resistant to damage this NPC is. | | | int | 0 | Stores the value of at the end of SetDefaults. Useful for scaling defense in AI code, like how King Slime changes defense as it gets smaller. | | | int | 0 | The maximum life of this NPC. | | | int | 0 | The current life of the NPC. Automatically assigned to lifeMax at the end of SetDefaults. | | | int | 1 | This value is used for multi part npcs that share life while maintaining separate hitboxes. This is useful for worm enemies. The value represents the index in of the npc that has the actual life for this multi part npc. All the segments will point to the same npc, usually the \"head\" of the npc, and the head and all other non multi part npcs will have the default value of 1 still. | | | LegacySoundStyle | null | The sound that plays when this npc is hit. | | | LegacySoundStyle | null | The sound that plays when this npc dies. | | | int | 0 | 0 is opaque, and 255 is transparent. This is the opposite of typical representations of alpha in computer graphics, so be aware of that. | | | Color | | | | | float | 0f | How many copper coins the NPC will drop when killed (100 copper coins = 1 silver coin etc.). | | | int | 0 | How rare the NPC is for the Lifeform Analyzer. 4 is for Tim and Mimics, 1 is for bound town NPCs. | | | int[] | all 0 | This determines if an NPC can be hit by a item or projectile owned by a particular player (it is an array, each slot corresponds to different players (whoAmI)). It is decremented towards 0 every update. Melee items set immune[player.whoAmI] to player.itemAnimation, which starts at item.useAnimation and decrements towards 0. Penetrating projectiles usually set immune to 10, while non penetrating projectiles do not set immune. ExampleAnimatedPierce.cs explains more about options for npc and projectile immunity. | | | bool[] | all false | Make the NPC immune to buffs/debuffs. Example: | | | float | 1f | How much of the knockback it receives will actually apply. 1f: full knockback; 0f: no knockback. | | | float | 1f | Makes the NPC bigger or smaller. Bigger than 1f = bigger. | | | bool | false | If true, the npc counts as a town NPC. Has multiple implications (i.e. npc shop, housing, hostile spawn rate reduction). | | | bool | false | If true, the npc will not be affected by gravity. Demon Eyes and other floating npc use this. | | | bool | false | If true, the npc does not collide with tiles, making the npc pass through tiles freely. Meteor Head and Worm npc use this. | | | float | 1f | Represents how much this npc counts towards the npc spawn limit. Small critters like worms or flys have values around .1f and .25. Enemies that are more difficult than normal have values higher than 1f, and bosses and mini bosses have values around 6. Proper npcSlots values help balance the game and prevents the player from randomly being overwhelmed by powerful enemies. Check the spreadsheets to determine a suitable value for your NPC. | | | bool | false | Set to true if the NPC is a boss. Prevents off screen despawn. | | | bool | false | If true, makes sure that this NPC is always synced in multiplayer for newly joined players (same happens if it's a boss or townNPC). | | | | | | Static Fields Static fields are accessed by the classname, not the instance. For example, we write to check if Plantera has been defeated yet. | Field | Type | Default Value | Description | | | | | | | | int[] | 0 | Indexed by BannerID. Returns how many kills of the specified BannerID have been killed. Many NPC can share the same BannerID and many NPC actually don't have a Banner ID at all. This code will retrieve the bannerID of an NPC, or 1 if it does not exist: | | | bool | false | These values indicate which NPC have been found in the wild. You can use these in various conditions in your mod. | | | bool | false | These values indicate which bosses have been defeated in the world. Most are self explanitory. refers to Eye of Cthulu, refers to either Brain of Cthulhu or Eater of Worlds, and referes to Skeletron. 1, 2, and 3 refer to The Destroyer, The Twins, and Skeletron Prime respectively. | tModLoader Only | Field | Type | Default Value | Description | | | | | | | | ModNPC | null | The ModNPC instance that controls the behavior of this NPC. This property is null if this is not a modded NPC. | | | internal GlobalNPC[] | new GlobalNPC[0] | Do not touch. Use | | | | | | Methods Remember that static methods are called by writing the classname and non static methods use the instance name. vs public static int NewNPC(int X, int Y, int Type, int Start = 0, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f, float ai3 = 0f, int Target = 255) Spawns an NPC in the world. Use this to spawn minions from bosses. Example: The parameters can initialize an NPC with particular data if needed for special AI behavior. public static bool AnyNPCs(int Type) Returns true if there are any NPC of the supplied type alive in the world. Useful for boss spawning items or anytime you need to check if an NPC is alive. Example: public static int CountNPCS(int Type) Same as except returns the number of active NPC of the supplied type. public static int FindFirstNPC(int Type) Returns the index of the first NPC of the supplied type. Returns 1 if not found. Use to index into to get the NPC instance. public static void SpawnOnPlayer(int plr, int Type) Spawns a boss somewhere off screen of the specified player. This is the most common way of spawning bosses. tModLoader Only public GlobalNPC GetGlobalNPC(Mod mod, string name) Gets the GlobalNPC instance (with the given name and added by the given mod) associated with this npc instance. public T GetGlobalNPC (Mod mod) where T : GlobalNPC Same as the other GetGlobalNPC, but assumes that the class name and internal name are the same. public T GetGlobalNPC () where T : GlobalNPC Same as the other GetGlobalNPC, but assumes that the class name and internal name are the same, as well as the Mod. This is the one you should use 99% of the time. public void CloneDefaults(int type) Allows you to copy the defaults of a different type of NPC."},{"path":"螺线翻译tml教程/原版代码文档/杂项/NetMessage-Class-Documentation NetMessage类 文档.md","filename":"NetMessage-Class-Documentation NetMessage类 文档.md","title":"NetMessage-Class-Documentation NetMessage类 文档","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This page is Outdated Some of this page's contents contain outdated 1.3 information. The up to date information is contained in the and the pages. NetMessage Class Documentation This page lists methods pertaining to the class. You can consult this page to get a better understanding of how works. If you want to create custom netcode for your mod, this page is not relevant, see and for that. Index| | | | | Fields doesn't use very many fields due to most of the information being stored in its instances. | Field | Type | Description | | | | | | | MessageBuffer[257] | Where all outgoing/incoming netcode data is stored. Index 256 corresponds to this client's NetMessage uses, the rest of the indices are directly tied to each player in and client in . | | | PlayerDeathReason | Used when sending player hurt/kill netcode data. | Methods All netcode data is sent via the method. However, does have several other methods for more specific purposes. public static void SendChatMessageToClient(NetworkText text, Color color, int playerId) Sends a text packet to the client player with the given . public static void BroadcastChatMessage(NetworkText text, Color color, int excludedPlayer = 1) Like , but the packet is sent to all players and, optionally, ignores a certain player. public static void SendChatMessageFromClient(ChatMessage text) Sends a text packet from this client's player to the server. public static void SendData(int msgType, int remoteClient = 1, int ignoreClient = 1, NetworkText text = null, int number = 0, float number2 = 0f, float number3 = 0f, float number4 = 0f, int number5 = 0, int number6 = 0, int number7 = 0) Sends netcode data from this client to the server or vice versa. Covered in more detail in the . public static void SendObjectPlacment(int whoAmi, int x, int y, int type, int style, int alternative, int random, int direction) Shorthand for . is 1 and is if this message is sent from the server and vice versa if this message is sent from a client. public static void SendTemporaryAnimation(int whoAmi, int animationType, int tileType, int xCoord, int yCoord) Shorthand for . public static void SendTileRange(int whoAmi, int tileX, int tileY, int xSize, int ySize, TileChangeType changeType = TileChangeType.None) Use this method to update a certain area of tiles. Has more control over the specified area than . Shorthand for . (tileX, tileY) is the top left corner of the tile square. is set to the max of and . public static void SendTileSquare(int whoAmi, int tileX, int tileY, int size, TileChangeType changeType = TileChangeType.None) Use this method to update a certain area of tiles. Shorthand for . (tileX, tileY) is the center for the tile square. is set to . The \"center\" is biased towards the top left of the tile square. For example, passing in for will have the top left tile in the square be at (9, 9). However, passing in for will have the top left tile in the square be at (8, 8), which makes sense since the square has odd numbered edges. public static void SendTravelShop(int remoteClient) Informs a certain client of the Travelling Merchant's current shop. If this game is a server instance, this method is a shorthand for . Otherwise, it does nothing. public static void SendAnglerQuest(int remoteClient) Informs all clients or a specific client of the current Angler quest. If this game isn't a server instance, this method does nothing. public static void SendSection(int whoAmi, int sectionX, int sectionY, bool skipSent = false) Useful for loading a specific section of the map for multiplayer purposes. Sections are 200 by 150 tile \"chunks\" of the world map. If this game isn't a server instance, this method does nothing. Otherwise, if the given section of the map isn't loaded for the client , the section is loaded and all NPCs inside the section send their info to that client. public static void sendWater(int x, int y) For each client, if the tile at is in one of the client's loaded sections of the map, said client is informed that that tile's liquid properties were changed. NetMessage.SendData() public static void SendData(int msgType, int remoteClient = 1, int ignoreClient = 1, NetworkText text = null, int number = 0, float number2 = 0f, float number3 = 0f, float number4 = 0f, int number5 = 0, int number6 = 0, int number7 = 0) is the God method for NetMessage, meaning it does anything and everything for sending netcode data. Below is the documentation for each valid message type, their names, and what data is sent: MessageID.NeverCalled (0) Unused. Plain and simple. MessageID.Hello (1) The first step of client connection to a server. Client state: 0 1 Vanilla sends the version string . tModLoader sends the version string instead. If the client is banned or the client's version string does not match the server's version string, the client is immediately kicked with the appropriate message. If the server has a password, the client sends a message. If the server does not have a password, the client sends a message instead. If the server accepts vanilla clients and the client sent a vanilla version string, tModLoader flags the client as a vanilla client and communicates using an unmodified protocol. If the client is not flagged as a vanilla client, the client sends a message instead of a message. | Type(s) | Size | Description | | | | | | byte | 1 | MessageID.ClientHello | | string | ? | ModLoader.versionedName | | byte, string | ? | NetMessage.SendData, message type ; only sent if the client is banned, the client's version number doesn't match the server's version number or if the client is using a vanilla client and is false | | byte, short, ? | ? | NetMessage.SendData, message type ; only sent if the server doesn't use a password | | ? | ? | NetMessage.SendData, message type ; only sent if the server uses a password | MessageID.Kick (2) Kicks the client player whose equals with the given reason . | Type(s) | Size | Description | | | | | | byte | 1 | MessageID.Kick| | byte, string | ? | Information about the used for preparing data to send as well as the reason provided for the kick | MessageID.PlayerInfo (3) The next two steps of client connection to a server. Client state: 1 2 The client sends , , , , and various messages. The final messages are sent for the player's main inventory, armor/accessories, equipped dyes, miscellaneous accessories, miscellaneous dyes, Piggy Bank inventory, Safe inventory, trash item slot and Defender's Forge inventory. tModLoader then calls . The client then sends a message. Client state: 2 3 | Type(s) | Size | Description | | | | | | | 1 | MessageID.LoadPlayer | | | 1 | remoteClient; the client's | | ? | ? | NetMessage.SendData, message type | | ? | ? | NetMessage.SendData, message type | | ? | ? | NetMessage.SendData, message type | | ? | ? | NetMessage.SendData, message type | | ? | ? | NetMessage.SendData, message type | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's main inventory | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's armor and accessory slots | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's equipped dye slots | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's miscellaneous accessory slots (pet, light pet, hook, minecart, mount) | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's miscellaneous dye slots (for the miscellaneous accessories) | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's Piggy Bank inventory | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's Safe inventory | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for the client player's trash item slot | | , , ? | 7 + modded data | NetMessage.SendData, message type ; called for each item in the client player's Defender's Forge inventory | | none | 0 | NetMessage.SendData, message type | MessageID.SyncPlayer (4) Sends information abount a player. The parameter is the player to sync information from. | Type(s) | Size | Description | | | | | | |1| , the to sync information from, cast to | | |1| , cast to | | |1| , cast to | | |?| | | |4| , only if vanilla clients are allowed| | |4| , only if vanilla clients are not allowed, cast to | | |2| , normally a but sent as a using bitshift wizardry| | |1| | | |1| | | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |3| , written as 3 s of the color's , and values| | |1| and sent as a | | |1| , , , and sent as a . | | |1| , , , , , and sent as a . | MessageID.SyncEquipment (5) Sends information about a slot in one of the player's inventory arrays. The slot to process is determined by the following table: | Indices | Inventory | | | | (Main inventory slots) | | (vanilla armor, accessory and vanity slots) | | (vanilla dye slots) | | (pet, light pet, hook, minecart, mount slots) | | (vanilla dye slots for items) | | (Piggy Bank slots) | | (Safe slots) | | (Trash slot) | | (Defender's Forge slots) | | (Void Vault slots) The parameter is the player to retrieve information from and the parameter is which slot to sync. For ease of use, here's a list of constants that can be used to make using this message more readable: Examples: NOTE: There is no bounds check for providing a slot beyond 260 ( + 40 capacity), so this message will throw an exception if the slot is too large. Furthermore, this message does not support syncing modded accessory slots. MessageID.RequestWorldData (6) // TODO MessageID.WorldData (7) Sends information about the world to the server and/or other clients. Use this whenever anything about the world has changed, including, but not limited to, the time of day and weather. | Type(s) | Size | Description | | | | | 4 | | | 1 | A set to the values of , and | | 1 | | | 2 | | | 2 | | | 2 | | | 2 | | | 2 | | | 2 | | | 4 | | | ? | | | ? | The return value of | | 8 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 1 | | | 4 | | | 1 | | | 12 | The contents of | | 4 | The contents of , each cast to | | 12 | The contents of | | 4 | The contents of , each cast to | | 4 | | | 1 | A set to the values of , , , , , and | | 1 | A set to the values of , , , , , , and | | 1 | A set to the values of , , , , , , and | | 1 | A set to the values of , , , , , , and | | 1 | A set to the values of , , , , , , and | | 1 | | ? | ? | The result of calling . is called here. | | 8 | If isn't , then the result of is written. Otherwise, a is written instead. | | 4 | Sending this net message has the following side effect: is set to before it is written to the if is . MessageID.SpawnTileData (8) // TODO MessageID.StatusTextSize (9) // TODO MessageID.TileSection (10) // TODO MessageID.TileFrameSection (11) Deprecated. Framing happens as needed after TileSection is sent. MessageID.PlayerSpawn (12) // TODO MessageID.PlayerControls (13) // TODO MessageID.PlayerActive (14) // TODO MessageID.Unused15 (15) Unused. Plain and simple. MessageID.PlayerLifeMana (16) // TODO MessageID.TileManipulation (17) // TODO MessageID.SetTime (18) Unused. Plain and simple. Not sure why main menu information would need to be sent through a server anyway. MessageID.ToggleDoorState (19) // TODO MessageID.TileSquare (20) // TODO MessageID.SyncItem (21) Sends the information of the dropped item . If the target item is not , then this MessageID can be used to inform other clients that this item has despawned. The parameter is used when sending the message from the server in for if is true. Otherwise, it can just be ignored. Example: MessageID.ItemOwner (22) // TODO MessageID.SyncNPC (23) // TODO MessageID.UnusedStrikeNPC (24) Unused. Plain and simple. Most likely unused due to it using an item's damage and knockback directly without any of the usual variance. MessageID.ChatText (25) Obsolete. Either use the in or use the class. MessageID.HurtPlayer (26) Obsolete. Use instead. MessageID.SyncProjectile (27) // TODO MessageID.DamageNPC (28) // TODO MessageID.KillProjectile (29) // TODO MessageID.TogglePVP (30) // TODO MessageID.RequestChestOpen (31) // TODO MessageID.SyncChestItem (32) Syncs the item at . This message is usually sent within , but it still functions normally by itself. Example: MessageID.SyncPlayerChest (33) // TODO MessageID.ChestUpdates (34) // TODO MessageID.PlayerHeal (35) // TODO MessageID.SyncPlayerZone (36) // TODO MessageID.RequestPassword (37) // TODO MessageID.SendPassword (38) // TODO MessageID.ReleaseItemOwnership (39) // TODO MessageID.SyncTalkNPC (40) // TODO MessageID.ShotAnimationAndSound (41) // TODO MessageID.PlayerMana (42) // TODO MessageID.ManaEffect (43) // TODO MessageID.KillPlayer (44) Obsolete. Use instead. MessageID.PlayerTeam (45) // TODO MessageID.RequestReadSign (46) // TODO MessageID.ReadSign (47) // TODO MessageID.LiquidUpdate (48) Obsolete. Use instead. MessageID.InitialSpawn (49) // TODO MessageID.PlayerBuffs (50) // TODO MessageID.MiscDataSync (51) // TODO MessageID.LockAndUnlock (52) // TODO MessageID.AddNPCBuff (53) // TODO MessageID.NPCBuffs (54) // TODO MessageID.AddPlayerBuff (55) // TODO MessageID.UniqueTownNPCInfoSyncRequest (56) // TODO MessageID.TileCounts (57) // TODO MessageID.InstrumentSound (58) Plays harp or bell sound based on held item at player position. for the pitch. MessageID.HitSwitch (59) // TODO MessageID.NPCHome (60) // TODO MessageID.SpawnBossUseLicenseStartEvent (61) // TODO MessageID.Dodge (62) // TODO MessageID.PaintTile (63) // TODO MessageID.PaintWall (64) // TODO MessageID.TeleportEntity (65) // TODO MessageID.SpiritHeal (66) Used by the projectile orbs from the Spectre Hood armor set bonus. Increases the player's life and displays the combat text on other clients. is the of the player to heal and is how much to heal the player by. Nothing happens on the receiving client's end if is not greater than zero. Example: NOTE: This message ID is not restricted to projectiles. You can use it to simply sync a player health increase in general as well. MessageID.Unknown67 (67) Unused. Plain and simple. MessageID.ClientUUID (68) // TODO MessageID.ChestName (69) // TODO MessageID.BugCatching (70) // TODO MessageID.BugReleasing (71) // TODO MessageID.TravelMerchantItems (72) // TODO MessageID.RequestTeleportationByServer (73) // TODO MessageID.AnglerQuest (74) // TODO MessageID.AnglerQuestFinished (75) // TODO MessageID.QuestsCountSync (76) // TODO MessageID.TemporaryAnimation (77) // TODO MessageID.InvasionProgressReport (78) // TODO MessageID.PlaceObject (79) // TODO MessageID.SyncPlayerChestIndex (80) // TODO MessageID.CombatTextInt (81) // TODO MessageID.NetModules (82) // TODO MessageID.NPCKillCountDeathTally (83) // TODO MessageID.PlayerSealth (84) // TODO MessageID.QuickStackChests (85) // TODO MessageID.TileEntitySharing (86) Attempts to send a tile entity's data, if the ID provided exists. The data is sent via , which calls . Example: If the ID no longer exists in the client that sends the message (via ), but it does exist on the other clients, the tile entity will be removed on those clients. Example: MessageID.TileEntityPlacement (87) // TODO MessageID.ItemTweaker (88) // TODO MessageID.ItemFrameTryPlacing (89) // TODO MessageID.InstancedItem (90) // TODO MessageID.SyncEmoteBubble (91) // TODO MessageID.SyncExtraValue (92) Syncs by setting it to and, on clients, plays the \"ping\" sound at the world position . Example: MessageID.SocialHandshake (93) // TODO MessageID.Deprecated1 (94) Unused. Plain and simple. MessageID.MurderSomeoneElsesPortal (95) // TODO MessageID.TeleportPlayerThroughPortal (96) // TODO MessageID.AchievementMessageNPCKilled (97) // TODO MessageID.AchievementMessageEventHappened (98) // TODO MessageID.MinionRestTargetUpdate (99) // TODO MessageID.TeleportNPCThroughPortal (100) // TODO MessageID.UpdateTowerShieldStrengths (101) // TODO MessageID.NebulaLevelupRequest (102) // TODO MessageID.MoonlordHorror (103) // TODO MessageID.ShopOverride (104) // TODO MessageID.GemLockToggle (105) // TODO MessageID.PoofOfSmoke (106) // TODO MessageID.SmartTextMessage (107) // TODO MessageID.WiredCannonShot (108) // TODO MessageID.MassWireOperation (109) // TODO MessageID.MassWireOperationPay (110) // TODO MessageID.ToggleParty (111) // TODO MessageID.SpecialFX (112) // TODO MessageID.CrystalInvasionStart (113) // TODO MessageID.CrystalInvasionWipeAllTheThingsss (114) No, that's not a typo. The constant is actually called . // TODO MessageID.MinionAttackTargetUpdate (115) // TODO MessageID.CrystalInvasionSendWaitTime (116) // TODO MessageID.PlayerHurtV2 (117) // TODO MessageID.PlayerDeathV2 (118) // TODO MessageID.CombatTextString (119) // TODO MessageID.Emoji (120) // TODO MessageID.TEDisplayDollItemSync (121) // TODO MessageID.RequestTileEntityInteraction (122) // TODO MessageID.WeaponsRackTryPlacing (123) // TODO MessageID.TEHatRackItemSync (124) // TODO MessageID.SyncTilePicking (125) // TODO MessageID.SyncRevengeMarker (126) // TODO MessageID.RemoveRevengeMarker (127) // TODO MessageID.LandGolfBallInCup (128) // TODO MessageID.FinishedConnectingToServer (129) // TODO MessageID.FishOutNPC (130) // TODO MessageID.TamperWithNPC (131) // TODO MessageID.PlayLegacySound (132) // TODO MessageID.FoodPlatterTryPlacing (133) // TODO MessageID.UpdatePlayerLuckFactors (134) // TODO MessageID.DeadPlayer (135) // TODO MessageID.SyncCavernMonsterType (136) // TODO MessageID.RequestNPCBuffRemoval (137) // TODO MessageID.ClientSyncedInventory (138) // TODO MessageID.SetCountsAsHostForGameplay (139) // TODO MessageID.SetMiscEventValues (140) // TODO MessageID.RequestLucyPopup (141) // TODO MessageID.SyncProjectileTrackers (142) // TODO MessageID.CrystalInvasionRequestedToSkipWaitTime (143) // TODO MessageID.RequestQuestEffect (144) // TODO MessageID.SyncItemsWithShimmer (145) Identical to MessageID.SyncItem (21), except also syncs Item.shimmered and Item.shimmerTime MessageID.ShimmerActions (146) Checks (number) with 3 results 0. 1. 2. MessageID.SyncLoadout (147) // TODO MessageID.SyncItemCannotBeTakenByEnemies (148) // TODO MessageID.Count (149) The total number of MessageIDs in vanilla. MessageID.InGameChangeConfig (249) // TODO MessageID.ModPacket (250) // TODO MessageID.SyncMods (251) // TODO MessageID.ModFile (252) // TODO"},{"path":"螺线翻译tml教程/原版代码文档/杂项/Projectile-Class-Documentation 弹幕类 文档.md","filename":"Projectile-Class-Documentation 弹幕类 文档.md","title":"Projectile-Class-Documentation 弹幕类 文档","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Projectile Class Documentation This page lists methods and fields pertaining to the class. This page is useful for understanding what to use in and . Only common fields and methods are listed. The should be consulted for a full listing of methods and fields not listed here. You can also see the names and documentation for these methods and fields directly in your once it is setup correctly. Index| | | | Fields and Properties You can assign these fields to give your various values. Typically you'll want to refer to this page when writing code for . Be sure to visit to see what values vanilla projectiles use for these fields. All fields listed are public unless otherwise noted. Vanilla | Field | Type | Default Value | Description | | | | | | | |int |0 | This is the ProjectileID, automatically set. | | | int | 0 | Selects which vanilla code to use for the AI method. Modders can use vanilla aiStyle to mimic AI code already in the game. See and to see how to use vanilla ai. If you are using custom AI code, you can omit this line. | | | int |0 | The width of the projectile's hitbox in pixels. | | |int | 0| The height of the projectile's hitbox in pixels. | | | bool| false | If True, this projectile will hurt enemies (!npc.friendly) | | | bool|false | If True, this projectile will hurt players and friendly npcs (npc.friendly) | | | int|1 | How many npc can it hit before dying. (Or tile bounces) Set at the end of SetDefaults automatically to the current value of penetrate. | | | int|1 | Current penetrate value. | | | int| 0 | How transparent to draw this projectile. 0 to 255. 255 is completely transparent. sets this to 255, and the projectile aiStyle of 1 automatically decreases alpha each tick, letting the projectile fade in quickly after being spawned. Useful for projectiles that look odd when initially spawned on the weapon because of texture overlap. | | |int | 3600| Each update timeLeft is decreased by 1. Once timeLeft hits 0, the Projectile will naturally despawn. The default value, 3600, is measured in ticks, which are usually 60 per seconds, so the default despawn time is about 60 seconds. Adjust this if you want the projectile to fizzle early rather than travel infinitely. Note that extraUpdates will cause it to decrease faster than normal time because Update is being called more often. | | |bool |true | The projectile will collide with tiles, usually bouncing or killing the tile depending on . shows how to bounce. | | | bool | false | The projectile will not be affected by water. | | |int |0 | Additional update steps per tick. Useful for really fast projectiles such as . | | | float | 1f | Scales the projectile drawing, but not the hitbox, making this not suitable for affecting hitbox. | | | int | 0 | The frame in the spritesheet that this projectile will be drawn with. Example: projectile has 4 frames, then can have values between 0 and 3 | | | int | 0 | Used as a timer to decide when to change | | | float | 0f | Rotation of the projectile. Radians not Degrees. Use if you want to convert degrees to radians. 0 is facing right, pi/2 is facing down, and so on. | | | Vector2[] | | Holds the value of from previous updates. Use for drawing trails. Must be used with and to be used. See | | | float[] | | Holds the value of from previous updates. See above. | | | int[] | | Holds the value of from previous updates. See above. | | | float[] | 0, 0 | An array used for any sort of data storage, which is occasionally synced to the server. Call to manually sync. | | | float[] | 0, 0 | Acts like , but does not sync to the server. | | | bool | false | Set to true if you don't want this item to have a chance to recover the ammo item that shot this. For example, if you shoot the wooden arrow projectile, it will sometimes drop the wooded arrow item. If your weapon shoots multiple arrows for 1 ammo, you might want to consider setting this field to prevent infinite ammo glitches. | | | bool | false | Indicates that this projectile is a minion | | | float | 0f | Set to 1f on a minion to count it towards the minion limit of the summoning player (Optic Staff summons two minions at once with 0.5f each) | | | int | | | | | bool | | Projectile is not drawn normally. See (TODO) | | | bool | false | Indicates that this projectile is currently in lava | | | | | | | | bool | false | Indicates that this projectile is currently in water | | | bool | false | Indicates that this projectile will be synced to a joining player (by default, any projectiles active before the player joins (besides pets) are not synced over). Example: glowsticks | | | bool | false | Set manually to true in once to make it sync its current ai[] array to the server and other clients (depending on what the Main.netMode is where this is set to true in) | | | bool | false | Used internally to check for projectiles that spam . Don't use it yourself manually | | | | | | | | int | | The projectile's universal unique identifier, which is the same on all clients and the server. Usually used to find the same projectile on multiple clients and/or the server, e.g. | | | float | 0f | Set to a value above 0f to make this projectile emit a white light (higher number: more intensive light. 1f being stronger than a torch)) | | | Vector2 | | | | | Vector2 | Vector2.Zero | The amount of coordinates this projectile will move per tick | | | bool | | True if this Projectile actually exists. will hold a lot of junk data in it. If you are iterating over , be sure to check to make sure the projectile is still alive. For example, old projectiles that die aren't removed from the array, they simply have active set to false. | | | | | The index of the player who owns this projectile. In Multiplayer, Clients \"own\" projectiles that they shoot, while the Server \"owns\" projectiles spawned by NPCs and the World. It is very important to check for things like dropping items or spawning projectiles in and some other methods because runs simultaneously on all Clients and the Server. This check gates some of the code that should only run on the owners computer. checks owner for spawning the recovered item. If you don't do this, you will run into desync bugs in your mod. | | | int | 0 | This will always be set in based on the weapons damage. Don't assume that setting it to something in does anything. | | | int | 0 | Set manually on projectile spawn in vanilla for minions and sentries, aswell as automatically by tML when is true. Causes the projectile to update its damage every tick (contrary to the usual design of \"snapshotting\" damage) | | | float | 0f | | | | bool | false | If true, this projectile was spawned by a trap tile. | | | bool | false | If true, this projectile was spawned by a friendly Town NPC. | | | | | | | | | | | | | | | | tModLoader | Field | Type | Default Value | Description | | | | | | | | int | 0 | The number of defense points that this projectile can ignore on its own. Cannot be set to negative values. On spawn, if this projectile was fired from a weapon, this value has the total armor penetration of the weapon that made the projectile added to itself. | | | int | 0 | The critical strike chance modifier of this projectile. Cannot be set to negative values. On spawn, if this projectile was fired from a weapon, this value has the total critical strike chance of the weapon that made the projectile added to itself. | | | DamageClass | DamageClass.Default | The damage class of the projectile, relates to damage bonuses and crit. Vanilla options can be assigned via the fields, and modded through | | | bool | false | If set, will be recalculated based on , and the owning player, just like minions and sentries. | | | ModProjectile | null | The ModProjectile instance that controls the behavior of this projectile. This property is null if this is not a modded projectile. | | | RefReadOnlyArray | | Do not touch. Use | | | | | | Methods Only the most basic methods are documented here. Other documented methods will show documentation in your when you hover over them. Vanilla Remember that static methods are called by writing the classname and non static methods use the instance name. vs public static int NewProjectile(IEntitySource spawnSource, float X, float Y, float SpeedX, float SpeedY, int Type, int Damage, float KnockBack, int Owner = 255, float ai0 = 0f, float ai1 = 0f) Spawns a projectile in the world. The owner variable should pretty much always be set to . See for info on the parameter. Proper usage with multiplayer in mind: If spawned from a player (via accessory, on hit by, on use, etc.), only the \"owner\" of this projectile should spawn it: Otherwise, if no player \"owns\" the projectile (such as a friendly or hostile NPC shooting it, or the world itself spawns it), spawn it on the server (or singleplayer) In both cases, this guarantees that runs only on one instance of the game, such that no duplicate projectiles spawn. public static int GetByUUID(int owner, int uuid) Do not use this method to get a projectile on a client based on its Projectile.identity. Instead, loop through the Main.projectile[] on the client you wish to find the projectile on and check if there is a projectile that has the same Projectile.identity as the projectile you want to find. tModLoader public T GetGlobalProjectile (bool exactType = true) where T : GlobalProjectile Gets the GlobalProjectile instance (of the specified Type) associated with this projectile instance. public void CloneDefaults(int type) Allows you to copy the defaults of a different type of projectile. public bool CountsAsClass () where T : DamageClass Returns true if the projectile counts as the given damage class (of the specified type) towards effects. public bool CountsAsClass(DamageClass damageClass) Returns true if the projectile counts as the given damage class towards effects."},{"path":"螺线翻译tml教程/原版代码文档/杂项/Tile-Class-Documentation Tile类 文档.md","filename":"Tile-Class-Documentation Tile类 文档.md","title":"Tile-Class-Documentation Tile类 文档","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Note: This page is out of date and only relevant for 1.3 tModLoader. Modders using 1.4+ should rely on the documentation instead. Tile Class Documentation This page lists methods and fields pertaining to the Tile class. If you are working directly with s, you can consult this page for an understanding of various things. If you want to create a Tile in your mod, this is not relevant, see for that. See also [Main.tile[]](https://github.com/tModLoader/tModLoader/wiki/Main Class Documentation tile). It is good to remember that can have null values in it, null values are empty/air tiles. Non null values could also be empty/air tiles as well. Index| | | | | Fields and Properties The class is structured to be very compact and efficient. You usually don't want to modify many of these fields directly. All values default to 0. | Field | Type | Description | | | | | | | ushort | Corresponds to the TileID of this tile. Since the dirt tile has the value of 0, you need to check other values to know if this tile has a tile or not. can be used to check if the is air or not. | | | ushort | Corresponds to the WallID of this tile. A value of 0 means no wall. | | | byte | Represents how much liquid is in the tile. Ranges from 0, no liquid, to 255, filled with liquid. | | | ushort | A bit field. Don't touch this directly, use the methods. Stores: Wires, Actuator, Slope, Color, and HalfBrick data. | | | byte | A bit field. Don't touch this directly, use the methods. Stores: LiquidType, WallColor, and Wire4 data. | | | byte | A bit field. Don't touch this directly, use the methods. Stores: FrameNumber, wallFrameX, and WallFrameNumber data. | | | byte | A bit field. Don't touch this directly, use the methods. Stores: SkipLiquid, CheckLiquid, and wallFrameY data. | | | short | Corresponds to the coordinates of the 16x16 (usually) area in the spritesheet this Tile uses. For a Framed tile, this value is set automatically as the world loads or other tiles are placed or mined nearby. See for more info. For FrameImportant tiles, this value will not change and will be saved and synced in Multiplayer. In either case, and correspond to the coordinates of the top left corner of the area in the spritesheet that this Tile should draw. Some Tiles such as Christmas Tree and Weapon Rack use the higher bits of these fields to do tile specific behaviors. Modders should not attempt to do similar approaches, but should use s | | | int | Get only property. Unused. | | | | | Methods public Tile() Constructor, all values default to 0. public Tile(Tile copy) Constructor that clones another Tile public object Clone() Creates a clone of the Tile. public void CopyFrom(Tile from) Copies fields from another Tile. public void ClearEverything() Clears all fields. public bool active() public void active(bool active) Sets or checks if the Tile has a tile present or not. public bool nactive() Returns true is Tile is active but not actuated. Equivalent to . public bool inActive() public void inActive(bool inActive) Sets or checks if the tile is actuated. public void liquidType(int liquidType) public byte liquidType() Sets or checks liquid type. 0 water, 1 lava, 2 honey. public bool lava() public void lava(bool lava) public bool honey() public void honey(bool honey) Sets or checks liquid type. public bool wire() public void wire(bool wire) public bool wire2() public void wire2(bool wire2) public bool wire3() public void wire3(bool wire3) public bool wire4() public void wire4(bool wire4) Sets or checks presence of individual wires. public bool actuator() public void actuator(bool actuator) Sets or checks presence of actuator on tile. public byte color() public void color(byte color) Sets or checks tile color. public byte wallColor() public void wallColor(byte wallColor) Sets or checks wall color. public byte frameNumber() public void frameNumber(byte frameNumber) Framed tiles usually have 3 choices (alternate images), this sets or checks that value. public int wallFrameX() public void wallFrameX(int wallFrameX) public byte wallFrameNumber() public void wallFrameNumber(byte wallFrameNumber) public int wallFrameY() public void wallFrameY(int wallFrameY) Various wall framing related methods. public bool checkingLiquid() public void checkingLiquid(bool checkingLiquid) public bool skipLiquid() public void skipLiquid(bool skipLiquid) Various Liquid movement related methods. public bool topSlope() public bool bottomSlope() public bool leftSlope() public bool rightSlope() public bool HasSameSlope(Tile tile) public bool halfBrick() public void halfBrick(bool halfBrick) public byte slope() public void slope(byte slope) public static void SmoothSlope(int x, int y, bool applyToNeighbors = true) Various slope related methods. public override string ToString() Prints debug info about a Tile. public void ClearTile() public bool isTheSameAs(Tile compTile) public int blockType() public void ResetToType(ushort type) internal void ClearMetadata() public Color actColor(Color oldColor) Various methods. Bitfield Data In order to store its data efficiently, each uses several \"header\" fields as bitfields . A bitfield is a variable used for a sequence of bits instead of an actual value. Accessing and modifying the bits is usually done through the bitwise operators: (bitwise OR), (bitwise AND), (bitwise XOR), (bitwise NOT), (shift left logical) and (shift right logical). An example of uses for each operator is shown below: | Operator | Value 1 | Value 2 | Expression | Expression (binary) | Result | Result (binary) | | | | | | | | | 35 | 68 | | | 103 | | | 39 | 68 | | | 4 | | | 47 | 68 | | | 107 | | | 68 | n/a | | | 187 | | | 35 | 2 | | | 210 | | | 35 | 2 | | | 8 | | Operator | Explanation | | | | If the bit in Value 1 or the bit in Value 2 is set, the bit in the result is also set. | | The bit in the result is set only if the bit in Value 1 and Value 2 is set. | | The bit in the result is set only if the bit in Value 1 or Value 2 is set, but not both. | | Every 1 bit becomes a 0 bit and vice versa. | | Every bit in Value 1 is shifted to the left Value 2 times. Zeros are filled in from the right and any bits that overflow past the most significant bit (the first one) are removed. | | Every bit in Value 1 is shifted to the right Value 2 times. The most significant bit is filled in from the left and any bits that overflow past the least significant bit (the last one) are removed. The class has four bitfields: , , and . These bitfields should NOT be modified directly. Instead, use the various methods in . For reference, here's what every bit in the bitfields represent and where they are normally accessed: sTileHeader : Unused. : Where the slope type for this is stored. Accessed from and . 0 is no slope, 1 is down left slope, 2 is down right slope, 3 is up left slope and 4 is up right slope. : If this has an Actuator on it. Accessed from and . : If this is a half brick. Accessed from and . : If this has a Green Wire on it. Accessed from and . : If this has a Blue Wire on it. Accessed from and . : If this has a Red Wire on it. Accessed from and . : If this is actuated. Accessed from and . : If this is active (not air). Accessed from and . : Where the paint color type for this is stored. Accessed from and . Value ranges from 0 to 30. bTileHeader : If this has a Yellow Wire on it. Accessed from and . : Where the liquid type for this is stored. Accessed from , , and . 0 is water, 1 is lava and 2 is honey. : Where the paint color type for this 's wall is stored. Accessed from and . Value ranges from 0 to 30. bTileHeader2 : Related to wall framing. Accessed from and . Values range from 0 to 3. : The alternate frame number for this . Accessed from and . Values can range from 0 to 3, but vanilla only uses 0 to 2. : Where the frameX for this 's wall in its spritesheet is stored. Accessed from and . The values range from 0 to 15. returns this value 36 when called, and sets this value to the parameter / 36. bTileHeader3 : Unused. : A flag used for liquid updating. Accessed from and . : A flag used for liquid updating. Accessed from and . : Where the frameY for this 's wall in its spritesheet is stored. Accessed from and . Values range from 0 to 7. These bits are handled in the same manner as the bits in ."},{"path":"螺线翻译tml教程/原版代码文档/杂项/Wall 墙.md","filename":"Wall 墙.md","title":"Wall 墙","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is a Wall? Walls are fairly straightforward and creating a is mostly an exercise in following the existing patterns. Like tiles, walls are comprised of 2 parts, the that places the wall, and the itself. Wall Item Pairing An will place a specific when is set to the of the . The will typically return the as well. This process is automatic for walls that are placed by the same item they return, otherwise use in to manually specify the item drop. Basic Example in ExampleMod is a basic example. It has 4 files: is the actual class is the texture for the is the corresponding class that places the . Note: The code in automatically sets and all other properties common to wall items. is the texture for the . in ExampleMod is also a basic example, but only has 2 files, the class and corresponding texture. doesn't have an item that places it, so is used to register the item drop. Advanced Example See for an advanced example showcasing animation, custom framing, and lighting. Texture The texture for a wall has several sections for drawing the wall in different positions depending on which neighbors are the same wall type. Notice how for each orientation, there are 3 options. The sections are referred to as \"style\" and the options are referred to as \"WallFrameNumber\". is based off of walls since it is simple to comprehend. Consult other for more detailed examples. If is used, a 4th is added to the mix for each to add even more variety. That template is shown here: This template shows how values of 1 (\"Phlebas\") and 2 (\"Lazure\") produce a deterministic pattern rather than a random pattern. Animated If the wall is animated, the pattern is repeated. This is only supported for non walls. Wall Properties In , various data can be assigned to affect the behavior of the wall. Main.wallHouse If true, the wall is considered a safe wall, used for various things. Main.wallDungeon If true, the wall is considered a dungeon wall. Main.wallLight If true, light flows in from the background, such as fences and glass. Main.wallLargeFrames If 1, the \"Phlebas\" pattern is used (Plating type walls). If 2, the \"Lazure\" pattern is used. These both use the 4th option. Main.wallBlend Assign to a known to blend with similar walls. For example, in an unsafe variant of a wall you would write . You should not do the reverse on the safe variant, only on one of the walls. Animated As seen above, the texture for animated walls has several copies of the template. The wall will animate in accordance with the timing and pattern provided in the hook. Example This example loops 7 frames of animation, switching frames every 10 frames. A cycling or more advanced pattern can be made with some effort. Safe vs Unsafe Many Terraria walls have safe and unsafe variants. The safe wall variant is the wall placed by the item the player receives when mining the unsafe wall. The unsafe wall is placed during world generation and usually can't be placed by the player. The unsafe wall is used in NPC Spawning calculations. This separation lets players mine walls and use them for decoration without risking enabling various enemies from specifically spawning in their creations. As a mod developer, this pattern is good to follow if NPC spawning logic takes wall types into account. Custom Framing With , a modder can implement whatever framing logic they desire. This example from shows weighting the 1st option more than the other 2 options: Here is the comparison between this example and WallID.Cog, which has a similar texture, note how rare the WallFrameNumber 0 is: Don't use for Game Logic Make sure not to use wall framing for game logic, only visuals. Wall framing is not synced and each player sees their own pattern of wall framing. Relevant References Contains other methods and properties that both and inherit."},{"path":"螺线翻译tml教程/原版代码文档/杂项/Workshop 创意工坊.md","filename":"Workshop 创意工坊.md","title":"Workshop 创意工坊","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide is only relevant for 1.4. The page is where you will find information relating to publishing mods for the 1.3 version of tModLoader. The Workshop is an online component of tModLoader where Mod Makers can publish their mods. Users are able to easily find, download, and install mods they are interested through the workshop. Users can browse the workshop directly in game by visiting on the main menu. Users can also visit the in their web browser or in Steam. tModLoader will also load workshop items the user has subscribed to from the . Workshop items on the Terraria Workshop are not mods. Worlds and Resource Packs are the only types of content found on the Terraria workshop. Modders wishing to publish their mod to the Mod Browser should continue reading. Getting Started Once your mod is working and functional, you may wish to share it with other users. You'll need a Steam Account and a working mod. Steam Account Modders wishing to publish their mod must have the Steam version of tModLoader. Additionally, the steam account must not be . Usually, this just means that the account must have spent at least $5 on Steam. // TODO: Can Family Share publish? Steam Subscriber Agreement Modders must accept the . There is a link to this page on the publish mod menu as well. Rules In addition, the modder should read the rules. Mods violating rules will be removed: tModLoader Rules (TBD) Publishing Mods After making sure your mod is ready for release, visit . You should see a button, if you don't, build and reload your mod and it should appear. After pressing , a menu will appear with some additional options. After selecting those options, click and the mod will be published to the workshop. Before publishing, however, do the following: Set a Version Set a version in your build.txt. Something like is good for an initial release. Please use semantic versioning: You are not allowed to use letters for the version Fill out description.txt This is the description that potential users will read when deciding if they will download, make it good. This is what modders will see if they click the button in game. It doesn't support as many formatting options as , but it does support chat tags and colored text. Fill out description workshop.txt This is the description that potential users will read when deciding if they will download, make it good. The contents of this file will populate the steam workshop page description for your mod. You can use to add headings, links, and images. Modders can use the button on the workshop page of their mod to quickly edit and test formatting. If you do this, make sure to copy changes made directly on the workshop to so that the next time you publish an update to your mod the changes aren't reverted. Test A lot. You don't want your mod to be quickly judged to be bad because of a poor first release. Make a Homepage Every mod can have a homepage in addition to their Steam Workshop page. This could be a thread on the , a wiki, a GitHub, or even a Discord link (Not recommended). It is up to you. A homepage should provide a way to interact with your users so they can give bug reports, criticism, or praise. Once you have a homepage, copy the URL and paste it into your . Save build.txt. Build Save all your files and Build the mod in the Mod Sources menu. Github If you have a Github repository for your Mod, push all changes. Visibility and Tags On the publish menu, set tags for your mod that match the features of your mod. Set the visibility to public if your mod is ready for anyone to use it. Modders can use Private or Friends Only to facilitate beta testing prior to publishing. Publish You can now click the Publish button. Within a few minutes, your users will automatically have the updated mod. Updating Mods To update a mod you have published, first do the following: Update Version Increment the version in your build.txt. Your Version should be 2 to 4 numbers separated by periods. Do not add letters such as \"v\" or \"beta\" to your version. .aspx Anchor 6). Note: Some examples: 0.1 is the same as 0.001, and 0.0.0.10 comes right after 0.0.0.9. Update Descriptions Update your and with any new info you'd like potential users to know about. A brief recent changelog might be nice here. Update changelog.txt If a file named is found, it will be used to populate the section of a mod's workshop page. Before publishing an update, clear out exiting text and type up the changes made since the last version published. Update Mod Icon A Mod icon can be added to a mod by adding an 80x80 to the root of the Mod's source folder. This is the icon shown to the user in game. In addition, the workshop website also supports a higher resolution . This file can be up to 512x512 pixels. If you want to keep the pixel art of the 80x80 icon consistent, you can upscale to 480x480 by scaling up by 600% and using the nearest neighbor upscaling option. Here is a template if you wish to use it: Test Test your changes a lot. Test the Save and Load code in your and classes by loading old saves from previous versions of your mod. Build Save all your files and Build the mod in the menu. Github If you have a Github repository for your Mod, push all changes now so your releases stay in line with the source code. Publish Click Publish in the Mod Sources Menu. Within a few minutes, your users will now see that an update to their favorite mod is now available for download. Update Website If you have a website, now would be a good time to advertise the update and changelog. Multiple Versions Mods can publish different builds of their mods for stable and preview simultaneously. tModLoader will enable the appropriate version of the mod depending on the version of tModLoader the user is running, nothing needs to be done by the modder. Unpublishing Mods You can unpublish a mod by visiting the steam workshop page for your mod and selecting delete. Collaborators On the steam workshop page for your mod, use the to add collaborators to your mod. The users must be your friend. Collaborators can publish updates to the mod to the workshop so it is extremely important that you only add collaborators that are trustworthy. To actually collaborate on the code, modders usually use GitHub to work on code together. .tmod File size If you find that your file is unnaturally big, check your Mod's source folder for large files that shouldn't be there. By default, all files in the folder will be packaged into the file. Use to specify folders or files to ignore, or delete the files in question. Common culprits include photoshop or other image editing project files. GitHub integration Modders can use Github Actions to build their mod with each commit. This can be useful to make sure the mod doesn't break. Modders can also use GitHub actions to publish a mod update whenever build.txt is updated, but that is not something we have a working example of and is left up to the user. Modders using this approach will need to be EXTREMELY careful with their Steam credentials. Renaming a Mod The in dictates the name users will see when interacting with mods. This name can change and updated as the mod changes. Feel free to edit this as you like, your changes will take effect next time you publish. Read on if you need to change the internal name of a mod. Aside from the , there is an . The is another name pertaining to a mod, this name has no spaces or special characters and will not change as the mod is updated. For example, the mod's is \"DisableCorruptionSpread\". tModLoader and other mods can interact with this mod within code using \"DisableCorruptionSpread\" and the connection won't be broken if the changes. The must be unique on the workshop, so you might find that the you have chosen for your mod is already taken when publishing. Or, you might want to rename the for other reasons. Due to various factors, it is not recommend to change the of a mod that has already been published, but it can be done. If your mod is small, it might be easier to make a new mod and copy over the changes rather than following the steps below to rename an existing mod. Renaming a Mod Steps Use the to find a new unique . The search doesn't search by internal names, but it should give you an idea of what might be taken already. If you are on the , you can type the command in the channel. Our bot will then reply with information about that mod if it exists or \"Mod with that name doesn't exist\" if a mod with that has not been published. Repeat until you find a name suitable for your mod that is unused. After deciding on a new , first rename your mod's source folder. Open up the folder and rename the folder for your mod. Next open up your mod's source folder and rename , , and if it exists. Open up and rename the class. Open in a text editor and rename the entry. Next we'll need to update all the entries on every file in your mod. Open up each and rename each entry. Make sure you saved all your changes on each file and try to build the mod in game. If the mod doesn't load or doesn't build, you likely missed something. The error message should help you find and fix the remaining issues. Using the \"Find in files\" feature can streamline this process. In notepad++, for example, the \"Find in files\" tool can be used to search all files in a specific directory. From there each result can be fixed easily. Limitations Terraria Community Forum Rules Mods published to the Mod Browser must abide by the Rules of note include the rule against porting content from non PC versions of Terraria and the rules against plagiarism. Violating these will result in revoked Mod Browser privileges. Mod Icon Guidelines Any nudity or inappropriate content in a Mod Icon will result in especially severe response. What will be deemed inappropriate? You can probably guess it, but still here's a few examples: nudity/porno, swearing, violence/harm to other humans or animals, and also icons that encourage vandalism, crime, terrorism, racism, eating disorders, or suicide.. The list can go on.. just use an appropriate icon please. Malicious Code Don't do it. The mods you upload are tagged with your Steam identity. You will be permanently banned from the browser and all of your mods will be removed. We will also notify Terraria and Steam staff about you and your malicious code. Common Issues // TODO: decription.txt too long error The content folder for the published item is missing?! Unconfirmed: If there is a Workshop folder in the saves directory, delete it. Try to publish again."},{"path":"螺线翻译tml教程/原版代码文档/杂项/World-Generation 世界生成.md","filename":"World-Generation 世界生成.md","title":"World-Generation 世界生成","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is World Generation World Generation is the act of programmatically placing and removing tiles from the world. World Generation is done in two places, during world creation and in game. The vast majority of this guide will focus on world generation during world creation, but in game considerations will also be detailed. World generation is a fairly complex topic, and a good understanding of many topics is required to work effectively. It is recommended to familiarize yourself when the following sections before jumping straight into the code. In addition, using an IDE with edit and continue support like Visual Studio is highly recommended. Table of Contents Terminology Pass, Step, and Task When a world is generated, the game runs each pass in order. In this guide, the term step will refer to individual sections of code that make up a pass. World Generation is composed of Passes, and Passes are composed of Steps. For example, a Pass that makes a biome could be composed of 2 steps, the first step digging holes, and the 2nd step placing trees. The term could be equivalent to Pass, but we will avoid that term in this guide since has another meaning that we will need later on in the guide. Prerequisite Knowledge Tile Coordinates The very top left of the world is located at in tile coordinates, and the bottom right at . These coordinates directly map into . See for more info. By convention, we use and or and in code for tile coordinates. We need multiple pairs of variables because many times we are working with coordinates derived from other coordinates. Main.tile[,] is an 2D array containing all the tiles in the world. You can directly access the struct at a specific and coordinate during worldgen by writing . Be mindful that attempting to access tiles at coordinates with negative numbers or outside the bounds of the world will lead to errors. To avoid this, use the method to ensure that the coordinates are valid before accessing . Tile class The struct contains all the data at the tile position it represents. The most important fields are and , which represent the tile and wall types present at the location. See for more details on the various fields and methods of the struct. Framed vs FrameImportant Tiles It is vital to remember that tiles in Terraria come in two basic varieties. There are normal terrain tiles like dirt, ores, and stone, and there are tiles that are not terrain tiles, like trees, anvils, paintings, and so on. Terrain tiles are known as \"Framed\" tiles because the game adjusts their look depending on nearby tiles. For example, placing a gemspark block next to an existing gemspark block tile changes the look of the original gemspark block and makes them look like a single deposit of ore. The other tiles, known as FrameImportant or multitiles, have a defined look that doesn't change. The important thing to know is that replacing Framed tiles with other Framed tiles is easy, simply set to the new Tile type. Attempting to manually place FrameImportant tiles or replace them is much harder. Framing Framing is the process where the game adjusts the and values of tiles to adjust their look to fit their context. In world generation code, you do not need to worry about framing because the game frames all tiles automatically when loading the world. If you are changing Tiles in game, you do need to tell the game to frame nearby tiles. shows a situation where tile framing and syncing is needed. Here is an example of unframed tiles. In this example, all the gemspark blocks have and values of 0. If you ever see tiles like this in game, then you have buggy code. This is the result after tile framing. Here we can see how tiles use and to determine the portion of their spritesheet to draw. For example, the tile outlined in red has a value of 36 and a value of 0, meaning that the 16x16 section of the sprite starting at the pixel coordinates 36, 0 is drawn for this Tile. The image on the right is the sprite sheet for this tile, the colored rectangles show the portions of the sprite sheet drawn for the indicated tiles. Debugging World Generation Testing world generation code can be very time consuming. First you have to make code changes, build and reload the mod, wait for the world to finish generating, then explore the newly generated world to see the end result. This process can be streamlined to make writing and testing world generation code much more productive. To be more productive, it is beneficial to have a setup where code testing can be done quickly. The short videos and pictures shown in this guide were all accomplished with a setup that allowed editing source code in game, manually triggering world generation steps in game, and undoing world changes. This setup is not required, but can make writing and testing world generation code require less guesswork and be much more productive. It is a good idea to test individual steps of a pass before blindly testing a complete pass. Start small and slowly expand the scope of your testing. For example, to test a pass that adds an ore, first test a single execution using the process below to get the parameters right. Once that is working, test the completed pass independently to verify that the frequency of the ore is correct. You can then add additional logic to control the placement of the ore and test that it is working. Finally, if needed, test the pass in a real world generation scenario to make sure it works completely. The Setup 1. Download and enable the following mods: and 2. Add the following code to your project, make sure to fix the namespace. You can replace the method later once you get comfortable with this process: 3. Make sure tModLoader is closed, then start . After the mod builds, tModLoader will launch. When tModLoader launches, open a World you don't care about. Place Visual Studio on one side of the screen and tModLoader in windowed mode on the other: 4. In , click on the buttons to \"Disable Enemy Spawns\", set \"Light Hack\" to \"100%\", turn on \"God Mode\", and \"Reveal Map\". These settings will let you focus. 5. With enabled, right clicking on the full screen map will teleport the player. Teleport to an area typical of the area you eventually wish to place your world generation code. 6. If the code you are testing is pretty destructive, use the Take World Snapshot button in the Miscellaneous Tool menu in Modders Toolkit to preserve a copy of the world. (The button is near the bottom right of the screen) 7. on the line of code you wish to experiment on. Clicking in the \"line number margin\" of the line you wish to experiment on sets a breakpoint: 8. Repeat the following 1. Hover over the tile you wish to attempt to test your code, then press the key on your keyboard. 2. Visual Studio will immediately take focus, as it has hit the breakpoint we set. This will be indicated by the yellow arrow in the \"line number margin\": 3. Now you can edit the code. If this is your first time, simply press to continue. Otherwise, change variables and other logic at or below the yellow arrow. Once you have completed your changes press to continue. 4. Back in tModLoader, you should briefly see a square of dust indicating the coordinates you ran the code at. You will also see the effect of the code. 5. If the world generation code was destructive, press the \"Restore World Snapshot\" button. The changes should revert. 6. If the effect of your code is what you desired, congratulations, you now have a good idea of the code you want to use in your world generation passes. You can copy the code over and use it appropriately. Otherwise, repeat these steps until you discover the parameters and values that do what you want. Learn by experimenting example Many methods available to use for world generation aren't documented at all. We can use the setup from above to discover what . First off, let's swap out for . Next, let's look at the parameter names and guess some suitable values. For and , we can guess that it is probably asking for some tile coordinates. and probably affect the direction, we can leave those at 0. and probably need a non zero number, lets start them at 1 and go from there. Now that we have some code, we will do the steps above and test our code. Each time we see the results, we can edit the code after hitting the breakpoint once again to see the effect of our changes, thereby learning the meaning of the parameters. Once we know the meaning, we have the knowledge required to use the method in our actual world generation steps. With , we get a small hole: Let's experiment with , here is the results of , we can see that seems to affect a radius: Let's experiment with , here is the results of . Its not clear the affect this parameter has, we probably need to test it in conjunction with other parameters: Let's experiment with and and . From reading vanilla code usages of , we can see that and are usually a number between 1 and 1, so lets try . Now we can see that and seem to affect the direction that the tiles are dug out (down and to the right in this case because that is positive x and y coordinates) and that seems to indicate how many times this digging process should iterate. With the knowledge of the parameters we have gained from experimenting, let's try to make a long hole traveling down. My guess is a high , high , and a medium will do what we want. Let's try : Looks good. I hope this experiment has shown how testing bits of code live in game can help decipher the meaning of methods and parameters. You can also read the source code if you are feeling confident. Advanced Code Setup If you want to really quickly iterate on testing parameters, you can... SkipSelect Modders can use the command line argument to load the game directly into a specific world. This can be useful if you are closing and loading the game frequently. Modders Toolkit Quick Tweak : Instructions on using the tool to iterate even quicker on parameter selection. Testing Complete Passes If you are happy with the individual steps in a pass, you will need to test the complete pass by generating a new world and seeing if the results are satisfactory. At this stage, you should tweak things that control how many of your world generation structures generate. Using the will help visualize the full picture of how prevalent your biomes and structures are in the world. Be mindful that players will be playing with other mods, so try not to cover the world with your structures. Rare world generation features that feel like a real discovery are exciting to players. Code Setup Now that you have learned the prerequisites and have a productive setup, it is now time to learn the basic layout of world generation code. The setup code goes in a class extending and the actual world generation code goes in a class extending from . This example will cover spawning ores, something simple but commonly desired. Please follow along and read the comments. Note that both of these classes are in the same file, but they could easily be broken up into separate files if that is the organization you prefer. As you can see, is used to register each of your world generation passes. Each class has a method that does some amount of edits to the world. We insert our passes into the vanilla world generation pass order to make sure our code executes when appropriate. Adding Additional World Generation Code To add more world generation code, first determine if you wish to add a step to an existing pass, or if you wish to make a new pass. Making a new pass is useful if the pass has no meaningful connection to the existing passes or if the order of existing modded or vanilla passes requires the new code to exist elsewhere. For example, if we wished to spawn chests in the world, you can't do that in the same pass that you spawn ores, since ores spawn before FrameImportant tiles are spawned. Ores spawning would corrupt chests placed too early. If you are making a biome, code digging out holes and code placing terrain can co exist in the same pass. If we wanted to spawn an additional ore, we could simply add another for loop to the method shown above, and tweak the numbers to suit the new ore. This would be referred to as adding a step to the pass. If we wanted to place chests, we would add code similar to the following to : And then add the class as well. Make sure you don't mess up the C syntax: Debugging considerations If you are using the debugging setup described above, we'll need to further break down our code to facilitate testing and experimentation. Here we can see that can be called from both our hotkey code in and our world gen step called , allowing the code to be independently tested. Determining a suitable index Consult to find a suitable place to insert your world generation pass. Doing similar code immediately after similar world gen passes is usually a good rule to follow. Some early passes have no regard for multitiles, so avoid placing chests or other multitiles too early. The same concept applies to various terrain shaping methods, as doing such methods too late runs the risk of corrupting already placed multitiles, causing them to break or appear incomplete. Note: Don't group multiple calls above your lines. This is because will change the indexes of passes, invalidating other values. If you do, the indexes could be wrong. Here is an example of a potential issue that could be caused by running code at the wrong step. Here we see TileRunner code that has corrupted multitiles, such as doors, chests, and other decorative tiles: Vanilla World Generation Timeline This section lists various important events that happen during world generation that will help you identify a suitable index for general world generation passes: Underworld: Spawn Point: and are assigned TODO Find important passes: last chance for large terrain edits, how to avoid corrupting chests, etc. Determining a starting location Most world generation steps randomly pick a coordinate to start at. We can adjust the distribution of our world generation code by adjusting our choice for this initial coordinate. Random We use the method to choose a random number. It is important that you use for all random decisions, as it facilitates the world seed feature. Width TODO: Center of map, safe zone around spawn, ocean position Depth From top to bottom, here are the depths available during worldgen: . By adjusting the min and max provided to the method, we can tell the game the range of depths that we want our ore to spawn. The following is the copper ore spawning code from the game, it uses 3 separate for loops with differing parameters and loop multipliers to make ore deposits larger and more frequent the deeper you are: Note that the distance between and is a lot larger than the other 2 ranges, so the distribution of ores isn't as dense as the would suggest. Also note that not all of these values persist into in game. For example, and are forgotten, and only remains. is equal to . Make sure that if you are doing in game world generation code that you are referencing variables that are actually loaded, you can check to double check. The underworld is located on the bottom 200 tiles of the map. and below will result in underworld coordinates. Biome We can check the existing Tile at random coordinates to determine the biome at the chosen location. For example, if we wanted to place ores only near Snow, we could check for snow tiles: When checking conditions like this, it is important to think about whether you want your loop counter to increase on failure or stay the same. It is possible that all the random coordinates chosen might not contain snow, and the world would not be affected by your code. On the other hand, if you repeat your world generation code until snow is found a specific number of times, a world that has a small amount of snow could disproportionately be affected by your world generation code. Be aware of this possibility when designing your code. Spawn and indicate the default spawn location. Typically is somewhere within 5 tiles of , but mods can change this. The spawn location is assigned in the \"Spawn Point\" pass. Dungeon and point to a tile on the entrance to the dungeon, these coordinates are generated during the pass. is also determined in the same pass, it will be if the Dungeon is on the left half of the world, and will be when the Dungeon is on the right half. Temple The Temple location is not stored in the world file, but if you search all tiles for or the locked door, you might be able to find it, but it is not guaranteed. TODO: On.makeTemple example Pyramid Pyramid coordinates are also not remembered. TODO: Use reflection to retrieve FieldInfo of local variables captured via closure example. Retrieve and . (double check if editing closured vars can modify original captured variable values) Find Surface Location To find a surface coordinate, you first choose a random X coordinate, then you start from the top of the world and check all tiles until you find the first solid tile. Here is an example: In this example, we check against to make sure we don't go too deep. This is to ensure that you don't attempt to spawn a surface biome in the middle of a deep pit, for example. Common Patterns Try Until Success Finding a suitable location for many world generation operations can be difficult to do. For example, placing a chest requires 2 solid tiles side by side with a 2x2 space above without any tiles present. Writing an algorithm to search for a location with exactly that situation can be difficult and error prone. While there are times when searching for a specific context is useful, it is extremely common to do world generation code in a lazier manner. This lazier manner is attempting to do something at random coordinates until the desired amount of successes have been achieved. For example, if you want each world to spawn with 4 special chests in the world, you might attempt to place the chest randomly in the desired area until reports a success 4 times. When doing this approach, there exists the possibility that the searched area doesn't contain any positions that satisfy your conditions, so it is useful to limit attempts. If you don't limit attempts, your code could end up in an infinite loop. This attempt limit should be large enough that it doesn't fail too early, but small enough that world generation doesn't pause for too long, causing the user to assume the code is stuck in an infinite loop. As an example, lets attempt to place 10 chests in the world: In this example, we attempt to place 10 chests, giving each chest 1000 attempts. Here is the output: Here you can see that with random coordinates, you can usually place a chest using within the 1000 attempts we allowed. Bumping 1000 up to 10000 would not be an issue, but would almost guarantee 10 chests rather than the 9 successes we see here. Computers are very fast, tens of thousands of placement attempts isn't a big deal. The most important thing is to allow your loops to fail after too many attempts, you do not want your world generation code stuck in an infinite loop. Affect All Tiles Sometimes you want to do something to all tiles. For example, changing all Iron Ore tiles to MyCoolOre tiles. You can do this, but be mindful that applying a blanket change like this might conflict with the expectations of other mods. Also, it is probably best to do this in PostWorldGen or a late Pass to allow other code that looks for these tiles to do their work first. To do this, we use a double for loop: Placing Tile Entities TODO: Have to manually place since they aren't placed the normal way Placing Items in Chests After using to add a chest to a world, you can add items by accessing the array of the object at the location. If using , the or chest index is not returned to the caller, so you can't modify the contents without searching the world for the Chest. Placing Items in New Chest The following example shows many approaches to adding items. The important thing to remember is to properly track the current index of the Item slot you are editing. This example adds all the items at the end to simplify this. Placing Items in Other Existing Chests ChestItemWorldGen.cs shows an example of placing a single item in a chest placed by other code. . You can also use techniques shown above if you want to place multiple items, you just need to make sure to follow the logic to find an empty item slot in Chest so you don't overwrite the existing items. Liquids Liquids are stored in the Tile struct coexisting with the actual tile, if it exists. Many of the large scale terrain methods have parameters that optionally place water in the resulting terrain. For example, has a parameter that will fill the hole with some water after digging it. Look for similar parameters in other methods. To manually place a single tile of water, you can set the liquid type and liquid amount at that Tile by writing: In Game/Multiplayer considerations TODO: Many methods are not designed to be use in multiplayer. Example on how to sync tile changes. Example of methods that don't send tile changes to avoid. Save corruption when leaving too early. (tModLoader needs WorldGen.IsGeneratingHardMode equivalent hook) Server crashing due to synchronous code. (needs example of async code, thread static warning) Make sure code runs on server Long running Tasks If an in game world generation task takes more than a moment to run, users will experience lag. In single player the game will freeze for that time and in multiplayer the server will freeze, leading to desync issues. Modders implementing world generation code that runs in game need to be aware of this and plan accordingly using the approaches taught in this section. Spawning new ores, a new biome, or a new structure are all common tasks that could potentially count as long running. Note that this section does not apply to tasks generated during hardmode or tasks during normal world generation, those are automatically handled correctly. Long running tasks need to run on a separate thread to not cause lag. Most code in tModLoader runs on the main thread, but this will cause issues because the game loop is also on the main thread. By running a world generation task on the main thread, the game will freeze for that same amount of time. If we run the task on a separate thread, the game can continue running as normal as the task updates tiles independently of the game thread. To spawn a thread, simply call the method with the method or code to run: . As always, make sure this code is running on the server if in a multiplayer game. The method shows an example of this. That method is called from if it is the first time the boss has been defeated in the world. Stamp Tiles Sometimes a mod wishes to place a well designed building or other designed feature into the world. Writing code to manually place each tile individually is quite cumbersome. There is a way to \"stamp\" a selection of tiles into the world. How it works is you first design the structure in game, then you use the TODOMETHODNAME method to export a binary file that represents that selection of tiles. You can add that file to your mod and reference it in a worldgen pass. You can use the TODOMETHODNAME method to convert that file to a 2d array of Tiles. Once you have the tiles, you can find a suitable location and copy the tiles over to that location, like you were stamping the tiles over that location. When using this approach, you might want to spend some effort making sure the chosen location merges well with the tiles you are placing. Procedural Syntax A more powerful approach to typical world generation code can be seen in many of the more recent world generation additions in vanilla code. This approach makes the more impressive world generation features of Terraria possible. The organic flow of the Living Mahogany Tree and the Enchanted Sword Shrine are good examples of the power of this approach. This procedural approach provides a means of chaining conditions and actions together in a more concise and less error prone way. The syntax is confusing if you are not familiar with advanced C syntax patterns, but once you get the hang of it, this approach can be extremely powerful and efficient. Quick Example As a quick primer on this approach, here is a quick example: This code is intimidating, but it truly isn't too bad if you learn to read it. Basically the method takes a , , and . Starting at the coordinates signified by , the code of the traces out the desired shape while running the code on each of those coordinates. This code runs the method on each coordinate within a circle, creating a circle with radius of 8 filled with Gemspark tiles. This example shows using to chain together multiple s. We place AmberGemspark, place the Blue Dynasty wall, and spawn purple dust. The dust is just there to help visualize all the tiles that could be affected by the Shape provided. GenShape GenShapes are used to specify where the actions occur. Vanilla shapes such as and are self explanatory, others you may need to experiment with. A good example of using a GenShape is the class. This class is responsible for the general shape of the world gen code. Here are examples of the Mound, Slime, and ShapeBranch GenShapes, respectively: GenModShape Classes inheriting from GenModShape use input points to drive their coordinates. For example, can be used to affect the inner outline of the set of points provided by the . Custom GenShape Inheriting from GenShape allows custom shapes to be utilized. GenAction GenActions dictate the code that affects the coordinates provided by the GenShape. Some common actions include , to set the tile type, and , to tally the number of iterations of a GenShape. Scanner can be used to count how many tiles currently satisfy the conditions of an . This is useful for finding spots that are mostly some condition or another. For example, if you wanted to find a location that was 90% solid tiles, you could compare the result of the Scanner with the total number of tiles checked. This examples shows how to use Scanner via . This example also shows , which allows separating conditions into sub chains that don't halt other chains when they fail. (Typically the chain will terminate when a an Action returns false.) TileScanner counts tiles by type in the given Shape. helps calculate if a position is a suitable placement by checking nearby tiles. It helps avoid overlap with other world generation elements and helps place a world gen feature in a place that matches the exact desired location. The following example uses to check that 50% of the tiles in the tested area are either Stone or Dirt. By adjusting our criteria, we can guarantee a pleasing placement of our world gen element. Custom The allows arbitrary code to execute. Most of the typical things you'd like to do with GenActions are already covered by existing classes, but one example of using this is spawning dust: Custom GenAction Inheriting from can be used to run custom code on each coordinate. Here is an example called modeled after . Custom GenAction classes can help organize reusable portions of code. Modifier Modifiers are special GenActions that limit the execution of subsequently chained GenActions. A simple example of this is the Modifier. randomly terminates the chain of actions. In the example below, all tiles within the circle spawn the yellow dust, but the Dither modifier terminates the chain early 20% of the time, resulting in the tattered placement seen below. Output can be used to remember the set of coordinates at a specific GenAction. In this examples, we Output the result of 2 separate Circles into a shared . This is passed to , which computes which tiles from that data form an inner outline. In this manner, we basically union the results of both s and use those results to make a unique shape of Lava Moss tiles. GenCondition s are classes that determine if an area or coordinate satisfy a condition. By default, they only check the provided coordinate, but can be used to find areas that satisfy conditions. Areas are measured as a rectangle with the provided coordinate as the top left corner. GenConditions are typically used in conjunction with to find a suitable location for a step. AreaAnd By modifying a with , all coordinates within the area must satisfy the condition to be considered a success. For example, checks that all tiles in a 6 tile wide by 2 tile high area are all solid. AreaOr checks if any tile in the area satisfies the condition. For example, attempts to determine if any tile in a 3x1 area is solid. Not can be applied to , , or a without an area. applied without an area will invert the condition. For example, will be a success only if the tile is NOT solid. applied to acts as a NOR operation, as in none of the tiles in the area satisfy the condition. would attempt to find a 3x5 area without any Solid tiles in it. applied to acts as a NAND operation, returning true only if not all tiles satisfy the condition, or in other words, at least 1 tile doesn't satisfy the condition. Offset Offsetting GenConditions is not yet supported. What this means is that all GenConditions in a single Find will share the top left corner. Find can be used to search for a location that meets certain conditions. Through the use of and a number of s, the method attempts to find a coordinate that satisfies all the conditions. The directs the Find to start at the input and travel down at most 20 tiles in search of a suitable location. The method returns true if the search was successful. The conditions in this example attempt to find a 5x5 square of tiles that are all solid and Sand. If this is found, obsidian is placed in the middle. The yellow dust shows the area that was discovered that matched the conditions. The cursor shows that the search started above ground and searched down until it found the final result. Case Studies Here are some complex examples that can show the full potential of this approach to world generation code. Enchanted Sword Shrine The code for Enchanted Sword Shrine is found in the class. This section will examine how uses various techniques to cleanly generate the shrine at a suitable location without issue. Follow along with the comments and the video below. Enchanted Sword Shrine Steps Video https://github.com/tModLoader/tModLoader/assets/4522492/00ded2ae 8cdb 47ec a04e 3fa9fe1a4903 Useful Methods [Terraria.WorldGen] public static void TileRunner(int i, int j, double strength, int steps, int type, bool addTile = false, float speedX = 0f, float speedY = 0f, bool noYChange = false, bool overRide = true) This method places small splotches of the specified tile ( ) starting at the coordinates ( and in tile coordinates). This method is typically used for placing ores or other non FrameImportant tiles, like sand, dirt, or stones. Special values of type have special effects. will remove tiles rather than place tiles, and will do the same but add lava if the coordinates are below the lava line. The shape and size are controlled by the and parameters. guides how big the splotch of tiles is, and indicates how many times the process will repeat. For example, a small and small would result in a small splotch, a large and a small would result in a large splotch, and a small and a large would result in a long but skinny path of tiles. and drive the initial direction that the path of individual steps will take, but the method will randomly adjust the direction as well. when true seems to place dirt wall behind tiles at surface level, and also has some effect on the variance of the vertical movement. when true places additional tiles in the world. when true changes existing tiles to the specified tile. TileRunner is NOT SAFE to use when multitiles are in the world with the parameter as , as it will corrupt them. It is also not safe to use in multiplayer, as it does not \"frame\" the tiles nor does it sync the tile changes. The latest vanilla step that uses this method is the \"Gems\" step, so the latest position to place a step using this method with parameter as would be immediately after the \"Gems\" step. If you have a tile that shouldn't be overridden by ores and gems spawning, set to false for that ModTile. As multitiles shouldn't be in the world when TileRunner is called, you should only need to set this for terrain tiles that you don't want ores bleeding into. TileRunner showcase video https://github.com/tModLoader/tModLoader/assets/4522492/5a1c3078 252e 4b1b 96d8 defbe7daa1c4 [Terraria.WorldGen] public static void OreRunner(int i, int j, double strength, int steps, ushort type) Similar to , but without many of the options. OreRunner places small splotches of the specified tile ( ) starting at the coordinates ( and in tile coordinates). OreRunner only replaces active tiles that are either or , making it suitable to be used even after FrameImportant tiles exist in the world. If you have a tile that should be susceptible to being replaced when additional ores are spawned in the world, set to for that ModTile. Vanilla code only uses this method when spawning hardmode ores. This method is suitable for use in game and in multiplayer as it both frames and syncs tile changes. [Terraria.WorldGen] public static int PlaceChest(int x, int y, ushort type = 21, bool notNearOtherChests = false, int style = 0) The method attempts to place a chest at the given coordinates. The coordinate provided will be the bottom left corner of the resulting chest, if the method succeeds. is the tile type to place, and is the style type to place. For vanilla chests, you can count from zero starting from the left in the Tiles 21.png image after to find the style you want to place. can be set to true to prevent the chest from placing if another chest exists within 25 tiles left or right and 8 tiles up and down. This method returns the chest index of the chest that was successfully placed or 1 if placing the chest failed. Chest placement can fail for many reasons, such as if existing tiles block the space, or if there isn't 2 suitable solid tiles directly below the intended location. See for an approach to using this method. See for info on placing items in the chest. [Terraria.WorldGen] public static bool AddBuriedChest(int i, int j, int contain = 0, bool notNearOtherChests = false, int Style = 1) The method attempts to place a chest and fill it with typical loot according to the style and depth. Without any parameters, a regular, gold, or locked shadow chest will be created, depending on the depth. You can pass in an item type for and the first item in the chest will be that item. Unlike , the resulting chest will be placed with the bottom right corner at the given coordinates. In addition, if the given coordinate isn't suitable, AddBuriedChest will search down from the given coordinate to find the first solid tile it encounters and attempt to place there. This method returns true if a chest was successfully placed, but be aware that the chest might not be exactly at the coordinates you provide. Here is an example of running the method with the default parameters . Notice how the chest style changes according to depth and how the chest is placed on the floor directly below the provided coordinates if possible: AddBuriedChest showcase video https://github.com/tModLoader/tModLoader/assets/4522492/d2243d92 a3fb 400c 9e5c d1412a6073cc See for info on placing items in the chest. [Terraria.WorldGen] public static bool InWorld(int x, int y, int fluff = 0) When dealing with random coordinates combined with addition or subtraction, there is a chance you might construct coordinates outside the bounds of the world. This will crash world generation, so it is important that you check that the coordinates are suitable before attempting to do things at those coordinates. Use this method to check if the given coordinates fall inside the world. The parameter further checks that the coordinates are at least that many tiles away from the edge, which is useful for world generation actions that could affect large areas of tiles. [Terraria.WorldGen] public static Point RandomWorldPoint(int top = 0, int right = 0, int bottom = 0, int left = 0) A more streamlined approach to finding a random tile coordinate in the world. is eqivalent to [Terraria.WorldGen] public static void KillTile(int i, int j, bool fail = false, bool effectOnly = false, bool noItem = false) can be used to destroy the tile or multitile at the specified and coordinates. prevents the tile from being destroyed, but still plays a hit sound. prevents the tile from being destroyed but still spawns hit dust and prevents the hit sound. prevents the item from dropping. [Terraria.WorldGen] public static bool PlaceTile(int i, int j, int type, bool mute = false, bool forced = false, int plr = 1, int style = 0) PlaceTile is the main way to place individual tiles while obeying anchor considerations. and are the coordinates. These coordinates relate to the origin of the tile, not necessarily the top left corner of the tile. Read to familiarize yourself with the concepts of Anchors and Origins. indicates if a sound should be made, this only applies to in game usage as sounds are all muted during world gen. attempts to place the tile even if other tiles are already at the coordinates, but it is unreliable. does nothing except affect bathtubs. refers to the style of the tile type provided. Styles are explained in the Basic Tile guide. PlaceTile returns a bool indicating placement success. Unfortunately, it doesn't work, don't use it. Checking the coordinates after calling PlaceTile is a good way to check if the placement was a success: PlaceTile doesn't expose everything. For example, attempting to place a tile with a specific style will be ignored by many of the underlying methods. Another issue is that it is impossible to place a tile that has left and right placement orientations facing right. In these situations, you might need to manually place each tile in the multitile or use instead. requires more input. For example, placing Coral with means you have to manually specify the style, as the random style choosing is a feature of PlaceTile. TODO: Explain how to place a TileEntity in code, since PlaceTile won't automatically do it. [Terraria.WorldGen] public static bool PlaceSmallPile(int i, int j, int X, int Y, ushort type = 185) PlaceTile is a special way to place ambient tiles. and are the coordinates. and are the count and row indexes of the specific tile in the . Indexes count from left to right and start at 0. So for example the Sapphire Stash would have Y=1 (second row) and X=21 (22nd 2x1 tile). MicroBiome StructureMap During world generation, the game uses , accessed through , to track important world generation features to prevent overlap. The is basically a collection of Rectangles indicating areas in the world that are occupied by world generation features that should not be interfered with. If you are spawning something important, you might want to add to StructureMap via the method to tell other world generation passes to avoid the area. StructureMap is cooperative, if you are placing structures, it would be a good idea to check with the structure prior to placing a structure at a coordinate. Some structures vanilla places in StructureMap include Hives, Enchanted Sword Altars, and Cabins. StructureMap doesn't have to be used for all structures, as biomes interacting with each other is interesting. Use StructureMap for structures that shouldn't interact and check StructureMap before doing destructive operations in late passes. This image shows entries in StructureMap highlighted in green. TileID.Sets.GeneralPlacementTiles When code is checking , CanPlace will additionally search the area for tiles that are false in . Setting a TileID to false in GeneralPlacementTiles will prevent structures that obey the StructureMap from attempting to place over it. TileID.Sets.CanBeClearedDuringGeneration This code affect terrain methods like Cavinator and TileRunner. Tiles marked false in this array will survive those operations. IL Editing Since vanilla world generation passes are all anonymous methods, they are IL edited in a slightly different way, which is demonstrated here in ExampleMod:"},{"path":"螺线翻译tml教程/杂项/BannerToNPC-Conversions 旗帜ID转NPCID.md","filename":"BannerToNPC-Conversions 旗帜ID转NPCID.md","title":"BannerToNPC-Conversions 旗帜ID转NPCID","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The Basis When making a banner, different values are used for enemies. Say for example you wanted to create a banner that gave you buffs for blue and green slimes. If you used their actual IDs, you would instead be buffed for completely different enemies. That's because the ID value is passed through to this function, which returns a different value based on which ID you use. The List This is the list of conversions made found in Terraria.Item.BannerToNPC. Below this is a second list, containing the code from Terraria.Item.NPCToBanner. It may prove useful. // Terraria.Item public static int BannerToNPC(int i) { switch (i) { case 1: return 102; case 2: return 250; case 3: return 257; case 4: return 69; case 5: return 157; case 6: return 77; case 7: return 49; case 8: return 74; case 9: return 163; case 10: return 241; case 11: return 242; case 12: return 239; case 13: return 39; case 14: return 46; case 15: return 120; case 16: return 85; case 17: return 109; case 18: return 47; case 19: return 57; case 20: return 67; case 21: return 173; case 22: return 179; case 23: return 83; case 24: return 62; case 25: return 2; case 26: return 177; case 27: return 6; case 28: return 84; case 29: return 161; case 30: return 181; case 31: return 182; case 32: return 224; case 33: return 226; case 34: return 162; case 35: return 259; case 36: return 256; case 37: return 122; case 38: return 27; case 39: return 29; case 40: return 26; case 41: return 73; case 42: return 28; case 43: return 55; case 44: return 48; case 45: return 60; case 46: return 174; case 47: return 42; case 48: return 169; case 49: return 206; case 50: return 24; case 51: return 63; case 52: return 236; case 53: return 199; case 54: return 43; case 55: return 23; case 56: return 205; case 57: return 78; case 58: return 258; case 59: return 252; case 60: return 170; case 61: return 58; case 62: return 212; case 63: return 75; case 64: return 223; case 65: return 253; case 66: return 65; case 67: return 21; case 68: return 32; case 69: return 1; case 70: return 185; case 71: return 164; case 72: return 254; case 73: return 166; case 74: return 153; case 75: return 141; case 76: return 225; case 77: return 86; case 78: return 158; case 79: return 61; case 80: return 196; case 81: return 104; case 82: return 155; case 83: return 98; case 84: return 10; case 85: return 82; case 86: return 87; case 87: return 3; case 88: return 175; case 89: return 197; case 90: return 6; case 91: return 273; case 92: return 379; case 95: return 287; case 96: return 101; case 97: return 217; case 98: return 168; case 99: return 81; case 100: return 94; case 101: return 183; case 102: return 34; case 103: return 218; case 104: return 7; case 105: return 285; case 106: return 52; case 107: return 71; case 108: return 288; case 109: return 350; case 110: return 347; case 111: return 251; case 112: return 352; case 113: return 316; case 114: return 93; case 115: return 289; case 116: return 152; case 117: return 342; case 118: return 111; case 119: return 3; case 120: return 315; case 121: return 277; case 122: return 329; case 123: return 304; case 124: return 150; case 125: return 243; case 126: return 147; case 127: return 268; case 128: return 137; case 129: return 138; case 130: return 51; case 131: return 10; case 132: return 351; case 133: return 219; case 134: return 151; case 135: return 59; case 136: return 381; case 137: return 388; case 138: return 386; case 139: return 389; case 140: return 385; case 141: return 383; case 142: return 382; case 143: return 390; case 144: return 387; case 145: return 144; case 146: return 16; case 147: return 283; case 148: return 348; case 149: return 290; case 150: return 148; case 151: return 4; case 152: return 330; case 153: return 140; case 154: return 341; case 155: return 7; case 156: return 281; case 157: return 244; case 158: return 301; case 159: return 8; case 160: return 172; case 161: return 269; case 162: return 305; case 163: return 391; case 164: return 110; case 165: return 293; case 166: return 291; case 167: return 121; case 168: return 56; case 169: return 145; case 170: return 143; case 171: return 184; case 172: return 204; case 173: return 326; case 174: return 221; case 175: return 292; case 176: return 53; case 177: return 45; case 178: return 44; case 179: return 167; case 180: return 380; case 183: return 9; case 184: return 343; case 185: return 338; case 186: return 471; case 187: return 498; case 188: return 496; case 189: return 494; case 190: return 462; case 191: return 461; case 192: return 468; case 193: return 477; case 195: return 469; case 196: return 460; case 197: return 466; case 198: return 467; case 199: return 463; case 201: return 480; case 202: return 481; case 203: return 483; case 204: return 482; case 205: return 489; case 206: return 490; case 207: return 513; case 208: return 510; case 209: return 509; case 210: return 508; case 211: return 524; case 212: return 529; case 213: return 533; case 214: return 532; case 215: return 530; case 216: return 411; case 217: return 402; case 218: return 407; case 219: return 409; case 221: return 405; case 222: return 418; case 223: return 417; case 224: return 412; case 225: return 416; case 226: return 415; case 227: return 419; case 228: return 424; case 229: return 421; case 230: return 420; case 231: return 423; case 232: return 428; case 233: return 426; case 234: return 427; case 235: return 429; case 236: return 425; case 237: return 216; case 238: return 214; case 239: return 213; case 240: return 215; case 241: return 520; case 242: return 156; case 243: return 64; case 244: return 103; case 245: return 79; case 246: return 80; case 247: return 31; case 248: return 154; case 249: return 537; case 250: return 220; case 251: return 541; case 252: return 542; case 253: return 543; case 254: return 544; case 255: return 545; case 256: return 546; case 257: return 555; case 258: return 552; case 259: return 566; case 260: return 570; case 261: return 574; case 262: return 572; case 263: return 568; case 264: return 558; case 265: return 561; case 266: return 578; } if (i = 580) { return i; } return 0; } The Second Coming: // Terraria.Item public static int NPCtoBanner(int i) { switch (i) { case 10: return 131; case 9: return 183; case 8: return 159; case 7: return 155; case 6: return 90; case 4: return 151; case 3: return 119; case 2: case 121: return 167; case 1: case 302: case 333: case 334: case 335: case 336: return 69; case 2: case 133: case 190: case 191: case 192: case 193: case 194: case 317: case 318: return 25; case 3: case 132: case 186: case 187: case 188: case 189: case 200: case 319: case 320: case 321: case 331: case 332: case 430: case 432: case 433: case 434: case 435: case 436: return 87; case 6: return 27; case 7: return 104; case 10: case 11: case 12: case 95: case 96: case 97: return 84; case 16: return 146; case 21: case 201: case 202: case 203: case 449: case 450: case 451: case 452: return 67; case 23: return 55; case 24: return 50; case 26: return 40; case 27: return 38; case 28: return 42; case 29: return 39; case 31: case 294: case 295: case 296: return 247; case 32: return 68; case 34: return 102; case 39: case 40: case 41: return 13; case 42: case 176: case 231: case 232: case 233: case 234: case 235: return 47; case 43: return 54; case 44: return 178; case 45: return 177; case 46: case 303: case 337: case 540: return 14; case 47: return 18; case 48: return 44; case 49: return 7; case 51: return 130; case 52: return 106; case 53: return 176; case 55: case 230: return 43; case 56: return 168; case 57: return 19; case 58: return 61; case 59: return 135; case 60: return 45; case 61: return 79; case 62: case 66: return 24; case 63: return 51; case 64: return 243; case 65: return 66; case 67: return 20; case 69: return 4; case 71: return 107; case 73: return 41; case 74: return 8; case 75: return 63; case 77: return 6; case 78: return 57; case 79: return 245; case 80: return 246; case 81: return 99; case 82: return 85; case 83: return 23; case 84: return 28; case 85: return 16; case 86: return 77; case 87: case 88: case 89: case 90: case 91: case 92: return 86; case 93: return 114; case 94: return 100; case 98: case 99: case 100: return 83; case 101: return 96; case 102: return 1; case 103: return 244; case 104: return 81; case 109: return 17; case 110: return 164; case 111: return 118; case 120: return 15; case 122: return 37; case 137: return 128; case 138: return 129; case 140: return 153; case 141: return 75; case 143: return 170; case 144: return 145; case 145: return 169; case 147: return 126; case 148: case 149: return 150; case 150: return 124; case 151: return 134; case 152: return 116; case 153: return 74; case 154: return 248; case 155: return 82; case 156: return 242; case 157: return 5; case 158: case 159: return 78; case 161: case 431: return 29; case 162: return 34; case 163: case 238: return 9; case 164: case 165: return 71; case 166: return 73; case 167: return 179; case 168: return 98; case 169: return 48; case 170: case 171: case 180: return 60; case 172: return 160; case 173: return 21; case 174: return 46; case 175: return 88; case 177: return 26; case 179: return 22; case 181: return 30; case 182: return 31; case 183: return 101; case 184: return 171; case 185: return 70; case 195: case 196: return 80; case 197: return 89; case 198: case 199: return 53; case 204: return 172; case 205: return 56; case 206: return 49; case 212: return 62; case 213: return 239; case 214: return 238; case 215: return 240; case 216: return 237; case 217: return 97; case 218: return 103; case 219: return 133; case 220: return 250; case 221: return 174; case 223: return 64; case 224: return 32; case 225: return 76; case 226: return 33; case 236: case 237: return 52; case 239: case 240: return 12; case 241: return 10; case 242: return 11; case 243: return 125; case 244: return 157; case 250: return 2; case 251: return 111; case 252: return 59; case 253: return 65; case 254: case 255: return 72; case 256: return 36; case 257: return 3; case 258: return 58; case 259: case 260: return 35; case 268: return 127; case 269: case 270: case 271: case 272: return 161; case 273: case 274: case 275: case 276: return 91; case 277: case 278: case 279: case 280: return 121; case 281: case 282: return 156; case 283: case 284: return 147; case 285: case 286: return 105; case 287: return 95; case 288: return 108; case 289: return 115; case 290: return 149; case 291: return 166; case 292: return 175; case 293: return 165; case 301: return 158; case 304: return 123; case 305: case 306: case 307: case 308: case 309: case 310: case 311: case 312: case 313: case 314: return 162; case 315: return 120; case 316: return 113; case 326: return 173; case 329: return 122; case 330: return 152; case 338: case 339: case 340: return 185; case 341: return 154; case 342: return 117; case 343: return 184; case 347: return 110; case 348: case 349: return 148; case 350: return 109; case 351: return 132; case 352: return 112; case 379: return 92; case 380: return 180; case 381: return 136; case 382: return 142; case 383: case 384: return 141; case 385: return 140; case 386: return 138; case 387: return 144; case 388: return 137; case 389: return 139; case 390: return 143; case 391: return 163; case 402: case 403: case 404: return 217; case 405: case 406: return 221; case 407: case 408: return 218; case 409: return 219; case 411: return 216; case 412: case 413: case 414: return 224; case 415: return 226; case 416: return 225; case 417: return 223; case 418: return 222; case 419: return 227; case 420: return 230; case 421: return 229; case 423: return 231; case 424: return 228; case 425: return 236; case 426: return 233; case 427: return 234; case 428: return 232; case 429: return 235; case 460: return 196; case 461: return 191; case 462: return 190; case 463: return 199; case 466: return 197; case 467: return 198; case 468: return 192; case 469: return 195; case 471: return 186; case 477: return 193; case 480: return 201; case 481: return 202; case 482: return 204; case 483: return 203; case 489: return 205; case 490: return 206; case 494: case 495: return 189; case 496: case 497: return 188; case 498: case 499: case 500: case 501: case 502: case 503: case 504: case 505: case 506: return 187; case 508: return 210; case 509: return 209; case 510: case 511: case 512: return 208; case 513: case 514: case 515: return 207; case 520: return 241; case 524: case 525: case 526: case 527: return 211; case 528: case 529: return 212; case 530: case 531: return 215; case 532: return 214; case 533: return 213; case 537: return 249; case 541: return 251; case 542: return 252; case 543: return 253; case 544: return 254; case 545: return 255; case 546: return 256; case 552: case 553: case 554: return 258; case 555: case 556: case 557: return 257; case 558: case 559: case 560: return 264; case 561: case 562: case 563: return 265; case 566: case 567: return 259; case 568: case 569: return 263; case 570: case 571: return 260; case 572: case 573: return 262; case 574: case 575: return 261; case 578: return 266; } if (i = 580) { return NPCLoader.GetNPC(i).banner; } return 0; }"},{"path":"螺线翻译tml教程/杂项/Bestiary-Stars 图鉴-星标.md","filename":"Bestiary-Stars 图鉴-星标.md","title":"Bestiary-Stars 图鉴-星标","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The stars, or \"rating\", in the ingame Bestiary are controlled by a multitude of factors. Below is the general formula (found in ) that the game uses to determine the stars for any given , with a few exceptions: 1. Start with a default stars rating of . 2. Add to the rating. 3. Check the following conditions in order, adding to the rating only once: 1. Is true? If so, add to the rating. 2. Is true? If so, add to the rating. 3. Is true? If so, add to the rating. 4. Is true? If so, add to the rating. 5. Is true? If so, add to the rating. 6. Is true? If so, add to the rating. (This condition is true for any rarities above ) 4. Is true? If so, add to the rating. 5. Calculate the sum of . The stats used here are the NPC's stats in Normal Mode . 6. Using that sum, check the following conditions in order, adding to the rating only once: 1. Is the sum greater than ? If so, add to the rating. 2. Is the sum greater than ? If so, add to the rating. 3. Is the sum greater than ? If so, add to the rating. 4. Is the sum greater than ? If so, add to the rating. 5. Is the sum greater than ? If so, add to the rating. 6. Is the sum greater than ? If so, add to the rating. 7. Cap the rating to , truncate it and then return it. How can I add a custom stars rating to my NPC? The dictionary stores the stars rating for all NPCs, including modded ones. To manually set the rating for an NPC, set in . Example: Setting an NPC's rating to less than is treated as if the NPC's rating were . Setting an NPC's rating to more than is treated as if the NPC's rating were . v2025.06 and earlier To manually set the rating for an NPC, set in . Example:"},{"path":"螺线翻译tml教程/杂项/Command-Line 命令行.md","filename":"Command-Line 命令行.md","title":"Command-Line 命令行","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In addition to all the Command Line and Server Config settings available in , tModLoader adds a few listed below. TOBEADDEDLIST 1) loadlib 2) publish, ciprep, publishedmodfiles, uploadfolder 3) experimental 5) steamworkshopfolder 6) audiodriver Overrides SDL AUDIODRIVER 7) videodriver Overrides SDL VIDEODRIVER savedirectory [pathToSaveDirectoryFolder] Server and Client Command Line Argument Specifies the save directory. The default save directories are listed but without the final folder in the path. The directory (or either or if on 1.3 or 1.4.3 tModLoader instead) will automatically be appended to the provided path. Use this argument to specify a different save directory. The save directory is the parent directory of the worlds directory and mods directory, so you can use only this parameter rather than both of those. tmlsavedirectory [pathToSaveDirectoryFolder] Server and Client Command Line Argument Same as above except won't automatically be appended to the provided path. modpack [modpackname] Server and Client Command Line Argument, Server Config. Specifies a modpack to use by name. Omit the extension. The mods specified in the modpack (and only them) will be loaded. Useful for quickly launching a specified set of mods for people who might be doing multiple concurrent play throughs with different sets of mods. modpath [pathToModsFolder] Server Command Line Argument, Server Config. Specifies the folder to look for files. Useful for hosted servers as typically the default folder location is no accessible on dedicated hosts. skipselect Server and Client Command Line Argument Useful for modders who wish to quickly test their mod. This flag will automatically select the 1st player and world in the list, allowing the modder to launch directly into the game. Very useful when building and launching from Visual Studio. Modders should read the below to learn how to easily use this argument while debugging. If you wish to specify a specific player and world, you can use . Either can be omitted and will default to the first player or world if missing. For example, will select the 1st player and the specified world. These parameters go off of the world name (what you see in game), not the file path. For servers, the argument available in is similar. It uses the world file path as the argument instead of the world name. build [pathToModSource] Server Client Command Line Argument Builds the mod specified by the folder from source, useful for modders. Used by default by the autogenerated csproj. publish [modname] Server Command Line Argument Used to publish mods from the command line. Must be used with and to work correctly. Currently only useable to publish mods. Example: publishtags [modpackname] Server Command Line Argument Used with . Setting this will override the tags currently set for the mod on the workshop. Each tag should be separated by . The list of tags can be found in the . The tag can be specified multiple ways, for example for , either \"QoL\" or \"QualityofLife\" is acceptable. Capitalization also doesn't matter, but spaces must be removed. Note that language tags will be removed automatically if they fall below some threshold, even if they are passed into . publicity [WorkshopItemPublicSettingId] Server Command Line Argument Used with . Setting this will change the visibility of a mod on the workshop. For new mods, if this is not assigned it will default to public. Possible values are as follows: eac Server Client Command Line Argument (Windows Only) Enables Edit and Continue, useful for modders. Used by default by the autogenerated csproj. gldevice Client Command Line Argument tModLoader uses the which means launch options from FNA are available. The most applicable one is which will switch graphics drivers. The available options are: (Default option on Windows) See the for more information about FNA launch options. testservermodloading Server Command Line Argument This is used internally by tModLoader when testing a server side mod before navigating to the publish menu. Usage For dedicated server configs, follow the example shown in the file in the . (for example, \"modpath=/mymods/\". Basically, [settingname]=[settingvalue]) You can also make a file in the install directory and the contained command line parameters will be loaded as if they were used normally. Otherwise, use either a script ( on windows, on linux/mac) to specify a command line argument (for example \"start tModLoader.bat modpack friendsplaythrough\"). Windows users can also add parameters to shortcut files by adding to the end of \"Target\". You can also add command line arguments to the \"Launch Options\" in the Steam properties for the game, these will only apply when launching from Steam. Examples cli argsConfig.txt Make a file in the install directory and edit it however you want. Arguments can be on separate lines or all on the same line. These arguments will be loaded even if debugging or launching from Steam, making it convenient for options you want to always apply. Here is an example: Windows Shortcut Make a shortcut to the file by either copy and then paste shortcut or by right click dragging the file to another place and selecting \"Create shortcuts here\". Next, right click properties and edit the appropriately. Launch Windows Client with a specific Mod Pack See picture: Using Command Line Arguments for Debugging Adding Command Line Arguments in Visual Studio This section assumes you have a working development setup achieved by following the guide. To add arguments for debugging, open up the debug properties for your mod's project. To do this, click the small black arrow next to the button. The button has a green arrow and will likely be labeled at this time. In the dropdown, select : This will open up a window named . In this window find the section. This is where the command line arguments that are used while debugging are assigned. The default value should be . More arguments can be added to this entry. The most useful argument to add is (See the for more details.). If you are debugging the server instead of the client, make sure to select the launch profile and then change . The default value would be for the server launch profile. Launch Profiles By default, your mod project will come with 2 launch profiles, and . These will launch and debug the client and server respectively. In the previous section, we added to one of those default launch profiles to streamline debugging by bypassing the player and world select menus. This is useful but we might not always want that behavior and editing launch profiles to add or remove command line arguments can get tedious. To avoid this, we can create a new launch profile with the new behavior. When we want the new behavior, we just need to select the launch profile from the dropdown and start debugging. First, open up the menu again: Select the launch profile you want to make a copy of ( for client or for server), then click : Next, click and give it a suitable name. In this example we will be naming the profile because we will be launching a world named \"MyTestWorld\" using the argument. Next, edit the section and add the arguments you want. In this example, has been added. Close the window. From now on, you can use the dropdown menu to select a launch profile, then click it to start debugging with that profile. Launch profiles are stored in the . The file can be edited manually if that is more convenient, just make sure to follow json syntax. Launch Profiles Ideas Using launch profiles to streamline mod development can save time. Here are some more ideas on how to use launch profiles: Use to use a separate saves location. This can be useful for organization or testing specific settings you don't want to affect your normal tModLoader client. Use to launch the game with a specific modpack enabled. This can be useful for testing the mod in isolation or testing the mod against specific optional dependencies."},{"path":"螺线翻译tml教程/杂项/Contributing-Localization 贡献-本地化.md","filename":"Contributing-Localization 贡献-本地化.md","title":"Contributing-Localization 贡献-本地化","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide is for 1.4.4, the current version of tModLoader. If you need to view the 1.4 version of this wiki page, click Learn how to contribute localization (translations) to your favorite mod or even to This guide also covers a brief introduction for the system, but if you want a full guide you should read the Localization Workflow 1. 2. 3. 4. 5. For information on using GitHub to contribute localizations, see the section. If you wish to localize tModLoader, see the section. Localization Approaches There are a few approaches to localize a mod. Some mod developers welcome translators to contribute translations directly to their project, either through GitHub or in some other manner. Other mod developers would prefer that translations are done as separate mods dependent on the original mod. Whatever the approach, this guide will cover how to localize a mod and how to get your localizations available to other users. GitHub Mods that host their code on GitHub are the easiest to contribute translations to. A translator can download the mods source code and work directly in it. Contact Mod Developer If a mod does not have a public GitHub, you might want to consider contacting the mod developer. They might be happy to accept translations directly from the community and integrate them into their mod. New Translation Mod If a mod developer can't be contacted or doesn't want to deal with translations, a last resort is making a new mod that contains the translations for the mod. This approach is less convenient for users and more work for the translators, but it is an option. (In the future, we plan to support localizations in resource packs.) Localization Template Files The first step to localizing a mod is to obtain the localization files. These files have the file extension and can be edited in any normal text editor. GitHub If you are working via GitHub, look for the files belonging to the language you wish to use. If no files exist for the language, see the section to learn how to generate the files. Contact Mod Developer or New Translation Mod If you are working without the source code, the easiest method is to make a new translation mod. Follow the to generate a mod skeleton. I'd recommend that the mod be named: . For example, a French translation of might be named . The display name should follow a similar pattern, maybe . While making the mod skeleton, don't generate the template sword item by leaving the entry for blank. Now, find in your mod's ModSources folder and open it in a text editor. Add the following line: , replacing with the appropriate internal mod name (A mods internal mod name can be seen by finding the mod in in the ). Next, add another line with . Save . Next, find in and delete it, then make a file for the language you wish to support using the . You can now build the mod in game. Make sure the mod you wish to translate is also enabled and reload mods. Your mods source code folder will now be populated with files. Note that the files will be organized according to the original mods layout, so you might need to look around for the files. If you take this approach, follow the steps in the section. An alternate approach to generating a new mod if you intend to contribute the translations to the original mod developer is extracting the localization files directly. This approach is simple but will require more work later on. First, open up tModLoader and switch the game language to the language you wish to contribute. Next, navigate to the Mods menu and make sure the mod is enabled. Reload mods if necessary. In the Mods menu, click the button. On the bottom right is a button for , press it. Once you press the button, the file explorer should appear opened to . This folder now contains all localization files in the same layout as the original mod. Do not move or rename files within this folder, that would make it harder for the original mod developer to integrate your changes. You'll likely only find a single file, this is typical. If you take this approach, follow the steps in the section. Editing Localization Files Now that you have the file or files for your language, open it in a text editor. You should see entries for content in the mod. As a translator, you only need to edit the right side of lines with the format . Leave category names and keys untouched (text to the left of ). For example: This example shows 3 translation entries: , , and . The and entries are \"commented out\", while the entry has already been translated into Chinese. The entry uses the single line comment style, while the entry uses the multiline comment style. After translating the right side of the and entries, the translator should un comment the entry by deleting the at the start of the line or the and surrounding the entry. You will also see lines with comments in the form . These lines should not be translated, they are simply there for context and other notes the original author wrote down. After translating, make sure to save the file. Placeholders and Substitutions You may come across special text like or in localization files. These are advanced usages of the localization system meant to streamline translations and reduce text repetition. See for information about and for information about or other numbers. Pluralization In many languages, plural nouns take different forms depending on the count. See for information on this feature. Testing Localization Files If there are any localization keys that are complicated or seem ambiguous, you may want to test your edits. GitHub If you are working on the source code directly, you simply need to build and reload your mod in game. The section can teach you how to do that. The can be used to test changes further while in game without requiring a rebuild and reload. Contact Mod Developer Since you don't have the mod code, you'll have to leave this step up to the mod author, or follow the steps below to make a temporary mod to test your changes. If you do, remember not to publish the mod. New Translation Mod To test a translation mod, first make sure the original mod is enabled, then build and reload your mod in game. You should see your translations working. The can be used to test further changes while in game without requiring a rebuild and reload. Publishing Localization Files Once you have checked over everything and made necessary changes, you'll want to publish your localization. This step also depends on which localization approach you are using. GitHub If you are familiar with GitHub, or want to learn how, you can make a pull request. More info on how to work with GitHub is found in the section below. If learning to use GitHub is too much work, there are other ways to contact the author with your translations. One simple way is to make an Issue on their GitHub page and post the files there. If you intend to localize many mods, it may be worth it to learn the basics of GitHub. Contact Mod Developer Send the finished files to the mod developer. The mod developer will then use your files in their code. The mod developer might want to track translation credits in a comment at the top of their English translation file, and also on their workshop homepage. New Translation Mod If you would like, make an icon for your translation mod. With permission, you might be able to modify the original mods icon. has info on the dimensions of the icon files. You'll also want to edit with information about the translation mod. Once everything is ready, should build the mod once more and then publish the mod. This is done in the Mod Sources menu. Maintaining Localization Files The mod you localized might update with new content. If that happens, you might want to update the translations. GitHub Pull or download the latest code. The template file should be updated already with missing translations. If it isn't, build and reload the mod. Contact Mod Developer If you made a translation mod, reload the mods to update the localization files. Find new untranslated entries, translate them, and get the new files to the mod developer once again. If you extracted the localization files instead, follow the same steps as before with the updated mod downloaded. If the author integrated your translations from earlier into the latest release, those entries should already be translated in the newly extracted localization files. New Translation Mod Reloading the mods should update the localization files. Find new untranslated entries, translate them, and publish. GitHub for Localizers This section is a simplified guide to GitHub and Git containing only information necessary for contributing localizations to mods. Terminology Git and GitHub Most mods will publish their source using the git version control system. GitHub, the site you're on, provides a nice global place for everyone to contribute to projects using git. Repository A repository is a specific GitHub project. This typically corresponds to the source code of a single mod. Commit A commit in git is a push of changes to the project. Every commit made has changed certain files in the project. When you have created translations for a mod, those will be pushed to the project via a commit. Fork Since you are likely not an official contributor to the project, you cannot push commits to the official project. That is why you must fork the project. A fork is a copy of the project under your own account. This lets you modify files and show them to the world, but not under the official project. Pull request When you've created your translations and committed them to your fork, they are not yet in the official project. In order to do this, you must create a pull request to the official project. On the page of your fork GitHub should provide you with a button to submit a pull request. Basic Step Overview 1. Login to your GitHub account 1. If you do not have an account, you can register yourself for free on GitHub . 1. Go to the official project, fork the project to your account: 1. Create the translations and commit them to your fork 1. Submit a pull request Contributing Localization Step by Step Example In this example we will be localizing the mod. First, log into GitHub. Next, open up the GitHub homepage for the mod you wish to localize. Find the button near the top of the page to create your own copy of the GitHub repository: On the next page, simply click . Wait for the page to refresh. Next, we need to find the localization files. Navigate to the \"Localization\" folder by clicking on it in the file view section: You should be able to find a listing of files. Note that file organization might be different for different mods, so you may need to look around. Find a file corresponding to the language you with to contribute to and click it. (If there is no file, you'll have to clone the mod's repository to your computer and work locally instead.) Once you've opened the file, first check to see if there are any missing translations. If there are, then there is work to be done. Click the button: You can now edit the file. Remember to remove from untranslated entries that you translate. Once you are done, click : A window will pop up, click after optionally editing the commit message and description. Next, navigate to the tab: Click and then : You should now see a list of changes you have made. Double check that they look correct. Click if everything looks correct: This next page allows you to edit the title and description of the pull request. Click . After clicking, your pull request is created. The mod owner will be notified and will review and merge your pull request when they have time. Congratulations! You have now contributed translations to a mod. If the mod owners accept your pull request the translations will be in the next release of the mod. Localizing tModLoader If you wish to contribute translations to tModLoader itself, there are a few differences from contributing to a mod. tModLoader doesn't use files seen in mods, but files, so the syntax is slightly different. The process is roughly the same, except for the structure of the files. Navigate to the and find the file you want to edit. Open the file and look for entries that have before them. These are missing translations. Follow the same procedure as translating a mod with a GitHub. Fork, edit, and create a pull request. You should be able to do all of these steps directly on GitHub.com if you are logged in. Remember to only change the right side and remove the from the lines you localize. Unlike with files, the quotes ( ) are needed, so don't delete them. If you wish to test your changes in game, you would need to follow to build tModLoader. For many non technical users, this is an involved process, so it is not necessary. If you need guidance on any of these instructions we are always willing to help on the . Localizing tModLoader Steam Store Page In addition to the in game text, we also localize the itself. These files are found in the folder and missing languages can be supplied through creating the files in a pull request. Localizing tModLoader Steam Workshop Page The mod \"tags\" that the user can click while visiting the are derived from the files mentioned above. If those files have been updated but they do not yet show on the workshop page, please let a tModLoader developer know and we will upload them. Localizing tModLoader News Announcements If you would like to help translate the monthly release announcements posted on Steam, please come to the on Discord and let us know. Localizing ExampleMod We do not localized at this time, the other languages present are there simply to demonstrate how the mod localization process works. Localizing tModCodeAssist The messages can also be localized. Editing these requires setting up the , and since there are only a few messages to localize, it is usually easier to just ping a tModLoader team member on Discord with the translations. If you want to contribute it directly, read the following: Localizing tModCodeAssist details First, open up the and then open up the files in the and the projects. In the \"Neutral Value\" column you'll find the English values. Scroll to the right to find your language, then type in the translations. After you are done editing both files, make a commit and pull request as usual. This screenshot shows where the description, title, and message text are shown to the user, for reference."},{"path":"螺线翻译tml教程/杂项/Contributing-to-tModPorter 向tModPorter贡献代码.md","filename":"Contributing-to-tModPorter 向tModPorter贡献代码.md","title":"Contributing-to-tModPorter 向tModPorter贡献代码","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction tModPorter allows modders to easily port their existing code to the latest tModLoader API. tModPorter is updated alongside tModLoader. Whenever changes are made to the tModLoader API that would break the source code of existing mods, we attempt to write tModPorter code that would fix the code for the modder. In rare cases where an automatic fix is not possible, we add comments to instruct the modder on how to fix their code to accommodate the changes. Pull Requests Writing tModPorter tests and code refactors is a slightly different skill set than making changes to the tModLoader source code itself. When a contributor makes a pull request, it is not expected that they write the tModPorter code. Frequent contributors, however, are encouraged to try writing tModPorter code for their pull requests. This guide will help interested contributors write tModPorter code. We encourage contributors to give it an attempt, as it will speed up tModLoader development. Remember that tModPorter code is not required for a pull request to be reviewed. The tModLoader maintainers will be able to write the tModPorter code when reviewing the pull request if needed. When is tModPorter Needed Not all changes to tModLoader require tModPorter changes. New hooks, new functionality, and newly public variables are all examples of pull requests that wouldn't need any tModPorter consideration. tModPorter is needed when existing modder's code would have compile errors if the changes in your pull request were published. For example, changing the parameters to a hook is a typical change that would necessitate tModPorter code. Basics There are 2 main parts to tModPorter, the \"Tests\" and the \"Refactors\". We'll first create a failing test, then add refactors to fix those failing tests. Note that the instructions in this guide will be demonstrated in screenshots using a contrived example that adds a to the method. Run Tests Fist, let's make sure the tests run correctly before any changes. This is a sanity check. Follow these steps: Open up Build the project In the solution explorer, right click on the project and select \"Run Tests\" This will build the and projects and will bring up the \"Test Explorer\" panel. After a few moments the tests should run and they should all pass. If something doesn't pass, either you forgot to build the Terraria project or something else is wrong. Seek help from a tModLoader maintainer. It everything passes, you are ready for the next step. Write Failing Tests In the solution explorer, open up the project and the folder, you should see a collection of files. These files come in pairs, both the regular file and an \".Expected.\" file. The regular file is the input given to tModPorter and the other is the expected output of tModPorter: Let's look at an example, open up and . In , the input file, you'll see code from various previous versions of tModLoader. For example, the parameters for used to be . In , the expected output file, you'll see the expected result from running tModPorter. Here we see that now has the current parameters . Now that we know about the input and expected files, it is time to write the tests. Find the file that most suits the changes in your PR. If no file exists, they can be created, but there should be existing tests for most of the tModLoader API classes. Add code to the input file that shows what modders might be using currently. Keep the code simple, just the changed method or field, no need to write actual mod content. Next, add the new code to the expected file. Run the tests again. You should see one or two failures. If the test fails, that means that the expected files do not build correctly. Click on the test entry to view the error message. This might just be a missing using statement, add the using statement to both the input and expected files and try running the tests again. If you see \"no suitable method found to override\", you likely forgot to build the project or made a typo. (In the rare case that tModPorter will not be able to fully port code to the new approach, see the section below for how to tell the tests to ignore compilation errors in the expected output.) You should see an error for the input file you edited in the section. If you do not, then something is wrong. The error details will show a diff between the expected file and the output file. At this point we want this test to fail, we will be fixing this in the next section. Ensure that the diff looks correct. There should only be a diff shown for the changes that tModPorter will be expected to fix. Write Refactors Now we are ready to write the actual tModPorter code. Open up the file in the project. This is where most of the refactors are implemented. Each statement in this file represents an automatic refactor that tModPorter will apply to the mod's source code. For example, the first line, , will change all usage of the instance field in the class to . If you remember, this change happened in the 1.4.3 release. This code is still present so that tModPorter can help port even 1.3 mods to current tModLoader. Take an opportunity to find a refactor that is similar to the changes you are implementing, there should be examples of all of the tModPorter functionality. Use the existing refactors as a guide. Now find a suitable place for your refactor. Try to follow the existing file organization. Follow the patterns shown in the examples to implement the refactor: Run Tests Again Now run the tests again (right click on the project and select \"Run Tests\"). If all goes well, you should see that the test has passed: If the test failed because of code formatting or whitespace, fix the issue in the expected or input file and run again. If the refactor doesn't seem to be applying at all, double check your code. If it is still failing, seek help from a tModLoader maintainer. Once it is all working, commit your code changes to GitHub. Update Pull Request Please update your pull request with a section. The section should detail the manual steps a modder would need to take to replicate the automatic refactors done by tModPorter. It should also mention other changes modders will need to adapt to. We will use this information to show in the channel on the , the , and the on our wiki. Do not update the migration guide wiki page, the tModLoader maintainers will do that. Workflow To recap, this is the basic workflow: Open up Build the project Make failing test Write refactor code Ensure test succeeds Commit changes and update pull request description Advanced if COMPILE ERROR Sometimes the functionality of tModPorter is insufficient to do all the changes for the modder. For example, the example has a section \"commented out\" by using . This section of code will not compile. Leaving in compiler errors is unavoidable in more advanced situations. In this case, the comments instruct the modder on how to fix the issue. We use the pattern to allow the tests to skip attempting to build those lines of code, allowing the test to continue succeeding. Don't use unless the actual result should result in a compile error."},{"path":"螺线翻译tml教程/杂项/Debugging-Multiplayer-Usage-Issues 多人模式常见问题.md","filename":"Debugging-Multiplayer-Usage-Issues 多人模式常见问题.md","title":"Debugging-Multiplayer-Usage-Issues 多人模式常见问题","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This guide is to help those who are having troubles with playing multiplayer with tModLoader. I can't join my own server using Host and Play Verify that you are connecting to the correct server \"You are not using the same version as this server\" You are trying to connect to a server that is not the correct version. You might be trying to connect to an un modded server, or you might be connecting to an outdated tModLoader server. 1. Open tModLoader 2. Open directly by opening the and double clicking on the file. 3. Verify that the tModLoader version of the Client and the Server match exactly. If not, reinstall the latest tModLoader. 4. You can also verify the filesizes Version is fine If version is the same, but the client still reports it's not the same version, check that the host doesn't also have a vanilla/unmodded server running on the same port (usually 7777). If version isn't the issue, read below Stuck on \"Found Server\" If you have an ASUS computer, there seems to be a program called Armory Crate running that prevents running the server on the normal 7777 port. You can close that program, or launch the server manually with a different port to bypass this issue. Make sure when you connect to the server to specify the new port as well. If you do not have that you can check for other programs taking the ports by opening up Resource Monitor, going to the Network tab, then expand TCP Connections and Listening Ports, then sort them both by Port. Look for any program using the default 7777 port. When I join my own server, mods get disabled This is caused by bad mods. You must view the file or start the server with the console visible to identify the issue. (Note: Option currently broken, see next option instead) Set Show Server Console to On: When the console shows up, look for red text or anything that looks out of place. Reading the exception messages, you should see mod names mentioned, disable those mods. View by opening the file from the in a text editor. Look for exception messages and stop using the mods that are causing the errors. If you are the developer of the mod that is being disabled, the most common reason for this is code accessing fields that are only assigned on the client but are on the server. Another common issue is attempting to access or initialize UI fields, which also aren't initialized on the server. The error message in should contain the file and line number of the error, but the easiest way to located and fix these issues is to . I can join my server, but my friend can't Make sure you have the correct IP address 1. If you are giving your friends an IP address that looks like , then you have the wrong IP address. IP addresses that start with are local IP addresses and will only work for playing with friends that are physically at your house connected to the same router as you. 2. To find your internet IP address, you can google \"what is my ip address\" or visit a site like . This number is the address you need to give to your friends. This number can change every once in a while, depending on your internet service provider. Verify that your server is visible to the internet 1. Open directly by opening the and double clicking on the file. (You can do this in Host and Play by setting Show Server Console to On: ) 2. Select a world and start the server 3. Go to on the computer with the server running and type in 7777 as the port (adjust this if you changed it.) 4. Click Check Port If the website says error, your ports are not open. You may need to enable UPnP on your router, unblock the file on the Windows Firewall, or manually port forward on the router. With the firewall, you'll want to click details and make sure the path matches the modded server path. There might be 4 separate entries depending on how you installed tModLoader, so you'll need to check all of them. You'll want to make sure both check boxes are checked. For router issues you'll just have to Google that and learn how to do that. If the website says Success, you should see a message like \"Exception normal: Tried to send data to a client after losing connection\" on the server console. This is fine. We now know that the server is visible to the internet, so the problem might be on your friends computer. My connection is fine but my friend or I am stuck on \"Connecting...\" This is where things get complicated. There could be many reasons for this error, and most of them are likely caused by poorly programmed mods. The best approach is to launch the server manually (NOT Host and Play) and watch for messages that appear to be errors in the output. (You can do this in Host and Play by setting Show Server Console to On: ) First, I would suggest using fresh player and world files and attempting to connect to the server. If this works, the problem might be a mod that has trouble saving or loading its custom data correctly. To figure out which mod is causing issues, you'll need to start the server many different times either adding or removing mods from your list of mods until you discover that you can join the server again. I'd start with no mods and then work my way up, adding a few mods at a time. Once you discover that you can't connect anymore, you have found a problem mod by the process of elimination. Unfortunately, the solution is to just not use that mod unless the modder who made the mod can diagnose the problem using your modlist, or world and player files. The process:"},{"path":"螺线翻译tml教程/杂项/Detouring-and-IL-Editing-using-HookEndpointManager 函数重定向与IL编辑-使用HookEndpointManager.md","filename":"Detouring-and-IL-Editing-using-HookEndpointManager 函数重定向与IL编辑-使用HookEndpointManager.md","title":"Detouring-and-IL-Editing-using-HookEndpointManager 函数重定向与IL编辑-使用HookEndpointManager","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In 1.4.4 is obsolete, use for detours or for IL patches, these require to be applied, unloaded and stored manually. There is also another way to modify other mod methods. If you looked into dlls generated with MonoMod's HookGen, you would see that it uses : You can skip creating intermediate dll with HookGen and call directly. However, it's not possible (at least in C 10 and .NET 6) to create hooks exactly like HookGen does it, so doing this will require some knowledge of working with Reflection. Preparations Start by getting of the method you want to detour or IL edit: Detouring If the method has more than 1 2 parameters, or any , or parameters, add separate delegate for original method: delegate matches with original method signature (return type and parameters). Detour method ( ) matches original method but with added first parameter, delegate. Please note that instance methods will have first parameter as class instance: And finally, call : tModLoader will make sure all detours and IL edits are unloaded during mod unloading, there is no need to manually unregister them s and s In some scenarios, custom orig delegate can be replace with or , for example if method has 1 or less parameters Some more Action/Func examples In some cases Action or Func can't be used, for example, if method has any , or parameter(s) IL Editing IL Editing is easier to setup than detouring, just create a method that retuns and has single parameter to manipulate IL and call ."},{"path":"螺线翻译tml教程/杂项/Fixing-Mod-Not-Fully-Unloaded 修复模组未完全卸载问题.md","filename":"Fixing-Mod-Not-Fully-Unloaded 修复模组未完全卸载问题.md","title":"Fixing-Mod-Not-Fully-Unloaded 修复模组未完全卸载问题","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction This guide goes over debugging your mod in Visual Studio in an effort to determine why your mod isn't fully unloading during a mod reload. Proper unload code ensures that mods properly reset their values and don't use excess RAM. This guide assumes you know how to debug your mod in Visual Studio, as it is necessary. Unload Basics As you know, c utilizes managed memory, meaning we can usually ignore memory considerations as we can trust that the garbage collector will clean up objects that are no longer being referenced. For Mods, there are many common pitfalls that will result in objects being referenced after tModLoader attempts to unload the Mod, causing a mod to continue consuming RAM/memory after being disabled. In an effort to fix these issues, starting in tModLoader v0.11 the Mods menu will inform users of mods that fail to unload properly. shows many common things that modders need to remember to \"unload\" (set to null). The main culprit is usually static references to any tModLoader class. Make sure to set those to null. Static references to XNA classes like will also cause issues. Debug After you have made sure to null out all references you can think of, you may find that your mod is still failing to unload. To fix this, we will use Visual Studio. First, however, make sure to disable all other mods, as some mods maintain references to other mods. If disabling all other mods fixes the issue, the issue is with a different mod that is preventing your mod from unloading. Tell them to fix their mod. Launch the Debugger Start your mod as normal through Visual Studio. See if you have forgotten, but this guide assumes you know how to debug your mod in Visual Studio. Edit and Continue plus memory Snapshots After a successful launch, disable the mod, then reload and take note of the icon notifying that the mod did not unload properly. Now, in Visual Studio, click in the window. This will make VS remember all the currently active objects in memory. Click the number in the objects column and a window will come up to search the snapshot. In the search bar on the top right, type in the namespace of your mod. This will filter the results to just object references of classes added in your mod. (Also make sure is selected) You should see 1 or more results: Here we have selected the (the name of the class this example happens to be using) item from the list, populating the view below with references to that Type. The tree view below shows that there is 1 reference to this Type in the class in a static variable in PresentOpener itself, in a field called . Looking at our code, we can see that it is actually empty! Oops! Let's set a breakpoint there, enable the mod, reload, disable the mod, then reload again. This will hit the breakpoint, allowing us to fix this first issue. Now, we repeat the process again. This time hopefully the item we just fixed no longer shows up. Make sure to take snapshots after disabling a mod that was loaded previously. Lets fix another issue: Here we see another static reference, this time to a tModLoader API class (ModConfig). Remember, static references to these classes will prevent the data from being unloaded. Lets set a breakpoint at the start of again and fix this problem as well. Then, we can do another snapshot once we are done and have once again loaded and unloaded the mod. We are getting closer, just a few more. Looking at these last 2, I noticed that PresentProcessUI held a reference to our VanillaItemSlotWrapper class. Fixing the unloaded reference to PresentProcessUI automatically orphans the reference to the VanillaItemSlotWrapper class, making this last fix a 2 for 1. After setting the 3 static fields from our class to null in , our mod finally unloads properly. Not all issues are as easily solved, but I hope this guide teaches you how to use the Visual Studio Diagnostic Tools to debug these memory issues well enough that you can figure out how to fix your own mod. Tips ILoadable It may be wise to implement an ILoadable interface: You can implement this interface in any class you wish to follow load/unload behavior, then from your main Load() and Unload() routines in the Mod class, you can simply call Load() and Unload() respectively on anything that implements ILoadable: What is Those can be ignored, and should go away once you fix the other issues. Compare To Snapshot confusion If the reference results doesn't seem to be getting smaller, make sure you aren't comparing to a previous snapshot:"},{"path":"螺线翻译tml教程/杂项/JIT-Exception JIT异常.md","filename":"JIT-Exception JIT异常.md","title":"JIT-Exception JIT异常","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What are JIT Exceptions? In an effort to avoid silent errors caused by tModLoader updating frequently and mods becoming \"out of date\", tModLoader now inspects all classes and methods of each mod as it loads, checking that it can work properly. tModLoader developers strive to avoid these types of issues through careful programming, but sometimes these issues are unforeseen or unavoidable. Player Instructions The mod is broken, you'll need to wait for the mod to update. It is possible the author does not know the mod is broken or does not wish to continue updating the mod. You can check the mods preferred feedback location to see if you can find more information or inform the author of the issue if no one else has reported the issue. Typically mods have a GitHub Issue tracker, a Discord server, or the mod's Steam Workshop page as their preferred feedback location. Modder Instructions You need to update your mod. Most of the time these errors happen because tModLoader changed and your mod has not updated. For example, if a tModLoader method changes, your mod will be broken because it is trying to use a method that no longer exists. The other possibility is that your mod uses strong or weak references and recent tModLoader changes dictate that you will need to further annotate some methods or classes in your mod to accommodate. tModLoader Changed You'll need to change the code in your mod to fix all the errors now present and publish a release. The first step is to run tModPorter from the ModSources menu. This should fix most errors. There will be some errors remaining that have new comments added by tModPorter, you'll need to fix those remaining errors according to the commented instructions. There are some changes that won't be handled by tModPorter. The channel on the is where we track breaking changes introduced in the tModLoader Preview in anticipation for each months update. There will usually be listed for changes that could break existing mods. The is also updated occasionally. There is a slight possibility that there are no errors in Visual Studio, but your original published mod fails to load. In this case, building the mod and publishing again should fix the issue. This is typically caused by a new optional argument being added to a method you were previously using. tModLoader Changed Example Here is a typical message, this example will go through interpreting and fixing this specific error: First, we see at the top the the mod causing the error is called \"BannerBonanza\". In the next section, we see the actual message, it says that: In BannerBonanza.Items.BannerRackItem.SetDefaults, Method not found: 'Void Terraria.Item.DefaultToPlacableWall(UInt16)'.\" From this, we know that in the class in the namespace, the method is where this particular error is happening. The error says that the method doesn't exist. When this mod was built, the method did exist, but apparently it doesn't anymore. At this point, you could check the channel on the and look for recent messages talking about this. Here is an example of what that would look like: At this point, open up Visual Studio and navigate to the location of the error. You should be able to immediately see red underlines indicating an error: Using the information provided in the update log message or other methods, fix the error by changing to . (Notice the missing \"e\" in the original \"Placeable\" spelling.) This quick example should teach the basic steps for fixing JIT Exceptions, but feel free to come by the channel if you have trouble figuring out how to fix your issue. There is a slight possibility that there are no errors in Visual Studio, but your original published mod fails to load. In this case, building the mod and publishing again should fix the issue. This is typically caused by a new optional argument being added to a method you were previously using. Strong References If you get this error with a strongly referenced mod, most likely that mod changed. Extract the latest .dll from that mod and reference the newer .dll file in visual studio instead of the older one. Make sure to update build.txt to reference at least that version number using . Next, fix the errors and publish an update. Weak References The other possible cause of a is a weak reference to another mod. When the game inspects all classes looking for errors, it'll trigger for references to other mods that can't be resolved. You'll need to annotate classes with special attributes to tell tModLoader to skip attempting to inspect these classes. excludes a class/method/property from the load time JIT. Use this on any member which directly references a type from a mod that may not be present. Provide the mod names that all need to be loaded to allow the inspection. Here are some examples in a fictional mod : If you have special circumstances, you can use the attribute on a class/method/property to skip the JIT process altogether. If you need more control, you can create a custom subclass of or set to a custom override. Note that the base implementation of checks for . These annotations do not exempt you from properly gating calls to methods with references to Types in weakly referenced mods as taught in the guide."},{"path":"螺线翻译tml教程/杂项/Localization 本地化.md","filename":"Localization 本地化.md","title":"Localization 本地化","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide was written for tModLoader v1.4.4, the most recent version of tModLoader. In legacy tModLoader, localization files won't auto update and some methods mentioned in this guide do not exist. The basic concepts still apply. Table of contents What is Localization? Localization provides the ability for a mod to be played and enjoyed by users who speak a language different from the language the mod author uses. Every piece of text that a user might see while playing a mod is contained in text files called localization files. For example, ExampleMod has an item called \"Paper Airplane\" in English, but \"Бумажный самолётик\" in Russian. Through the use of localization, Russian users can understand and enjoy the content of ExampleMod without learning English. These localization files are easy to work with, allowing users without technical skills to translate mods. These translations can then be provided to the mod author or published as a new mod, allowing more people to enjoy the mod. Even if don't intend to personally localize your mod to other languages, you will need to use localization files for the one language you do support. This wiki page will cover localization topics intended for a mod developer. If you are interested in localizing an existing mod, or providing localization to tModLoader itself, please read the . Supported Languages Currently, tModLoader supports the following locales. Listed here are the corresponding default filenames. Note that the filenames can be different if using : | Language | Abbreviation | Filename | :|: | | | | | | | English | en US | en US.hjson | | German | de DE | de DE.hjson | | Italian | it IT | it IT.hjson | | French | fr FR | fr FR.hjson | | Simplified Chinese | zh Hans | zh Hans.hjson | | Spanish | es ES | es ES.hjson | | Russian | ru RU | ru RU.hjson | | Brazilian Portuguese | pt BR | pt BR.hjson | | Polish | pl PL | pl PL.hjson | Migrating from 1.4.3 to 1.4.4 If you are updating a mod last updated during 1.4.3, expand this section and read carefully. Migrating from 1.4.3 to 1.4.4 details Beginning in tModLoader v2023.01, all localization is now done completely in the files. Declaring translations in code is no longer supported. This change will greatly streamline localization management and make mod translations easier to create. See the if you are interested in more of the rationale for these changes. If you are not using Git or some form of version control, it is recommended that you make a backup of your mod's source code folder before continuing. Generate Localization Files on 1.4.3 To begin, we need to use an older tModLoader to export localization files. You'll need to use Steam to switch to the branch. ( ) Once the game is on the right version, open up tModLoader, enable the mod, and visit the menu. Find your mod in the listing. You will find a green arrow that says \"Export 1.4.4+ localization files\" when hovered, press it. Now navigate to the folder and navigate to your mod's localization files. If you did not have localization files previously, navigate to the top level of your mod's folder. You should see newly generated files: Open up the new files in a text editor and confirm that they look correct. There should be all the entries that were previously in the current files as well as newly generated entries for all other content in the mod. If it looks good, continue to the next steps. Changed Keys Note that many key patterns have changed. These will automatically adjust in the export, but any custom keys or code that uses the old key pattern will need to be fixed by the modder. For example, is now . Changed Key Patterns Switch to 1.4.4 tModLoader and Build Mod Use Steam to switch to the branch to return to 1.4.4 tModLoader. ( ) After launching tModLoader, you'll notice that your mod (and most likely all other mods you had enabled) fails to load, this is expected. Visit the Mod Sources menu and press the \"Run tModPorter\" button. Along with other changes, this will remove all code using the old localization approach. After this, you'll want to find those files and use them to replace the existing files. To do that, first delete the current files (if any) and then rename the files to the extension. (If you can't rename the extensions for the files, you'll need to so you can.) Now, you might need to open up Visual Studio and fix any remaining compilation issues. Once you have fixed any remaining issues, you can rebuild your mod and it should work. Once things are working, you can search through your mods source code for lines like or and delete them. They will no longer be used. (You can search all files in the project for the search term to easily find most of these lines.) You can use the following regexes to help find the calls more easily (and replace them with an empty string). Both requires using a tool like Notepad++ with the \". matches newline\" option enabled Single line comments: Multi line comments: Quick guide for Notepad++ to apply this to an entire mod: Open any file with Notepad++, press ctrl + F, click the \"Find in Files\" tab, Select \"Regular Expression\" and \". matches newline\" at the bottom, then to \"Filters:\" add , for \"Directory:\" click the button on the right to navigate to your mod's root folder. Finally, paste the regex expression into \"Find what:\" and leave \"Replace with\": empty, then press \"Replace in Files\". If you made a mistake, just press ctrl + Z once to revert all changes. It's recommended to use versioning software like git to be able to manually revert if required, and to review the result. Localization Workflow Localization files are updated at the end of mod loading. This means that a modder will need to build and load a mod after adding content in order for the localization files to update. After they update, the modder can edit the files to add translations. After this is done, the mod can be built and reloaded once again for the translations to appear in game. To avoid losing work, please be aware of the intended workflow: 1. Add new content to mod, such as a new 2. Build and Reload Mod 3. At this point, the files will have automatically been updated with entries for new content. Edit files to give new content an English name 4. Build and Reload Mod 5. Non English files are now updated with appropriate placeholders and can be updated as well by translators or mod makers If a translator sends you an updated file to add to your mod directly, be aware that it might get overwritten if the mod loads and tModLoader detects that the file is newer than the file for some reason. If this is the case, the best option is to build the mod before loading or reloading the mod. You can build in Visual Studio while tModLoader is closed, or you can skip loading mods when launching tModLoader by holding down the shift key, then immediately visit the Mod Sources menu to build the mod. If you forget to do this and find that tModLoader reverted the newly translated files to their old content, copy the updated files into the mod sources folder again and then build and reload. Live Updating tModLoader will detect when files in the ModSources folders are saved and will reload them automatically while in game. By using this approach, the modder does not need to rebuild and reload the mod to test the new values. If you are using this feature, remember to rebuild the mod before publishing so that all the changes make it into the published mod. Here we see the feature in action. The modder edits the file and then saves to change the English display name and tooltip of the item. The changes appear in game after a couple seconds: https://user images.githubusercontent.com/4522492/229942438 26604fd7 9073 436c b2ab d99b4f2efeb7.mp4 How Localization Works Every piece of text in the game, from the names of items to the words on the main menu, uses localization. Each piece of text in the game is actually a pair of data: a localization key and a localization value. For example, when the player is creating a small world, the game uses the localization key of to look up the correct translation value for the currently loaded language, and displays the word \"Small\" to the user if English is selected. If another language is selected, the game still looks up but the localization value will be different. As the creators of Terraria write code in English, most localization keys are very similar to their English translation value. In tModLoader, mods use files to cleanly contain localization keys and localization values. Each language has their own file. If you are familiar with JSON, these files will be familiar. Here is a simple example: Filename: tModLoader/ModSources/ExampleMod/en US.hjson In this example, we can see 2 main concepts: localization keys and localization translations. The localization key is derived from the combination of all the text to the left of at each level of nesting. The text to the right of the is the localization value. This example communicates 2 localization keys and their corresponding localization values: corresponds to and corresponds to . If the syntax seems complicated, do not worry, modders do not need to manually edit these files, the game will update them automatically. When this mod is loaded, tModLoader will find all localization files corresponding to the current language and store them in memory. When the game needs to display text to the user, a key is used to query the stored data and retrieve the correct text. Translations are stored in memory as a object, modders can use the method to retrieve the object from a localization key. The property can be used to retrieve the localization value from the object. Alternatively, the method returns the localization value directly from a localization key: Localization Keys tModLoader will automatically assign translation keys to most content. The key pattern is , where is the internal name of the mod, is supplied by the type of content, is the internal name of the content (commonly the classname), and specifies the key within the class. For example, has the set as . It also has 2 separate pieces of data, the and the . If a mod named adds a class named , then 2 keys will be generated and added to the files: and . Note: Avoid spaces and other special characters in localization keys. Substitutions If there is text that repeats often in your localization files, or if you wish to use existing text in the game, you can use substitutions to keep your localization files clean and organized. Substitutions take the form of in localization values. When the game loads, these sections will be replaced by the localized text corresponding to the key provided. For example, the game already has translations for the text , stored in the key. A mod can utilize substitutions to reuse that value. The entry would end up with the text in the users language for this item. Other existing translations such as item names and other common tooltips are also available for use. Translations from within the mod can also be used. For example in , is used to reuse the translations contained in the key. Many substitutions have or in them, these are placeholders for values modders can provide. This functionality is explained in the . Existing Item Tooltips Using the existing item tooltips provided by the game in your modded items is a good idea. Using consistent language and existing translations makes your mod more appealing to more people. Expand the section below to view a listing of existing common tooltips. Remember that the key for all of these will start with . CommonItemTooltip Keys Other Existing Translations In addition to the translation keys intended to be used for item tooltips, modders can reference any other translation key in the game. , for example, is the key to get the localized name of Blue Slime. Modders can view all localization keys by downloading the file mentioned in the . Note that modded translation keys do not follow the same key pattern as Terraria content. For example, ExampleMod's has the translation key of . The translation key of modded content will not necessarily follow a default pattern, so code should not be written with that assumption. Scope Simplification If substitution keys share a scope with the value for a localization key they are being used in, the substitution key can be simplified. For example, in , the value of the key is set to . In this case, the game knows to check for keys within the current scope resulting in the value of the key being found and substituted in. Using this technique, can be omitted from substitution keys. More text of the substitution key can be omitted the more it matches the key of the value that it is being used in. Expand for detailed logic The substitution key is appended to the current key, then the current key without the last postfix, and so on until an existing key is found. Key: Value: key checked, it does not exist. key checked, it does not exist. key checked, it does not exist. key checked, it does exist, so it is used in the substitution. Overriding Content Localization Keys If many items in your mod share a common translation, you can have them all point to the same translation key. To do this, override the property and return the result of using the translation key you wish to use: If you are using inheritance, you only need to do this in the base class and can even override it again in child classes if a specific child class needs a different localization. See for how to add extra localizations to your content, beyond the default properties provided by tModLoader. Modders can use to indicate that no translation key should be generated. Using this can keep the localization files cleaner. String Formatting Modders can use to leave places in translations for text to be filled in when used. This is a normal feature of c . Modders can use the method or overloads to use string formatting. The Placeholders section below has more info on this. Placeholders You may see things like in translation entries. The and are placeholders for text that the game will fill in depending on the logic of the code. This is similar to how is used in normal C programming. You may have to see the text in game to make sense of the usage in order to make accurate localization. Binding Values to Localizations Many translation entries have placeholders like or in them, indicating places where the modder can supply a value. For example, the translation key has a value of . In order to use this in an accessory item, we need to be able to provide a number to be used in place of the placeholder. First, in the file, we assign the tooltip for our item: Next, we need to \"bind\" our intended value to this tooltip. This accessory is intended to boost max minions by 3. To do this, we override the property and call the method on the original tooltip. This will populate the placeholder with the value provided. We recommend using a field in your class to store these stats. In the example below, is used in 2 separate places. Using a field allows the modder to change the behavior and tooltip at the same time. The field being prevents accidentally attempting to modify the value at runtime, which would not work with . This approach prevents typos that could potentially result in the tooltip and behavior being out of sync. LocalizedText.Format method In the previous section the method was used to bind values to a instance. This is useful for one time assignments. Sometimes, however, we want to format a with values that change and need to be updated every time the text is displayed. To do this, we use the method in a similar manner, passing in arguments to fill placeholders. This method, however, returns the final directly, it does not bind values to the . We use in code that will be executed during gameplay, such as . Multiple Formattable Substitutions When a localization references multiple substitutions, there might be an issue of repeated placeholders. For example, an accessory that uses and will find that they both use the placeholder. Attempting to bind values to a tooltip that uses both of these text substitutions will not work without additional work. Modders can use special syntax to offset indexes within a specific substitution key. Adding an followed by a number after a substitution key will increase the placeholders within that key by the number specified. In short, the syntax is . serves as a good example of this feature: Existing CommonItemTooltip Entries from ExampleMod/Localization/en US.hjson ExampleMod/Content/Items/Armor/ExampleBreastplate.cs From this example, we can see that is attempting to bind to and to . Because was added to in the localization entry, the original placeholder of was interpreted as instead, allowing the game to bind the value of to the correct spot in the resulting tooltip text. This may seem a bit complicated, it might be simpler to ignore text substitutions and altogether and just type out the tooltip text directly in the localization file, but the benefits of this approach can be significant if used correctly. With this approach, much of your mod will automatically be localized to other languages. This approach also significantly reduces the chance of a typo causing confusion at a later date. See and the corresponding entry for an even more complex example of this feature. Combining Translations for Dynamic Content In rare situations, you may need a translation which references the name of content from another mod, but you are unable to create a specific translation because the combinations are generated at runtime. ADVICE: Avoid the temptation to create combination translations just because English always follows a certain pattern, as there may not be a suitable pattern in all languages. Instead try and make as many unique and detailed translations as possible. For example, you might be tempted to make and substitute in the damage class names ( , , ) etc. This would work in English, but other languages may require changing the structure of the phrase or adding additional grammar based on the substitution. Eg, may translate to but may translate to and attempts like or may not make sense. A classic example would be a mod which automatically adds infinite ammo items to every ammo item in the game. can accept other as parameters. You can also override a property to return an entirely different all together (see in the example below) ModConfig Usage The and of elements can utilize text substitutions. Through the and attributes, values can be provided to the corresponding translation. Note that strings starting with \"$\" are interpreted as translation keys. The , , and examples in show off this capability. Pluralization When using placeholders for numbers, such as in , you'll run into issues in English when the number is exactly 1. When the number is 1, the text should say \"1 minute ago\" instead of \"1 minutes ago\". This issue can be solved with pluralization. As an extension to placeholders, tModLoader also supports language rule defined cardinal pluralization. In English, nouns have two forms, one for a single count of that noun, and one for multiple of that noun. For example, \"1 dog\" and \"3 dogs\". Other languages have different rules. To support this, special syntax is used to provide translations the ability to pluralize properly. In this example, , the is the placeholder where a number will be populated, and the tells the game to check the 0 th placeholder and use its value to choose between and . English, German, Italian, Spanish, and Portuguese all use the first form for values of 1, and the 2nd form for other values. French uses the first form for values of 0 or 1, and the 2nd form for other values. Chinese only has 1 form regardless of count. Polish and Russian form rules are a bit more complicated and can be found on . The order of cardinal forms in these charts correspond to the order tModLoader will use. Chat Tags Color and item icons can be added to localization values using . Find in for an example of this. NetworkText class When dealing with text in multiplayer, it is desirable for text to display to each client in their selected language rather than the language of the server or client sending the message. The class helps facilitate that. You'll notice that methods dealing with network messages use a parameter for passing in text. The class can use localization keys or the object itself to send a message in multiplayer correctly. See the documentation and examples to learn mod. Timing Considerations The localization values contained in mods are not available during the early stages of mod loading. For example, if is used during the early stages of the mod loading process, \"MyKeyHere\" will be returned rather than the localization value contained in the files. Similarly, the method will return a dummy for keys yet to be registered. As a rule of thumb, modders should make sure to only attempt to access localization values during or after the phase. This means methods like and are suitable places to access localization values (and also retrieve instances of course). On the other hand the instances themselves can be retrieved and cached as early as assuming they are present in the localization files or retrieved using . This is particularly relevant for UI code. It is useful to initialize s during or even in game for this reason. Automatic Localization Files tModLoader will automatically update files when new content or translation keys are used. The English files will be used as the template for other languages, which will inherit comments and layout automatically. Note that localization files will update only in situations where the game thinks appropriate, for efficiency. For example, the mod must exist in the folder. The mod that is loading must also be a locally built mod. Localization files will only update if the file modified timestamp is older than the mod or any mods referenced by the mod. Be aware that testing an old file directly might overwrite your files with old content, so using Git or making a backup of your mods source code is recommended so you can restore the files. Adding Content When a modder adds new content to their mod, such as a , that piece of content will initially not be localized. The modder should build and reload their mod. Once the mod loads, the files will automatically update. The English files will now contain default translation entries for the new content. The non English files will contain those same entries, but commented out. To localize the content, the modder needs to edit the .hjson files with the desired text, save, and build and reload their mod again. The files should be saved using the UTF 8 encoding, if your text editor asks. HJSON syntax files contain Hjson data. Hjson is similar to JSON, but is intended to be human readable. See explains the details of the Hjson syntax, but most modders can just follow examples to get a feel for the syntax. Multiline If a line of text needs multiple lines, use the following syntax. Make sure the indentation is consistent: You can also use as an alternative, but for readability this is not recommended. The quotes are needed for to be interpreted as a newline. Note that tModLoader will automatically converted this to the above syntax when it updates the files: Special Characters If a translation value needs to start with or whitespace, you'll need to quote the translation. You can omit quotes in other situations. If your value needs a literal , you can use the multiline syntax: tModLoader HJSON Features Color can display colored texts. The is a Hex Color Code. Here is an example: When displayed, the 'yes' will be in green and the 'no' will be in red. Items and can display items in a message. The is the of the item. Since modded items don't have a fixed , you can use instead. The is your mod's class name and the is your item's class name. can display an item with a prefix. The is the of the prefix. can display an item at a certain stack. The is amount of the item stacked. Here is an example: In this example, will display , is a modded item from Quality of Life. will have a and a stacks at 1145. Keybinds can display the localized name of a keybind. Only for left click and for right click are supported. is the name of the keybind. Here is an example: The will be shown as the localized name of \"right click\". Comments files can contain a variety of comment styles. tModLoader uses Hjson comments to convey 2 separate concepts. Comments using the at the beginning of the line are actual comments, useable by mod authors to remind themselves of useful things. These comments should be placed immediately above the key they pertain to. Failure to place comments above the item will result in the comment being lost or misplaced when tModLoader automatically updates the localization files. Example: These comments will be copied from the English files to the non English files as well, where they can remind translators of where custom translation keys are used, for example. Comments using the or style are used by tModLoader to indicate that a non English translation key has yet to be translated. This serves as an indicator to the modder about which languages are missing translations. A translator can translated the translation value into their language and remove the comment syntax. Modders should not use this comment syntax for normal comments as they will be lost when the game automatically updates the files. Translation File Names tModLoader will attempt to load all files in the mod as localization files. As such, localization files can be placed in any folder path, but by convention we recommend placing them in a folder named \"Localization\" at the root of your mod's source folder. The mod generator follows this convention and will generate in your mod to get started. A valid culture code must be present at the start of the file name, or as the name of a containing folder to determine the language. Culture The following languages, also known as cultures, are supported: English (\"en US\"), German (\"de DE\"), Italian (\"it IT\"), French (\"fr FR\"), Spanish (\"es ES\"), Russian (\"ru RU\"), Chinese (\"zh Hans\"), Portuguese (\"pt BR\"), or Polish (\"pl PL\"). These codes are used to indicate which language the file pertains to. To start supporting a new language, see . Prefix The prefix of a file indicates that all localization entries in the file share a common prefix. The most common usage of this is to omit the and entries from localization files. By omitting these, the file is less indented and easier for some to work with. The vast majority of mods won't use localization values outside their mods prefix. For example, a file called will inherit the prefix, meaning that the file can start directly with an entry for . The pattern for this is as follows: The file path is split by folder, then by underscore. After culture is found, the next result will be used as the prefix. The following are all examples of options to indicate that a file is intended for English and should use the prefix. Non Localization .hjson files files without a culture in their filename will not be interpreted as localization files. Modders can use these files as they would any other \"data\" file, whatever that purpose might be. files with a culture in their filename that do not match the English template filenames will be renamed to and their localization entries will not be loaded. Modders encountering this rename should ensure that the English template files are updated or migrate those localization entries into other existing localization files. This is by design to keep all localization file layouts and filenames consistent. Multiple Files Modders can use multiple files to organize their translations. For example, if a mod contained and , the file could contain all item localization while the other file contains the rest of the localization entries. New content will automatically end up in an existing file that has existing entries most similar to the translation key. If you split up localization files, you only need to edit the English files and then build and reload the mod. The other languages will automatically adjust themselves to match the same layout. Adding new Translation Keys Entries for new content will automatically populate the files, but custom translation keys can also be added to the files. Note: Avoid spaces and other special characters in custom localization keys. Manually Adding Keys Manually adding keys is not the recommended approach for most custom keys, it is easy to make a mistake and will not fully utilize the power of the localization system. See for the typical way of adding new keys to your mod. Manually added keys can be useful in some situations, however. To add custom keys, a modder can follow the syntax to add the localization entry directly. For example, ExampleMod has a category called \"Common\", these entries were all manually added as they are not used by tModLoader classes directly. For example, lets start with this file: We can add a new entry for a key by adding a line and following the example. We can add a new category called by following the syntax shown in the category. We can also add an entry that only takes a single line rather than specifying the category separately by following the example. The following shows each of these approaches: Do note that when the localization files are automatically updated, tModLoader will decide how to organize and format the file, which will result in entries moving, but no data will be lost. Adding Localizable Properties Modders can add properties to their classes, for a variety of purposes. When correctly implemented, these properties will automatically populate the files and be ready for localization work. shows one such use for this. uses a property called that is used in a dynamic tooltip. The basic approach is the following: 1. Add a static property to your class 2. Assign that property in using method 3. Retrieve the localized text value when needed by accessing the property For example: In the above example, the file is automatically populated with an entry for alongside the existing and entries. The modder then updated it with the English text seen: Note instances are meant to be statically stored. Ideally you should register and retrieve them once during loading. The example does the registering in and caches the retrieved into the property. If caching is too much effort, you can access the property every time you need it for a small performance cost. Note that for translations to be automatically populated to the files, you need to access the property at least once during load time. Retrieving text from Localizable Properties In the class, the property can be used to display localized text to the user: If the text has placeholders, those can be populated with the method, which accepts as many arguments as there are placeholders: Inheritable Localized Properties When using inheritance, rather than a static property, a get only property in the base class or a non static property in the inheriting classes can be used to the same effect. The nature of inheritance allows logic and translations to be reused, keeping code and files clean and without needless repetition. For example, imagine a base class shared by several items in a mod. A property can be added to the base class that holds the for each inheriting item. The property must be accessed during for it to automatically appear in the files. Base class: MyBaseClass If classes and both inherit from , then the file will be automatically populated with stub entries for the key: If or override , make sure to keep so the original code is executed. The key generates will be of the form . If a specific key outside the expected pattern is needed, a modder could use or instead ( is a shortcut that prepends \"Mods.ModName.\" to the key, it is a more generic version compared to used in the rest of the guide as it will not contain ). Note that must be invoked prefixed by due to the design of C , it can not be omitted. By using a full key in an inherited property, the shared localization can exist in a single common translation key, with inheriting classes that need their own key overriding the property and using their own key via . Another Example serves as an example of using a custom key. By default, tModLoader will register a single translation key for each in the form . This key makes it easy to add a map entry to a tile. (Map entries control the text shown to the user when the tile is hovered over in the fullscreen map.) , however, needs 2 map entries. Using , new keys can easily be added to the localization files: The result of this code is that the localization file now contains these keys, ready for localizing into other languages: Elsewhere in ExampleChest.cs, these localization keys are dynamically retrieved using : This approach is useful for localization keys that are dynamic. ModType and ILocalizedModType Mods implementing a custom can implement to easily facilitate localization. This is as simple as adding to the class inheritance and implementing the property by adding . For each in your custom class, you can use , allowing them to be categorized properly in files as other existing classes. You'll also want to make sure that each is accessed during mod loading so that they populate the files automatically. If your logic doesn't already access them, simply add to your method for each in your class. In Depth: is a helper method to simplify code and avoid typos. is equivalent to calling with the full key passed in. Similarly, is equivalent to in the same manner. can be used to retrieve the generated key if desired. and have an optional 2nd parameter named that defines a function that will be used to make the default value that will be assumed if the localization does not exist. For example, passing in , will result in the default value being an empty string rather than the key. Modders can pass in to achieve the typical behavior of taking the internal name of a piece of content and adding a space between capital letters. This approach should be used if the localization is optional, or you have a sensible default value for it. LocalizedText[] We can use an array to store many related . For example, the following will load entries for \"DrawMode 0\", \"DrawMode 1\", \"DrawMode 2\", \"DrawMode 3\", and \"DrawMode 4\" into the array: Another option is using to load all localization keys that share a common prefix. This approach can be useful when the entries are not numbered. It also happens to load keys supplied by other mods, making the final text count non deterministic. uses this approach to load keys that are not numbered, but named. Adding a new Language By default, tModLoader will only generate and update localization files for languages already appearing in files. To add a new language, simply make a text file and name it in the same manner as your existing localization files. You only need to make one. The file or folder path needs to contain the language code for the language: English (\"en US\"), German (\"de DE\"), Italian (\"it IT\"), French (\"fr FR\"), Spanish (\"es ES\"), Russian (\"ru RU\"), Chinese (\"zh Hans\"), Portuguese (\"pt BR\"), or Polish (\"pl PL\"). Once the file is made and has the correct file extension, rebuilt the mod. The file will update with entries ready for translating. Other files will also be generated following the organization of the English hjson files. Comments and organization of localization files other than English are all inherited from the English files. If you wish to add credits for translators, add them all to a comment at the top of the English files and they will propagate to the non English files from there. Modders can freely organize the English localization files to their liking and the other language files will update to match them. If you split up localization files, you only need to edit the English files and then build and reload the mod. The other languages will automatically adjust themselves to match the same layout. Keys removed from the English files will similarly result in the key being removed from other language files. In short, modders typically only need to touch the English files and the other language files will automatically adjust themselves. Overwriting Existing Terraria Keys Replacing existing Terraria localization values is also possible. The syntax is exactly the same as modded localization entries, but note that since the localization keys for Terraria keys are not prefixed by , the localizations will have to go into a localization file without a prefix, such as . You'll need to manually type them into the file. Also note that you'll have to look up the keys themselves. The file from the lists all existing localization keys. shows one example of this at the very bottom of the file, editing the value of the key. When multiple mods edit the same key, the mod last to load will take precedence. Issues Why are my localization entries disappearing? This usually happens when your mod has the same localization key in multiple files. When the game updates localization files, it will remove duplicate entries leaving each key in only one localization file per language. Many modders do not realize that the mod template comes with a folder with a file in it, so they mistakenly add their own file elsewhere in their project directory. To avoid this issue, simply use one file or the other and delete the other. Another possibility is you tried to add a custom localization key to a non English localization file without also adding it to the English localization file. When tModLoader loads a mod, it updates all the localization files using the English entries as a template. Any keys not present in the English files will be deleted when the game updates the files. Be sure that any custom localization entry exists in the English file. Why is my localization file being renamed to ? A file that is renamed to by tModLoader indicates that tModLoader detected that the file had no entries in it. This can be caused by issues similar to the situations mentioned in the \"Why are my localization entries disappearing?\" section above."},{"path":"螺线翻译tml教程/杂项/Mod-Browser 模组浏览器.md","filename":"Mod-Browser 模组浏览器.md","title":"Mod-Browser 模组浏览器","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide is only relevant for 1.3. The page is where you will find information relating to publishing mods for the 1.4 version of tModLoader. The Mod Browser is an online component of tModLoader where Mod Makers can publish their mods. Users are able to easily find, download, and install mods they are interested in directly from tModLoader. It is highly recommended that you visit the website and/or read the description of mods you want to download. Direct Download If you are having trouble in game, you can use to download mods directly. Place them in Modders wishing to publish their mod to the Mod Browser should continue reading. Getting Started The first time you attempt to publish a mod by pressing the button in the menu, you will be directed to the where you will authenticate via Steam to verify your identity. (You don't need to own Terraria on Steam, you just need an account) The Mod Browser, having confirmed your identity, will provide you with a that will be pasted into tModLoader. Now that you have a passphrase, you can now publish mods on the Mod Browser. Note: Due to 1.3 tModLoader being legacy, it is no longer possible to register anymore. Please make mods for current versions of tModLoader if you wish to publish your mod. Publishing Mods Publishing a mod is simple, after making sure your mod is ready for release, you just press the button in the menu. Before publishing, however, do the following: Set a Version Set a version in your build.txt. Something like is good for an initial release. Please use semantic versioning: You are not allowed to use letters for the version Fill out description.txt This is the description that potential users will read when deciding if they will download, make it good. Test A lot. You don't want your mod to be quickly judged to be bad because of a poor first release. Make a Website Most mods make a thread on the Making a thread provides a great way to interact with your users. They can give bug reports and criticism or praise. Once you have a thread, copy the URL and paste it into your build.txt on the property. See ExampleMod if you are unclear on the layout of the build.txt file. Save build.txt. Build Save all your files and Build the mod in the Mod Sources menu. Github If you have a Github repository for your Mod, push all changes. Publish Click Publish in the Mod Sources Menu. Within a few minutes, your users will now see that an update to their favorite mod is now available for download. Updating Mods To update a mod you have published, first do the following: Update Version Increment the version in your build.txt. Your Version should be 2 to 4 numbers separated by periods. Do not add letters such as \"v\" or \"beta\" to your version. .aspx Anchor 6). Note: Some examples: 0.1 is the same as 0.001, and 0.0.0.10 comes right after 0.0.0.9. Update Description Update your description.txt with any new info you'd like potential users to know about. A brief recent changelog might be nice here. Test Test your changes a lot. Test the Save and Load code in your ModPlayer and ModWorld classes by loading old saves from previous versions of your mod. Build Save all your files and Build the mod in the Mod Sources menu. Github If you have a Github repository for your Mod, push all changes now so your releases stay in line with the source code. Publish Click Publish in the Mod Sources Menu. Within a few minutes, your users will now see that an update to their favorite mod is now available for download. Update Website If you have a website, now would be a good time to advertise the update and changelog. Unpublishing Mods Warning! No confirmations are given for the buttons in this menu! You can unpublish a mod in game by going to and then and clicking . Only do this if the mod is of low quality. .tmod File size limitations The default limit for mods is 5 MB. If you have linked the Mod Browser to your GitHub repository, it can be up to 50 MB. If you find that your mod is too big, check your Mod's source folder for large files that shouldn't be there. By default, all files in the folder will be packaged into the .tmod file. Use buildIgnore in build.txt to specify folders or files to ignore, or delete the files in question. Common culprits include photoshop or other image editing project files. Mod Icon A Mod icon can be added to a mod by adding an 80x80 to the root of the Mod's source folder. As an incentive for using GitHub and linking your repository, your Icon will show in the Mod Browser menu in addition to the Mods menu. Here is a template if you wish to use it: GitHub integration The Mod Browser uses a lot of bandwidth, more than we can afford. In an effort to alleviate these limitations and encourage Open Source software, mods that have their GitHub repository linked to the Mod Browser will enjoy several benefits including larger files size (up to 50 MB from 5 MB), a history of old releases, and Mod Icon visible in the Mod Browser menu. To integrate, visit the , log in, click \"Manage Mods\", then \"Submit GitHub Authorization\". After that, follow the instructions very, very carefully. After success, the next time you publish your mod you will enjoy the benefits. Advanced Github Integration If you are using Github as designed, meaning as a repository of your source code, you can automate releases of your mod by using Github Actions. To do this, visit your repository and click the button. Then, click . Copy and paste the following into the text box. Now, replace with the internal name of your mod. Commit this file. Next, visit and create a repository secret called with your steamid64 and another secret called with your current mod browser passphrase. With these steps complete, the next time you push a commit to your master branch that increases the version in , the mod will automatically be published using the tModLoader version specified. As tModLoader updates, so too will , so be sure to update the version used by changing to the tModLoader version you wish to publish with. Renaming a Mod The displayName in dictates the name user will see when interacting with mods. The internal name, is another name pertaining to a mod. The internal name must be unique on the workshop, so you might find that the internal name you have choosen for your mod is already taken when publishing. Or, you might want to rename the internal name for other reasons. Due to various factors, it is not recommend to change an internal name of a mod, but it can be done: TODO: Steps here. Limitations Terraria Community Forum Rules Mods published to the Mod Browser must abide by the Rules of note include the rule against porting content from non PC versions of Terraria and the rules against plagiarism. Violating these will result in revoked Mod Browser privileges. Mod Icon Guidelines Any nudity or inappropriate content in a Mod Icon will result in especially severe response. What will be deemed inappropriate? You can probably guess it, but still here's a few examples: nudity/porno, swearing, violence/harm to other humans or animals, and also icons that encourage vandalism, crime, terrorism, racism, eating disorders, or suicide.. The list can go on.. just use an appropriate icon please. Malicious Code Don't do it. The mods you upload are tagged with your Steam identity. You will be permanently banned from the browser and all of your mods will be removed. We will also notify Terraria and Steam staff about you and your malicious code. Frequently Asked Questions (FAQ) No one can download my mod This can happen if you finished github integration and then made your repository private. Repositories linked to mods have to be public so the Mod Browser can redirect to the releases. It won't publish my mod Reread the instructions on the . I can't register / Access Denied Due to 1.3 tModLoader being legacy, it is no longer possible to register anymore. Please make mods for current versions of tModLoader if you wish to publish your mod."},{"path":"螺线翻译tml教程/杂项/ModPlayer ModPlayer类.md","filename":"ModPlayer ModPlayer类.md","title":"ModPlayer ModPlayer类","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is a ModPlayer is the class used to add data and functionality to players. Each player will automatically have an instance of every attached to it, allowing the class to act as an extension to the vanilla class. We use classes to store state and use that state to apply logic to affect the behavior of the player. If X, do Y The most common usage of is to make a player do something when some other condition is met. Or in other words, \"If X, do Y\". As an example, we will explore how an accessory can give a player a specific effect. While this example is an accessory, the same logic applies to buffs, armor, potions, etc. This section will go through the code of . First, we need to add a field to the to track if the effect is active on the player or not: Next, we need to use the method to reset it to the default value. The game is designed in such a way that all gameplay effects and stats are recalculated each game update, this method facilitates that: Next, we need to use our field to drive some gameplay logic. This is the \"do Y\" in \"If X, do Y\". This can be anything, such as when the player is damaged or damages an enemy, or when the player heals, or each game update. This usually comes down to finding a specific hook that relates to the desired effect and using it. The and various ExampleMod examples can be consulted to find the correct approach. In this example, we will be using the method: And finally, we need to give the player our effect under some conditions. This is the \"If X\" in \"If X, do Y\". Since this examples is an accessory item, the correct place is in : And that's it. In summary, the is in charge of the actual logic of the effect, while accessories, buffs, armor, etc. is in charge of telling the player that the effect should be active. [!NOTE] You might expect an accessory to contain the code for the effect it gives, but this is not how the game is designed. This is especially relevant when your mod introduces upgraded accessories. In the upgraded accessory item, you would just set the same fields as the original accessory item, and maybe add some additional effects. This design avoids duplicating gameplay logic code. Multiple ModPlayer Classes Mods can have multiple classes, in fact, we highly recommend it. In particular, we recommend that classes stick to a single \"responsibility\". This means that a class in charge of fishing adjustments, for example, wouldn't also contain adjustments to max health stats. More Information contains a wide variety of . Each example is documented and can be studied and applied to your own mod. Other related wiki page: Read this to learn about implementing persistent effects, since those require saving and loading. Find appropriate \"hooks\" suitable for your desired gameplay effects by searching the documentation."},{"path":"螺线翻译tml教程/杂项/MountDataParameters 坐骑信息参数.md","filename":"MountDataParameters 坐骑信息参数.md","title":"MountDataParameters 坐骑信息参数","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"These are the things you can use in the ModMount's SetDefaults | MountData | Description | | : | : | | mountData.spawnDust (int) | The ID of the dust spawned when mounted or dismounted.| | mountData.buff (int) | The ID number of the buff assigned to the mount.| | mountData.abilityChargeMax (int) | Used in the Scutlix mount, represents the maximum amount of time in frames a mount will charge its ability until it stops charging. In the case of the Scutlix mount, it affects the rate of change of the lighting on the mount's eyes. The higher the value is for the Scutlix mount, the slower the blue value of the color value of the lighting on the Scutlix's eyes will raise each frame until the max. | | mountData.abilityCooldown (int) | The amount of time in frames before the mount can call Mount.UseAbility or the ModMount can call MountLoader.UseAbility. | | mountData.abilityDuration (int) | How long, in frames, the crosshair on the Scutlix mount will exist on screen after the ability has been used. | | mountData.swimSpeed (float) | This parameter is used in vanilla for the turtle mount, the drill mount, and the cute fishron mount. It represents the horizontal velocity, how many pixels on the x axis it can move per frame. | | mountData.heightBoost (int) | How many pixels the player is boosted in the vertical axis when mounted. | | mountData.fallDamage (float) | A number which is the fall damage multiplier. | | mountData.runSpeed (float) | The amount of pixels the mount can move left or right, possibly modified by other variables before applied to the player's position update next frame. | | mountData.dashSpeed (float) | The speed the mount moves when in the state of dashing. | | mountData.flightTimeMax (int) | The amount of time in frames a mount can be in the state of flying. | | mountData.jumpHeight (int) | How many pixels the player and mount will ascend (negative y velocity) when pressing the jump button. | | mountData.acceleration (float) | The rate at which the mount falls faster down the y axis due to gravity when in the air. To find the speed in pixels per frame that you will be falling while mounted at any given time will be your existing Y velocity Acceleration + Gravity + 0.001. Gravity will be a value between 0.25 and 1 depending on your X position in relation to the world's surface position divided by 6. | | mountData.jumpSpeed (float) | The rate at which the player and mount ascend towards (negative y velocity) the jump height when the jump button is presssed. | | mountData.blockExtraJumps (boolean) | | | mountData.totalFrames (int) | The total amount of frames involved in the animation of the mount when involved in movement under various conditions. There is an order to the sequence of movement states a mount can have. The order goes: Standing, Running, Freefalling, Flying, Swimming, Dashing | | standingFrameStart (int) | The index of the starting frame in the mount's animation frame array | mountData.constantJump (boolean) | | | mountData.MinecartUpgradeDashSpeed | Alternate dashSpeed for this minecart while the Minecart Upgrade Kit is active. Defaults to 20f. | | mountData.MinecartUpgradeAcceleration | Alternate acceleration for this minecart while the Minecart Upgrade Kit is active. Defaults to 0.1f. | | mountData.MinecartUpgradeJumpHeight | Alternate jumpSpeed for this minecart while the Minecart Upgrade Kit is active. Defaults to 15f. | | mountData.MinecartUpgradeJumpSpeed | Alternate jumpSpeed for this minecart while the Minecart Upgrade Kit is active. Defaults to 5.15f. | | mountData.MinecartUpgradeRunSpeed | Alternate runSpeed for this minecart while the Minecart Upgrade Kit is active. Defaults to 20f. |"},{"path":"螺线翻译tml教程/杂项/Named-ID-Sets ID设置信息.md","filename":"Named-ID-Sets ID设置信息.md","title":"Named-ID-Sets ID设置信息","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This page serves as a reference to usages of named ID sets used in released mods. The has more details on how to use and collaborate on named ID sets. Feel free to update this listing with usages from your released mods. Try to be brief and try to collaborate with other mod makers to agree on keys and their intended \"meaning\". The sets might represent a concept, not a specific effect implementation. How each mod interacts with the intended meaning of each set is up to each mod. There is no purpose in adding named ID sets to your mod unless other mods intend to collaborate with that set, so try to talk and plan with other modders. Named ID Sets Named ID sets facilitate mod collaboration without requiring mod dependencies. This is referred to as ad hoc collaboration. Mods can use named ID sets to \"tag\" content in their mods, and other mods can read and act on those tags. | Content ID | Key | Type | Default Value | Usage by Mods | | | | | | | | | ExampleMod/FlamingWeapon | | | Randomly outputs \"Hahahah, burn!\" when weapon hits anything. ?? Note: this is the teaching example, please don't actually use it. | | | HolyLight/IndestructibleProj | | | When removing enemy barrage, it will not be removed ?? | | | | | | |"},{"path":"螺线翻译tml教程/杂项/Open-Source-Mods 开源模组.md","filename":"Open-Source-Mods 开源模组.md","title":"Open-Source-Mods 开源模组","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The following is a list of Open Source Mods (not all are technically \"Open Source\" in the traditional sense, by the way.). These mods' sources are available for a variety of reasons, mostly to facilitate and encourage community contributions, but we have listed them here for two reasons. 1. The first reason is that modding is difficult, and learning how to do everything by oneself can prove hard. Joining an existing mod is a great way to quickly see your ideas come to life without having to know everything about Terraria modding. If you are interested in contributing to one of these mods, feel free to fork the mod, make your changes, and then submit a pull request to the main branch. Once you have gained the trust of the mod owner, you may be allowed into the team and given direct access to the mod. Please note that not all open source mods desire random contributions. Try to get a feel for what the mod needs, either by noticing bug reports on their Issue tracker or on their homepage. You can also look for notes in the code or noted elsewhere for ideas of things to implement. If you are contributing art or sounds, it might be a good idea to communicate with the mod owner as well to get art direction before you waste your efforts on something that wasn't desired. If in doubt, contact the mod owner on the Terraria Community Forums. 2. The second reason we have listed these mods is because there are still a lot of things the tutorials and ExampleMod do not cover. Search these mods and look for code that might help you. Remember, just because a Mod is Open Source, that doesn't mean you can copy all the code and call it your own. Read the licence the code is licenced under for details. For the most part, however, you should be using Open Source mods as a guide for learning how to structure your mod. (You'll be shunned in the modding community if your mod is just a copy/paste conglomeration of other mods' code.) Remember, you can't just copy code from these mods unless the licence they are under specifically allows it. If there is no licence, the owner reserves all ownership and copyright of the code, so you need to contact the owner and ask permission to utilize certain parts. Don't worry, most will be happy to allow you to use portions of their code, but you still need to ask. Content Mods These mods are mods that add common things such as items, enemies, furniture, pets and so forth. A good example of NOT using Autoload. Learn from this mod how to programmatically add items to write clean code. Adds several generated structures, quest system and other content, including bosses, enemies & items. This mod aims to add more vanity items/pets to the Calamity mod. This is a great example of adding new more complex pets. Adds a bit of everything. Adds a custom class and associated items. Comes with armor glowmasks, custom mod.Call API including an example mod, and translation/localization support. Adds a custom energy system with some UI elements, a custom damage type, quite a few unique weapons and transformational effects. Good resource for learning how to code Boss AI Adds a new level up system, a few bosses, weapons, and accessories. Offers a wide variety of code examples covering Beginner to Expert. A new mode that overrides vanilla boss AI This mod aims to overhaul Terraria by adding RPG elements, and includes a leveling system, an item upgrade system, an elemental damage system, procedurally generated weapons, and much more. For more detailed information, see the A lot of UI, inheritance, and networking. Small content mod with a bit of everything. A big content mod which adds multiple new damage classes and one full damage class. Adds a lot of almost everything. Adds a lot of interesting things. Has a lot uses of custom npc AIs (including bosses), an invasion, custom minion/sentry AIs, player layers and more. Large content mod with alot of worldgen, and custom visuals utilizing primitive drawing. Adds a herb that spawns on sky islands, a planter box to go with it, and three potions crafted from it. Projectile and Minion related code. Uses TerrariaHooks' detours (On.) to simulate a minion target. Heavy emphasis on weapons. Adds a reloading system, healing weapons, and an ability for NPCs to scale their health and damage based on the player. Adds new minions and associated items, aswell as a \"squire\" summoner subclass. Heavy utilization of inheritance, and has custom networking/netcode. A pet that collects loot for you. Complicated items, custom graphics, config file system with JSON. Adds a bunch of different weapons and armor. Other Mods These mods cover everything except mods that are primarily about new content. Some change mechanics, others make quality of life changes, others do random things. These mods may be a bit harder to contribute to due to their nature. Hundreds of mechanics implemented in readable and scalable code. Also serves as a good reference on advanced concepts such as injections, data driven content, video playback, lighting buffers, scalable GUI, \"event recording\", etc. UI, a slot that auto trashes items you pick up. Adds boomerang style projectiles using a Boomerang abstract class UI, weak mod references, and using Call for cross mod communication. Makes coins bounce (also showcases weak dependency support with FK's Mod Settings Configurator). Many examples of cross mod recipes and use of recipe groups. Makes normally unobtainable lunar tools craftable. Automatically editing recipes in complicated ways (without using RecipeEditor). Tile Entities, UI and a bunch of framework stuff. A mod to add custom effects to the game that can affect weapons, accessories and armors. Showcases hacking armor items to allow them to be reforged as accessories, UI, a solid open ended framework designed so other mods can add their own content to its system, documentation, abstraction and design practices, MP compatibility, glowmasks and shaders, optional hard references (support with other mods) and various uses for Attribute classes. Start the game with a bit more gear than usual. A set of 11 open source mods adding significant original gameplay elements or minor content additions. A lot of networking code. (Do not consult for UI) UI, TagCompound, saving Items in TagCompounds. Messing with shaders. A lot of UI. Very useful in game to visualize the effects of code as well. In game c interpreter also very useful. All the basic and advanced modding: UI, shader, save and load data, multiplayer, On, IL, localization and a lot more. Messing with shaders. Integrating with other mods through Call. (Cheat Sheet and HEROs Mod). Everything Terraria sounds: Lets see sounds, their exact values, etc. without needing to search in the source code. You can also select any sound you want and play it in its extensive config. Uses TerrariaHooks' detours (On.) and reflection. Deconstruct any item back into its recipe (showcases custom UI, sound effects and more). Various tweaks using GlobalItem, GlobalNPC etc, recipe editing, options system with JSON. Wiring related code, storing custom tile information using ModSystem. Modify the vanilla fishing mechanism by mainly using IL, On and Reflection. And provide players with various options to customize their own fishing experience through configs. Too Advanced/Specific These mods are probably too specific or advanced to for most modders. An incomplete implementation of alternate dimensions. Knowledgeable and determined modders are encouraged to discuss a suitable implementation. Various Expert Mode related \"hacks\", options system with JSON, integration with Cheat Sheet. Rewriting the update methods for all entities, loads of static method tools that you can use to save some time typing. Adds a drawtext equivalent data structure to drawdata. Has some rewritten collision detection and some custom. Tries to aid TMod the best it can. Always accepting help. Add a Chat Tag Handler Hijacking the WorldGen screen, Reflection."},{"path":"螺线翻译tml教程/杂项/Patching-Other-Mods-Using-MonoMod 使用MonoMod给其它模组制作补丁.md","filename":"Patching-Other-Mods-Using-MonoMod 使用MonoMod给其它模组制作补丁.md","title":"Patching-Other-Mods-Using-MonoMod 使用MonoMod给其它模组制作补丁","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction This guide will explore the use of MonoMod to patch the code of other mods a very useful tool for compatibility reasons, as well as a means to allow your mod to better interact with others. Using this, you are essentially given complete freedom of choice as to what changes you wish to make. It involves using techniques that will be familiar to experienced modders and , and I recommend trying it with vanilla before moving on to other mods, so you get a grasp of how it works. The expert IL guide can be found . Word of Warning Note that one of the tModLoader guidelines states: Your mod will not do anything else deemed illicit, inappropriate, or harmful. (Yes, we check the decompiled source of mods from time to time. If your code is obfuscated to prevent easy checking we may ban you if we decide to.) This also includes irresponsible use of reflection, Cecil, or other code that prevents harmonious mod coexistence. This means that it is prohibited to use any of the techniques mentioned in this guide to deliberately prevent another mod from working, or otherwise compromise it. If you do, we will find out and you will be banned from the workshop. There are some exceptions, for example deliberately disabling/alter a mechanic because it would crash the game etc. But don't play around! Prerequisites Mod Extraction If you are going to be IL editing specifically, then the prerequisites for that are identical to those mentioned in the IL guide (linked above). However, as we are editing other mods, there are also a few more things that need to be done. In order to make changes to another mod, we first need acquire its file, as we cannot make changes without knowing what to target. The simplest way to do this is by extracting a mod in game: However, if this doesn't yield anything, using this fork of allows files to be opened and extracted. After decompiling a in ILSpy, its C code can be saved ( ) for later viewing, and the IL can be viewed in ILSpy. You will need to do this with the mod's file regardless of how it was acquired. [!NOTE] ILSpy must be used strictly for viewing purposes in most cases, as the license of the mod it is used on must be respected. If a mod does not have a visible license, it is All Rights Reserved. Lastly, if you want access to the classes contained within another mod (primarily for writing hooks), then you will need to add the mod's as a dependency to your project. Note that this is not the same as having a strong reference to another mod; it simply allows the compiler to resolve any references to classes from that mod. In VS, you can easily add a dependency by right clicking underneath your mod's in the solution explorer, clicking , , and selecting the mod's in the file explorer. The mod in this guide will have added as a reference to allow types from that mod to be resolved. If you add a mod's as a reference, you either need to add it as a strong reference or as a weak reference (read about both of these ). This guide will add Calamity (the mod I will be using as an example) as a weak reference ( in ), as when using to apply patches a weak reference is required , and for it is recommended so that less reflection is required. It is required in any case where you need to reference types from the target mod. This technically isn't always, as a method whose parameters are only types not from the target can be patched without needing to reference the mod, but this doesn't apply to 99% of use cases. Defensive Design You cannot always assume that the mod you're targeting will be loaded, unless your mod confers a strong reference to it (i.e., it is in your mod's list in ). As a result, when using weak references or none at all, your code must be written such that it won't crash if the target mod is not enabled. To start off, let's create a class responsible for handling cross mod changes to Calamity, making use of defensive features: The attribute is used on the class. This prevents tModLoader from autoloading and from attempting to resolve the references in this class unless Calamity is enabled, which prevents a from occurring if Calamity is not loaded. If using on the class is not desirable for some reason, another option is to use to conditionally call the methods that apply patches. Each of those methods would need to be annotated with the attribute when using this alternate approach. Using First, let's decide on a change to make. (All source code from Calamity shown hereon out is courtesy of the Calamity Mod Team, and can be found on their ). In Calamity, the method is used several times throughout its codebase, and is used to spawn some bosses with extra parameters: One of the instances this method is called is when spawning Supreme Calamitas (SCal): The goal will be to replace SCal with another NPC on spawning; this example will use a gnome. This is therefore a good use case for an hook, as we want to change the return value of a method and replace its functionality with our own. One of the first things you might notice when trying to patch another mod is that, unlike with patches targeted at vanilla, there are no or classes that provide events to apply your patches with. This is because these are pre generated and supplied by the dependency . Additionally, if you are familiar with how typically works, this might seem like an obstacle as there are no delegates that you can use as the parameter in your hook. To resolve this, you first need to declare a delegate with the same signature as the target method. This will be used as your delegate, which calls the original method when called in your hook: Next, we can actually apply the hook. Since there are no pregenerated methods available, it must be manually applied with . This tModLoader method wraps MonoMod's functionality for applying hooks. If need be, you can disable a hook with , but this is usually unnecessary as tModLoader automatically removes all hooks on unload. To apply it, we need to get the of the target method, and declare another method to act as the hook. This method should have the same signature as the target, but with the delegate from earlier as an additional first parameter: Currently, this won't compile, since needs to return an NPC instance (which, according to the source code from earlier, is the instance of the boss that the method spawns). This means we should populate the method. Since we only want to target SCal, we need to fall back to the method's default behaviour if the parameter is not SCal's NPC ID: Any code after this block will apply only to SCal. To mimic the original method's functionality, we can adapt some of the position calculation and check code from the original source code: Finally, we can add a method call that spawns our new NPC and returns its instance. A shorthand version of is : This code will now compile, and when we attempt to summon SCal via the mod's spawning method: [!NOTE] The most common pitfall with using is forgetting to call the delegate, which results in functionality being lost when done unintentionally. Unless you want to prevent the base method from running, always call ! Using This guide assumes you already know how edits work, and if you don't, it's advisable to first read the main . Code wise, edits require less boilerplate than , as you do not need a delegate or even weak references just a representing the target method. Once again, let's select a method that we'd like to IL edit. Looking at SCal again, we will change the text that is displayed in chat when she spawns. This happens in the method in her class, which is over a thousand lines long. This makes it infeasible to use , as it's unreasonable to replace the functionality of the entire method, so we need to make more granular edits with . The easiest way to relate IL and C code is to use ILSpy in the mode that superimposes both IL and C . Let's navigate to the area of the AI code that this message is sent in ILSpy, at : The corresponding source code snippet is shown below: Now that we have a target method, we need to set up a pair of methods to apply that edit using the IL counterpart of , known as . The signature of the edit itself is the same as any other IL edit: The easiest way to edit the text in this case would be to change the value of from earlier, which we will do by replacing its value after it is first pushed onto the stack. The first step is to navigate to the instruction where that string is loaded onto the stack by matching its value to an : In case you haven't seen this pattern before, an exception is thrown if the instruction with the matching operand could not be located. Alternatively, you could here instead of throwing, which would prevent the edit from applying safely rather than preventing mods from loading. places the cursor after the target instruction, so we can insert our own and avoid having to remove instructions (this is discouraged, as it could disrupt other edits). The next step is to insert our new value onto the stack. Since we can't leave unused values on the stack, we first have to the existing value: This will then allow us to push a new value onto the stack using . Since the string itself is a localization key the new string must also be a localization key in this case. For simplicity's sake, instead of adding a new one to the mod, I will use another localization key from Calamity . This is can be found in the public GitHub's localization file. Let's push that onto the stack: Finally, when SCal is summoned in game (with the gnome edit disabled), the message is changed as we would expect (before vs. after): The full source of both test edits is as follows:"},{"path":"螺线翻译tml教程/杂项/Player-Item-Animation 玩家物品动画.md","filename":"Player-Item-Animation 玩家物品动画.md","title":"Player-Item-Animation 玩家物品动画","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Overview Player item animation seems simple at first, but it begs a few questions. Notably, how does the Clockwork Assault rifle work like it does? Why can't you switch items for a short while after using some weapons? All of these questions will be answered below. A simple overview of the terminology and system is: governs the visuals. For melee weapons, the hit box moves with the animation, and the hit rate also resets with the animation, so this affects dps governs the effect of the weapon (shooting, mining, building, consuming etc) refers to a multiplier that uniformly affects both animation and use This is why, by default, also increases use speed (fire rate, digging rate etc) Weapon prefixes which increase speed modify and directly, so in this sense they are 'speed' modifiers, but since they directly affect the item stats, rather than making a separate multiplier they are distinct from hooks and the player stat For some items (such as tools) it may be desirable for and to only affect the animation of the weapon. tML provides for this purpose. Note that for whatever historical reason, vanilla sets this on most melee projectile weapons (like beam sword). Prior to the 'true melee' rework in 1.4.4, this was more widespread. itemTime, itemAnimation and reuseDelay In order to keep track of when the player is using an item, the game uses three variables in : , and . itemTime determines how long the current \"use\" for the player's held item will last for. When this value reaches zero and hasn't reached zero yet, then the use code for the item will repeat. Most codes in vanilla, including tile placing, first check if (among other conditions), then set (give or take a call to or use speed modifiers such as ) if that was true. After that, the actual \"use code\" for the item will run and the game will wait until is true (among other conditions depending on the item). Example ( code): itemAnimation , in conjunction with , is used to determine how far along in the use animation the player is in. Any item use is wrapped around a check of , so this field is what drives the use. Noteworthy Cases: If the player's held item's is equal to its , nothing spetacular happens. If the player's held item's is less than its , the item use code will be called multiple times during the animation due what was mentioned in the previous sub section. If the player's held item's is greater than its , then the player will be unable to switch items nor use the item again until has reached zero, which would happen after the use animation finishes. However, if is greater than when reaches 0 in this case, the leftover timer from will be overwritten. Example ( check): For reference, this is what does: Basically, it makes sure that the player is just starting the item use animation. Items that use bypass the above method call. reuseDelay is the intended way to force the player to wait a bit longer after using an item (via ). However, for any items where , or is true, this field is ignored . If is true for the player's held item, the following code is ran just before the check for if the player just clicked the \"use item\" button (usually Left Mouse): Thus, the player has to wait this additional time and an additional item use doesn't occur since will never be true after the above code snippet runs. itemTime vs itemAnimation The item animation ( ) doesn't necessarily match or sync with the item use time ( ). For example, the iron pickaxe has and . This means that over 2 visual swings of the pickaxe (2 20, or 40 frames), the pickaxe will finish 3 usages (3 13, or 39 frames) and be starting on the 4th usage at frame 40. An item being animated does not necessarily mean the item is being \"used\". For example when swinging a pickaxe, if the user click in an empty location, the item will animate but will not be affected. If the user clicks on a mineable tile, both will be set at the same time. If the mouse moves from an empty location to a mineable tile during the swing, the usage can even start off sync from the animation. There are some types of items that require manually triggering an \"item usage\". Projectile weapons, tiles, wall, tools, potions, and some others all automatically trigger and item usage when the user clicks, but items that don't fit into normal categories might not trigger an \"item usage\". For example, and will both play the animation when the player clicks and is , but the result of determines if the game will consider the item as being used or not, ultimately setting . is another example, it calls in the method to start an item usage. Manually setting itemTime or itemAnimation Sometimes it is useful to assign or directly. This is usually done with held projectiles to tell the game that the player is currently using an item and should appear as such. The method sets both conveniently. Case Study Clockwork Assault Rifle To better illustrate how , and work together, please expand and read the following section: Details In the following spreadsheet, we can see the values of , , , and others through time (\"Game Updates\" column) as a player uses the Clockwork Assault Rifle item. Note that the values shown are from the start of the game update before the events occur. In this example we see that as the player clicks to use the item on game update 34, the and values are set to their max values and count down from there. Each time would reach 0 before does it resets back to , resulting in a 3 shot volley. Once and both reach 0 at the end of game update 46 the value is applied to both. After the expires during update 60 the item usage is once again begun anew, starting a new volley of shots. Helpful Properties tModLoader provides several properties that encapsulate and to allow modders to write code that is easier to comprehend and more expressive. Use these when possible. Doing so will help you avoid typos and logic errors. Player.ItemAnimationJustStarted Evaluates to if the item animation is in it's first frame. Equivalent to . Player.ItemTimeIsZero Evaluates to if the item usage is in it's first frame. Equivalent to . Note that this particular property is only valid to be used in and hooks. uses this to run code once per swing. Player.ItemAnimationActive Evaluates to if an item animation is currently running. Equivalent to . Player.ItemAnimationEndingOrEnded Returns if the item animation is on or after it's last frame. Meaning it could (if the player clicks etc) start again next frame. Vanilla uses it to despawn spears, but it's not recommended because it will desync in multiplayer (a remote player could get the packet for a new projectile just as they're finishing a swing). It is recommended to use ai counters for the lifetime of animation bound projectiles instead. Equivalent to . uses this. Player.ItemUsesThisAnimation The number of times the item has been used/fired this animation (swing). uses this to vary the logic for each shot in a multi shot volley. Item.attackSpeedOnlyAffectsWeaponAnimation Dictates whether or not attack speed modifiers on this weapon will actually affect its use time. Defaults to , which allows attack speed modifiers to affect use time. Set this to true to prevent this from happening. Used in vanilla by all melee weapons which shoot a projectile and have set to false. and use this to match the behavior that melee speed should not affect mining speed. Item.shootsEveryUse If , this item will shoot it's projectiles each time the weapon animation plays, rather than the use time. Defaults to . uses this, as do True Excalibur, The Horseman's Blade, Terra Blade, and others. Item.useLimitPerAnimation Dictates the amount of times a weapon can be used (shot, etc) each time it animates (is swung, clicked, etc). Defaults to . Used in vanilla by the following: Tome of Infinite Wisdom, Nightglow, Eventide Item.consumeAmmoOnFirstShotOnly Dictates whether or not this item should only consume ammo on its first shot of each use. Defaults to . Used in vanilla by the following: Flamethrower, Elf Melter. Item.consumeAmmoOnLastShotOnly Dictates whether or not this item should only consume ammo on its last shot of each use. Defaults to . Used in vanilla by the following: Clockwork Assault Rifle, Clentaminator, Eventide Player.channel and Item.channel Items that \"channel\" are items that are in use as long as the user holds the use button. These weapons commonly spawn a \"held projectile\" that acts as a weapon item and handles spawning bullets or other secondary projectiles itself. It is up to the logic in the held projectile to properly account for use time and use animation scaling if needed. For example, the Vortex Beater item spawns the Vortex Beater projectile. The Vortex Beater projectile has timers and logic to control how bullets are spawned Adjusting Use Speed and Animation Speed Never directly modify and dynamically. tModLoader provides hooks to cooperatively adjust use times and animation times. For dynamic effects and accessories, please use the hooks as designed for maximum compatibility. (ModPlayer|ModItem|GlobalItem).UseTimeMultiplier Allows you to change the effective of an item. (ModPlayer|ModItem|GlobalItem).UseAnimationMultiplier Allows you to change the effective of an item. Player.GetWeaponAttackSpeed Gets the total attack speed for the provided weapon for the player. Takes into account of the items damage class. Player.GetTotalAttackSpeed Gets the total attack speed for the provided damage class for the player. Player.GetAttackSpeed Gets the attack speed modifier for this damage type on this player, for editing. uses this to boost ranged attack speed. DamageClass.MeleeNoSpeed This is a damage class used by various projectile only vanilla melee weapons. Attack speed has no effect on items with this damage class. Other Information How does the Clockwork Assault rifle work like it does? The Clockwork Assault Rifle item has the following code in its defaults: Due to being less than , will end up looping times before forcing the item animation to continue for frames. Why can't you switch items for a short while after using some weapons? In , the condition must be true before checking the triggers in for the 10 hotbar slots. On the other hand, if that condition was false, the game instead checks the number keys on the main keyboard ( through ) specifically instead of the triggers set."},{"path":"螺线翻译tml教程/杂项/Saving-and-loading-using-TagCompound 使用TagCompound保存和加载.md","filename":"Saving-and-loading-using-TagCompound 使用TagCompound保存和加载.md","title":"Saving-and-loading-using-TagCompound 使用TagCompound保存和加载","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click What is TagCompound is the data format for custom data saved using tModLoader. We use in , , , , , , and . If you are familiar with the concepts, thinking of as a nestable dictionary or JSON comes pretty close. Like a dictionary, we provide string keys and values of any supported type. Please use to visualize TagCompounds by opening .twld or .tplr files with it. It can be very helpful to view the data in this manner to verify that data is being saved in a manner that makes sense. Key Ideas Below are some things to keep in mind as you use . Where to use We use in , , , , , , and . We save data in the method and load data in the method (except in where we save in and load in instead). Do not store in fields, they are not intended to exist beyond the loading and saving processes. Compatible Data Types All primitive data types are supported as well as , and s of other supported data types. Usually we use the methods like or , but we can use for Types without specific methods defined. See the or rely on your IDEs to find the method you want. In addition to the types suggested by the method names, , , , , , , , , , and are also supported. Additional support can be implemented by implementing the interface, creating a class that inherits from , or by nesting s manually. Mod Version Updates Using helps modders update mods smoothly. For example, if v1.0 of a mod saves only , but v2.0 saves both and , the modder doesn't need to make extra checks validating the value or presence of for most situations. They'd only need to do extra effort if has a non default value. For example, will return the default value of int if the value does not exist in the , and the default value of int is 0. If 0 is the value the mod would expect for a missing entry, this works out well. If a non default value is what the mod expects for a missing entry, the following approach can be used: Notice how sets the value to 10, the default value our mod expects. We then check that the tag has an entry for \"QuestsLeft\", and if it does, we retrieve that value. Without this check, would return 0 if the key did not exist. Designing your variables such that the default values correspond to the expected default values might be useful if you wish to avoid checking . This example used the method in to show this concept, but other classes have similar methods that are suitable for initializing data. For , for example, initial values can be set in . Updates to data Type If in a version update a saved value changes , such as from to , extra care must be taken to not run into exceptions. Updates to data Type details Attempting to use , , or when the value in the for that key is a will throw an exception. Using a new key will result in existing users losing their data when they update to the latest version of the mod. If unavoidable, the following code shows an example of preserving the old data when the data changes : Renaming the class If in a version update you change the name of the class, such as from to , it gets treated as a new thing and from the player's perspective it looks like the data got reset. To make it carry over the old data, you need to add the attribute above the class. For things like , this has the benefit of not turning the old item into an \"Unloaded Item\". Here is an example: Initialize Make sure to initialize values in appropriate methods, constructors, or field initializers. This includes creating data structures and populating them with default values if appropriate. This is because will not be called if no has previously been saved for this entity. For example, always make sure to reset values in , if you don't data from worlds will cross over into other worlds as the player goes in and out of worlds. Similarly, make sure to do the same in for data. Here is an example: In the above example, we make sure to set to false in . If we forgot to do this, the following could happen: Player enters World A, is set to true because of some event (such as defeating a boss), player exits World A and enters World B, World B doesn't have data yet, so is not called, is still true despite the fact that what represents has never happened in World B. Always remember to set values to default values in the appropriate method, constructor, or field initializer. Examples Here are links to various examples in ExampleMod and other mods, in order of complexity: ModPlayer Simple Example, 1 number indicating life boost item consumption and 1 number indicating mana boss item consuption. ModSystem Saves bools indicating which bosses from ExampleMod have been defeated in the world ModNPC Saves an int to this town NPC to indicate talk activity ModItem Saves an array of Color pertaining solely to the specific instance of the item ModItem Saves a string GlobalNPC Saves a bool (optionally, for efficiency) ModSystem Shows and usage. ModPlayer Saving and Loading a list of s. TagSerializable Shows several examples of implementing TagSerializable, including nesting (and TagSerializable Shows implementing TagSerializable TagSerializer Shows inheriting from TagSerializer to facilitate serializing existing classes Simple Example Lets start with ExampleLifeFruitPlayer from ExampleLifeFruit.cs: Here we see a very simple example of saving and loading an int variable. In , we add data to the provided. In we are provided a named tag and retrieve values from it. We must use the appropriate methods in Load that match the data type of the data stored. List Example A common mistake that modders make with is saving lists of data as individual entries in a . For example, the following is a bad approach: Saving individual entries like this is not how we should be using . Here is what this approach looks like in NBTExplorer: supports Lists of compatible data types, here is a proper approach: Note: If an entry is missing, an empty list rather than null will be returned from or . Dictionary Example Saving and loading a dictionary can be done, but take a little effort. One approach is to save the keys and values as lists and then reconstruct the by using the method: If you are specifically saving a keyed by , there is another approach. Using a keyed by is very typical, so this approach is useful to learn. This approach capitalizes on the fact that acts like a keyed by internally in the first place, so we can save the keys and values directly to the rather than reconstruct the later from two separate lists. Both options work, but the resulting data is stored differently. It may be useful to use the alternate approach (if indexing by ) so that it is easier for a user to modify their save in case anything goes wrong. It is also easier to read and debug issues if stored directly like this. The blue highlighted section in the screenshot below corresponds to the alternate approach while the yellow section corresponds to the approach saving 2 separate lists. Here is a more complex example of a . Using to do this would be a little hard, so we take an alternate approach here. Rather than store keys and values as lists separately, we construct a list of , each in that list representing an entry in the : Nested Example TODO: Finish this section with an example. Item Example A common task for modders is saving an . Don't attempt to hack out your own approach by saving the itemid or name of the item and then attempting to restore it during . The class is natively supported by . Unloaded items will persist through mods unloading and loading as expected. Do note that saving entries in a List or array of is not supported. Each entry must be an instantiated . Missing tags will be loaded as a as well. If you only need to save the identity of items, it might be better (more efficient and easier to work with) to save and load an instead. is a special class that can be used to safely store and restore an item type. Do not store values directly, that will not work for modded item types which can change if a mod or the mod list is changed or updated. also works to preserve item identities even when a mod is unloaded. Custom TagCompound Example TODO: Finish this section with an example. TagSerializer and TagSerializable Examples Creating a class that inherits from or a class that implements the interface is another approach to simplifying saving and loading custom data to s. We can create a for classes that are not a part of our mod, while implementing is preferable for classes defined in our mod. TagSerializer Examples We create s for classes not under the control of our mod. Adding s allows us to save and load the class directly in . Here is an example: We can now freely use as if it were a natively supported data type: Please be aware that is already implemented in tModLoader natively, and any attempt to register a for will cause your mod to fail to load. Several other common classes already have s made for them such as , , , , and . Since multiple s for the same class will cause errors, if you implement a for a class that might be useful for other modders, please reach out to us with your implementation and we can add it in directly to the next tModLoader release. TagSerializable Examples If a class is defined in your mod, it is better to implement directly on the class. To do this, add to the class and add to the class. Below is a complete example that utilizes for clear and concise code. This example also shows saving s and how saving objects with other objects contained in that object can easily be done. The example also shows compact syntax in the class as well as usage of the operator ( ). You'll also notice that has a contained within, showing how the already implemented for that class is automatically utilized. In short, this example goes over much of this guide. Here is the data that is saved for this example: Other Topics GlobalItem Optimization Saving data in will quickly explode the filesize of player and world saves. Make sure to only assign values to the if there is non default data to save. For example, if you are tracking how many times an item has been reforged, if the reforge count for the item is 0, don't save the value at all. nameof operator The operator can simplify some things, but be careful. (See ) The operator can help avoid spelling mistakes between and (or between and if in a class). Be careful, however, of refactor renaming variables in your mod (the F2 command in Visual Studio). If you rename a variable that is saved using , for example, your mod will lose data when your users update the mod. See below for an example. Notice how we don't need to write to specify the key, risking a spelling error that would be hard to catch."},{"path":"螺线翻译tml教程/杂项/Starting-a-modded-server 启动一个模组服务器.md","filename":"Starting-a-modded-server 启动一个模组服务器.md","title":"Starting-a-modded-server 启动一个模组服务器","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Page Has Been Updated for 1.4. For 1.3 Instructions, Click This page is outdated for 1.4.4 dedicated servers. Please refer to our Dedicated Host If you have your own hardware, skip this section and proceed to the self hosted walkthrough. A Dedicated Host is a company that provides server hosting for a fee. Edit the server config file that the dedicated host is using. Not every host is the same. You'll need to make sure that tModLoaderServer is being launched with either the command line argument or the server config line for the path to Mods folder. If you wish to use a Mods folder in the same folder as the tModLoaderServer executable, I believe you can use a relative path like \"modpath=./Mods\". You'll also need to set savedirectory since some mods store mod specific data in the save directory. (savedirectory is a command line only parameter.) Add to the command that launches the server, which can be found usually on the website for your host. Dedicated Hosts known to work NodeCraft Follow the GameServers Add to server command line Works as is. Dedicated Server Setup Pre word There are a few options for establishing a Dedicated Server on 1.4 tModLoader. We will cover just one of these options for simplicity, but do not be discouraged to experiment! All of this information is included in the DedicatedServerUtils folder in any tmodloader install. Setting Up a Dedicated Server on Linux If you have an extra old computer sitting around or leave your computer on all the time, you can use that computer to host a dedicated server. Docker vs Management Script While both the Docker container and the management script can install and update tModLoader and any mods, there are a few key differences. Docker isolates tModLoader from your host system and increases security. The management script allows for direct access to your server and increased control as a result. If you are a public server operator or just prefer Docker, then go with the , otherwise make use of the . Using The Management Script The script can be used to install tModLoader either directly from the GitHub release or from SteamCMD. The script is made to run fully standalone, so just download it to your server and run it. No other files from the repo are needed. Installing tModLoader Via SteamCMD (recommended) Ensure SteamCMD is installed and on your PATH. You can install SteamCMD from your package manager or . Run . You will be prompted for your password (and your 2fa code if applicable). By default, tModLoader will be installed to . To specify an installation directory, use From GitHub Run . By default, tModLoader will be installed to . To specify an installation directory, use . This will install the latest GitHub release, which is the same version as released on Steam. Installing Mods Mods will be automatically installed during the tModLoader installation step, but can also be installed separately using the argument. Simply place any files, for workshop mods, and into the same directory as the script. Additionally, you can avoid updating or installing mods with the argument. Obtaining install.txt Because the steam workshop does not use mod names to identify mods, you must create a modpack to install mods from the workshop. To get an file and its accompanying : Go to Workshop Go to Mod Packs Click Click . Enter the folder with the name of your modpack You can copy and to your script directory and they will be used next time the script is run (run to install mods immediately). You will need a Mods/enabled.json to contain all Mods that you want enabled. Launching To run tModLoader, you just need to navigate to your install directory ( for GitHub, for SteamCMD, by default), and run . There is also a argument that will launch the game. Automatically Selecting A World If you want to run tModLoader without needing any input on startup (such as from an init system), then all you need to do is copy the example and change the settings how you like. Additional options can be found Updating If an update for is available, a message will be printed letting you know one is available. It can be updated using . An outdated script may contain bugs or lack features, so it is usually a good idea to update. When using , tModLoader updates can be performed with . When using a GitHub install, use . Use if your install is in a non standard location. Mods will be updated as well. When using the Docker container, simply rebuild the container using to update tModLoader. Mods will be updated as well. Using The Docker Container To install and run the container: Ensure and are installed. They can be installed from your package manager or Download and the . Next to those docker files, create a folder named , and place , , , your worlds, and any files inside. Edit with your GID and UID. These can be found by running . Run Run The server will be available on port 7777. To run without any interactivity, use , and include in the directory. Autostarting On Boot When using , refer to your distro's documentation. You can likely use a startup script with your init system. When using the Docker container, add within inside of , then rebuild with . Server Configuration If you are missing , you have to create one manually. You can use config preset from the internet or make one yourself. Some recommended parameters to have there: Load the world automatically when you run , this one is required for some other arguments to take effect Set the world loaded on the server For example, (it must be and not !) Set the max number of players allowed on a server. The value must be between 1 and 255. (default=8) Set the port number (default=7777) Set the server password Reduces enemy skipping but increases bandwidth usage. The lower the number the less skipping will happen, but more data is sent. 0 is off. (recommended around 2 6, increases required bandwidth but reduces teleporting) Link the mods folder (might default to that so could be irrelevant) Select the modpack to load for the specific world. The is optional For full list go to: https://terraria.wiki.gg/Server Server config file Note : Journey's End config commands are NOT going to work because tModLoader runs on an older version of terraria! Portforwarding If you want other people to connect to your server from another network, you must open up the port your server will run on. What is a port? Your computer has access to many ports. When an incoming network packet is received by your internet router, it will come bundled with an associated IP address and port number. If the IP matches your server IP, it will be sent to your server machine. The port number tells the computer exactly to which application the packet should be sent. This allows computers to run many applications simultaneously and communicate between networks. You can read more ) How do I portforward? In order to open a port to other networks, it must be explicitly told to open inside your network router. If you live at home, you'll have to discuss with your parents and have them allow you to do so. Opening the specific port for a terraria server will allow other computers to communicate with yours through the terraria application, but nothing else because the terraria server application will 'consume' the port: no other application can then use this port. How to access the router Your typical home IP starts with 192.168, the router is often located on 192.168.1.1 You can type this number in your internet browser to navigate to the router webpage. You'll need the password to login, which is typically displayed on a sticker somewhere on the physical router device. It is recommended to change this password if possible to increase security. It is possible your internet provider did this for you, if you do not know the password you'll have to call them and discuss how you can retrieve it. You'll likely have to reset the router, so make sure to remember the password next time. Starting server on Windows The contains a script called . This script will start an instance of a server on Windows. There are several ways this file can be used. 1. Launch directly 1. Launches a server with 2. Will prompt if the server should have Steam support enabled or not 3. If does not set the property, will also prompt for which world to load 2. to 1. Additional parameters can be added to the to customize the game launch, such as setting to automatically load a specific world, to use a specific config file, to skip prompting for Steam support, or any other supported command line argument. 3. Make a copy of and edit the copy with the same command line arguments mentioned above 1. Edit the line, adding command line arguments before . For example will behave exactly the same as normal except it will skip the prompt to enable Steam multiplayer support. You can create a desktop shortcut to this .bat file for convenience. 4. Make a new file 1. In the file type and then add any command line arguments. For example would start a server loading with no Steam multiplayer support. You can create a desktop shortcut to this .bat file for convenience. Starting server on Linux or Mac The contains a script called . This script will start an instance of a server on Linux or Mac. This script can be launched and customized in the same manner as the Windows script in the section above, just replace with in those instructions and add command line arguments to the line instead if using the 3rd approach. You may also need to make the new file executable as well. Optional: it is recommended running the server inside of a screen or tmux session. This way, when you need to close the terminal, you don't have to close the server. This is especially useful for headless servers where the owner will only be connecting via SSH. Starting server headless By default, the server will ask several questions before actually launching. The first question is if Steam multiplayer support should be enabled. If yes, it will then ask if the server should be open to friends, friends of friends, or be private. After this, mods will load and the server will ask which world to load. Once a world is selected, additional prompts for max players, server port, port forwarding, and password will be shown to the user. With some configuration, these prompts can be skipped and the server can start \"headless\", or in other words it will start hosting a specific world directly with no interaction required. To start the server headless, we need to specify at least 2 things, the Steam multiplayer server support choice and the world to load. To set the Steam multiplayer server mode, we can set one of the following command line arguments: 1. Steam multiplayer support disabled 2. Steam multiplayer support enabled, friends allowed to join directly. 3. Steam multiplayer support enabled, friends and friends of friends allowed to join directly. 4. Steam multiplayer support enabled, invite only. To specify a specific world to load: 1. The command line argument can be provided. Make sure this is the full file path to the file, not the file. For example, . 2. The entry in or whatever file is being used can be set. Make sure this is the full file path to the file, not the file. For example, . Make sure to save the config file. Quotes should not be used in this case and make sure to delete the preceding . These custom command line arguments can be added to a copy of as shown in the or . At this point launching the new script file should start a server directly with the specified world. Further edits can be done to customize port, mods, modpack, and many other settings if desired. These changes will either be command line arguments or changes to or whatever file is being used. Additional server arguments Set the Steam workshop content directory, useful for using SteamCMD to install workshop items to a custom directory"},{"path":"螺线翻译tml教程/杂项/The-tModLoader-development-pipeline tModLoader开发管线.md","filename":"The-tModLoader-development-pipeline tModLoader开发管线.md","title":"The-tModLoader-development-pipeline tModLoader开发管线","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This article roughly explains how tModLoader was established, how it works and how it is being maintained Use this as an introduction to tML and get some valuable background insights about the API How is tModLoader developed? First of all, tModLoader is a modification to the vanilla source that facilitates both modding development for mods and loading (playing) with mods. It uses a custom built patcher (by chicken bones) that can manage the source using patches. The patcher uses internally to decompile the vanilla client which allows access to modifications using an IDE such as The patching system allows tML to be open source as it does not disclose vanilla information nor does it host the decompiled source. Developers will have to manually decompile and patch their local source to work on the tML codebase. The patcher can do this by first decompiling the vanilla client, and then making separate managed projects in which one will have the patches applied. This will result in the user having access to the tML modified codebase locally. How is tModLoader updated? Everytime vanilla updates, the patches for tModLoader become broken. This is due to changes in the vanilla codebase. For every update, the developers will have to manually go through patches to figure out what changed and how to fix the patch. This is all done manually. How does tModLoader facilitate modding needs? tModLoader exposes a variety of classes and methods that can be used by modders to create their own content. It can then \"build\" a modders' mod and register its changed in the vanilla code. Modders get access to this by referencing the modded assembly (tModLoader) in their IDE. Every mod has one entry point, a \"Mod\" class, and from there can add any content that is desired. tModLoader provides an Object Oriented design approach for modders to build content, which is facilitated by classes such as , , and so forth. Modders can use these classes in their mod to add these respective subjects to their mod. For example using the ModItem class modders can add their own items to the game. We've designed these classes to be easy to use and be ). We expose the API via methods or methods, which can be overridden by the . Abstract definitions do not contain any logic, and must be implemented by the deriving party. Virtual definitions can contain base logic, but may be overridden by the deriving party. Once a mod code base is made, it can be built using the in game mod source menu which will package the mod into a .tmod file. This file can then be spread to other players so they can play the mod. How does tModLoader facilitate playing the game with mods? tModLoader is not only a tool to build mods, it also allows playing them. It does so by providing a Mod Browser (to look for and download mods) and providing in game functionality to load in and apply mods to the game (as well as unloading them). Players only need a '.tmod' file to get started, which is tModLoader's specific package format for mods. How does tModLoader understand what mods want to add? Upon loading a mod, tModLoader will load that (its code) and look for classes that are provided by tModLoader. It can then load this content into the game. This is done by the so called 'Loader' classes. These are classes that contain specific code to load a certain content into the game. These classes do things such as preparing the vanilla source to be edited, this can include things like resizing arrays that hold particular content. The loaders contain methods that are called from specific points in the vanilla code, when modders would expect their code to execute. These calls are added by the tModLoader developers and is what makes the modded content work. tModLoader works sort of like a bridge between the client and mods; it will know which mods are loaded, and then proceed to call the necessary methods in them. This is why modders do not have to worry about how or when their code will be executed, they can simply focus on creating the content instead. Evasive patches We try to edit the decompiled source as little as we can, due to the patching system. By doing so, we can minimize the difference in patches and thus make it easier to fix the API when vanilla updates. If you wish to contribute to the API, keep this in mind and try to minimize patch difference. Tips These are also things we keep in mind ourselves to minimize our patch differences: 1. Call tModLoader classes from vanilla classes if you can, when code resides in our own classes it is not a maintenance hassle. 1. Do not refactor any vanilla code. As tempting as it may be, it will increase the patch difference and make it harder to update. 1. Document your changes, especially changes made in a patch. Mark line numbers and landmarks."},{"path":"螺线翻译tml教程/杂项/Time-and-Timers 时间和计时器.md","filename":"Time-and-Timers 时间和计时器.md","title":"Time-and-Timers 时间和计时器","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide has been updated to 1.4. If you need to view the old 1.3 version of this wiki page, click Time and Timers When dealing with various aspects of Terraria modding, you'll find yourself wanting to delay actions of make things happen less frequently. In short, you'll want to utilize time and timers to accomplish your modding goals. This guide will go over many time related concepts so that you don't unknowingly make a mistake in your code. Cooldowns A cooldown is nothing other than a timer, often accompanied by a condition or trigger instead of repeating endlessly. The same concepts from this guide can be applied to implement a cooldown, for example when pressing a custom keybind, dashing, and many other things. Don't use Loops When dealing with timers, the most important thing to remember is that the game loop is what is calling all the hooks and methods. Loops within your code will not act as a timer, they will loop the number of times within nanoseconds and then continue executing the code below it. Timers must be programmed taking into account that the game loop will call the methods once a tick. The following show common mistakes modders make. Mistake Examples This example mistakenly assumes that the while loop will cause this code to wait 60 ticks and then run the code below. That is not the case, the while loop will run 60 times and then immediately run the code below. The correct approach necessitates storing the timer in a non local variable and removing the loops, as shown in other examples. This example will also fail, will never reach above 60 because it is defined in the same scope, meaning it will start at 0, increment to 1, and then next tick will start at 0 again. To avoid this, put your timer definition ( ) outside the method (usually the class). See the \"Timer Using New Field\" section for details. Wall Time vs Game Time vs World Time First off, it is important to know the difference between various types of time. Wall Time is actual time in the real world. We almost never want to use this in modding because usually our effects run at the same speed as the game or at the speed of the game world. Running things in wall time would mean that while the game is paused or is running at a slower frames per second, the events we are coding would still happen. This would lead to many bugs. World Time is the reported time of the world. An issue that could arise with improper usage of world time would be events happening extremely quickly while an enchanted sundial is active. Game time is the time we want to use for gameplay effects most often. Terraria tries to run at 60 frames per second, but weak computers might be running the game in slow motion if they can't maintain 60 FPS. By using game time in our logic, we can account for gameplay effects running at the same relative speed. For example, if an enemy should attack every second, using Wall time would mean that the users running Terraria at 30 FPS would have twice as many attacks to dodge. In summary, use Game Time for pretty much everything. Never use Wall Time. Use World Time for things tied to the day/night cycle of the world itself. Game Time Game Time is what we use for most gameplay timer elements. Game Time is consistent with respect to frame rate, so gameplay effects happen at the same frequency as the gameplay itself. This is almost always the intended behavior for modders looking to implement a \"timer\" in their mod. Game Time is measured in Ticks. Ticks is a term that refers to each time the game logic is updated. For example, every tick each projectile is advanced by their velocity and everything else moves as well. If you have a good computer, you'll get 60 ticks each second. Thus, an effect that you want to last 2 seconds would need to count to 120 ticks. As a reminder, it won't be exactly 2 seconds if the user is not hitting 60 FPS and has frame skip disabled, but that's ok because everything else in the game will be slowed down by the same degree. Implementing a timer that counts in ticks is easy, you simply increment a field of your class each Update/AI/etc call. After increment, you can use an statement to check if you've reached the intended value, and if so, run the code that does what you want, such as spawning a . Within this if statement, you might also want to reset your timer back to 0 if you intend to repeat the action. (An alternate approach is initializing your timer to a number and decrement it until it reaches 0. The effect is the same, either counting up or counting down. This is up to your preference.) Important Fields Each time a world is loaded, this will reset to 0. Incremented by 1 each tick, even while the game is paused. Incremented by 1 each tick and cycles from 0 to 299. Use this to drive player visuals. and A common approach in vanilla code is to use these arrays as timers. Counts down to 0, once 0 is hit, the Projectile will die automatically. By default, will be 3600 (60 seconds), but can be changed in . Can be used for a simple timer, usually for counting ticks after spawning or before despawning. See example below. / This will cause Projectile.Update to run multiple times for special effects. Be aware of this if you are implementing a timer but it seems to be too fast. You'll need to scale your timer logic to account for the additional Updates. Examples In these examples, we'll use or to advance our timers. Timer Using Projectile.ai[] (or NPC.ai[]) (This example uses as an example, but also works the same way) If you are using an original AI, or know that the aiStyle you are using doesn't use one of the 2 ai slots (4 for npc), you can use projectile.ai[] as a timer. Since projectile.ai[] is automatically synced, this could be convenient, but it does require some investigation to make sure the ai slot is free to use: shows using a timer to fade in the Projectile for 50 ticks, then fade back out. We can use a property to make the code much easier to read: shows this approach in practice. Timer Using New Field and are synced automatically over the multiplayer network by the game, but you can make new fields in your or class. This makes the code much easier to read, but you might need to sync this extra data. Read if you want to learn more. Some data won't need to be synced, so try to familiarize yourself with when data needs to be synced. Making a new field to act as a timer is simple: ExampleMod has many examples: . Projectile One Time Timer Using Projectile.timeLeft If you need something to happen once X ticks after spawning, you can take advantage of (you may want to change in to something smaller): Modulo Timer For visual effects, you can get away with making a timer that simply uses . Don't use this approach for gameplay elements, as the inaccuracy will cause issues. Here is another example showing cycling between 4 colors with 1 second between. Dividing by 60 turns the value into counting seconds, and using modulo 4 lets it cycle. This code came from a method, but the idea can be in other situations. Cycling, Looping, Interpolating effects We can use a timer to control a visual effect that should change over time. For example, if we want to transition a tooltip between 2 colors, we can use a timer to control how far close we are to the 2nd color. This is called interpolation. To do this, use a modulo timer approach and divide the result by the period. , for example, would start at 0 and move towards 1 each game update until it looped back to 0 after 60 game updates or 1 second. We use this value to call the method, which will return a color value suitably between the input values. Looping As the game runs this code each game update, the colors will transition from red to green and then loop back to red over the course of a second. Change 60 to adjust the speed. There are other \"Lerp\" methods such as and to experiment with. Cycling Another approach is cycling. A cycling effect is achieved by interpolating from 0 to 1 and back to 0. This approach will avoid the jumps that looping will result in. The takes a value from 0 to 1 and interpolates from 0 to 1 and back to 0 without any jumps. This example transitions from red to green and back to red, then repeats. operates the same way, but does so smoothly as a cosine wave would. Use this for an even smoother effect that avoids the transition suddenly reversing direction. World Time World Time usually advances at the same pace as Game Time, but there are several situations where the difference is critical. While the game is paused, world time does not progress. While an enchanted sundial is in use, time progresses 60 times faster than usual. Journey Mode also allows adjusting world time. Be aware that mods could also change how fast time progresses. For example, time can be paused in HerosMod, so relying on World Time for gameplay effects would fail. Important Fields Here are the important fields relating to World Time: true during the day, false at night A value between 0 (4:30 AM) and 54000 (7:30 PM) during the day and between 0 (7:30 PM) and 32400 (4:30 AM) during the night. Use with Main.dayTime. Main.time usually increments by 1 each tick (see ). Each in game hour is 3600 ticks. Example: Morning between 4:30 AM and 9:30 AM (because 18000/3600 == 5) Normally 1. 60 while enchanted sundial is happening. The value is added to during the method. Intended Use World Update events, such as the TODO: Wall Time When you are a beginner modder, you may find yourself googling \"c timer\" in an attempt to code up something for your mod. If you did, you found examples of using . Those concepts do not apply to video games or tModLoader modding at all, as they are examples of Wall Time. You'll need to consult and above to determine the correct approach. Again, any usage of is almost certainly the wrong approach. It'll be buggy and incorrect when the user pauses the game or uses an enchanted sundial. The same can be said for using to wait some time before running code. That will freeze the game. You need to write your own logic to run code later by taking advantage of the game loop. One appropriate usage of wall time for modders is measuring the performance of a piece of code, such as a world generation method. Feel free to use wall time to measure performance:"},{"path":"螺线翻译tml教程/杂项/Update-Migration-Guide 更新迁移指引.md","filename":"Update-Migration-Guide 更新迁移指引.md","title":"Update-Migration-Guide 更新迁移指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This page contains guides for migrating your code to new methods and functionality of newer tModLoader versions. When a tModLoader update requires rewriting code, we will present the information here. For migration information from past versions, see Table of contents tModPorter tModPorter is a tool that automatically applies code fixes to mod source code for changes made to tModLoader. As a modder, the first step in updating a mod after a major tModLoader release is usually to run tModPorter. tModPorter will modify your source code files to fix or provide suggestions on how to fix your code for the new update. Please also read the relevant corresponding porting notes below to be fully aware of changes made in case you need to adapt your code further. To run tModPorter, visit the menu in game and click on the \"Run tModPorter\" button. You should see a window pop up with the status of the process. Once it is complete, you should see \"Complete!\" and a message noting how many files were affected. tModPorter might not fix your mod completely, you may need to still fix some things manually, see the instructions in the next section. tModPorter Notes Some tModPorter fixes will add comments to your mods source code for changes that might require additional work from the modder. Open Visual Studio and begin working on updating parts of the code that tModPorter either couldn't port or left a comment with instructions. To find all comments, first go to and add as a custom token. Then close it and open , which will list all comments. You can also use the search bar to filter specific comments. Short Summary: Porting Notes: Long: Pull Request: Short Summary Line 1 Line 2 Porting Notes Line 1 Line 2 v2025.08 Pull Request: Short Summary has been added, allowing mods to add new achievements to the game. (Note that these are not actual steam achievements and won't appear on steam) Achievement menu has been updated with search, additional filters, and the option to reset all achievements. ExampleMod has been updated with plenty of examples, please read them and the PR description before starting to make your own , there are several important nuances to that are taught in the examples. Porting Notes If you have manually manipulated the achievements previously, please use this new system. Pull Request: Short Summary Tiles and walls can now specify a 'conversion fallback tile'. When a modded conversion attempts to convert a tile but there is no registered conversion for that tile, the tile will be converted as if it was the fallback tile. Use and as described in the PR description to indicate tile conversion fallback types. Overriding is now only required for advanced use cases where doesn't suffice. Porting Notes If your mod already implements tile conversion logic, consider adapting to the new options in this PR where appropriate for better compatibility and easier to maintain code: Use for conversions which don't need any additional logic beyond converting the tile/wall. Use for conversions which do need special logic but should still be treated as a pure counterpart for other conversions. Remove explicit conversion code when the fallback conversion would produce the same result. Pull Request: Short Summary added, it is called when a tile is being replaced via the block swap feature. Porting Notes If a block swappable tile has or logic, you might want to test it with block swap and decide if should be used to implement some or all of the same effects. Pull Request: Short Summary Added , showcasing an implementation of and , and to implement a custom item use style. Added to allow mods to safely determine a unique custom use style ID. Added helper methods: , , and Porting Notes Replace magic numbers (made up numbers) for custom values with the result of . This will allow greater compatibility and will avoid the potential of conflicting values between mods. Pull Request: Short Summary A \"Translation\" tag has been added to the Steam Workshop for mods, allowing users to filter by (or filter out) mods that add translations. It will automatically be set during publishing for mods setting in build.txt. Porting Notes The tag will be applied the next time the mod is published. Upload a new release if you want the tag right away. Pull Request: Short Summary added to support properly cleaning up temporary tiles similar to the tiles placed by Ice Rod. added for situations where is too early. Porting Notes If currently using a detour, IL edit, or the event for code covered by the new features in this PR, consider using these new features instead. Pull Request: Short Summary Projects can import to reference tModLoader without being built as a mod by setting the property instead of redefining the target that would build a mod. This feature is intended for non mod tools or libraries that need access to tModLoader references but shouldn't be packaged as a mod when the project is built. Porting Notes Replace with within a . v2025.07 Pull Request: Short Summary The code analyzer (formally ) has been reworked and is now directly included in tModLoader releases. This new implementation will be much easier to update and we intend to add more requested code fixes to the analyzer. We welcome suggestions and feedback at . If you are unaware, this feature is responsible for the suggestions in your IDE to change code like to . This also fixes the issue where the old would cause issues for users who had bad nuget settings. Porting Notes If you run into issues in your IDE after this update, you likely need to run \"Upgrade .csproj file\" from the menu. (To remove the old reference to ) Pull Request: Short Summary Support for interactable projectiles added. Projectiles can now be targeted by smart select and draw a smart select highlight. Use and follow the logic in to make an interactable projectile. Porting Notes Replace any detours or IL edits on the method with usage Consider upgrading existing projectiles that can be right clicked directly with this smart cursor support for better compatibility and user experience. Pull Request: Short Summary Add hooks. Lets modders override or piggyback off of right clicking on or hovering over an NPC Pull Request: Short Summary Adds and some documentation. Porting Notes We encourage any mod with vine tiles to compare your code against and . It is possible your vines do not match the vanilla behavior, such as converting properly when the grass tile changes (Clentaminator), rendering properly (offset and flipping), not cutting when the user is using the staff of regrowth, breaking when the tile above is block swapped, incorrectly growing on activated tiles, incorrectly growing on bottom slope tiles, not propagating paint to newly grown vines, etc. Pull Request: Short Summary Fixes manually setting bestiary stars. Mods can now set in . Porting Notes Mods setting in currently work by accident, but we recommend setting in instead. v2025.06 Pull Request: Short Summary Many vanilla sound behaviors have been fixed Sounds no longer stop when pausing the game by default Sounds using the same now properly honor and won't be seen as the same sound now has , , and fields to further customize sound behavior. Porting Notes In fixing various bugs, this PR does change some existing behaviors some modders might have unwittingly relied on. We recommend that modders test the sounds in their mod that relate to the following: Sounds now continue playing when the game is paused by default. If this is not desired, consider setting setting to (or ). Various changes to now means that some that previously were seen as the same are now seen as different and vice versa. If you have multiple using the same but want them to behave independently for sound limiting purposes, make sure to set . Consider setting if making use of the variants feature to allow each variant to have an independent instance limit. Pull Request: Short Summary has been added to allow mod code to safely modify and save changes to . added to facilitate reacting to the reply of save requests for configs. can now make changes to the pending config values before accepting. has been updated to showcase using correctly. Porting Notes If using reflection to access , use instead. If your mod has UI, consider using to save user preferences to preserve UI positioning and toggles. Pull Request: Short Summary Negative NPCIDs, such as Pinky, are now usable with NPCDefinition Porting Notes Due to some negative values now being valid for , the for an \"unloaded\" has changed from to . If you have code checking directly, it would be better to check instead. v2025.05 Pull Request: Short Summary now supports loadouts by default. Porting Notes If loadout support is not wanted for a , set to false without custom backgrounds that support loadouts will be tinted with loadout colors as normal. If using a custom slot background, however, they will not be affected. A new hook, , can be used to further customize the color. is now obsolete, use instead. and can now be called on the server and remote clients instead of just the local client. This might mean some syncing issues need to be addressed. Pull Request: Short Summary has finally been implemented. See the PR description for images depicting what this means. Users can use the chat command to remove tiles in a world from mods they are no longer using. Modders can assign values to to dictate which vanilla tile a deleted tile should revert back to. Porting Notes Nothing is required, but if you want to make it possible for your mod to be removed from a world, consider assigning values to . The default fallback of should work, but if something is more appropriate it can be used. Pull Request: Short Summary Adds customization for town NPC and boss death messages. Adds which modifies the message broadcasted when a town NPC or boss dies. This also affects what the town NPC's tombstone says in hardcore mode. This allows custom death messages similar to \"The Twins\", which were previously not possible. Color can also be modified with . Adds which prevents tombstones from being spawned in hardcore and sets the death message to \"X has left!\" unless specified otherwise by the method above. This is what the Angler and Princess use. Porting Notes became obsoleted and replaced with . Both will still be called for now but you should consider changing to ahead of time. If you had a workaround for paired or group bosses, you can get rid of it and use instead to prevent duplicate boss defeat messages. Pull Request: Short Summary Wall blending has been fixed to work as intended for modded walls. Wall blending is when the border between different types of walls don't have a thin black line between them. Previously all modded walls blended with each other, but that has been fixed and each wall will now only blend with walls they are intended to blend with. Please see the pull request for more information, there are images and animations that show the original issue and fixed behaviors. Porting Notes Add to any where blending was intended. This only needs to be done on one of the walls in a pair, since this is indicating that this wall should be considered to be the other wall for the purposes of blending. never worked in the first place, despite being recommended on our wiki previously. If you were using it, remove it and use instead. v2025.04 Pull Request: Short Summary and hooks added to and folder in ExampleMod showcases a full custom visual equip type example Porting Notes If you have modded visual elements that don't show up properly on the player select screen, such as a custom equip type layer, you should move code assigning those flags/fields to while checking that if false. (Follow the examples) Existing methods like , , and couldn't perfectly work for custom draw flags like these. Pull Request: Short Summary added to facilitate compatibility for adjusting underwater breathing time Adjusting directly to implement a Breathing Reed or Diving Helmet effect is no longer the best option. added to , so it is no longer necessary for mods to do it. Porting Notes Remove from . If adjusting previously, consider instead adjusting for more compatibility. Technically is the breath capacity and is how long each unit of breath lasts, so advanced situations might warrant adjusting both, see PR for details. Pull Request: Short Summary This PR allows 's , , and properties to produce pitch values outside the octave range they were previously restricted to. Porting Notes Check if any of your code has accidentally relied on the previously present internal clamping, and alter it to always produce the pitch range you intend it to. v2025.03 Pull Request: Short Summary Custom ID sets (ID sets are arrays indexed by a content ID like ) are now fully supported. Use or a class annotated with to correctly initialize them. Custom ID sets can be registered with a name (\"named ID set\") allowing multiple mods to access the same array. After registration they can be used exactly as an existing ID set would be used. You might know of this concept by other names like \"content tags\". See the PR description for more information. Porting Notes There are no breaking changes, but the custom and named ID sets supported in this PR might greatly simplify existing code, especially for cross mod situations where data is accessed by multiple mods. There are some situations that were incorrect before but now throw errors during loading due to this PR. The most common issue is calling for an equip type that has already been autoloaded using . To fix, get rid of one or the other. and Pull Request: , Short Summary Adds hook to allow modded tiles to be converted via clentaminator, purification powder, hardmode worldgen or infection spreading. Adds methods to provide or block 'global' conversions for tiles. Adds and helper methods to cut down on repeated code Adds for conversion hooks. Adds to register custom conversions. Adds and calls hooks when chlorophyte attempts to purify nearby tiles in Pull Request: Short Summary Full example of a , , that should be complex enough to be useful but simple enough to use as a template. Various new helper methods: , , , . Please see and the PR details to see how these are used. added to help implement chest like tiles that shouldn't break easily. Various bug fixes and related documentation, see PR for details. Porting Notes Nothing is required, but the new example and helper methods can be used to clean up existing Tile Entity code. can replace some workarounds. See the PR for full porting note details. Pull Request: Short Summary Chandeliers and other rigid swaying tiles can now customize their physics and flame visuals behaviors ( and ) added to simplify spawning tile dust and gore with the correct timing and behavior support. s can now use custom 1 off animations, similar to how the MushroomStatue behaves. added, showing off all these hooks and more. Modded torches now work with Torch God event and The Constant rain extinguishing feature. Porting Notes Revisit tiles and see if any of the new features would help make them better. Consider moving tile dust and gore code from to . Doing so would allow simplifying code greatly by removing the boilerplate code. Update torch tiles with dust spawning if you had used as a guide. Pull Request: Short Summary now supports ordering. ( and ) Previously all modded map layers would be drawn in load order after all existing layers. Porting Notes Adjust your to use the new ordering methods if desired. Many users might expect Pings to show above all layers, so adding would be recommended for that. Pull Request: Short Summary Fixes 's default implementation to automatically include prefixes from To opt out of GenericPrefixes, set this to false Pull Request: Short Summary Frost and Pumpkin moon music had higher priority than all other music and could not be overridden. They now both have the proper priority. Porting Notes If you had workarounds for this, they can be removed. v2025.02 Pull Request: Short Summary The ExampleMod relic, , did not match the vanilla behavior completely. It animated at a slower frame rate and was blurry due to interpolation. This example has been fixed. now supports custom rendering, which allows 60fps rendering rather than the 15fps rendering of Porting Notes Fix your relic tiles using the changes to in this PR as a guide. Consider using instead of for usages that would benefit from rendering at 60fps rather than 15fps. The pull request description has steps to do this. Consider adjusting frameCounter logic to count to multiples of 4 for smoother animation. The updated docs explain why values that are not multiples of 4 results in jerky animation Pull Request: Short Summary is now , replaced by to correctly support localization of death messages. Previously users would see death messages in the language of the player that died, not their own selected language. Porting Notes If already using , change to . If still using a string directly, consider supporting custom death message localization by following the example shown in and . Pull Request: Short Summary: Mods which are built from locations outside the folder via the command line/visual studio will now show in the menu. See the \"How to use\" section of the PR to learn how to use this feature. This can give some developers more flexibility over their paths and workflows Porting Notes: Symbolic links in the folder pointing to other folders might now result in duplicate entries in the Develop Mods menu. Deleting those links will fix this. v2025.01 Pull Request: Short Summary and added to allow customizing drops from shaking vanilla trees. showcases using these hooks. Porting Notes and now default to instead of and respectively. This means that modded tress no longer default to having all the vanilla tree shake drops. Adjust this back if that behavior was desired. Pull Request: Short Summary and Porting Notes hooks, callbacks and methods have been replaced with hooks which have an additional parameter. This allows you to apply discounts when shimmering to prevent infinite craft shimmer exploits. The current classes and hooks are marked but remain functional Added read only property , exposing previously internal state The field has been removed, as its functionality is now covered by Pull Request: Short Summary If you would like to make your mods' music slightly louder than vanilla's intended volume range, or to use old music files whose volume was adjusted for pre 1.4 TML, you are now able to opt out of the internally used XACT matching volume remapping, via either the new set, or the new property. The default music volume behaviors remain unchanged. As before this PR and since TML for 1.4, by default any given music track is lowered in playback volume to better match vanilla music volume in game, matching it best if the file had a peak amplitude of . If the volume remap is skipped for a music track, then it will be able to play at about twice the volume of vanilla tracks. v2024.12 Pull Request: Short Summary: Previously, ' parameter required modifying any of the color parameters to actually have effect. This requirement has been removed making it easier to use correctly. Porting Notes: If using , you can remove any workaround code setting , , , or . v2024.11 Pull Request: Short Summary Enemy banner tiles are now fully supported, and shows a fully correct implementation. added. It contains all the code common to enemy banner tiles and should be used. Various other fixes and documentation related to banners. Porting Notes Read the porting notes in the pull request description to learn how to use this new feature. Existing banner tile examples in other mods have various bugs, please read the porting notes even if your mod already has banner tiles. Pull Request: Short Summary Allows modders to \"categorize\" a custom bestiary info element, giving more control over where the element will be drawn in a given Bestiary entry. Porting Notes Implement and the property to support this feature for in your mods. Pull Request: Short Summary Sending and receiving bools through or was inconvenient, new methods have been added. Porting Notes Consider using the new and methods to simplify and improve the readability of your code. v2024.10 Pull Request: Short Summary Allows modders to \"register\" their multi tiles to sway in the wind and with player interaction, facilitating implementing swaying multi tiles such as banners, chandeliers, vines, etc. added, /\"Red Firefly in a Bottle\" (a lantern tile) updated. added. Various methods made public. Porting Notes Please update your banners, lanterns, chandeliers, etc to use the new tile swaying mechanics for consistency with vanilla tiles. / / / are all now public Consider replacing or checks with for cleaner code if appropriate. Pull Request: Short Summary Mods are now required to have a unique icon and mod description. will automatically be scaled up for workshop publishing, meaning modders no longer need to create a for their icon on the workshop unless they want the workshop icon to be more detailed than the regular icon. Porting Notes Make sure your mod has a unique icon and description if you can no longer publish the mod. Pull Request: Short Summary added to allow custom clouds. Textures in a folder named \"Clouds\" will now be autoloaded as unless is false. Porting Notes If you happened to have a folder named \"Clouds\" that doesn't contain s, you can add to your class constructor. Pull Request: Short Summary: now resets to and is capped to . Porting Notes: If your mod previously reset or , it is no longer necessary. Pull Request: Short Summary: Afterimage example code in was incorrect. If you used it as a guide, please fix your usage of it. Porting Notes: Change to to draw afterimages from furthest to closest for the proper afterimage layering. Pull Request: Short Summary: is now public. Public getters for and Porting Notes: If your mod previously used reflection, consider updating or verifying compatibility. Pull Request: Short Summary Adds and , making it easier for mods to make a player situationally ignore certain damage instances. Cancelling a hurt has the same effect as returning true from FreeDodge, though even undodgeable hurts can be cancelled. Unlike FreeDodge, immune frames are not applied, so the player can still be hit by another attack this tick, or the same attack next hit. Porting Notes None. Modders do not need to check if a is , tModLoader will not be passing cancelled hurts to hooks. v2024.09 Pull Request: Short Summary and added to facilitate triggering modded armor set bonus effects without workarounds. ExampleMod updated to now showcase an armor set effect, armor set shadows, and more varied usage. Porting Notes If you were using a custom hotkey or detour/IL edit to activate armor set bonuses, consider migrating to or v2024.08 Pull Request: Short Summary can now belong to multiple prefix categories, either via their or by overriding added to allow DamageClasses to declare which vanilla prefix categories weapons using it should inherit. (For example, a Melee/Magic hybrid class might want weapons to get Melee and Magic prefixes) Porting Notes Some existing items in your mod may now count towards multiple prefix categories, especially those using a custom . Test these items and determine if their prefixes are desired. Adjust or as appropriate. The mod contained in the PR description can be used to easily compare prefix results, please use it to verify that the item prefixes are as expected. If using , use instead and adjust your logic v2024.07 Pull Request: Short Summary class has been fully documented Basic Tile wiki page updated Fixed several issues related to /tile placement: Modded tiles with alternate placements would sometimes require a workaround to not break when placed Fixed / incorrectly ignoring when used with , which will allow tiles also using to function correctly. fixed to not break when opened to the left. added to showcase and visualize advanced usage, such as left and right placements, random placements, animation, toggle states, custom anchors, and multiple styles. Porting Notes Modders should fix their open door tiles if they are using or if their doors break when opening to the left. Modders should double check that tiles using placement alternates ( / ) work as expected. The fixes should not cause issues, but it is possible that incorrect workarounds to issues fixed in this PR are now broken. Modders should use and where correct. This should reduce the amount of workarounds such as using or to fix item drops that are incorrectly being calculated. v2024.06 Pull Request: Short Summary to match the behavior of vanilla explosives without having to use New method which will damage the local player if they intersect the hitbox. New hook to implement explosives correctly. A full set of rocket projectiles as well as rocket launcher and rocket ammo items, showing how they all connect to each other. Porting Notes If you were using (16) to match the vanilla behavior of explosives, you can now use . Also override and add the explosion resizing logic there. Rocket ammo should have defined for all applicable vanilla launchers. Rocket launchers should set to the closest vanilla launcher to inherit ammo specific projectiles from. If you were using or similar to fix your rocket ammo shooting the wrong projectile for the Snowman Cannon and Celebration Mk2, double check that because it is probably not necessary anymore. Pull Request: Short Summary to change the distance away the player stands while petting Town Pets/Slimes. to change whether the player's arm will be angled up or down while petting Town Pets/Slimes. to change the chat bubble that appears while hovering over a Town NPC. to change the emote bubble on NPCs. to have more control over the party hat on Town NPCs. New which has no predefined offsets for the party hat. Pull Request: Short Summary hooks added. These facilitate weapon enchantment visuals. has been used for this, but only covers items and does not cover projectiles. With both hooks it is now possible to fully support weapon enchantment visuals. and showcase a full implementation of a flask potion and corresponding weapon imbue, the most common type of weapon enchantment. Porting Notes Mods with weapon enchantments (such as flasks, frost armor, or magma stone type effects) should implement the hook. The code will be quite similar to the code you are already using, see for an example. Use instead of setting to a high value, if you want. Consider testing projectiles in your mod while weapon enchantments are active, set for special projectiles that shouldn't be affected by weapon enchantment effects (buffs) or visuals (dust). If weapon enchantment visuals on melee projectiles seem to be incorrectly positioned, such as would likely happen on \"energy swords\" such as Excalibur, consider using and as shown in to manually position the enchantment visuals. Pull Request: Short Summary ( ) calls added back to and . This was missing since 1.3. Porting Notes Check that UseItem logic dealing with health/mana potions still works with quick heal and quick mana hotkeys. v2024.05 Nothing this month. v2024.04 Pull Request: Short Summary: Shaders no longer need to declare all the parameters expected by the game Pull Request: Short Summary has been added to completely support modded liquid droplet gore. The old approach resulted in some slight visual bugs. Porting Notes Replace usages of with in modded liquid droplet gore. Compare against ExampleDroplet.cs. Pull Request: Short Summary has not worked correctly, this has been fixed. Porting Notes Verify that your code is still correct and get rid of any manual workarounds. Note that is still called during block swap by design. Pull Request: Short Summary: It was previously impossible to declare that an item was a tool for the creative mode duplication menu. This is now possible with Short Summary Modders should double check their usage. We've recently become aware of mods setting far lower than . We've determined that a custom price the regular value would allow a user with max happiness and a discount card to sell the item back to a shop for more than the purchase price after leaving and entering the world. This is because the normal is used to determine the sell price. Either raise or lower to avoid this exploit. v2024.03 This release includes an update from .NET 6 to .NET 8. Modders will need to install the and . After that, restart the computer. See below for details. Pull Request: Short Summary Upgrades tModLoader from .NET6 to .NET8. Players have reported noticeable performance improvements. World generation benchmarks finish 10% faster! Mod developers will benefit from access to new C and .NET features, such as , , , and more. Porting Notes Install the To update your mods' project files access the menu and click the button near your mod. Due to , this is now a safe operation to perform. Future runtime updates will not require this step. If you're a developer who's using or earlier you'll need to run a command for a continued smooth experience. Press , paste in the \"Run\" window, and press enter. A PC restart is also recommended for ensured compatibility. Players do not really need to do this. .NET 8 development in Visual Studio requires VS2022 17.8 or later. If updating from VS2019 make sure to export your customization/configuration for a re import post update. You may need to restart the computer as well. Pull Request: Short Summary Upgrading mods will no longer completely reset their files, when possible. It's now a safe operation to perform. All files in the mod template produced by the \"Create Mod\" dialog have been slightly improved, including the default mod icon. Properties like , , , and the are removed in favor of coming from the always imported . If you have any edge cases that this change interferes with let us know. Conditional groups are currently skipped just in case. v2024.02 Pull Request: Short Summary We've noticed that many mods do not use as efficiently as they can. These changes and accompanying guides will help modders improve their mod's load times and performance. A new has been made to teach modders various guidelines on how to properly use the class. to follow these new guidelines. It serves as a practical example of the guidelines taught in the Asset wiki page. Log messages will warn about mods that spend a long time using during mod loading. ShaderData now has a constructor that takes a , allowing for more efficient Shader loading. Porting Notes Please read the new and apply the guidelines taught within. Replace constructors with the new approach: Old: New: Pull Request: Short Summary: has been made obsolete and has been added to replace it. Basically, the pole item now controls the string position and color instead of the bobber projectile, matching the Terraria behavior. Porting Notes: Move logic from the bobber projectile's to the rod item's . Pull Request: Short Summary: property added. Use this when outputting the display names of mods to logs or console window. Also use it if your mod has the ability to search or filter by mod display name, such as a search bar. Porting Notes: Change to if appropriate. Pull Request: Short Summary: now has more functionality, such as custom drawing, ordering, and left and right click methods. Porting Notes: is now obsolete. Use instead and modify . Pull Request: Short Summary Sand tiles and associated falling sand and sandgun projectiles are now natively supported. If your mod implemented sand tiles previously they should still work. You can consult ExampleSand to see how it can be done with much cleaner code. Modded sand examples available previously online have slight inconsistencies with bugfixes added in 1.4.4 Terraria, so it might be worth switching to the native approach for exact behavior consistency. Porting Notes If you used reflection to access , it is no longer private and can be called normally. Pull Request: Short Summary TML will no longer interfere in cases where mod developers want to utilize files for non localization needs (such as content and data declarations), as long as the files' names don't begin with language codes (e.g. ). If you're going to make use of this it's recommended that you use consistent suffixes in your asset enumeration patterns (e.g. , , ), as to not repeat our initial mistake. Porting Notes . Unlikely that anyone used it. Pull Requests: Short Summary Improves mod loading times by up to 10% Methods for custom hooks are no longer specified via reflection, and instead use the 'lambda expression' syntax The only mods with runtime breakage are those with custom hooks that have or parameters. Examples of adding custom hooks (for an imaginary method in ): Ping Chicken Bones or Mirsario on Discord if you need help updating your mod or implementing custom hooks. v2024.01 Pull Request: Short Summary with values of 0 are supposed to be immune to knockback, but the old implementation would apply knockback to NPC if were assigned a value. This was deemed incorrect, so a method was added to disable knockback altogether. It is automatically applied to NPC with values of 0 Porting Notes If, for some reason, your mod depended on this behavior, you'll have to devise a workaround. This behavior has been deemed incorrect so an easy workaround has not been implemented. Pull Request: Short Summary: Fixes multiple bobbers causing sonar buff related issues. Porting Notes: If you are using in bobber projectiles, use your own GlobalProjectile field instead. The fix uses it. v2023.12 Pull Request: Short Summary and will now set to for , and Should reduce issues with dummy and despawned entities being assumed by accident, and subsequent calls failing. Pull Request: Short Summary Outer types will be checked for jit filter attributes such as This makes it easier to use lambdas which reference types from weakly referenced mods Commits: , . Short Summary A commit has been pushed to to fix an accidental long present misbehavior of main menu interfaces being recalculated every frame, with the fix improving performance among other things. This misbehavior has resulted in some of our recent main menu GUIs being written without proper manual calls, making them dependent on this bug, as due to it everything looked fine to us in testing. Porting Notes If your mod contains custom user interfaces that get shown in main menu please ensure that they didn't get borked on preview, and if they did insert manual calls when first activating the interface, or when it should be refreshed. As you usually would when writing GUIs. Example fixes: . . v2023.11 : Bad Tile Object Data leading to Render Mismatch Short Summary: There was a visual bug with tModLoader that could lead to 'floating' tiles Annoyingly, these issues are sometimes caused by incorrect code in the ModTile loading immediately before the 1st affected ModTile, leading to bugs that are hard to track down. This PR fixes the issue by resetting the affected fields in CopyFrom. This PR also throws errors in CopyFrom to instruct the modder that their code is not doing what they think it is, and will give you an error while developing your mod if applicable : now defaults to 1 for modded NPCs Short Summary: ai = 1 is for custom AI applications. The tModLoader code expected to handle 1 as the default, but had been written as zero due to a typo. If you had been using aiStyle 0 implicitly by leaving it as default, then you will need to explicitly assign it going forward v2023.09 : TileDrawing.IsVisible(tile) now public Short Summary: Terraria 1.4.4 added echo tiles and coating, but ExampleMod and other mods have not adapted their code. Many mods using will erroneously draw torch flames and spawn dust when the tile is invisible. Made method public, updated ExampleMod to use. : ModConfig.AcceptClientChanges parameters changed. Short Summary: parameter replaced with parameter for better localization support. : added Short Summary: New which allows players to place tiles next to non solid tiles. Allows for the same placement behavior of Cobwebs, Coin Piles, Living Fire Blocks, Smoke Blocks, and Bubble Blocks. v2023.08 Extra Jump API added a proper API for implementing and modifying extra mid air jumps. Short Summary: Adds , a singleton type representing an extra jump that is controlled via the structure The object for an extra jump can be obtained via the methods in Extra jumps can be disabled for the \"current update tick\" or consumed entirely NOTE: will consume the extra jump if it is available and prematurely stops it if it's currently active Adds new methods related to checking the state of the player's extra jumps to Also includes a field, which prevents any extra jumps from being used, but does not stop the currently active jump nor consume any remaining extra jumps Flipper swimming is now considered an \"extra jump\" and can be accessed via is now more directly related to the state of the Sandstorm in a Bottle extra jump ExampleMod contains examples for and extra jumps, as well as an example for . The PR's original comment contains snippets for enabling/disabling an extra jump, temporarily disabling extra jumps in a and changing the horizontal movement modifications for an extra jump. Porting Notes: , and for all vanilla jumps are now accessed via the for the respective extra jump If you were setting one or more of these fields to in order to disable the extra jump, use instead If you were disabling all extra jumps: Set for temporary disabling Call (optionally followed by ) for permanent disabling until the player lands and are now properties, so any code that was using them will have to be rebuilt Rework reworks NPC buff immunities Short Summary: Replace with , , and to simplify modder code. Added buff immunity inheritance through the set and corresponding methods. Porting Notes: If your mod has any NPCs or does anything with buff immunity, you'll need to update their buff immunity code. Read the Porting Notes section of . Mods should consider using the new buff immunity inheritance system for buff inheritance compatibility. : Rename hook to Short Summary: renamed to to better match the behavior and other similar hooks. Porting Notes: Run tModPorter or rename usages of to : hook Short Summary: Adds which functions the same as the hook. The hook has been added for convenience, to reduce the need to make a separate class when many of the effects modders want to make are stored on a instance : Add modded world header data Short Summary: Modded world data can be now be saved into a 'header' in the .twld file. The header can be read without deserializing the entire .twld file, and the modded data is accessible in the world select menu and during vanilla world loading. The list of mods the world was last played with is now shown in the world select menu, just like for players The list of mods (and version of those mods) the world was generated with is now stored in the header. Only applies to worlds generated in the future of course. See for more details and usage examples : Modded Emote Bubble Short Summary: Modders can now make custom emotes Modders can adjust how NPC pick emotes ExampleMod shows off several custom emotes and custom emote spawning : Modded Builder Toggles Short Summary: Modders can now make builder toggles, which are those small icons top left of the inventory that are used for block swap, wire visibility, etc. Porting Notes: If you previously made builders toggles using your own approach, use the tModLoader approach. : Better Changelogs Short Summary: Expand ChangeLog functionality Porting Notes: tModLoader no longer adds it's own text when a changelog.txt is provided. We recommend adding to your own changelog.txt files based on All 4 fields in the example, such as , are replaced with the info from tModLoader during publishing for convenience. : Rubblemaker support Short Summary: Modders can now add tiles to the Other v2023.08 Changes v2023.X (1.4.4) The tModLoader team took advantage of the release of Terraria 1.4.4.9 to implement a wide variety of breaking changes. These changes are large features that have been highly requested from the community. The extent of the changes, as well as changes in Terraria, are so large that all mods will need to update to continue working on 1.4.4. tModLoader for 1.4.3 will continue to be available to users as the steam beta option. If a modder intends to continue updating their mod for 1.4.3 users, they should use backups or to maintain copies of their source code for 1.4.3 and 1.4.4. This migration guide assumes the mod has already been migrated to 1.4.3. If that is not the case, do that first. The first step in migrating to 1.4.4 is following the section below. Once that is done, switch to the branch on steam by following the . Launch tModLoader, make sure it says and in the corner. Next, visit the Workshop Develop Mods menu in game and click on the \"Run tModPorter\" button. After that completed, you are ready to open Visual Studio and begin working on updating parts of the code that tModPorter either couldn't port or left a comment with instructions (to find all comments, first, go to Tools Options Environment Task List, and add as a custom token. Then close it, and opening View Task List will list all comments, where you can also use the search bar to filter specific comments). As 1.4.4 continues to update, you might need to \"Run tModPorter\" again if an update breaks something. Localization Changes The largest change to tModLoader is that localization is now done fully in the localization files. You MUST follow the instructions. Failure to do this step will make porting a mod extremely tedious. More details can be found in . New Vanilla Features Terraria 1.4.4 has many new features and changes. The details these changes. Modders should be aware of the changes in case they would impact the balance or functionality of their mods. For example, can now have 20 buffs and can now have 44 buffs by default. Of specific note is the Shimmer, modders should consider how content in their mod would interact with the Shimmer. contains examples of various shimmer features, such as transforming NPC, decrafting examples, and transforming items. Other Vanilla Changes now requires an additional texture, . See for details. is only called if is . This applies in mod accessory slots too now. Reforging is now implemented via . This sets to 0 and then refreshes the item. Make sure any custom fields set by custom prefixes are not serialized independently. Renamed or Moved Members All of the changes in this section will be handled by tModPorter and are listed here for completeness. Modders can skip this section and go directly to to see the changes that require the modder to make big changes to their mod. Namespaces / Classes Static Methods Static Fields / Constants / Properties and possibly and Removed, use , or The following all change from to : , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , , Non Static Methods Removed, use either (if ) or (for armor slots) Non Static Fields / Constants / Properties Misc changes tModLoader changes The following contains smaller scale changes to tModLoader members. More elaborate changes are handled in separate categories below. removed, use instead removed, use instead removed, use instead , parameters changed. ( is different, see the docs for details) , parameters changed. ( is different, see the docs for details) parameters changed, copy the implementation of in vanilla if you to count money, and be sure to set a flag when unlocked, so you don't count every tick Use or add a method hook to Use or add a method hook to parameters changed parameters changed Renamed to and replace usages with parameters changed parameters changed parameters changed parameters changed removed, use instead removed, use instead life and shield current and max values are now separate to allow for hp/shield number text draw See Player/NPC damage hooks rework section below See Player/NPC damage hooks rework section below See Player/NPC damage hooks rework section below See Player/NPC damage hooks rework section below in , use if you previously had this method return true in , use if you previously had this method return true Nothing to override anymore. Use hjson files and/or override DisplayName to adjust localization Use . New hook is called at slightly different times, so read the documentation parameters changed removed, use or to check whether an item is reforgeable removed, use , or removed, use . See below. removed, use . See below. removed, use instead. See below. suggestion: Set displayColor to InactiveInfoTextColor if your display value is \"zero\" or shows no valuable information and These methods changed drastically. See for more information. Now use , if needed. See for more information. Now use , if needed. See for more information. Removed, override instead , parameters changed , parameters changed , parameters changed Parameters changed Parameters changed. is now , use to adjust to the change. See docs for how to use hook with an item type. . Shops have drastically changed, see for more information. Parameters changed Parameters changed. Shops have drastically changed, see for more information. Parameters changed. Shops have drastically changed, see for more information. Parameters changed. Shops have drastically changed, see for more information. , see ExamplePylonTile for an example. To register to specific NPC shops, use the new shop system directly in ModNPC.AddShop, GlobalNPC.ModifyShop or ModSystem.PostAddRecipes return type changed from to , no longer used to prevent reforging. Use for that purpose. removed, use instead. Note that the method will no longer mistakenly attempt to consume custom currencies. added. Some modders might want to move prefix specific tooltip lines from to it for better code maintainability. localization entries relocated to . See the porting notes in for more information. removed. See the porting notes in for more information on how to adapt to this change. and parameters changed Big change concepts Localization Changes Details contains the proposed changes. contains the actual changes, as well as ExampleMod changes. contains additional changes specific to . explains localization and porting instructions for modders. contains instructions for translators and translation mod makers. Short Summary : Translations are now fully in localization files (.hjson files). and , for example, can no longer be assigned in code. is now fully localizable by default. (See for more information) Localization files are automatically updated with entries for new content and managed by tModLoader. More organization options available. New content will appear in localization files after loading. Edits to .hjson files will be detected by tModLoader and loaded into the game as soon as they are saved, allowing modders and translators to quickly test and update translations. All usages are now replaced with All translation keys now follow a more predictable pattern: Contributing translations, directly or through translation mods, has been streamlined. Porting Notes : Modders MUST follow the Migrating from 1.4.3 to 1.4.4 section in the prior to attempting to update a mod on tModLoader. Modders with hardcoded values in localization files, such as \"10% increased melee damage\", \"5 armor penetration\", etc should consider updating their code to have less duplication by following the section on the wiki. showcases our recommended approach for writing clean and maintainable item tooltips. In the example, all the numbers denoting the effects of the accessory only exist in code, not in both code and translation files. Most notably with this new approach, there is no risk of the tooltip and actual behavior being out of sync. Previously a modder could update an accessory but forget to update the tooltip, or forget to update tooltips for other languages, resulting in items that behave differently than how they claim to behave. , , and further build on this idea. In these examples, the actual damage absorption stat, (set to 30), only exists in . references that value for the buff tooltip via . also references the value in it's own tooltip. also references that value in and via the property. If the modder wished to change this accessory to absorb 35% of damage instead of 30% of damage, the modder would only need to change the value in 1 place, rather than several places in multiple and files. This shows the power of properly using localization files and binding values to them. is now localized by default, see the porting notes section of for porting information specific to . Player/NPC damage hooks rework. Hit/HurtModifiers and Hit/HurtInfo , , and drastically changes how player and npc hit hooks are structured. Short Summary: Player and NPC hit hooks ( , , , etc) have been simplified with common architecture, and had many new features added. The goal of this change is to improve mod compatibility by making the damage calculations an explicit equation, where mods contribute modifiers, and tModLoader calculates the result. Many examples of how to make hit/hurt modifying accessories and weapon effects have been added, demonstrating the new system. /ExampleDamageModificationPlayer: example, similar to : Multiplicative defense debuff, similar to Broken Armor /AbsorbTeamDamageBuff/ExampleDamageModificationPlayer: Damage absorption example, similar to Paladins Shield item. : Extensive examples of new and hooks. Disable damage variation, modify knockback, modify crit bonus damage, flat armor penetration, percentage armor penetration, etc examples. and ExampleWhipAdvancedDebuff: Show proper tag damage, both flat and scaling varieties. : Shows an NPC that is \"resistant\" to a specific damage class, taking less damage : Shows ModifyDamageScaling replacement, as well as proper usage of various fields and properties to scale damage and knockback dynamically. : Shows a projectile dealing bonus damage to an npc that is weak to it. tModPorter will be able to convert the hook signatures, but you will need to read the Porting Notes (in particular the FAQ), to figure out how to convert old damage modification code into the new system. Porting Notes: Too many to write here, please read the PR descriptions if you have questions after running tModPorter. Shop Changes (aka Declarative Shops) has changed how NPC shops are done. Short Summary: NPC shops are now declarative, meaning they get registered, and items can be added to them with conditions, similarly to NPC drops (loot) and recipes Adding items to shops, or hiding items from shops is now as easy as adding or disabling recipes Info mods can traverse the NPCShopDatabase to show how to obtain an item. All the conditions for items appearing in shops have been localized. Registering multiple shops per NPC is perfectly fine, and selecting the shop to be opened when chatting can now be done via the ref string shop parameter in OnChatButtonClicked Porting Notes: has been replaced by . Please see the documentation and is now . This hook still exists to allow for custom shop modification, but you should consider moving to the new and hooks The in will now contain null entries. This distinguishes slots which have not been filled, from slots which are intentionally left empty (as in the case of DD2 Bartender) Please take a look at the changes to Example Mod in the PR to more easily understand the new system. Tile Drop Changes has changed how tiles drop items. Short Summary: Tiles and walls now automatically drop the items that place it. This process supports tiles with multiple styles. Block Swap feature now supports modded torches, chests, and drawers. Other miscellaneous fixes. Porting Notes: The vast majority of code and code can be deleted or simplified by following the porting notes. All mods with any must follow the porting notes, failure to adjust your code for this major change will result in duplicate drops. There are too many changes to write here. Please read the Porting Notes section in the after running tModPorter. Improve Player.clientClone performance has added new approaches to to improve performance. Short Summary: can become very performance expensive with many mods. Only type, stack and prefix are required to tell if an item has changed in the inventory and needs to be re synced. This PR replaces usages of in with . Additionally, a single Player (and ) instance is reused for all / calls, acting as a 'storage copy' rather than making a new one each frame. Please note that tModPorter is not smart enough to identify usages in calls automatically. You will need to replace these yourself or an exception will be thrown at runtime. Porting Notes: Use instead of in Use instead of in Item instances altered by are not initialized! Do not attempt to read properties or retrieve or instances from them! The only valid operation on an which was updated with is , , and briefly show usage of to trigger an item to sync. Max Health and Mana Manipulation API greatly changed the API for modifying the player's max health and mana, rendering custom sprites over the player's hearts and mana stars and even added an API for creating custom display sets. Short Summary: Adds with arguments for permanent adjustments to max health/mana While this hook is intended to be used for permanent stat adjustments, it can also easily support temporary adjustments as well However, do note that this hook runs very early in the player update logic. It runs shortly after Temporary adjustments that rely on buffs or other player variables affected by armor, accessories, etc. should still use the old method of modifying in one of the update hooks in Adds , and properties These properties are directly tied to the vanilla stat increases and can also be manually set by modders Adds helper methods and for displaying the visual effects Adds allowing for custom life/mana draw styles (similar to boss bar styles) that can be selected in settings Adds to allow for drawing custom hearts/mana/effects over the vanilla (or modded) life/mana UI elements ExampleMod contains examples for a and . , and showcase how to handle permanent stat increases. Porting Notes: Refer to , and on how to properly set permanent stat increases Temporary stat increases to and can still be performed as usual Though they should not be changed in , since that runs too early for the changes to be kept Use , and instead of checking or due to the stat fields being adjustable by mods Smaller Changes : Fix Quick Heal and Quick Mana consuming non consumables Short Summary: Adds as a check in Quick Heal and Quick Mana. Porting Notes: For Quick heal, Quick Mana non consummables, it is recommended to use field instead of overriding : Add ModSystem.ClearWorld Short Summary: Adds ModSystem.ClearWorld which runs on world clear. The new best place to clear/initialize world related data structures. Porting Notes: Consider replacing overrides of with to reset world related data. Generally no need to override anymore. Use Unload if you want to fully clean up all memory, but empty lists are nothing to worry about. : Unify Localized Conditions Short Summary: has been moved to and can now be applied to more things. Recipes, item variants, drops and shops. Added class to help make drop conditions more easily. Porting Notes: (tModPorter). parameter removed from condition delegate, since it was almost always unused. Custom conditions will have to change from or to : Change HookGen Namespace Style Short Summary: Hookgen namespaces ( and ) have been removed in favor of and prepended to the type name. No longer will you get 3 different namespace suggestions when you use VS to import a Terraria type name. Want On Item hooks? Just use it's in the same namespace as ! Porting Notes: As usual, tModPorter can convert your old code automatically. : Default Research Unlock Value changed to 1 Short Summary: All items will now default to needing 1 item to research. The previous value of 0 left items unresearchable since many modders don't bother to implement journey mode features Modders can clean up their code: has been removed and tModPorter should have changed it to already. lines can be changed to s with or lines can be deleted, since the default is 1. Porting Notes: This is almost entirely optional. The only thing is s that should never exist in the inventory, or should otherwise not be researchable, now need added where previously, they would be unsearchable by default. (Note: will result in bugs, use ) Modders might consider using this opportunity to add research values matching vanilla values to their : ."},{"path":"螺线翻译tml教程/杂项/Update-Migration-Guide-Previous-Versions 更新迁移指引 先前版本.md","filename":"Update-Migration-Guide-Previous-Versions 更新迁移指引 先前版本.md","title":"Update-Migration-Guide-Previous-Versions 更新迁移指引 先前版本","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This page contains guides for migrating code to new methods and functionality of newer tModLoader versions. When a tModLoader update requires rewriting code, we will present the information here. This guide covers outdated migrations for versions 0.10, 0.11, and v2022.X (1.4.3). For migration information for current versions, see Table of contents v2022.X (1.4.3) v2022.X updates tModLoader to Terraria 1.4.3.6. This update changed everything. Before starting, you'll need to install the . Next, you need to copy your mod sources into the folder. Next, visit the Workshop Develop Mods menu in game and click on the \"upgrade .csproj\" button. After that, click on the \"Run tModPorter\" button. After that completed, you are ready to open Visual Studio and begin working on updating parts of the code that tModPorter either couldn't port or left a comment with instructions (to find all comments, first, go to Tools Options Environment Task List, and add as a custom token. Then close it, and opening View Task List will list all comments, where you can also use the search bar to filter specific comments). You can \"Run tModPorter\" multiple times after big tModLoader updates, it is updated regularly and handles inter 1.4 changes too. Here are the most relevant changes. Renamed or Moved Members Namespaces / Classes Static Methods , (This affects the constructor) (and do note the changed namespace of ) unchanged, but now you need a check whenever you use it (if it's not a client only context), otherwise it will crash in the namespace completely removed Static Fields / Constants / Properties has renamed fields ( (1), (2), (3), (4), (5)) and alot more use styles to choose from Regex: Regex for items: and similar environmental flags are now in and slightly renamed, e.g. and similar surrounding tile counts are now in and slightly renamed, e.g. (Accessible via ) Regex for replacing ModTranslation.AddTranslation uses: Non Static Methods ( class contains various static instances of it to use for the last parameter) with the return representing previous removed, use directly (only the override, invocation is through still, though with the new parameters) Non Static Fields / Constants / Properties is now static are now static (changed from string to automatically assigned auto incrementing int) to (Many changes to related methods aswell) to (Many changes to related methods aswell) to (Many changes to related methods aswell) and other jumps etc. . Player.dash is used for something else now. and similar accessory flags that spawn projectiles etc. To check if they are enabled: ; To enable them: assign your own accessory to it. (Changed by vanilla due to the bestiary). Getting the value of was not changed, only setting it was. (Changed by vanilla due to the new inventory access projectiles). Setting it is now done using the method on the respective tracker. for 1.3 1.4 only, as AddStructure still exists but serves a different purpose. Misc changes Shaders registered as now require as a parameter Armor shaders now require the , and parameters tModLoader changes The following contains smaller scale changes to tModLoader members. More elaborate changes (i.e. things surrounding IEntitySource) are handled in separate categories below All ModX things listed here apply to GlobalX aswell All lowercase properties are now capitalized (e.g. , , and , , ) (With some additions from . have been changed to accommodate for the world context: . If you are porting directly to 1.4.4, ) (requires ) Many methods were moved from to : hooks were moved to and split, with slightly different names: removed, use removed, use with Mod as the first parameter removed, use with Mod as the first parameter removed, use with Mod as the first parameter, cast to if necessary removed, modded sounds are not categorized anymore removed without the parameter removed/deprecated , similar for other assets like Regex: , similar for other assets like Regex: (Second parameter of has to be ) (Second parameter of has to be ) now throws if the mod is not loaded, use now returns which is the head texture slot. removed removed, ise in ( ) return type changed from to , concider returning instead of , , and , so use instead of (using the same parameters (except the last one is float int, which should stay at 0)). and , this means you should use the new parameter instead of so things draw correctly in the bestiary. (Drops will now have to be added in , see the section) removed, spawn the treasure bag alongside other loot via Changed from to (typo) return type changed from to , concider returning instead of now use to specify these qualities of an equip texture. Removed. Porting: and (in ) , the UpdateVanity hook still exists, just for a different purpose removed/deprecated , returns an . Use ModifyStartingInventory for modifying if needed removed/deprecated removed/deprecated removed/integrated into ( variant is instead of ) ( requires ) , also concider , also concider , also concider removed with inverted logic removed (only for initial 1.3 porting, the UpdateVanity hook still exist albeit for a different purpose) now returns , this means you should be assigning your data to the passed in tag. Big change concepts Assets Every asset ( , , , etc.) is now wrapped inside an . You'll need to use to access the actual asset. For example, instead of , you would write (The method is ). You could also technically do , which, depending on your style, might be easier to look at. It does the exact same thing as , which is load the texture. In addition to that, tModLoader by default loads textures asynchronously. This means that upon requesting an asset for the first time, the associated value might not be assigned yet. This is usually not a problem (for textures, tModLoader supplies a dummy texture until the real asset is loaded), but it can be for UI things that need texture dimensions on construction (such as ). Then, specify as the second parameter in . Texture/Asset paths are now also slightly changed, so any use of something like this: , will have to be changed to this: Finally, when summoning vanilla textures, make sure to call the right variant of before using it in cases such as to avoid null errors. Gores ( ) are now autoloaded from any folder that contains \"Gores\" in the path (instead of having to be in the \"Gores\" folder in the mod root folder). Sounds Sounds are now greatly simplified, there is only one way to play a sound, and one object to represent a sound. See the updated guide for more info. The section in particular will teach you what to change. To migrate existing code, use , fields, and as taught in the guide. For more info and a few examples, see the corresponding . Recipes Recipes were totally reworked (don't panic, read below). Instead of creating a (now just ), and calling methods on that, recipes can now use fluent api syntax. If you don't know what that is, here's an example of what it looked like before: This has been replaced with: You can even use an expression for this: There is a more detailed explanation of how to do this in . Keep in mind that chaining methods is optional, you can still use the old pattern. RecipeFinder and RecipeEditor The two classes were removed. Now just use any hook (such as in ) and manually iterate over to find and edit what you need. To delete a recipe, call on it. Custom ModRecipe class/extension As ModRecipe is gone, and Recipe is sealed, you cannot extend from it anymore. Any 1.3 patters that utilized custom classes and its methods will need to use the new methods. Porting notes for methods (delegates are interchangeable with passing in a method directly): : write your code as a method for : : write your code as a method for : : write your code as a method for (You find more about it in ExampleRecipes, aswell as how to use vanilla conditions): Mod.XType, Content Fetching String based mod content fetching (such as or ) have been replaced and unified under (rarely is ). Instead of returning 0 if said content is not found, it will now throw an exception, encouraging use of the compile time safe generic methods (which still exist, such as ), or if using the generic method is not possible (such as cross mod), (and then using if the method returned ). The same methods also exist in , the string parameter then expects the format \"ModName/XName\" (which is by the way what would return). IMPORTANT: Do NOT replace/remove the part! Other methods unified to the new approach: with (Important to note: this will error if called serverside, as is now a clientside type, so check for ) (Also important: Find/TryFind will now not require the in anymore) Examples: Damage Classes , etc. are replaced by tModLoaders own implementation, which utilizes for consolidated access to base/additive/multiplicative/flat bonuses. This means turns into , and turns into . You can also make your own custom classes through this system. For more information, visit , and its items and projectiles in general. Minion and sentry projectiles will have to have (in case of minions, in addition to ). With the inclusion of throwing damage, thrown weapons/damage class bonuses will go from to for example . Accessories giving damage bonuses are changed from to . Flat increases are done via for increased damage after applied multipliers, or for before. Use to get the effective stat modifier for the damage class (including inheritance, like ) Other porting changes: (when using += on it) (when using = on it) Type change to While normally removed in 1.4, it is reimplemented by tML through Damage Classes (detailed further below). Same as XItem.Shoot has been split into three methods: , , and . Now allowing shooting and changing shooting related parameters is separated from creation of the projectiles. simply controls if the item can shoot projectiles or not. contains all the parameters as , while doesn't. The parameters have also been combined into . If you misuse for i.e. changing damage but not actually spawning any projectiles manually, then returning true, you need to switch (or move that code) to . Small overview of the changes: (for allowing or preventing spawning in projectiles) (for changing shooting related parameters) (for spawning projectiles and controlling if the default projectile spawns) Player Drawing Modders previously using and will now have to adapt to the replacements: , , and . Instead of instantiating custom objects, and then adding them to a list of existing layers by using an index in the list, you can now use the self contained class (use it just like any other class), which specifies it's draw order using the override by returning objects that define an unconditional order/hierarchy ( , , ( usually being a vanilla layer found in the class). The hooks are not used for inserting anymore. To hide layers (previously done by setting Visible to false), you call the method on them, which will also hide any children appended to this layer. Small overview of the (equivalent) changes: (for creating your layers) (for referencing vanilla layers) Accessing all layers is done through (not ordered by draw order!) instead of the param in ( only for hiding (see the above to access all layers if you need to)) ( only for changing the ordering) Porting mostly entails moving your insertion code from to (must be unconditional, if you need to change the order based on a condition, use the new hook), moving your immediate draw conditions into the hook, the actual draw code into , and adding the created to . See the example in ExampleMod for an implementation. Tiles The type is no longer a by reference , but a that acts as a key to data that is stored elsewhere, actually taking in mind the way computers' processors and memory planks work. Usage of the type for users remains somewhat similar. Memory usage has been heavily reduced. In the case of a Large world, 242/484 less megabytes of data will be used in 32 bit and 64 bit contexts accordingly. Performance has been increased up to 30% in some cases. For the good of future developments, is now a 6 bit integer, with a [0, 64] range. is no longer nullable. All checks are useless and will always return false. will result in a key that points to the [0,0] tile, NOT a null like value. If you need nullability use , (C short hand for Nullable .) You can add custom tile data by declaring a struct that implements the marker interface. It will also be copied and removed alongside vanilla data. However, it is not automatically saved or synchronized. Tile data structures must be , that is, they can only contain value data. Tile data can be accessed & modified via the method or via . Most of the tile get/set methods are now internal, replaced by properties for consistency and ease of use. tModPorter will handle all of them. Except . This method is only used by vanilla for network compression, and probably doesn't do what you want. You should compare the fields you care about directly. If you're doing something like schematics, take a look at s type is changed from to . ModBiome and ModSceneEffect now does the handling of choosing scene effects instead of separate hooks, so that tML can give proper attention to designated priorities. Notably, it has an return method, and a property associated to it. It should be derived directly when adding scene effects that were controlled by any of the following hooks, with the exemption of s that derive this class already such as . Multiple small, derived classes may be required to accomplish the same functionality. This change does not affect existing ModNPC music implementations at the time of writing. The following changes have been made with respect to Hooks, with possibly multiple classes being required to fully replace the Hook (If not otherwise specified, also counts as , as the latter inherits from the former): , aswell as Likewise, with the introduction of , the and hooks have been integrated in to the class. Hook Changes : Now accepts an actual multiplier instead of divisor. Invert your values by dividing 1.0 by them. : Replaced with and . Use the former if you want to increase value (risking increasing the amount of uses/shots), use the latter if you just want to safely speed up the item/weapon while keeping the ratio between and the same. . Now all s have such a method. Ammo changes: changed to , with caveats. Read more on this without the parameter removed/deprecated Proper variable names + additional context for (clarify usage to specify and , and add each one missing as context) , now only invoked on the weapon. New hook for ammo: . : now only invoked on the weapon. New hook for ammo: . New hooks for ammo selection : and : Now has additional context and is no longer used to modify the item the caught NPC is turned into. to modify the caught NPC's item, use and check if the source . Autoload Autoloading and type structure of classes within tML have changed. Classes implementing are now autoloaded. The most notable implementation is the class, which is used for all ModX and GlobalX classes, unifying various behavior. Previous hooks have been replaced with and the attribute: allows for simple \"can be loaded or not\" behavior (i.e. config) attribute for classes, which can be supplied with (allowing you to choose to manually add and control content using elsewhere), and (allowing creation of side specific content, i.e. , which is clientside) , and other similar methods , with the name now being specified through the property on the and are removed. Assign directly //TODO more detailed porting notes for parameters in old Autoload hook, and how to add content manually now tModLoader .NET Upgrade {Some info on .NET5 and AnyCPU targetting} .NET 5 Install and Visual Studio Setup {} .NET 5 Tutorial Links {} Terraria 1.4+ vanilla changes {1.4 includes several back end changes that we should point out} IEntitySource Various entity creating methods ( , , , (tML only), ) have received a new parameter denoting its source, read more about it . Equip Textures and Armor Sheets The Sprite Styling has changed for some aspects of the armor namely (the latter affecting the 1.3 Arm and FemaleBody textures too). Tools and guides on migrating to the new armor texture format can be found in . Minion spawning Summon damage (minions, sentries, and minion/sentry shot projectiles) now scales dynamically instead of fixed on spawn. Modders now have to manually assign to the base damage (usually ) AFTER it is created (NOT in , in the item that spawns it is a suitable place). Here are the two most common approaches: Bestiary Each mod gets its own filter for the bestiary, by default a \"?\" icon. You can change it by providing a 30x30 in your root folder. To add drops to NPCs, you now have to use the (and ) hooks (instead of the 1.3 analog of , , which is for non loot e.g. marking a boss as defeated, spawning ores or projectiles)). Read more about it . You can customize the bestiary entries using the hook, and the appearance of the NPC in the preview and full image by adding your data to . //TODO bestiary integration with custom preview images, animation, drop rules etc. NPC Buff Immunities The old approach to setting buff immunities on NPCs does not work anymore (Reminder: in : ). The new approach moves it to and is using new syntax. Example: If you want to give your NPC immunities to all debuffs (like The Destroyer), use this: Wings Wing data is now assigned through an set on load ( ) like follows: (Check other constructors for more fine tuning). Only assign or use if you need to dynamically adjust those. Failure to add the former code will result in the player not moving horizontally while flying. Misc Flagging a boss as defeated will not have to be manually synced anymore ( will be sent after the hook), and it will also trigger a lantern night if you use this method: v0.11.7.5 Reflection As always, your reflection might have broken, so double check that. In particular, the fields in the class, see v0.11.7 (Steam Release) It is required to have a fresh Terraria v1.4 installation. tModLoader from now on must not be installed into the Terraria folder, but in a separate folder in case of manual installation. No additional changes to mods should be required. v0.11.5 v0.11.5 introduced , a faster and simpler way to access IDs and instances of modded classes. Do I need to Update No, all mods should still work, but if you wish to publish on v0.11.5, you will have to update. Mod.XType If you previously used the generic methods, you'll need to change. and are now simply , provided you write at the top of each .cs file. If you don't, it will be . You'll need to keep the approach for method calls located in your class because there will be a namespace conflict otherwise. If you are still using the string versions, you do not need to update, but the new approach is faster, and the generic approach is less error prone. Regex Auto Fix You can migrate your whole mod easily with the following Find and Replace command in Visual Studio. Make sure is enabled. Find: Replace: Example: If you'd prefer the approach, do the following Find and Replace commands instead. These also require that is enabled. You'll need to fix the calls in your Mod class to use manually: Find: Replace: Find: Replace: Mod.GetModX and Instance fields Similar to above, generic methods such as are now no longer invoked from an instance of the class. Replace with , provided you write at the top of each .cs file. If you don't, it will be . Also, static instance variables are no longer recommended. Remove things like and simply call instead. Another example: . Player.GetModPlayer (Mod) Syntax such as is now obsolete, use aka remove the mod instance from the backets, like this: . ModTile.RightClick is now . returns a bool indicating if an interaction has occurred, preventing weapon usage. To migrate, replace with and add if an interaction has occurred. Iterating over Buffs v0.11.5 adds . If you previously iterated over buffs using , you'll want to update the code to . Reflection As always, your reflection might have broken, so double check that. Many internal classes and fields have changed namespaces and identifiers. For example, here are the changes needed for reflection into the load mods progress bar. v0.11 v0.11 introduced many changes. Here is the . v0.10 Here is the"},{"path":"螺线翻译tml教程/杂项/Visual-Studio-Snippets VisualStudio代码片段.md","filename":"Visual-Studio-Snippets VisualStudio代码片段.md","title":"Visual-Studio-Snippets VisualStudio代码片段","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"When you've figured out the basics of modding, it can be annoying to constantly go to ExampleMod just to copy code that you're too lazy to manually write (believe me, I used to do this all the time). Fortunately, Visual Studio supports the use of custom snippets, which allow you to paste premade code with a few key presses. First VS Snippet To create your first snippet, create a file with the extension. Open the file in any text editor and paste this: If you've never worked with HTML or XML this might look intimidating, so here's a simplified breakdown of all the important bits: Everything in the tag is the snippet's information, which is displayed in the Snippet Manager. For now, title the snippet however you want. The actual code that this snippet will provide should go in the tag, inside the bracket pair. In short: . You can format the code however you want, but Visual Studio's C language features will automatically format it when the snippet is used. The tag is where you put your parameters. These are the parts of the snippet that you are able to customise when you use it (more on this later). Snippet Parameters Parameters are a great way to add flexibility to your snippets, allowing you to customise the boilerplate code that the snippet provides. Parameters can be used in place of variable names, function parameters, and other areas of your code wherein you want to include customisability. For example, you could add a parameter in place of a class name to allow the user to use his / her own. To create a parameter, in place of a value of your choice, add any name, and surround the name with characters (example: → ). Here's one of the parameters in the Mod Item snippet that I use. Notice how the content of the string is removed and replaced with a : Now that you set up your , you need to give it some properties. Remember the tag in your snippet's code? Within it, write code as shown here The tag defines a new replaceable value The is what's within the in the code The is a helpful bit of information about the value. While not required, it is recommended The tag defines the default value of this parameter. This is just what's shown when the snippet is first used Here's how the declaration looks for the tooltip parameter of my snippet: And here's how the parameter will look when the snippet is used. Importing your snippet Once you've finished writing the code for your snippet, save the file and open Visual Studio (if it isn't already open). Press followed by to open up the snippet Manager; this is where you can manage snippets added by Visual Studio or yourself. Select in the Language dropdown, click the Import button, and select your file. You'll see a new window, wherein you're asked where you want to import your snippet file. You should see a folder named on the right; select that. Now that your snippet is in Visual Studio, you're ready to use it. Press followed by , click , and select your snippet. The code that you put in the part of your snippet file should appear, and if it does, congratulations! You've completed your first Visual Studio snippet. You can repeat this process for all of your boilerplate code needs. Here's a demonstration of snippets using my example |"},{"path":"螺线翻译tml教程/杂项/tModCodeAssist tMod代码分析器.md","filename":"tModCodeAssist tMod代码分析器.md","title":"tModCodeAssist tMod代码分析器","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is tModCodeAssist? is a that provides code fixes for mod projects. It is included in tModLoader and is automatically enabled. To take advantage of , make sure your is properly configured according to our guides. The purpose of is to help modders create readable code. For example, when following the , a modder might end up with in their source code. The number corresponds to a specific dust, but it is impossible to know which dust just from the number alone. Rather than look up the number in , will suggest a code fix that will automatically change to and the modder can choose to apply it to their code. Another purpose is to prevent modders from mixing up IDs. For example, new modders frequently mix up and when making a Recipe for their items, leading to the mod not working for no discernable reason. detects these misused ID values and reports an error to the modder. All of these issues will be reported in the tab in your IDE: Applying Code Fixes To use the code fix suggestions, simply hover over the green underlined code and click \"Show potential fixes\" and then the appropriate suggestion. (Or, place the cursor, type the hotkey, then click the appropriate suggestion) This works in the exact same manner as the . Show potential fixes: Change magic number: In the above example, was changed to . You can still hover over to see that it has the value of . Applying Code Fixes to whole File or Project Clicking the \"Fix all occurrences in: Project\" option is a great choice for applying these code fixes to the whole mod all at once. Diagnostics Below are the current diagnostics and code fixes provided by tModCodeAssist. You can easily navigate to these entries by clicking the hyperlink in the Code column of the Error List panel in your IDE: ChangeMagicNumberToID Severity: ⚠️ Warning This diagnostic will warn of ) and suggest changing them to their appropriate value from their corresponding ID class. For example, will be changed to . Since modders deal with decompiled Terraria, we usually end up with raw numbers when . This diagnostic and code fix will restore the original meaning of those values for the modder and leave the code much more readable. . BadIDType Severity: ⛔ Error This diagnostic will error if an incorrect ID class is used in a place where another ID class is expected. For example, will error because the modder has mistakenly used an value for a method that expects a . Since ID values are just numbers, without the error this code would result in the Presents tile being the crafting station instead of the Workbenches tile because has a value of 36 and that is the same as . To fix this issue, change the ID class and let help you find the correct entry. If you can't find the entry in the correct ID class, consulting the might help. There are several ID class entries that don't match the English name, so you might need to look them up. Also note that tiles can have multiple styles in the same TileID, such as how corresponds to both the Mythril Anvil and the Orichalcum Anvil. . CommonCollisionName Severity: ⛔ Error This diagnostic will error if a namespace or classname matches one of several frequently used Terraria classes. For example, attempting to make a namespace named will error. The reserved names currently include: \"Main\", \"Mod\", \"Player\", \"Item\", \"NPC\", \"Projectile\", \"Gore\", \"Dust\", \"Entity\", \"Liquid\", \"Mount\", \"Tile\", \"Recipe\", \"ModPlayer\", \"ModItem\", \"ModNPC\", \"ModProjectile\", \"ModGore\", \"ModDust\", \"ModType\", \"ModMount\", \"ModTile\", and \"ModWall\". New modders frequently make an namespace, which in turn leads to situations where the compiler can't rectify the name collision and will throw errors with lines of code like . We recommend that modders name their namespaces with plural nouns, such as or to prevent namespace collisions with Terraria classes (which are usually singular nouns). . SimplifyUnifiedRandom Severity: ℹ️ Info This diagnostic suggests changing to . These are logically the same, but the approach is more expressive of code intent and helps avoid mistakes for new modders who might not understand what the original code was doing. . SimplifyLocalPlayer Severity: ℹ️ Info This diagnostic suggest changing to . These two are logically the same but is more expressive of code intent. . Configuring Code Fixes There are extremely rare situations where the code fixes suggestions might not be desired by the modder. Details The modder can configure the code fixes using their IDE. Code fixes can be suppressed to varying scopes using the options provided. Contributing New Features to tModCodeAssist We welcome community contributions that add new features to . Writing Code Analyzer code is quite different from writing \"normal\" C code and the process can be quite daunting, but there are simple templates modders can follow to easily add capabilities to the existing code fixes. Adding to the Analyzer This section will teach how to add to the code fix feature of . This means if some field or method parameter isn't currently being fixed to a ID class entry, we can add it and it will then work as expected. This guide assumes you already know how to and make pull requests. See the if that is not the case. We will be using as a guide for the rest of this section. Open up the \"Files Changed\" tab and follow along: 1. If the ID class you want to add support for is not included in yet, add it by manually editing the file in the manner shown in the example. 2. Add the \"binding\" to by following the example. A \"binding\" is simply a mapping between a field (or method parameter) and the ID class it should be using. If the ID class does not have a field, you'll need to provide the argument matching the of the fields in the ID class. Otherwise, you should not provide that argument. 3. Add new lines to existing tests in that demonstrate the new code fix. In this file you'll see 2 versions of a code snippet in each test. The first is the original code and the second is the code after the code fixes from this analyzer have been applied. Adding a single line to test your new binding is usually sufficient. Take note of the special syntax in the original code snippet indicating where the code fix should be applied. 4. Run the tests to ensure they work: Expand for instructions Right click on the project in the solution explorer and click . This will open the window. Verify that the tests all pass. You might want to deliberately sabotage the test as a sanity check to confirm that it fails as expected as well. 5. If ExampleMod has any missing ID values, we want to fix these and add them to our pull request. To do this, first build the project. This should result in ExampleMod seeing the updated file. You should now see the fix suggestion. 6. Make the pull request as normal. Adding completely new feature to tModCodeAssist For a completely new feature, you'll need to be more familiar with code analyzers to be successful. The official guide is a good place to get started learning. Compare what you learn in that tutorial to the code to get even more familiar with how it works. Another good resource is , on this website you can convert C code to the corresponding syntax tree representation. This will help you make sense of how the code is represented. Similarly, Visual Studio has a built in Syntax Visualizer accessed from . You can use it for the same purpose. If you have any further questions or want to discuss, come to the where development happens, we'd be happy to guide you."},{"path":"螺线翻译tml教程/杂项/tModLoader-Release-Cycle tModLoader发布循环.md","filename":"tModLoader-Release-Cycle tModLoader发布循环.md","title":"tModLoader-Release-Cycle tModLoader发布循环","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"tModLoader currently has releases mirroring Terraria 1.3, 1.4.3, and 1.4.4+ content. The version will not receive any major updates anymore The version will not receive any major updates anymore The 1.4.4+ versions are divided amongst three different locations: 1. Nightly 1.4.4+ GitHub actions for dev builds, 2. Preview GitHub Releases and related Steam Beta ( ) for Pre release builds of tModLoader, not intended for players, but useful for porting mods to upcoming releases 3. Stable GitHub releases and deployment to the default option in Steam. This is where vast majority of players, will play, and is designed around minimum interruption from tModLoader updates. 1.4.4+ 1.4.4+ tModLoader is in active development. This means that the code changes frequently and that backwards compatibility with earlier releases is not guaranteed. Regular users should stick to the 'Stable' (default) version of tModLoader. Release Cycle V2 (Current) At the start of each month, a new version of tModLoader arrives for Stable (default) players. This version is the is the culmination of one month's changes from development. The particular month is known by the YYYY.XX of the tModLoader Version Number In order to get that to Stable and all the users, it goes through three stages: 1) Month 1: (Version 2023.6 made in June 2023) consists of building changes in on the Dev Branch in Github 2) Month 2: (Version 2023.6, current month is July 2023) consists of a Pre Release / Staging build of tModLoader available for Modder Porting and release testing. This pre release build will rarely see updates as it is a 'Release Candidate', so any changes are intended to be non impacting to mods and players. It is available as GitHub Preview branch / Steam Beta ( ) 3) Month 3: Assuming everything is all good, we release the build that's on Preview to Stable, and thus make it available to all players as a stable experience. As a reminder: Please do not hassle modders to make their mods available on the Preview (Pre Release) versions of tModLoader. It is intended as an opportunity for them to get their mods ready for the next stable release on their own schedules, not tML or yours. Modder Instructions Modders should keep an eye on in the and look for breaking changes related to functionality in your mods. If there is something listed with Runtime Breakage related to your mod, you should join the branch and publish an update before the start of the next month so that your users can continue using your mod seamlessly. If related changes are only listed as Source code Breakage , there is no urgency and you will just need to follow the Porting Notes section after the changes are live. If you don't use Discord, the will also be updated with the same information. Release Cycle V1 Used during 1.4.3 era At the start of each month, a new version of tModLoader arrives for Stable (default) players. This version is the is the culmination of one month's changes from development. The particular month is known by the YYYY.XX of the tModLoader Version Number On the 21st of each month, we pause updating 1.4 Preview to give modders a chance to update their mods, ensuring that their mods will work when 1.4 Stable (default) updates on the 1st of the following month. The chart below should help visualize this process: Stable (default) The 1.4 Stable (default) version of tModLoader is updated at the start of each month. This is the default version that Steam users will receive. If you are using mods that are well maintained, you should not experience any issues, but be aware that each month there is a chance that mods you enjoyed previously might have been abandoned by the author. In this situation, you will have to either wait for those mods to update or disable them. Preview The Preview version of tModLoader is where recent changes to tModLoader are tested before reaching Stable (default). This version of tModLoader is where new features are tested, so things can break occasionally. Do not use this version of tModLoader for doing a normal playthrough. This version is intended for modders testing new features and players doing playtesting for those modders. Release Cycle V2 Freeze: At the end of a development month, we will bundle all the changes and deploy a new Preview version of tModLoader as a Release Candidate. It will be available in our staging environment via a Steam Beta 'Preview' option. It will be frozen from a breaking change perspective, and supported for bug fixes. It will, essentially, be available for a whole month as a Preview Freeze Period, just like V1. Release Cycle V1 Freeze: Each time we add or change something in tModLoader, the 1.4 Preview version of tModLoader will update. On the 21st of each month, the 1.4 Preview version of tModLoader will stop changing, a time known as the preview freeze period. During the freeze period, modders should update their mods and publish them if updates are needed in anticipation for the start of the next month. At the start of the next month, 1.4 Preview becomes the new 1.4 Stable (default) and all users will update. If curious what's upcoming, these will be brought into Preview. 1.4.3 Legacy 1.4.3 tModLoader is currently in maintenance mode as all of our efforts are focused on newer tModLoader. If Terraria updates, 1.4.3 tModLoader will be updated to account for new version checks and broken sprites to keep the game working, but no major efforts are being put into 1.4.3 tModLoader. 1.3 Legacy 1.3 tModLoader is currently in maintenance mode as all of our efforts are focused on newer tModLoader. If Terraria updates, 1.3 tModLoader will be updated to account for new version checks and broken sprites to keep the game working, but no major efforts are being put into 1.3 tModLoader."},{"path":"螺线翻译tml教程/杂项/tModLoader-Save-Data-Migration-Tracker tModLoader存档数据迁移.md","filename":"tModLoader-Save-Data-Migration-Tracker tModLoader存档数据迁移.md","title":"tModLoader-Save-Data-Migration-Tracker tModLoader存档数据迁移","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"In the beginning of 2020, there was two. Games/ModLoader (1.3) Games/ModLoader/Beta (1.4 dev) Each contained: Mod Sources Mod Config Mod Reader Mods Logs Players Worlds Config.json Achievements.dat input profiles.json And a lot of custom mod folders/files for their custom save data. We also had, in Steam Cloud, Steam/ModLoader Steam/ModLoader/Beta contained: Players Worlds Achievements.dat (PortOldSaveDirectories) At the onset of 1.4 Alpha release, we performed the following porting: Documents/ModLoader/Beta renamed to tModLoader in tModLoader folder, removed spaces from Mod Sources, Mod Reader, Mod Config folders to improve Linux compat We did not include any porting of steam cloud at this stage (New 1.4 era preview, dev folders) In addition, we added two folders that depend on the 1.4 alpha porting to successfully complete first. tModLoader preview tModLoader dev Both folders are created when launching tML with BuildPurpose.Preview and BuildPurpose.Dev respectfully. (PortCommonFiles) Further, on first launch, preview/dev copy the following files for the new environment: config.json input profiles.json (Port143FilesFromStable) Prior to launching tMod 1.4.4 era, we needed to preserve 1.4.3 player data. This requires step PortOldSaveDirectories to run first. The core goal is to safely backup everything but ModSources and temp publishing folder \"Workshop\". The backup will be added to a new folder, which will act same as ModLoader for 1.3 The new folder: Games/tModLoader 1.4.3 This move is the most complicated thus far, involving the following: 1) If the Games/tModLoader 1.4.3 folder does not exist, then copy over all files as designated if and only if the save data corresponds to 1.4.3 or earlier 2) Perform the same as 1) for Steam/tModLoader 1.4.3 Given that we actually are touching all users data, it is critical we include recovery logic in the event of a partial file move. As such, if the tModLoader 1.4.3 folder does exist, we still have to copy over all files from tModLoader that are newer than or don't exist in tMod 1.4.3 if and only if those files are for 1.4.3 or older. Finally, to avoid running this logic every time as it is expensive, we left a completion flag in the form of Ported143.txt to tell us tml completed fully previously. The tModLoader 1.4.3 was decided to share ModSources folder with tModLoader, like dev and preview, and unlike 1.3. (Maybe Port202306FilesFromPreview) At the onset of 1.4.4 release, we will need to either Migrate existing tModLoader preview data from preview to Or Establish functionality to scan all folders for data, and prompt the user to select which to use. Regardless, the tModLoader directory, if it exists at launch of 1.4.4 stable, can't be used until step Port143FilesFromStable has fully completed. The logic involved in migration replicates that of Port143 step, swapping the folders involved and version for 2023.06 instead of 2022.09 (More to be added)"},{"path":"螺线翻译tml教程/杂项/tModLoader-Style-Guide tModLoader代码风格指引.md","filename":"tModLoader-Style-Guide tModLoader代码风格指引.md","title":"tModLoader-Style-Guide tModLoader代码风格指引","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"The number one rule of collaborative development is pick a style and stick to it . The following style guidelines should apply to all future contributions to tModLoader. Please be mindful of past developers and don't reformat code just for the sake of it. Reformatting PRs will only be considered when there is an active need for change in the associated piece of code. The following are useful resources for general C design and style https://google.github.io/styleguide/csharp style.html https://docs.microsoft.com/en us/dotnet/standard/design guidelines/ https://github.com/ktaranov/naming convention/blob/master/C%23%20Coding%20Standards%20and%20Naming%20Conventions.md If something is not listed in this guide, use your best judgement to pick between matching existing code and the advice listed above. Identifier Names Use for local variables method parameters private fields Use for everything else. Why: With the exception of method parameters, camelCase indicates a variable that is not part of any public APIs. Use for 'backing fields' on properties. Private fields may also optionally be prefixed with an . Why: indicates the field is an implementation detail of specific members, and not key to the overall function of the class. Use properties instead of fields for classes (and structures that contain logic). Structures that do not contain logic and are only used as data should use fields. Why: API implementation details may change in the far future. Using properties and auto properties allows getters and setters to be altered or added without forcing a recompile of dependencies. The JIT is very efficient at inlining auto properties so there is little performance concern in Release mode. Because properties cannot be used with variables, simple data s should use fields instead. Terraria itself rarely uses properties. Microsoft guidelines recommend avoiding public fields entirely. Braces Use . Braces on the same line for statements, method and property declarations. New line for all other declarations. This is mostly enforced by .editorconfig Braces may be omitted on single line statements. For example: The following is forbidden Do not mix and match missing braces Exception : ExampleMod contributions; single line statements and method bodies should receive braces. Only properties (i.e. ) can be kept as defined above. Why: Balance between good visual separation and keeping code on screen when Terraria is full of small control flow statements. File Scoped Namespaces is a relatively new C language feature. As such, we will hold off on using it in learning resources until it's usage becomes more widespread. We use it in tModLoader, but do not use it in ExampleMod. Comments Short comments about a single line should go on the same line. Do not use block comments. Use multiple line comments instead Member Order Follow the general order: inner classes, static members, fields, properties, constructors, methods. Group fields and methods by function. Start with the largest/most used features and end with the smallest. Backing fields may be declared right before the corresponding properties. Supporting 'lookup fields' can go with the methods they serve. Method Length Keep methods short. When a method has multiple 'parts' consider splitting them into multiple smaller methods (and make them /pure if possible). Why: Good method names can take the place of comments which can rot over time. Method arguments and return values clearly show the flow of data between parts of a larger method. Smaller methods reduce the mental load for a reader, and reduce the programming errors by limiting the number of variables in scope. Control Flow Nesting Try to avoid more than 3 levels of control flow nesting within a method. Avoid having statements at the end of a long block. Handle errors early, fail fast, and rather than creating long chains. Why: Improved readability. Highly nested control flow is easy to get lost in. Guard statements make the method easier to read by eliminating errors and cases from the implementation further down. See https://en.wikipedia.org/wiki/Guard (computer science) Visual Newlines Use blank lines to break up long methods into logical blocks. Always put a blank line after any indented statement if the method continues. Do not put a space between every field or every line. Cast instead of using If the cast is meant to succeed, is more informative and will be thrown at a more useful line number than a corresponding from . For safe type checking, use pattern matching instead of with a check. ❌ Avoid Comment out vanilla code, rather than removing it Use and to comment multiple lines. They should each be on their own lines. When modifying a single line. Leave a commented version of the vanilla code only when it is not obvious what has been added by tML and what is vanilla. Also use a hashtag when multiple changes are part of the same fix/feature/refactor ❌ Unnecessary comment Keep Patches Small The source code of Terraria is not stored on git, instead tML changes are stored in .patch files in the patches/ directory. Keeping patches as small as possible makes handling Terraria updates and identifying the exact changes tML requires much easier. Use return/continue or goto to avoid changing indentation. Only when 5+ lines would be indented Wrap a method to insert a hook at the end of a method with multiple return statements Always check your patches when committing and see if there's a way to minimize them. Be Aware of Breaking Changes Some changes made to the tModLoader source code will cause issues for modders and players once they become part of an official release. For example, renaming a field used by mods will cause those mods to break when tModLoader updates. Because of this, we have various strategies for maintaining compatibility. Breaking changes come in 2 varieties, binary incompatibilities and source incompatibilities. When a change results in a binary incompatibility, mods built on an earlier version will either not load or not work properly. When a change results in a source incompatibility, the modder will have to change code the next time they build the mod, but the mod will continue to function otherwise. The lengths we go to preserve compatibility and maintain functionality depends on how stable the release should be. Usually, this depends on updates to the vanilla game. Breaking changes in tModLoader are much more likely while it is still catching up to a vanilla update. If there hasn't been a big Terraria update in a while, tModLoader will attempt to make previously built mods work properly when introducing new features or bug fixes. New Hook Adding a new hook is no issue. Adding a parameter to a hook If becomes , mods using the old approach will find that their mod is limited in functionality since the old method is no longer being called. To preserve compatibility, sometimes we keep the old method and mark it as Changing a return type Changing a return type causes incompatibilities. TODO, more info. Adding a parameter to a vanilla method We don't usually do this since it will break compatibility. Instead, we add a new overload and mark the current method as . See below. Adding an overload to a vanilla method When we add an overload to a vanilla method, this is usually because we need to add a new parameter to pass in additional context. If the intention is for all modders to use the new method, we mark the original method as and make the original method a forwarder with some default value for the new parameters. If there was previously only one overload for a method, we also need to make sure to mark the original method with to preserve MonoMod compatibility. (This is because the existing events have their parameters omitted from the event if they are the only overload, which will no longer be true.) The ](https://github.com/tModLoader/tModLoader/pull/4774/files) PR is an example of this, see how the original method has been changed. See the PR for information on this process. Examples This example shows a typical hook renaming situation. We want the mods built to continue working, but want to move mods being built to the new approach immediately The old hook is set as and the new hook is added with the new name. The PR makes sure to call the old hook to keep existing behavior. Note how is set as while is set as and flagged as a compile error. An method can call a compile error flagged method by design. is used as well. The code ports to the new method name using , applies changes to ExampleMod, and has tests to verify their effect. This example shows making several methods obsolete and replacing with a new combined method. This example showcases using tModPorter to both rename methods and change their signatures: and This example showcases using 's to change a hook signature. This example doesn't preserve compatibility, which is fine in this case because the usage of the hook is so rare."},{"path":"螺线翻译tml教程/杂项/zh‐Localization‐本地化.md","filename":"zh‐Localization‐本地化.md","title":"zh‐Localization‐本地化","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"此指南是为 1.4.4 版 tModLoader 而作。在 1.4.3 版本的 tModLoader 中，本地化文件不会自动更新，此指南中的一些方法也不存在。但基本概念是一样的。 目录 ) ) 什么是本地化? 本地化让使用各种语言的玩家都能畅玩模组。每一条游玩过程中可见的文本都被储存在一种叫做“本地化文件”的文本文件里。举个例子，ExampleMod 里有个物品叫做“纸飞机”，但在英语中叫“Paper Airplane”。通过本地化，无论是汉语还是英语的使用者都可以看懂，而不需要先去学一门语言。 这些本地化文件很容易制作，使得不懂编程的人也能翻译模组。然后作者便可以将这些翻译加入模组中，允许更多人游玩。（译注：而无需加载翻译补丁） 即使你只想支持一种语言，你也需要使用本地化文件 此指南将涵盖模组作者需要知道的本地化专题教程。如果你想要翻译一个已有的模组，或者是翻译tModLoader本身，请参阅 。 语言支持 tModLoader 目前支持下列文字： | 语言 | 缩写 | 文件名 | | :|: | | | 英文 | en US | en US.hjson | | 德文 | de DE | de DE.hjson | | 意大利文 | it IT | it IT.hjson | | 法文 | fr FR | fr FR.hjson | | 简体中文 | zh Hans | zh Hans.hjson | | 西班牙文 | es ES | es ES.hjson | | 俄文 | ru RU | ru RU.hjson | | 巴西葡萄牙文 | pt BR | pt BR.hjson | | 波兰文 | pl PL | pl PL.hjson | 从1.4.3迁移到1.4.4 如果你是要将模组从 1.4.3 迁移到 1.4.4，展开这一节并仔细阅读。 Migrating from 1.4.3 to 1.4.4 details 从tModLoader v2023.01开始，所有的本地化都在 文件中完成。不再支持在代码中声明翻译（译注：然而可以硬写文本）. 这项改动将大幅精简改良本地化管理并使翻译模组更简单。如果你对逻辑层面的改动更感兴趣的话，参阅 . 如果你没在使用Git或其它形式的版本控制的话，建议在迁移之前备份好你的模组。 在1.4.3生成本地化文件 首先，我们需要一个较“老”的tModLoader来导出本地化文件。用Steam将tModLoader的测试版调至 。（ ) 切换至正确的版本后，启动游戏，启用模组，然后进入 菜单。在模组列表里找到你的模组。你会看到一个绿色箭头按钮，鼠标停留于其上时显示“Export 1.4.4+ localization files”，点它。 现在去到 文件夹，然后是你模组里的本地化文件夹。如果之前没有本地化文件夹，那就到你模组的根目录。你将会看到新生成的 文件： 在文本编辑器里打开上述文件，确认一下它们都是好的。原有 里的条目和新生成的条目都应该在新文件里。如果一切正常，下一步。 本地化键改动 从1.4.3到1.4.4，许多键的格式都改变了。在导出新版本地化文件时，它们会自动调整，但自定义的键或者代码中使用的旧版键不会自动调整，需要你手动修改。比如， 在1.4.4变成了 格式改动 切换至1.4.4并生成模组 用Steam将tModLoader的测试版调至 。（ ) 启动tModLoader后，你会发现你的模组（大概你启用的其它模组也会）加载失败，这是正常现象。进入 菜单并点击“Run tModPorter”按钮。这会将过时的本地化方法连同其它过时内容一起移除（译注：但这并不能解决所有问题，该手动改的还是逃不过的）。 在此之后，你应该用 文件替换现有的 文件。首先，删除 文件（若有），再将 重命名为 文件（如果你不能修改文件扩展名，你需要先 ） 现在，你可能需要打开Visual Studio, 修复剩下的问题。完成后你就可以重新生成你的模组。确保一切正常后，你可以在模组源码里搜索 和 之类的东西，删掉，因为它们没用了。（你可以在项目中的所有文件搜索 找到这些该删的代码） 你也可以使用以下正则帮助你查找 调用（然后用空字符串替换它们）。 单行注释： 多行注释： ，需要用类似Notepad++的工具并开启“.匹配新行”的功能 本地化流程 本地化文件再模组加载过程的最后更新。这意味着模组作者需要在添加内容后生成并加载模组以更新本地化文件。更新后即可修改 文件以添加翻译。翻译完以后，需要重新生成并加载模组来使翻译出现在游戏中。 为了避免丢失翻译，请遵循这一工作流程： 1. 向模组添加内容，比如一个 2. 生成并加载模组 3. 完成上一步后， 文件就会自动更新并生成新内容的条目。编辑英语的 文件，给上述内容一个英语翻译 4. 生成并加载模组 5. 非英语 文件自动根据英语文件更新并生成合适的占位条目以供译者翻译， 请不要在英语文件之前编辑非英语的文件，否则对非英语文件的更改会丢失 译注：目前tModLoader不支持自定义“第一语言”，但你可以将中文内容填入英语的本地化文件中。 如果译者发给你翻译好的 文件，要小心，如果tModLoader检测到 文件新于 文件， 文件可能被覆盖。在这种情况下，最好的办法是在模组加载前生成一遍。你可以在tModLoader未开启时用Visual Studio生成，也可以在启动tModLoader时按住Shift键跳过模组加载再进入模组源码页面生成模组。如果你忘了这一步，发现tModLoader把新翻译重置成旧的了，那就得重新来过了。 热更新 tModLoader会在ModSources里的 文件保存时检测并自动重载它们。这样模组作者就不需要重新生成并加载模组来测试本地化了。如果你用了热更新，记得一定要在发布模组前重新生成一次。（译注：对于代码的热更新也是如此） 让我们来看一个例子。为了修物品 的英语名称和描述，一个模组制作者修改并保存了 文件。几秒后，改动就出现在游戏内了: https://user images.githubusercontent.com/4522492/229942438 26604fd7 9073 436c b2ab d99b4f2efeb7.mp4 本地化如何运作 从物品名字到主菜单文字，每一条文本都使用本地化。游戏里的每一条文本实际上是一对数据：一个“键（key）”和一个“值（value）”。举个例子，当玩家创建一个小世界时，游戏用键 来寻找当前语言的对应翻译，若为汉语则显示“小”，若为英语，游戏依然会寻找键 ，但此时它的值就不一样了：是“Small”。由于泰拉瑞亚的作者们用英语写代码，大部分原版的本地化键很接近它们在英语下的值。 在tModLoader中，模组使用 文件整齐地存放本地化的键与值。每一种语言有它自己的 文件。如果你熟悉JSON, 那么 用起来也不会陌生。 下面是一个简单的示例： 文件名： tModLoader/ModSources/ExampleMod/zh Hans.hjson 在上面这个例子中，我们可以找到两个概念：（本地化）键和（本地化）值。键从 号左侧每一级的文本组合而来。 号右侧则是值。这个例子包含两个键和它们对应的值： 对应 ， 对应 。如果这些语法看起来很复杂，别担心，tModLoader会帮你更新这些文件的。 当模组被加载时，tModLoader会寻找当前语言下的所有本地化文件并将它们储存在内存中。需要向玩家显示文本时，就用一个键去储存的数据里查询并检索出正确的文本。翻译以 对象的形式存储于内存中。模组作者可以用方法 以键获取 对象。 的 属性可取出它的文本值。另外，方法 直接由键获取文本值： 本地化键 tModLoader会自动为大多数内容分配键。这些键的模板是 ， 是是模组的内部名称（类名）， 依内容的类型而定， 是内容的内部名（一般是类名）， 指明了该类中的键。 例如 有叫 的 。它也有两条数据，分别是 和 。如果一个叫 的模组加入了一个类名为 的 ，上述两个键会生成在 文件里： 和 。 注意 ：请不要在本地化键中使用空格或其他特殊字符。 自定义键 如果你有许多描述相同的物品，你可以令它们的描述指向同一个键。要这么做，重写描述属性并返回你要的 ： 如果你有其它的物品继承此类，你只需要在此基类中重写描述。当然，如果有需要，你还可以在子类中继续重写。 模组制作者可以用 代表“不应生成本地化键”，让本地化文件更干净。 文本换元 如果你的本地化文件里有重复出现的文本，或你想要使用游戏里已有的文本，你可以使用换元来保持文件整洁。在值中使用 来换元。当游戏加载时，这一段将会被替换为其 所指的文本。 比如说，游戏里已经有“右键以打开”的翻译，储存在键 中。模组可以使用换元复用它的值。HJSON条目 将被展示为用户语言的“右键以打开”翻译。其它已有翻译，诸如物品名称和常用描述也都可以这样使用。 模组内的翻译也可以换元。比如 中的例子， 就复用了键 对应的翻译。 许多替换里有 或 ，它们是可供模组作者传值的占位符。这一点在 有解释。 已有的物品描述（Tooltip) 在你的模组中使用游戏提供的描述是个好主意。使用统一的语言和既有的翻译能提升你模组的吸引力。仔细看看下面这个常见物品描述列表。所有这些的键都以 开头。 CommonItemTooltip包含的键 其它已有描述 除了 ，模组制作者还可以引用其它本地化键。举个例子， 是用于获取蓝史莱姆本地化名称的键。模组制作者可以下载 中提到的 文件，查看所有的本地化键。 请注意，模组本地化键与原版格式不同。如示例模组中的 有本地化键 。写码时要注意，模组内容的键名不一定遵守默认的格式。 简化作用域声明 如果用于换元的键与其所在的值有重合的作用域，相同的部分可以被省去。例如，在 中， 的值是 。在这个例子中，tModLoader知道在当前作用域检索，结果是键 的值被检索到并且被替换进去。在此情况下， 可以被省去。 格式化字符串 模组作者可以使用 在翻译中给要填的文本留出空位。这是C 的功能。你可以用方法 或 来格式化字符串。章节 有关于此特性的更多信息。 占位符 你也许已经见过像 这样的条目。其中的 和 就是应该根据代码填入文本的占位符，跟 C 里常规的 很像。写完翻译条目后，你可能需要打开游戏看看占位符有没有放在正确的地方。 往本地化中传入值 许多翻译条目中有类似于 ， 或 的占位符，表示模组作者可以往这些地方传值。比如，键 对应这个值 。为了在饰品中使用它，我们要提供一个填入 的数值。 首先，在 文件中，把这条翻译放进我们的物品描述中： 接下来，我们需要将要传入的值与这条描述“绑定”。这个饰品提高3仆从上限。为了传入这个数值，我们重写属性 并调用方法 ；这会将占位符替换成你输入的值。推荐使用一个 的字段来储存此类数据。在下面这个例子中， 被用在了两个不同的地方。用字段储存数据允许模组作者同步更改实际效果与描述，避免打错字或者描述与效果不一致。用 则是为了防止在运行时以外修改其值，进而打乱 。 多个占位替换 当一个本地化条目中包含多个替换引用时，可能会有替换名重复的问题。例如，一个描述用了 和 的饰品会有两个占位符 。直接传值是无效的。模组作者可以使用特殊语法修改特定替换中的占位符。在一个换元键后加上 可以使其中的占位符增加其所声明的 。简单来说，就是 。 是个好例子： 已有的CommonItemTooltip条目 ExampleMod/Localization/en US.hjson ExampleMod/Content/Items/Armor/ExampleBreastplate.cs 我们可以看出 尝试将 同 绑定，并将 同 绑定。这是因为 里加入了 ，原本的占位符 被视为了 ，允许游戏将 的值绑定到正确的位置，显示出物品描述。 或许这看着有点复杂，你可能觉得“我不管什么替换，直接写出描述不是更简单吗?”，若使用得当，替换是大有优势的。有了这些已有的条目，模组的许多文本将自动完成本地化。这还能显著减少人工失误。 更复杂的示例参见 和与之对应的 为动态内容组合翻译 少数情况下，你需要引用其它模组的翻译，却无法创建指向特定内容的翻译，因为需要翻译的内容是在运行时生成的。 建议： 避免用某种语言的语法来组合翻译，因为在其它语言中可能就会出错。相反，你应该尽可能使用独特且详尽的翻译。比如说，你也许会用 ， 和 三条文本拼成一句话 ，但翻译成英语时，这句话会被组合成 而不是正确的 ，因为你是逐字拼接的。更合适的做法是为这句话添加一条独有的翻译 ，这样它可以被翻译为 一个典例是“为所有弹药添加对应的无限弹药”。 能接受 作为参数。你也可以重写一个 属性以返回一个完全不同的 。（见下） 在ModConfig中的使用 的元素的 和 也可以利用文本换元。它们的值可以通过特性 和 分配给对应的翻译。注意，以“$”开头的文本会被当作本地化键。 中的 、 和 展示了这一用法。 复数化 现代汉语采用词汇手段（名词前加数词和量词）和语法手段（名词后加“们”）表示名词的复数，故不存在复数化问题，删除其格式即可。 由汉语翻译成其它语言时则要注意这一点。比如：汉语的“{0} 分钟前”翻译成英语是“{0} minutes ago”；这样能适配大多数情况，但如果传入的“分钟”值是 （单数），“minutes”就错了，需要改成“minute”。 除了常规占位符换元，tModLoader 还支持基于语言的基础复数化。回到上面的例子，其英语的复数化可以写成 ，其中 是分钟数， 就告诉游戏去检查 0 号占位符接受的值，再根据语言规则从 和 中选一个。 对于英语、德语、意大利语、西班牙语和葡萄牙语，值为 时用第一形态，其他时候用第二形态；对于法语，值为 或 时都用第一形态，其他时候用第二形态。波兰语和俄语的规则比较复杂，参见 。tModLoader 根据这个表中“cardinal”规则的顺序选择形态。 聊天标签（Chat tag) 本地化值中可以加入颜色和物品图标等（译注：可以参考 ）聊天标签。参考 中的 。 NetworkText 多人模式下，每个客户端显示的文本应该同客户端选择的语言相同，而不是按照服务端语言来。类 就可实现这一目标。处理网络消息的方法需要文本时会接受一个 参数，可以用本地化键或 构造。具体使用方法参见其文档和示例模组。 获取本地化的时机 在模组加载的初期是无法获取本地化值的。举个例子，如果很早就 ，只会获取到“某个.本地化.键”，而不是它对应的值。此时 也只能返回默认值。 根据经验， 及以后提取本地化值是比较稳妥的，也就意味着 和 是获取 实例的好时机。在 UI 代码中尤为重要——这就是为什么模组一般在 时初始化 。 自动更新本地化 tModLoader会在有新内容或本地化键加入时自动更新 文件。英语的文件 会被用作其它语言的模板，注释和排版将会自动继承。 注意，为了效率，游戏只会在它认为合适的时候更新本地化文件。例如，模组必须被放在 文件夹里且在本地生成；本地化文件只会在其修改时间早于其模组或其模组引用的模组时更新。当心，如果你加载旧版的 文件，你的 文件的内容也可能会被换成旧版的，推荐使用Git或手动备份进行版本控制。 加入新内容 当模组作者向模组中添加内容时，就拿一个 来说，一开始并没有被本地化。模组作者应该生成并重载模组。一旦重载完成， 文件将会自动更新。英语的文件 会包含所有新内容的默认本地化条目。非英语的文件也会包含一样的条目，但都是注释。译者需要修改 文件，填入翻译，保存（记得以 编码保存），重新生成并加载模组。 HJSON语法 文件包含HJSON数据。与JSON相似，但是可读性更高。详细语法参见 ，你也可以看下面的示例初步了解一下。 多行文本 如果文本需要换行，使用下面的语法。确保缩进一致： 你也可以使用 作为备选方案，但从可读性考虑，并不推荐使用此方法。使用 换行时也需要双引号。tModLoader会在自动更新本地化文件时将这种方案转换为上面那一种。 特殊字符 如果一条翻译要以 或空格开头，需要将其以双引号包裹。其它情况下双引号可以省略。如果你需要显示 ，可以使用 转义或多行文本的语法： tModLoader的HJSON特性 颜色 可显示带颜色的文本。 是16进制颜色代码。 例： 显示时，“yes”是绿色的而“no”是红色的。 物品 和 可以在消息中显示物品。 是物品的 。由于模组物品没有固定的 ，你可以用 。 是模组的类名， 是物品的类名。 可以显示带前缀的物品。 是前缀的 。 可以显示特定堆叠的物品。 是物品的堆叠数。 例： 在这个例子中， 将会显示成 ， 是 更好的体验 中一个 的类名。 中会有一个 和一个堆叠到1145的 。 键位 可以显示该按键在目标语言中的名称，仅支持 左键和 右键。 是键位的内部名称。 例： 会被显示为目标语言中的“右键点击”。 注释 文件可以包含多种注释。tModLoader用两种HJSON注释表达不同的含义。 以 开头的注释可被用做提示。它们需要被置于对应键的上一行。否则就有可能在本地化文件自动更新后消失或错位。 例： 英语文件中的此类注释会被自动复制进其它语言的文件，可以用于向译者说明情况。 以 包裹或以 开头的注释被tModLoader用于指示非英语文件中未翻译的键。译者可以将标出的值翻译并移除注释。模组作者 不应该 将它们作为常规注释，因为它们可能在自动更新时丢失。 本地化文件名 tModLoader会尝试将模组里的所有 文件加载为本地化文件。如此一来，本地化文件可以被放在任何路径下。但我们习惯将它们放在模组的根目录下一个叫做“Localization”的文件夹里。模组生成器遵循此习惯生成 。 文件名的开头或包含此文件的文件夹名必须是一个有效的文化编码（culture code) 以指明其语言。 文化（语言） tModLoader支持以下被称之为文化（culture）的语言：英语（en US）、德语（de DE）、意大利语（it IT）、法语（fr FR）、西班牙语（es ES）、俄语（ru RU）、汉语（zh Hans）、葡萄牙语（pt BR）、或波兰语（pl PL）。这些代号用于指明 文件所属的语言。要添加语言支持，参见 展示了一种用法。 把一个叫做 的 属性用于动态物品描述。 基本操作是： 1. 向你的类中添加一个静态 属性 2. 在 中用 为那个属性分配一个值 3. 在需要的地方用那个属性获取翻译 例： 在上面的例子中，除了 和 ， 文件里还会自动生成 的条目。然后模组作者就能更新这些条目： 注意 实例从设计上来说要以静态储存。理想情况下你应该在加载时注册并获取它。 的例子中， 在 里注册并缓存进属性 。如果缓存不了，也可以以一点性能作为代价，每当需要时就提取一次。 为了自动在 里生成与 属性对应的条目，至少要在加载期间访问一次对应的属性。 从LocalizedText属性中提取文本 在类中， 属性可被用于向玩家显示文本： 如果要显示的文本中有占位符，可以用方法 填入值，该方法接受与文本中占位符数量相同的参数： 可继承的本地化属性 使用继承时，可以在子类中用仅可 的属性或非静态属性达到与静态属性一样的效果（子类不会继承父类的静态属性）. 继承的性质允许你复用逻辑和翻译，保持代码与 文件整洁，减少不必要的重复。 以物品为例，想象一下，一个模组里的数个物品共用一个基类。基类中可以有一个 属性给每一个子类。这个属性得在 时被访问以自动添加进 文件里。 基类：MyBaseClass 如果类 和 都继承自 ， 文件中会自动填入键 的条目： 如果子类重写了 ，记得保留 来执行父类的代码（以访问LocalizedText属性）。 生成的键的格式是： 。如果需要一个不符合此格式的键，应当改用 。注意，由于C 的设计， 必须以 调用，不可省略。通过在被继承的属性中使用完整的键，该属性的翻译可以用单个键保存（而不是为每个子类创建一个键），需要不同翻译的子类仍可以重写该属性，通过 使用它们自己的键。 另一个示例 是一个使用自定义键的例子。默认情况下，tModLoader会为每个 注册一个 格式的键。这使得为物块添加地图条目变得简单。（地图条目控制大地图中鼠标停留在物块上时显示的文字。）然而， 需要两个地图条目。新的键可以被轻易地添加进本地化文件中： 这样做的结果就是本地化文件中多出了这些键，可以被翻译成其它语言： 在这个文件的另一个地方，这些键以 被动态获取： 这种方法对动态的键很有用。 与 有实现自定义 的模组可以实现 来轻松地推行本地化。仅需在类继承后面加上 并添加 以实现属性 。对于你自定义的 中的每一个 ，你可以使用 以允许它们像已有 里的 属性一样成为 文件中分好类的属性。 跟前面一样，在模组加载时访问自定义的 才能使它们自动填入 文件。如果本来没有实现，在 里 即可，其中 是需要填写的 。 深入解析： 是一个用于简化代码和防止打错字的helper方法。其等同于传入了完整键的方法 。相似的， 等同于对应写法的 。若要获取生成的键，可以使用 。 和 有一个可选的 参数，决定了键不存在时默认生成的值。例如，传入 会导致默认值变为一个空字符串而不是键本身。若不必进行本地化或内部名已经写得很清楚，模组作者可以传入 以显示加了空格的内部名（ \"My Item\"）。 添加新语言 默认情况下，tModLoader仅会为模组更新已有的 文件。要添加新的语言，仅需新建一个文本文档，复制现有的本地化文件名称并修改语言代号。文件名或其路径中需要包含对应的语言代号：英语（en US）、德语（de DE）、意大利语（it IT）、法语（fr FR）、西班牙语（es ES）、俄语（ru RU）、汉语（zh Hans）、葡萄牙语（pt BR）、或波兰语（pl PL）。创建好文件并确保其有正确的文件扩展名 之后，重新生成模组。这样该文件就会更新出可供翻译的条目，其它文件也会依据英语的 文件的结构一并生成。 非英语本地化文件的注释和结构都从英语的文件继承。如果你要向译者致谢，将他们写进英语文件顶部的一条注释中，这样那条注释会被传到其它语言的文件里。 如果你分割了本地化文件，也仅需编辑英语文件。相似地，从英语文件中移除的键也会从其它文件中移除。总的来说，模组作者一般仅需对英语文件进行操作，其它语言文件将会自动调整。"},{"path":"螺线翻译tml教程/杂项/迁移指南/Armor-Texture-Migration-Guide 盔甲贴图迁移指南.md","filename":"Armor-Texture-Migration-Guide 盔甲贴图迁移指南.md","title":"Armor-Texture-Migration-Guide 盔甲贴图迁移指南","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"1.4 includes support for a new streamlined body armor texture format. This affects . The old styles must be converted to the new styles in order to draw correctly. Body Texture The previous , , and textures have been combined into one new texture. The new texture contains \"extended\" arm sprites. These extended arm sprites are used in: Eating food ( ) Playing golf ( and ) Drinking potions ( ) Using the Lawn Mower ( ) Playing guitars ( and ) Swinging shortswords ( ) Using the Nightglow ( and ) Petting the Town Pets. You can see examples of these Use Styles on the . Texture Templates and Tools : A tool to quickly convert the old Body, Arms, and FemaleBody textures into the new format. As stated on the forum page, the tool is not 100% accurate because many of the new textures were hand drawn by Re Logic. You will need to do some additional editing. Use these templates as a reference when creating your new texture. Full Porting Example Body Here we will port the Solar Flare armor from the 1.3 textures into the 1.4 texture. 1. We have our 1.3 style , , and textures. 2. We will input them into Sprite Transformer which will generate our new texture. If your armor set does not have a , check the \"Use Body sprite sheet for Female equivalent\" option in Sprite Transformer. While Sprite Transformer is trying its best with the limited information it has, it's generated texture is not perfect. Notice the lack of the shoulder section. We will have to manually edit this texture to fix the issues. Use the references above as a guide for what goes where. Something to note: the shoulder sections will always draw over the arms except for when swinging and jumping. 3. We will edit the texture generated from Sprite Transformer to fix its issues. Here is what the finished Solar Flare Chestplate looks like: (From 1.4) Notice how the shoulders are now in the correct location, the arms are more complete, and the body sections are more complete. Accessories HandsOn and HandsOff accessories need to follow this new format as well. Here we will port the Fire Gauntlets from the 1.3 style into the 1.4 style. 1. We have our 1.3 style and textures respectively. 2. We can use Sprite Transformer for these too, but it is a little tricky. Sprite Transformer requires that we have a Body texture selected. We can use an that is 40 × 1120 to use as our Body texture and then select the \"Use Body sprite sheet for Female equivalent\" option. Sprite Transformer's output looks like this, HandsOn and HandsOff textures respectively. 3. The HandsOn texture looks very good. All we have to do is remove the extra extended section on the far right. The HandsOff texture is not very good, however. Sprite Transformer doesn't know that it was supposed to be the back hand. We will have to move it down ourselves and create extended sprites for it. Here is what our finished textures look like: (From 1.4) Additional Information and Pitfalls More information about textures can be found on the Texture Size The final body texture should be 360 × 224 Vanilla Textures To see the vanilla textures for yourself, use a tool like to extract the vanilla assets. Make sure to look specifically in the folder for the armor and folder for the accessories. \"When I extract vanilla or accessories I still get the old texture format!\" Look in the folder for the new style of textures. The and textures located in just the folder are the old format. \"When I use Sprite Transformer, my output texture is just black and white!\" Set your source images to RGB colors instead of Indexed colors. \"When I use Sprite Transformer, clicking Transform does nothing!\" Set your source images to RGB colors instead of Grayscale colors. \"When I use Sprite Transformer, my output texture has strange dithering and a black background!\" Set your source images to 32 bit depth."},{"path":"螺线翻译tml教程/概念了解/Assets 资源文件.md","filename":"Assets 资源文件.md","title":"Assets 资源文件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Overview In tModLoader, we use the class to work with assets such as textures ( ), shaders ( ), fonts ( ), and sounds ( ). The and classes provide on demand (asynchronous) loading and resource pack support. This guide shows how to work with the asset system for optimal performance and compatibility. General Guidelines This section is a quick overview of various best practices. See the later sections for more details on each of these topics. Store the Asset reference, not the contained data class You should always be working with the class directly up until the contained data needs to be used. For example, instead of storing a and calling , store an and call . Preload Textures tModLoader will request and load textures for most modded content during mod loading. This preloading reduces the need to request textures on demand at the cost of loading time and RAM utilization. These assets are usually accessible in arrays found in the static classes, such as , if needed. If you have extra textures, such as special effects for an NPC or Projectile, you can request them in or one of the other Load hooks. Vanilla doesn't preload all textures. For Item, NPC, Projectile, Background, and some other types of content unloaded Assets are populated into the fields of the class. Using these textures require first calling the respective method to ensure that they are loaded. Vanilla textures without a corresponding are most likely preloaded. After , tModLoader will make sure all requested assets for the mod are fully loaded, so there is no need to for them during gameplay. This also means there is no need to use when requesting textures during loading. Doing so will only slow down the load process dramatically. If you don't want to preload extra assets, either because it's inconvenient or because you'd like to save RAM or load time, you can them on demand at any time during the game. It is still recommended to use when requesting assets in game to avoid reducing frame rate. Avoid requesting assets every frame You should strive to only request an asset once and then store the reference in a field for usage. It is more efficient to access the field than it is to call the method. This can be done during mod loading or on demand via a null check. For singleton classes, storing the asset in a instance field is sufficient. For classes with multiple instances such as , , and , the asset will need to be stored in a static field and requested during . There is no need to set the reference to in or manually of the . Avoid using Loading assets with (or calling ) is inefficient and unnecessary in most situations. Read the sections below to learn when it might be needed. Retrieving/Requesting Assets The method can be used to request any asset from any mod or Terraria, but there are other options that might slightly reduce code repetition. When using the method, the of the asset is passed in as a generic argument. For example, requests a texture ( ) with the path specified. would do the same but for a shader ( ) asset. Assets contained in the Mod To load an asset contained in the current mod, simply call the method on the class. Any class will have access to the instance via the property, so would be written. Other classes not inheriting from can use to access the instance. Alternatively, the method can be used if the modder provides the as part of the asset path. Requesting an asset during mod loading, such as in a or method, is a good idea as it will cause errors to be thrown right away rather than during gameplay. This allows the mod maker to fix typos and other asset related errors more quickly. Assets from Terraria or other mods Loading assets from other mods or Terraria is the same process as loading from your own mod, it just requires retrieving the Mod instance or adding the mod name to calls. It is usually simplest to just type out the full path for rather than deal with accessing the classes of other mods. For Terraria assets, will be added to the path. Note that Terraria assets follow their path from the Contents folder in the install directory. Also note that most Terraria textures are already loaded into the class and can be used directly rather than loading a separate . Many of these require calling special methods such as or to fully load, however, as they might not yet be loaded. Asset Load Timing Mods can load additional assets in 2 ways, during mod loading or on demand. It is recommended to load additional assets during mod loading. Assets loaded during mod loading will be fully loaded by the end of the mod loading process, ensuring that they are available to use immediately when needed in game. The asset loading process will also cause the mod to fail to load if any asset fails to load. This will allow modders to quickly notice typos or formatting issues that would otherwise only appear as error messages in the in game chat. Assets loaded on demand in game have the benefit of not being in RAM unless needed. They will never unload during a game session, but for some content it might be useful to only load assets when needed. Assets loaded on demand might require a little more effort by the modder to account for the asset load state. Preloading Assets The most common approach would be to have a field in a or and to request the asset in or . The field storing the will need to be for content that creates multiple instances of the same class, such as with , , and . In either case there is no need to set the Asset reference to in or manually of the Asset. On Demand Asset Loading When loading an asset on demand, modders should try to call once and store the resulting in a field. This can be done with a null check. As an alternative to the check, modders can use if they are familiar with the syntax. Server Considerations Modders should remember that the server does not load any assets. Most hooks that would deal with assets are not called on the server. Requesting assets on the server will return a dummy with a . There is no need to gate code attempting to load assets with checks for . AssetRequestMode The default request mode is . Any assets requested during mod loading will be loaded completely by the time mod loading has completed. Asynchronous loading allows multiple assets to be loaded in parallel in the background, while the game continues to load mods or update/draw frames. Assets requested asynchronously during gameplay will take at least one frame to load, but potentially multiple frames if the asset is large or many assets are requested simultaneously. contains a with a transparent 1x1 texture that will be returned from while the asset is still loading. This allows mods to use the in rendering without needing to check whether the asset has finished loading yet. [!NOTE] As a demonstration, here is a mod loading hundreds of item textures during gameplay. When using , the scrolling is smooth and item textures appear as they are loading. When using the scrolling is interrupted and the frame rate of the game suffers as the game spends time waiting for textures to load. This is an extreme example as it is loading hundreds of item textures at once, for normal modded content the textures loading in will be much less noticeable. https://github.com/tModLoader/tModLoader/assets/4522492/ca66b2d0 37cc 4c0f a565 1b2c5d384991 There are situations where an asset might need to be loaded immediately. The most common situation is when the dimensions of the texture are required for UI layout (such as in the / classes). If the element is initialized with an asset which hasn't finished loading, the dimensions of the temporary transparent 1x1 texture will be used and the resulting user interface will be incorrectly laid out. It is recommended to load the texture asynchronously during mod loading, and initialize the later, but can be passed to or can be called to ensure the asset is loaded. Modders should not use and instead follow the on demand loading advice above. Terraria uses to populate the fields with entries that will be loaded only when needed. This necessitates helper methods which check whether the asset is loaded and re request it such as . Other Asset Methods Asset.IsLoaded Use to check if the asset has finished loading. Asset .Size() This helper method is a bit shorter than calling and will return for assets which have not yet been fully loaded. Asset.Wait() The method can be used to force a texture previously requested to load immediately. Creating Asset from bytes (AssetRepository.CreateUntracked) Some mods need to generate assets from other sources, like loading icons from a web service. Modders can use the method to create an from a containing a etc directly. The resulting is \"untracked\" in the sense that it can not be retrieved by name via . Vanilla Code Adaption Considerations If you copy code from Terraria that uses , you might notice that the vanilla code behaves as if the asset is loaded immediately, even though the default request mode is . This is because there is a special overload of which uses by default that keeps the vanilla code working, while we changed the default for modders and ."},{"path":"螺线翻译tml教程/概念了解/Conditions 条件.md","filename":"Conditions 条件.md","title":"Conditions 条件","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"This Guide was written for tModLoader v1.4.4, the most recent version of tModLoader. In legacy tModLoader, this generalized Condition class does not exist. Condition Class Conditions are a simple that hold a Description and Predicate. Conditions are used in Recipes and Town NPC shops. Conditions can also be used in NPC Loot and almost anywhere else. The class is within the namespace. Description Each condition has a description. The description is a that describes what the condition is. is a special that points to a key in the localization file. See the for more information on localization. The description should be short and to the point. Most conditions start with words such as \"In\", \"Near\", \"When\", \"During\", \"Before\", or \"After\". Some examples are \"After defeating King Slime\", \"In a Hallow biome\", \"During a Blood Moon\", \"Before defeating the Pirates\", and \"When the vendor is happy enough to sell pylons\". The description could also start with \"Not\" such as \"Not in an Drunk world\". The descriptions do not end with punctuation. The description can be accessed with . For example, will return a that says \"During daytime\". Why is a description needed? A description of the condition can be used in several places to tell the player when something is available. For example, when the player gives the Guide a crafting material, text will display saying which crafting station is needed and which other conditions are needed (like being in a Graveyard biome). Mods may also want to show this description to players. Recipe Browser wants to show the player how to obtain an item, for example. Predicate Each condition has a predicate. The predicate is a that defines when the condition is true. The predicate can be accessed with . We can also get the predicate as a simple with . For example will return a saying if it is daytime or not. Pre Defined Conditions There are many useful conditions that we can use. These including checking which biome the player is in and which bosses have been defeated in the world. Look at the Condition class for all of the pre defined Conditions: This file has all of the pre defined Conditions as well as their predicates. The descriptions for each of the pre defined conditions can be found in the tModLoader localization file. Combining Multiple Conditions Multiple Conditions can be combined when adding them to Recipes, Town NPC shop items, or NPC Loot. However, ALL Conditions must be satisfied. Multiple Conditions are ANDed together, not ORed. For example, if an item is available in the Hallow biome but not in a Remix World ( Don't Dig Up World) we would use the Conditions and . The following localized text would show to the player: ANDing many Conditions is easy, but ORing Conditions can't be done. ORing Conditions is fairly rare, but one such example in vanilla is which has the description of \"During the night after defeating the Eater of Worlds or Brain of Cthulhu, or anytime in Hardmode\". This Condition is used by the Arms Dealer to sell Unholy Arrows. In order to OR Conditions together, we will need to create our own Condition. Creating Conditions Even though there are many useful pre defined Conditions, we may need to create our own. To create a custom Condition, we need to define a variable with a type of and give it a description and predicate. ANDing many Conditions is easy, but ORing Conditions can't be done. We can create our own Condition that ORs several bools. Here is an example where we want the Condition to be true if Plantera OR Golem have been defeated. You'll notice we are specifying a localization key for our Description. This is so we can add support multiple languages in our mod without having to edit our Condition's code. We will put the actual text description in our . Here is an example that is used by the Merchant to sell the Drum Set. It is available after defeating Eater of Worlds/Brain of Cthulhu, or defeating Skeletron, or in Hardmode. is localized text that is already defined in tModLoader. Here is a more advanced example to check the percentage of the filled Bestiary. This Condition takes an argument. This is used by the Zoologist for many items. is localized text that is already defined in tModLoader. Localization We set our Descriptions to a localization key so that we can add support multiple languages in our mod without having to change our Condition code. Our localization file would look something like this. Check the for more information on localization. Creating a Conditions Class If we are going to use a Condition that we have created several times in our mod, it would be more useful to define the Condition once in a custom Condition class rather than recreating it every time we need it. We can create a simple static class that has our commonly used Conditions in it. Now, we can just use to get that specific condition when we need it. See also: In Recipes Conditions can be added to recipes with . Here is an example recipe that requires the player be stood in a Graveyard biome. See the for more information on recipes. In Town NPC Shops Conditions can be added to shop items to determine when the item is available to purchase. See also: In NPC Loot Conditions can be used to create a DropCondtion. This is potentially much easier than creating an IItemDropRuleCondition or LeadingRuleCondition. Additionally, because of the description on Conditions, the Bestiary will say the availability of the item too! We can turn any normal Condition into a drop condition by adding to the end of it. takes at least one argument to say if the item will show up in the Bestiary. will make the item always appear in the Bestiary even if the condition isn't met, will make the item appear only when the condition is met, and will make the item never appear in the Bestiary. The second argument of will determine if the description of the Condition will be shown (true by default). Here is a full example of an NPC's loot. In this example, the Example Sword will be shown in the Bestiary at all times and will have an additional tooltip line that says \"Drops: During daytime\". See the for more information on NPC loot. In Mod Hair can use a Condition to determine when the should be available in the Stylist's shop. In vanilla, most hairstyles are available at all times, but a few require a boss to be defeated. If you want your hairstyle to be always available, simply don't override . See for more information on Mod Hair. Other Uses For Conditions Conditions can be used anywhere as bools by adding . Using a Condition instead of something else may be easier to understand. Example: Which mechanical boss corresponds to , , ? Besides memorizing which one goes with which, or referring to the every time, we can just use a Condition. Using , , is much easier to understand and doesn't require us to remember which number corresponds to which boss. There are also some Conditions that combine several other bools into one. If we wanted to check if all mechanical bosses are defeated, instead of writing , we could just write . Conditions that check for the player will always use . This is not ideal for situations where you are given a instance or are looping through . In these cases we should use the normal variables instead such as ."},{"path":"螺线翻译tml教程/概念了解/Coordinates 坐标系.md","filename":"Coordinates 坐标系.md","title":"Coordinates 坐标系","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Coordinates Many modders get confused when working with Tiles, Projectiles, or Drawing code because they don't understand the various Coordinates in Terraria. This guide will teach you. Common Common to all coordinates is the fact that the X axis goes up from left to right and the Y axis goes up from top to bottom. Down is positive Y, up is negative Y . All coordinates start in the top left of what they represent. World Coordinates Players, NPC, Projectiles, and Dust all reside in world coordinates. World coordinates are typically represented as a , meaning that the and components of world coordinates are float values, meaning non whole number values like 3943.23 and 2334.213 are valid values. If you are using 100% screen zoom, each pixel on your monitor is equal to 1 unit of world space. The world coordinate of 0, 0 resides on on the very top left corner of the world. Tile Coordinates Tiles are in tile coordinates. Tile coordinates are only used in Tile related methods and the array. Tile coordinates are typically represented as a or , meaning that and components of tile coordinates must be whole numbers/ints. Screen Coordinates Screen coordinates (actually window coordinates) are used for things like drawing on the screen and user interface elements. A common mistake with manually drawing entities is to draw them using the position of the entity. This doesn't work because the draw code only accepts screen space coordinates, not world space coordinates. Make sure to subtract Main.screenPosition from whatever you are trying to draw to draw it correctly. Drawing Tiles Tiles are drawn not necessarily drawn to the screen all the time. If you are using or or , use in your code and add to all calls to . The reason for this is to accommodate the shift in drawing coordinates that occurs when using the different Lighting modes. Press to change lighting modes quickly to verify your code works for all lighting modes. Converting Coordinates Tile World Each tile is occupies a 16x16 area of world coordinate space. If you multiply a tile coordinate by 16, you end up with a world coordinate pointing to the top left corner of that tile. You can use to simplify your code. automatically adds 8 to both X and Y, returning world coordinates of the center of the tile. World Screen When drawing tiles manually, you need to be aware of , mentioned above. Relevant Fields Main.MouseWorld World Coordinates of the current mouse position. Unfortunately this doesn't work with zoom. Main.MouseScreen Screen Coordinates of the mouse. and are the same. Example Lets look at this picture to review. The white lines depict the Tile spaces, the red points show the world coordinate of the tile when converted to world coordinates. The bottom right tile is at tile coordinate . Converting this to world coordinates by multiplying by 16 gets us . The snails position is displayed in the yellow box. The position of entities relates to the top left corner of the entity. Adding to the world position of the tile mentioned earlier, we arrive at , which is very close to the top snail position shown. (the snail is still a pixel to the right of that point) I hope this has helped visualize this concept. Some practical examples are:"},{"path":"螺线翻译tml教程/概念了解/Geometry 几何.md","filename":"Geometry 几何.md","title":"Geometry 几何","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Why Geometry Many visually interesting effects and interesting behaviors that a modder would want to implement in their mod require a small bit of geometry knowledge. This guide will explain the most basic usages of geometry in regard to tModLoader modding. For example, spawning dust or projectiles in an arc, having an enemy shoot towards the player, and writing homing behaviors all make use of geometry. After teaching the basics, the latter part of this guide will have examples of these concepts. Prerequisite Knowledge Geometry Education As a programmer, especially one with interest in video games, geometry is an essential skill. As Terraria is a 2D game, the geometry knowledge needed is not extensive, but familiarity with the basics of Vectors is essential. Coordinates Terraria uses different sets of coordinates, and the directions of X and Y might surprise you if you haven't worked in graphics before. See and familiarize yourself with world coordinates and the direction of positive X and Y. Rotation Rotation is expressed in radians, not degrees. If you would like to use degrees, simply call the method. Typically you only want to use degrees for the initial assignment of some behavior, such as declaring that the weapon will shoot in a 30 degree arc. Also note that a rotation of 0 faces to the right. Rotating by 90 degrees will point straight down, as Y points down. Vector2 is a struct that represents a 2 dimensional vector as taught in geometry. A contains 2 fields, and , representing the magnitude of the and components of the 2 dimensional vector. In tModLoader, Vector2 are used for two main purposes. The first purpose is locations. A is used to represent the position of many game elements, such as a , , , or . are also used to represent velocity. Velocity is the speed that something is traveling in both the X and Y directions. For example, if a players position is and the player has a velocity of , then the players position will move each time the game updates positions by its velocity. In this example, after 1 update, the players new position will be as and . As you can see, adding vectors is done by adding each individual component. If Vector A represents a position, and Vector B represents a velocity, then after X units of time, the new position will be equal to . Here are some diagrams teaching this concept in the Terraria coordinate system. Notice in the video how each tick the position is changed equal to the velocity of the player. Remember that the game runs at 60 updates per second, so velocity values are in world space units per update, not world space units per second. https://github.com/tModLoader/tModLoader/assets/4522492/e5c11e4c b6d8 43c0 bbe5 9feb07105ced We can also use vectors to represent the difference between two points. A common example of this is an enemy shooting a projectile at the player. If you want to program an enemy to shoot at the player, your code needs to know what direction to shoot at. We can calculate that direction by subtracting the player.position from the npc.position. Subtraction of vectors works the same as addition, the X components are subtracted from each other and the Y components of the vector are subtracted from each other. The vector from A to B is calculated by the following: . Imagine an enemy at and a player at . By subtracting the enemy position from the player position, we get a result of . In our code, we can't use this vector directly, as it represents the raw difference in position, not a direction. To turn this vector into a direction and subsequently use it to spawn a projectile, read the Vector2.Normalize section below. The diagram below shows the resulting vector from the enemy to the player. Position vs Center In the above diagrams, you might have noticed that the arrows originate and point to the top left corners of the entities. In reality, does refer to the top left corner, as that is just how the game is designed. What this means is we rarely actually use in code. Instead, we use as that value points to the center of the entity. (All entities can be thought of having a rectangle as their hitbox). The same can be said for and . From now on, the guide will use as this position makes more sense to use. Acceleration When the game updates the position of something like a projectile, it takes the current velocity and adds it to the current position. This happens 60 times a second and operates in world coordinates. For projectiles like a bullet, this is all that needs to happen, but we can implement \"acceleration\" to influence the velocity over time to give our projectile interesting movement. This acceleration happens in various methods and also in various collision methods. Acceleration can be used to simulate gravity, wind resistance, and homing capabilities. Gravity Gravity is simulated by adding a positive Y velocity to the entity every update. The game implements gravity to players by default. NPCs are affected by gravity by if is false. Dust also have a field. Projectiles are not affected by gravity, so the modder must add a gravity force to the projectile in if they wish. The guide goes into various details for implementing gravity. Drag or Wind Resistance To simulate wind resistance, please read the guide. Essentially a component of the velocity is multiplied by a number slightly smaller than 1, so slowly reduce it. Homing Homing in its simplest form is basically accelerating towards a target. See . Collision and Bounce When a projectile collides with a solid tile, the velocity instantly reverses direction to allow the projectile to bounce. See for more on this. Acceleration Visualization Examples In the video below, we can see a summary of most of the topics above. Red arrows represent velocity, and the blue arrows represent acceleration. In the Shuriken examples, we can see that the acceleration forces point slightly to the left and down. The left force is caused by wind resistance and the down force is caused by gravity. Also notable is that for one third of a second immediately after being spawned, the Shuriken does not have any forces acting on it. This is done through a timer such as shown in the section and gives the Shuriken an interesting movement behavior. The grenade does not have the same wind resistance force, so we only see a gravity force. When the grenade collides with a tile, we see a large force for an instant. This is the collision force which reverses the projectile velocity. https://github.com/tModLoader/tModLoader/assets/4522492/c6ee3ea3 1485 419b b113 41cf2a23ea07 Vector2.Normalize When working with vectors, much of the time the size of the vector isn't relevant, only the direction that the vector represents. Imagine a player 100 units away from an enemy and another player 1000 units away from the enemy in the same direction. If we calculate the vectors from the enemy to each of these players, those vectors will point in the same direction but one will be 10 times longer. If we used these vectors as is in our method for spawning a projectile to shoot at the players, the second projectile will travel 10 times faster! We don't want this, we want enemy projectiles to have a consistent speed no matter how far away the player is. (Right now we are imagining a bullet style projectile, if your enemy is lobbing something like a grenade, you would want to take distance into account up to the max intended throw speed of your enemy, but that kind of advanced AI behaviors is not what we are talking about here.) The solution to this problem is to \"normalize\" the Vector. Normalizing vectors simply means we scale the vector to have a length of 1, resulting in what is called a Unit Vector. You could do this by using the Pythagorean theorem you learned in school, but luckily the class has this functionality already in it. We don't want to use the normal Normalize method, however, because there is a possibility of dividing by zero and crashing the game. Instead, we use a method called : Vector2.ToRotation Given a Vector2, normalized or unnormalized, we can calculate a rotation value by calling the method on that vector. Many flying enemies rotate to face their target, such as Demon Eyes. You can use a vector representing the vector from the enemy to the player to set the enemy rotation, or you can use the current enemy velocity to set . For more advanced situation, you may want an enemy NPC to slowly rotate towards a target rather than immediately turn to face the player. Multiplying Vectors We can scale vectors by simply multiplying them by a float. We typically scale normalized vectors, such as in the example above. In that example, we had a unit vector representing a direction to the player that we intended to shoot at. By multiplying that vector by our intended shoot velocity, we made a vector that was in the same direction as before but much longer. Since we are using that in the parameter of the method, the result is the projectile will spawn with the desired speed in the desired direction. You can also multiply vectors for other reasons. For example, in we multiply a projectile velocity vector by or (the variable), effectively cutting the velocity of the projectile to a fraction of it's original velocity. This gives the flail a weighty feel as it bounces off tiles. Vector2 Length We can determine the length of a Vector easily without resorting to the Pythagorean theorem. Calculating the length of a vector can be very useful in many situations. An example is an enemy that won't shoot until the player gets within a specific range. By checking the length of the vector from the enemy to the player, we can have the enemy decide whether or not to spawn the projectile. Vector2 Length Squared If you are doing something computer intensive like iterating over many entities to find the closest one, you should be aware that using the length squared methods are more efficient. Using or in this situation is more efficient if you desire. Vector2 rotation Rotating a vector can be useful for many purposes. A common example is giving a weapon inaccuracy. By taking an original and calling the method on it, we can calculate a new that has been rotated at most the provided radians. See to see this in action. Note that the resulting distribution is not evenly distributed, which works well for this effect. We can also rotate a vector by a non random amount. The method does this. For example, we could rotate a vector by or to calculate a vector that is perpendicular to the original vector. We could use that vector to create a splitting projectile. By repeatedly rotating a vector, we can calculate several vectors representing an arc. See to see this in action in the Vampire Knives example. // Others? Random Vectors Utilizing random vectors is an easy way to add variety to visual and behavior effects. There are many ways to generate a random vector. The diagrams accompanying the following approaches show the distribution an an in game example of spawning several dust using the approach to illustrate their behavior. Random Vector Within Circle This approach is the most typical result when a modder wants to make a random vector. The results are well distributed. https://github.com/tModLoader/tModLoader/assets/4522492/07341fea ad1f 4418 b464 c0a28093e96d https://github.com/tModLoader/tModLoader/assets/4522492/d330ee58 8bda 4cc6 b37c 16b71daf321b https://github.com/tModLoader/tModLoader/assets/4522492/80677a4e 6719 4a75 9d20 9665415b4a49 Random Vector Along Circle Edge By generating a random vector that reaches the edges, a modder can generate a random vectors with a consistent length or magnitude. https://github.com/tModLoader/tModLoader/assets/4522492/ada40247 d17c 4dc0 a7cd 87b531e0cd74 https://github.com/tModLoader/tModLoader/assets/4522492/35c9caa2 a907 4e97 91c7 731e62a317b5 Random Vector Within Square A lot of old Terraria code uses a strange approach to randomizing vectors. Each component, X and Y, are randomly generated in the following manner: On first glance, this seems like it should work fine, but this approach actually has a strange distribution that may be unwanted, it actually can generate vectors longer than intended extending out towards the corners of an imaginary square. In the image and video below, note the odd shape that forms. https://github.com/tModLoader/tModLoader/assets/4522492/5bd85be8 15a8 4a1f bea3 8a5d4a9e6809 Random Vector Square Edge Not very useful. Examples Now that we have a basic knowledge of geometry and have seen various methods that facilitate that knowledge, we can finally use geometry to program interesting behaviors into our mod. In these examples, you may see Dust or Projectiles being used to illustrate the technique, but they are interchangeable. Just remember to consult the method signature of the method you are using to know the purpose of each parameter. Spawn a random burst/circle of something This is the code used for the random vector section above. In this example, we use a for loop to spawn 50 dust, each with a random vector along the edge of the circle. Note that we multiply the vector by 5 to scale it and make it larger, causing the dust to move a good distance. We can use some simple geometry to change the spawn location away from the same spot. By adding to , the dust start in a small circle and expand outward from there instead of all starting in the same spot. The speed has been reduced to more easily visualize the effect. https://github.com/tModLoader/tModLoader/assets/4522492/9b9913f2 afaa 487d ab7c df3b81739fcb Shoot at a Target In , the basic pattern of an enemy shooting a projectile at the player is shown. Basically, to shot at a target, we calculate the vector from the source to the target, normalize it, then scale that normalized vector by some shoot speed. Make sure to only call this code if the attack cooldown, distance, and line of sight checks pass, as shown in the linked example. Face toward a Target You can face a target by using . If your entity texture is not oriented to face to the right, you may have to add to rotate the entity an additional 90 degrees. Also be aware that sometimes projectile or NPC flip the sprite when facing left. This is done via the bool. If this bool is true, you may need to add an additional 180 degrees of rotation to compensate by adding : // TODO: Explain what happens automatically, where to put various direction and spriteDirection code in both projectile and npc Learn More After mastering this guide, learning collision could be useful. // TODO: Make a collision guide."},{"path":"螺线翻译tml教程/概念了解/IEntitySource 生成源信息.md","filename":"IEntitySource 生成源信息.md","title":"IEntitySource 生成源信息","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"If you are making a 1.4 tModLoader mod, you will need to use . This guide will go over the purpose of and the most frequent uses of it. Purpose of IEntitySource works with the hooks to provide additional information about why a is spawned in the world. There are two primary use cases: Altering the properties of an / only when spawned from a specific context (eg bombs from pots, or minions of a boss). Transferring stats or buffs (such as npc banner id, or player/weapon crit chance), from the source to the spawned entity (normally a ) For example, when a Boss NPC spawns minions, those minions are spawned with the value resulting from the helper method . The result of that helper method is a class with an field of type . This could then be detected by a mod that intended to reduce the HP of all boss minions by half. This additional info can help facilitate many more effects that were previously impossible to accomplish with mods. Note that does not let you prevent the spawning of an entity. On/IL hooks are currently required for that, but such a hook could be considered in the future (causing the returned entity to be the 'dummy' entity slot at the end of the array). See , , or classes in Example Mod for some uses. Lifetime Do not store in fields. The validity of the information they encapsulate is only relevant at the moment of spawning. Any lasting effects of the source information will need to be registered in fields within your mod at the time of spawning. The details on why it is a bad idea are too advanced for this guide. Methods requiring IEntitySource The following commonly used methods require . Using Sources If in doubt use something which extends from Most of the time, this means calling , , , , or is the most important source. tML uses this to transfer values such as from the parent or (or + in the case of ) to a spawned . These values are also transferred from parent projectiles to child projectiles via ensuring the initial 'source' value is retained. Detailed list NPC spawning projectiles should use NPC spawning item drops should use (if loot) or (if anything else). (Note that 99.9% of NPC item drops should be using the new loot system) NPC spawning other NPC, such as boss minions, should use NPC spawning gore on death should use Projectiles spawning items, such as arrow recovery drops, should use Projectiles spawning other projectiles, like a splitting projectile or a shooting minion, should use Held projectile weapons spawning other projectiles using ammo should use Spawning minions or pets in : use An accessory spawning a projectile: use or An armor set bonus spawning a projectile: Use Spawning things in , or any not covered elsewhere: Player spawning Projectiles in should use the passed into the method Tile dropping an item ( or ) should use Player spawning an item due to dropping or being unable to recover an item from a UISlot (player.GetItem overflow) should use Retrieving Information from IEntitySource Using the information provided by is the other half of the purpose of this feature. There are various methods available that provide the source to the modder, all called . For example, in , there is a parameter. We can use casting to cast the to the source that we wish to check. This code uses the operator and the to quickly match a specific set of conditions. For maximum compatibility with mods which add custom entity sources, use with interfaces rather than classes when they exist: instead of instead of instead of Note that for most things, you'll have to manually sync changes. OnSpawn happens on the client or server that spawns the entity, any changes that should reflect on other clients need to by synced in some manner. The files in show examples of this."},{"path":"螺线翻译tml教程/概念了解/Licensing-information 许可证信息.md","filename":"Licensing-information 许可证信息.md","title":"Licensing-information 许可证信息","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Table of Contents Primer about licenses When you make a creative work (which includes code), the work is under exclusive copyright by default. Unless you include a license that specifies otherwise, nobody else can use, copy, distribute, or modify the work without being at risk of take downs, shake downs, or litigation. Once the work has other contributors (each a copyright holder), “nobody” starts including you. Even in the absence of a license file, you may grant some rights in cases where you publish your source code to a site that requires accepting terms of service. For example, if you publish your source code in a public repository on GitHub (like tModLoader), you have accepted the Terms of Service, by which you allow others to view and fork your repository. ( ) Others may not need your permission if limitations and exceptions to copyright apply to their particular situation. Neither site terms nor jurisdiction specific copyright limitations are sufficient for the kinds of collaboration that people usually seek on a public code host, such as experimentation, modification, and sharing as fostered by an open source license. A shorthand definition of license is \"a promise by the licensor not to sue the licensee\". That means without a license any use or exploitation of intellectual property by a third party would amount to copying or infringement. Such copying would be improper and could, by using the legal system, be stopped if the intellectual property owner wants to do so About copyright Copyright is a legal right, existing in many countries, that grants the creator of an original work exclusive rights to determine whether, and under what conditions, this original work may be used by others. This is usually only for a limited time. The exclusive rights are not absolute but limited by limitations and exceptions to copyright law, including fair use. A major limitation on copyright on ideas is that copyright protects only the original expression of ideas, and not the underlying ideas themselves. About trademarks and patents Copyright is not the same as a patent or trademark. Copyright protects original works of authorship created by you. A patent protects inventions and useful discoveries. Trademark protects distinctive words, phrases, symbols, sounds and designs. Trademarks identify and distinguish the source of the goods (and services) of one party from those of another party. About tModLoader's license TML uses the , also known as the Expat license. The MIT License is a very permissive license, and it was actually meant to be read by ordinary people and not just lawyers and attorneys. According to : These licenses, as applied to the original licensed code, allow that code to be used in proprietary software and do not require that open source versions of the code be dis tributed. Code created under these licenses, or derived from such code, may go “closed” and developments can be made under that proprietary license, which are lost to the open source community. For the same reason, however, these licenses are very flexible and compatible with almost every form of open source license. To explain this more thoroughly, it means you can distribute the compiled software without the MIT license, and that you can distribute your own source code that uses the MIT licensed software, but your own source code does not have to be licensed under the MIT license. The MIT license only protects the code it was licensed for. This means if you make a fork of TML, you are free to choose another license to distribute your work under, but you must still include the MIT license because that's what TML was licensed under. The license also provides a disclaimer. Essentially, we (the publishers of TML) are not responsible for damage done to you or your computer by using the software. How to license your mod(s) To license your own mod isn't very difficult. If you take things very seriously, you can consult a professional and setup your own license. It is however recommended, to take a good look at existing licenses that cover the points that you want. You can use a website such as to help you find and choose one. The most common licenses are the MIT License, Apache License, and GNU License (but there are many more licenses). Including a license on Github (and many other distribution platforms) is easy. On Github, people will usually include a file called \"LICENSE\" or \"LICENSE.txt\" in the root of their project. Github will also attempt to automatically detect your license by checking for this file. Simply include the contents of the license you want in such file, and your repository site now includes that license. Please note that you cannot stop others from viewing (unless you make your project private) or forking your repository. If you publish your source code in a public repository on GitHub, according to the , other GitHub users have the right to view and fork your repository within the GitHub site. If you have already created a public repository and no longer want users to have access to it, you can make your repository private. When you convert a public repository to a private repository, existing forks or local copies created by other users will still exist. For more information, see (see also: ) Selective Licensing Depending on the nature of the project in question, licensing parts of it piece wise may be required. Consider the . It contains a large quantity of copyrighted assets and some code to load them. Given the significant value associated with maintaining copyright ownership and control over assets, they utilize a uniform all rights reserved copyright. In contrast, contains a large quantity of code samples intended for usage by others. It uses a uniform MIT license, and all assets included have also been licensed as MIT for usage under those conditions. You may select multiple licenses. You are required to ensure that you explicitly identify what is covered under what license. As such, if you are considering making your mod source code visible then it is recommended to consider if you wish to apply a separate licenses for your code and assets. If you do, please consult appropriate image/music licensing authority and explicitly identify the scope of files under each license. Usually, it will look something like 'All files are all rights reserved, with the exemption of the C Source File type which is licensed under {your license here}'. It is recommended to consult examples such as or Not using a license (\"license free\") or opting out of copyright You are not under obligation to use a license. As stated before, the default copyright laws apply, so you retain all rights to the work of your project and no one may reproduce, distribute, or create derivative works from your work. (Except for viewing and forking your project on the Github website, as stated by the ToS, that is only if you use Github. Please consult the Terms of Service of the distribution platform you use to inform yourself). Not using a license is called software that is \"license free\". License free software is computer software that is not explicitly in the public domain, but the software owner has not made explicit the terms of the license which makes the software fully copyright protected according to the Berne convention. (see also: ) If you do not care much, not using a license is fine, but it is advised to make an informed decision for choosing a license. The \"Unlicense\" is another such option if you want to . You can do so easily by licensing your work under . But please note that the Unlicense isn't exactly very 'detailed', it's rather simplistic and open to different kinds of interpretations which can lead to liability concerns in legal context. It can be considered as written 'easy to read for humans', but not necessarily fit for legal systems we use today. You may be more interested in the (CC0) if you want to dedicate your work to the public domain, it is much better defined license. Please note also the Creative Commons (CC0) licenses are very popular, very well established and used for many products and not just code. All of the CC licenses are a good choice. The Unilicense is NOT global. The Unilicense doesn't make sense outside of a commonwealth ecosystem, has unclear legality in some countries (Australia, New Zealand, etc.) and is even explicitly illegal in some countries (like Germany) . Lastly, some clauses can easily be interpreted for another or vague meaning, so if you somehow go to court, it may take a few trials for a legal team to come up with an objective definition for the Unilicense. Please understand that it is not possible to completely relinquish yourself of copyright holding in every jurisdiction, but certain licenses like the CC0 license are the most complete alternatives to still serve your product to a public domain. We highly recommend any of the CC0 licenses if this is your goal. Copyright infringement Someone may have infringed your copyright, and may be held liable for not abiding to the terms of your license. There is only so much we can do as a non professional, hobbyist modding team. We own the in house Mod Browser. What we can offer you is a takedown of the copied mod in question if you can provide proof, but we have no jurisdiction on other platforms such as Github and limited jurisdiction on partner platforms like Steam. We also cannot offer you legal advise. If it is of importance, you are advised to consult a professional. If you want to contact us, your best bet is by contacting the tmodloader dev team through our (this will require a DiscordApp account) Sources All sources were consulted on the 26th of April, 2019 unless stated otherwise https://en.wikipedia.org/wiki/License free software https://choosealicense.com/no permission/ https://en.wikipedia.org/wiki/Copyright https://unlicense.org/ https://help.github.com/en/articles/licensing a repository https://help.github.com/en/articles/github terms of service https://choosealicense.com https://www.gnu.org/licenses/agpl.html https://creativecommons.org/share your work/public domain/cc0/ https://github.com/Dradonhunter11/tModLoader/tree/x64 https://web.archive.org/web/20170301020915/https://lists.opensource.org/pipermail/license review/2012 January/001386.html (consulted 29 July 2019)"},{"path":"螺线翻译tml教程/概念了解/Logging 日志信息.md","filename":"Logging 日志信息.md","title":"Logging 日志信息","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction tModLoader logs useful information to log files. Users can use logs to identify buggy mods to disable. Users can see the to learn about how to read their own logs to identify buggy mods. tModLoader use the to facilitate logging functionality to modders. Modders can use logs from their users to diagnose and identify bugs and incompatibilities of the mods they develop. Modders can read below to learn how to properly utilize logging. Features Detailed logs Logs are split between files, e.g: and . If there is an issue that happens in multiplayer, the issue might be logged in the server log or the client log, depending on where the code is running. If you see or , those are logs from a 2nd instance of the client or server running at the same time. Every log output provides at least generic log info: time, loglevel and source. In addition to the normal logs, there are special logs that can be consulted for diagnosing more unique issues: is a log of the environment variables is a log of the events that happen before the game actually launches is a log of native dll issues and messages is a log of the process handling the Terraria playtime tracking feature Archiving Old logs are archived in a compressed format so they can be revisited at a later date. These are contained in the subfolder. These old logs can be consulted for an issue that happened in a previous game session. Usage Provided in your class comes your own object. You can use this to log things on behalf of your mod. Inside the log file, your mod will be marked as said source of the log. There are a few different levels of logging: INFO : Should be used for generic informational messages WARN : Should be used as a warning, for example when something went wrong but didn't cause critical problems ERROR : Should be used for critical problems, such as a mod breaking, potential crashing or malfunction of systems FATAL : Should be used when the application can no longer do useful work due to a critical problem DEBUG : Should be used for additional debugging information (verbose) Knowing the difference between error and fatal logging can be difficult, but generally you can follow this rule of thumb: an error is fatal if the application can simply not continue due to the problem causing the error´´ Examples: The above examples all assume the logging is taking place in any inheriting class, such as , , etc. If you are logging from the class directly, you can just write . If you are logging from some other class, you can use to access the of your class. What should I log? It can be hard to determine what should be logged. In general, you should try to avoid bloating log files with useless items. Ask yourself: what purpose does this item have if logged?´´. You want your logs to be useful, so they need a purpose . The purpose of a log is usually to identify issues (or to ensure there are none!) Ideally, you only log items that are required for this purpose. For example, you should push an informational log if a system in your mod completed a particular task successfully (e.g. setting up). In case it failed, it would push a warning or error instead. This way, when inspecting logs, you could identify an issue with the initialization of this system if it occurred. Optional Logging You can use a option to allow a user to determine if something should be logged. This can be useful for rare situations that would bloat the log files of the majority of users. An example of this approach can be seen in . In this example, logging that would only be useful for modders is provided as an option that can be toggled on, keeping bloat from normal users log files."},{"path":"螺线翻译tml教程/概念了解/Polymorphism 多态.md","filename":"Polymorphism 多态.md","title":"Polymorphism 多态","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"(to be made guide)"},{"path":"螺线翻译tml教程/概念了解/Reflection 反射.md","filename":"Reflection 反射.md","title":"Reflection 反射","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"Introduction Terraria is programmed in C . In C , such as , , and are used to restrict how classes, methods, properties, and fields are accessed. For example, something with an accessibility of will not be accessible outside of the class itself. Proper usage of access modifiers is a sign of well structured code, and usually there is little reason to bypass these access modifiers. As modders, however, we sometimes need to access something not normally accessible due to the nature of modding a game. Since we can't implement the code directly in the Terraria source code, we need to bypass the access restrictions using something called . When using , we must be aware of the implications of accessing inaccessible members. For example, something marked as might be that way because the needs to adjust other fields in tandem with that field to keep the code working correctly. Make sure to study the code containing the members you are using reflection to access to ensure that the behavior is maintained. Do note that tModLoader itself will change the access modifiers of various members depending on how useful they would be to modders. It might seem like tModLoader could just change everything in Terraria to , but we do not do that because access modifiers are useful and help modders write correct code. Please feel free to suggest changes if they would benefit modders. Finally, be aware that by using reflection your mod could stop working when tModLoader updates. tModLoader developers try not to break mods by not changing public methods and fields, but private methods and fields have no such guarantee. Basic Concepts There are many well written tutorials online about \"c reflection\". Rather than reiterate the basic concepts and information about reflection, this guide directs the reader to consult those tutorials to establish a basic understanding of the concepts. Google \"c reflection\" and follow whatever tutorials you find until you feel somewhat comfortable, then come back to this page to see how reflection can be used in tModLoader. Note that this guide has not yet been updated to new approach to reflection added in .NET 8, this guide will be updated at a later date with that info. Accessing a private field In there is a static field named that is . We want to read the value. First, we use reflection to get a . is a special class that facilitates accessing the field. Next, we use the to access the value. Since the field is , we pass in as the argument. To set the value, we use the method. Once again we pass in as the argument. Make sure the value you are passing in matches the of the field, it is up to the programmer to do this when using reflection. Accessing a private field of a private class Some classes in Terraria are private. In this case, we must use reflection to access the of the class rather than use the operator. To use the method, we need an instance. For Terraria classes we can use to retrieve that. Use the assembly to retrieve the , then use reflection as normal to access private fields of that class. Using reflection with members of other mods Reflection is used in 2 ways when dealing with other mods. The first way is to access members as we have done previously. This is useful for mods with to the target mod. The second way to to access members of other mods at all. In this case, your code can't access the fields not because they are private, but because they may or may not exist at all. This can be useful for loose cross mod compatibility, such as a mod looking for a specifically named field in a class to drive some effect. Reflection for other mods is the same as above, but we need to access the of the containing the . After retrieving the instance with or , the field of the class is the object we need. Clean Code When using reflection, sometimes the code can get a bit verbose. The code examples in this guide are written with the intention of accessing or setting a reflected member once for the sake of simplicity. It is useful to use other programming approaches if accessing a member multiple times. Store MemberInfo instance Rather than use / / each time the code should access a private member, you can store the as a field in your class and reuse it. This should be done for efficiency and convenience. Reflection is slow, so retrieving the only once and reusing it will speed up code that needs to use reflection."},{"path":"螺线翻译tml教程/概念了解/Spriting 精灵图.md","filename":"Spriting 精灵图.md","title":"Spriting 精灵图","description":"","category":"螺线翻译tml教程","topic":"mod-basics","author":"错数螺线","difficulty":"beginner","time":"不具体","last_updated":"2017-9-18","content":"What is a Sprite? A \"Sprite\" refers to 2D graphics typically found in 2D games. For example, the Gold Bar item sprite, , looks like this: . When making mods, you'll typically need to make a sprite for each bit of visual content you add to your mod. This guide will teach you the basics of spriting and how sprites work in relation to tModLoader. Sprite Frame Many sprites have several \"frames\" within a single image usually referred to as spritesheets. These are typically used for animation or variation. For example, the GiantBee projectile looks like this: You can find this texture in your extracted copy of the vanilla textures by finding . The game was told by the programmer that this sprite has 4 frames in it, so the game knows to split the 96 pixel high texture into 4 equally sized 24 pixel high sections. The game cycles between these 4 frames as the game draws this projectile Some sprite frames are for variety. Here is the Metal Bars sprite, , this sprite is shared between all metal bar tiles: Spriting tiles is a full topic for itself, please consult the guide and confirm specifics with your programmer before making tile sprites. File Format Every tModLoader sprite must be a .png file. As long as you don't mess with settings in your program, saving as a .png should work fine. Sprite Making Tools You will need to use a capable art / spriting program. MS Paint (pre Windows 11) will not work for most sprites you might want to make because it can not save transparent pixels. See to find a list of suitable programs. The rest of this guide will use Aseprite in example diagrams, but any of these programs should have similar capabilities. While the full version costs money, Aseprite does offer a free compilable version that is 100% safe and legal to use. You can compile it by using . Other spriting programs that are recommended include, but are not limited to: Vanilla Sprite Resources Before getting started, we recommend extracting the vanilla sprites to a folder you can easily access. We will be using the folder in this guide. To do this, follow . We will be using these textures as guides for sizing and orientation of similar content we will be making in our mod. If you just need a reference for how big various vanilla textures are, you can consult this . Live Editing Sprites If you need to make slight adjustments to a tile or armor texture, it can be very time consuming to make sprite changes, rebuild the mod, reload mods, then test in game to see if the changes were correct. You can use a mod called \"Modders Toolkit\" to edit textures live in game. Follow the video below to see how that is done. After making changes, you'll need to rebuild the mod for the changes to persist. Live editing sprites showcase video Instructions: Download and enable the mod. In game, click the small icon in the bottom left, then find the button that says \"Click to toggle Texture Tool\" and click it. The texture tool should be showing. Click the mod you are working on in the listing, then check \"Watch Mod Sources\". Use your image editing program to make adjustments. When you save your changes in the image editing program, Modders Toolkit will notice the changes and update the in game texture for you. https://github.com/tModLoader/tModLoader/assets/4522492/9da8b20d 3fa8 4fd8 9724 8e844364e868 Making Sprites 2x2 Pixels Terraria uses a pixel art style where each pixel is actually a 2x2 block of pixels. You do not have to follow this art style, but be aware of this concept. If you would like to follow this style, you can simplify your efforts by drawing in normal pixels and scaling your resulting sprite by 200% while using the \"Nearest Neighbor\" option when resizing. Note that this will also change the padding from 2 pixels to 1. If somehow your sprite upscales incorrectly, a common term you may see thrown around is mixels. A \"mixel\" refers to mixed sized pixels within a sprite, leading to inconsistency and making the sprite appear messy. It is recommended to always sprite in 1x1 pixels and then upscale to 2x2, not the other way around or with a mixture of the two. Another concern is players may be tempted to use to adjust the size of their sprites directly if they appear too small. While this is useful in the sense of converting 1x1 sprites to 2x2, this certainly isn't useful for cases such as converting an already 2x2 sprite to something bigger (say 4x4). The reasoning you wouldn't use this is due to upscaling a sprite in this manner causing both mixels (as discussed prior) as well as it won't match with the 2x2 sprites in the game already. The left side of this example has inconsistent pixel sizes, whereas the right keeps it consistent. The right ends up looking cleaner since it is consistent within itself. Dimensions The dimension of a sprite refers to the height and width the sprite is comprised of. For example, a sprite that is 20 pixels wide and 20 pixels tall would be a 20x20 sprite. The maximum dimensions a sprite can be is 2048x2048 before being resized so 1024x1024 before being resized to 2x2. Art Tools Padding When a sprite has several frames, we use padding to separate the individual frames. By default, Terraria expects 2 pixels of padding between each frame. For horizontally laid out frames, this means 2 pixels of padding below each frame, even the last one. Here is the GiantBee projectile sprite with magenta padding drawn in to show where padding goes. For tiles, the padding goes to the right and below each frame. Animation Animation is done by including several frames of animation within your sprite. Make sure the frames are evenly spaced. Example here of incorrect spacing, then fixed with guidelines showing padding and even texture splitting Animation typically loops, but custom animation cycles are also possible. The animation speed and pattern are up to your programmer, so the details of that are found in separate guides. Orientation Many things in Terraria have an expected orientation. For example, NPC sprites usually face left , arrow projectiles point up , and staff point to top right . These conventions are useful to follow because the code drawing these sprites expects the sprites to be oriented in a specific manner. Hitboxes and drawing will be wonky if you do not follow these conventions. Consult the most similar vanilla sprite for a good idea on how to orient your sprite. Projectile Glowmasks Glowmasks refer to a separate sprite that is drawn at full brightness regardless of lighting. This is typically used for glowing lights on weapons. For example, the regular VortexDrill item sprite, , can only be seen when there is light around, but the corresponding glowmask sprite, , is drawn in full brightness regardless of nearby lights: To make a glowmask sprite, make a copy of the original sprite and remove all pixels that shouldn't \"glow\". Your programmer will then need to write some code to make it draw correctly. Example Here we will make a sprite for a sword. First, I'll look at a similar vanilla sword sprite to get an idea on how big I want to make it. First, I'll look up a weapon with the size I'm interested in on the wiki. Lets go with . The item sprites on the wiki aren't exactly the same as the actual sprites, so don't use that sprite. Instead, find the ItemID by looking for \"Internal Item ID: \" in the infobox. Here we see the number is 155, so open up your copy of the extracted vanilla sprites and find . Open this file in your sprite editor and use Save As to save a copy of this file to the folder where you are saving your sprites. Now, feel free to draw a sword while keeping the same orientation and general size. Take note of the 2x2 pixels as well. By using this approach, you will make a sprite that will appear the same size as a vanilla weapon. In this case, the sprite is 58x58 pixels. With time, you'll learn the conventions of various entity sizes and be able to make sprites without needing vanilla texture guides. Making Good Pixel Art This guide has focused on the technical details of how sprites are structured and how to integrate them into your mod. If you find making sprites difficult, it may be worth finding an artist friend to collaborate with. If, however, you want to further develop your artistic skills, there are many learning resources on the internet to guide you. Joining the and visiting the channel is a great way to get advice and feedback from other spriters. Here are some links to other learning resources:"},{"path":"Modder入门/DPapyru-给新人的前言.md","filename":"DPapyru-给新人的前言.md","title":"给新人的前言","description":"","category":"Modder入门","topic":"mod-basics","author":"小天使","difficulty":"beginner","time":"5分钟","last_updated":"2025-12-02","content":"致谢 首先，谢谢各位能够看我搭建的网站，这个网站的本意是想给新人学习泰拉瑞亚Mod开发的，我本人现在已经不做Mod了，所以知识有所遗漏的话可能也不知道，欢迎进群: 960277607 讨论。 下面先说一下应该怎么学习吧： 基础 如何从最基础学习？ 例如下面这种比较简单的代码： 你要学会看通过修改数据，然后观察结果，然后学习到这个东西是做什么的，例如这里这个 这个东西，你修改它就会改变物品的伤害，但是这是在 里面使用的， 的效果是： 物品生成时调用 ，所以你通过热重载修改它，那么你就需要把这个物品重新生成，也就是拿一个新的物品出来。 我们学习就是通过观察效果，然后去想象它经历了什么，从而知道改变这个东西的作用。 如何提问？ 这个东西，说难不难，说简单也不简单。 听说过一个东西吗？ X Y问题 没听过我给你看看什么是 X Y问题： 接下来我要说几个提问常见问题： 开场白： 你直接问你好再丢问题没什么，你如果是：“你好？有人在吗？我有一个问题群友能解决吗？”，我只能说：“你TM问不问了？” 建议：直接给问题丢出来然后问，不要去@群友，自然有人解决。没人解决就几分钟后回复自己发的内容，别问：在吗？ 多开： {color:Mad}{你是一定有什么大病才想着开了50多个Mod的情况再过来问问题。} 脑炸描述： 接下来请分析我想说什么： 请问我应该怎么做一个成长型武器，不是和灾厄那种一样的，就是那种，会随着玩家进度升级而成长的武器。 那我怎么知道你要实现什么？那我默认以为你是想要实现一个根据Boss进度决定你武器强度的武器，要是不是呢？ 如果你说：我想要一个成长型武器，它会随着玩家的一些特殊条件，例如我自己的一些事件，或者是击败一些特殊Boss而成长的武器，是不是好多了？ 国家机密代码： 接下来我要公布一个国家机密代码，震惊全人类（ 一般我觉得你应该这样： 致敬传奇牢大（实际：没有能力硬着头皮要用这个实现） 然后你发现你坠机了。 好高骛远环节 举个经典：“这刀光怎么做？” 但是你实际是：刚刚接触C ，然后不会打开项目。 乐 “我不会看教程” 那你想好死法了吗） 好啦，接下来就可以开始学习了，愉快哦！"},{"path":"Modder入门/DPapyru-提问的艺术.md","filename":"DPapyru-提问的艺术.md","title":"提问的艺术","description":"","category":"Modder入门","topic":"mod-basics","author":"小天使","difficulty":"beginner","time":"5分钟","last_updated":"2026-01-17","content":"为什么我要写这篇文章？ 我在给新人的前言里面说过如何提问，但是我觉得还是不放心，所以我专门写了一个这个文章，强调 如何提问 什么是X Y问题？ 在开始之前，先了解一下什么是 X Y问题 。 X Y问题是指：你遇到了问题X，你觉得解决方案是Y，于是你问别人\"如何实现Y\"，但实际上Y可能不是解决X的最佳方案，甚至可能完全走偏了。 举个简单的例子： 错误提问：\"如何用On语法糖Hook玩家的Update方法？\" 正确提问：\"我想在玩家移动时添加特效，应该用什么方法？\" 第一个问题假设了\"正则表达式\"是解决方案，但实际上解析HTML用专门的库会更好。 提问前的准备 在提问之前，请先做好以下准备： 1. 自己先尝试解决 搜索引擎是你的朋友，先搜索一下问题 查看官方文档和教程 尝试自己调试，看看错误信息 2. 整理问题信息 把以下信息整理好： 你想做什么 （目标） 你做了什么 （尝试的方法） 发生了什么 （错误信息、异常行为） 你期望发生什么 （预期结果） 提问的黄金法则 1. 直接说问题 不要这样： 应该这样： 原因： 大家都很忙，直接说问题能更快得到帮助。如果没人回答，几分钟后回复自己的消息即可，不要问\"在吗\"。 2. 提供完整信息 不要这样： 应该这样： 原因： 没有代码和错误信息，别人无法帮你定位问题。 3. 截图要完整 不要这样： 只截一小部分代码，或者截错误信息的一半 应该这样： 截取完整的代码块 截取完整的错误信息 如果是运行时问题，截取控制台输出 4. 描述要清晰 不要这样： 应该这样： 原因： 清晰的描述能让别人准确理解你的需求，给出合适的建议。 常见错误示范 1. 多开Mod提问 {color:Mad}{你是一定有什么大病才想着开了50多个Mod的情况再过来问问题。} 原因： Mod冲突很难排查，先在只有你Mod的情况下测试，确认问题后再提问。 2. 好高骛远 不要这样： （实际上你刚刚接触C ，连项目都不会打开） 应该这样： 从基础开始，先学会创建物品、设置属性，再逐步学习高级功能。 原因： 没有基础就想做高级功能，只会让你处处碰壁。 3. \"我不会看教程\" 如果你说\"我不会看教程\"，那我只能说：你想好死法了吗） 原因： 教程是系统学习的最佳途径，不学教程就想直接问问题，效率极低。 4. 没有能力硬要用复杂实现 不要这样： 明明可以用简单方法实现，非要追求\"高大上\"的复杂方案，结果自己都搞不定 应该这样： 先用简单方法实现功能，等熟练了再优化。 原因： 过早优化是万恶之源，先做出来再说。 提问模板 如果你不知道怎么提问，可以参考这个模板： 提问后的礼仪 1. 耐心等待 ：大家都有自己的生活和工作，不是秒回机器人 2. 感谢帮助 ：问题解决后，记得感谢帮助过你的人 3. 分享经验 ：如果你解决了问题，可以分享给其他人，帮助更多人 4. 不要刷屏 ：没人回答时，几分钟后回复自己的消息即可，不要重复发 总结 好的提问 = 清晰的问题 + 完整的信息 + 谦虚的态度 记住：别人帮你是因为热心，不是义务。尊重别人的时间，你也会得到更好的帮助。 祝你在Mod开发的道路上越走越远！"},{"path":"怎么贡献/DPapyru-贡献者如何编写文章基础.md","filename":"DPapyru-贡献者如何编写文章基础.md","title":"如何贡献文章（详细指南）","description":"","category":"怎么贡献","topic":"article-contribution","author":"小天使","difficulty":"beginner","time":"10分钟","last_updated":"2026-01-16","content":"如何贡献文章（详细指南） 这篇文章会带你从“新建/修改 Markdown”到“本地构建 + 通过 CI 检查”完整走一遍，适用于给本教程站点贡献内容的所有人。 你要做的事情（最短路径） 1. 在 下新增或修改 （必须带 YAML Front Matter） 2. 运行构建： （会自动更新 、 、 ） 3. 运行一致性检查： （确保生成文件已提交） 4. 提交并发起 PR 仓库结构速览 ：文章与站内页面（文章在 ） ：静态资源（图片建议放 ） 根目录： 、以及搜索索引 构建脚本： 注意： 、 、 都是自动生成的，请不要手改它们作为最终结果；应修改 Markdown 后重新运行构建。 新建文章：文件位置与命名 推荐结构： 放在： 文件名： （建议作者名用英文/ASCII，避免路径兼容问题） 例如： 如果你想写“系列章节”，可以用 控制排序，并用 / 做章节跳转。 必须写的 YAML Front Matter 每篇文章开头必须有： 推荐模板（VS Code snippet 输入 可快速生成）： 字段说明（按常用程度） ：文章标题（必填） ：作者名（推荐） ：分类（推荐；不写时会尝试按目录归类） ：主题（推荐；用于把同一分类下的文章再分组） 建议写 Topic key，例如 、 、 … 也允许写别名（例如“文章贡献”），但为了稳定建议写 key ：同一分类/主题内的排序（数字越小越靠前） ：难度（推荐： / / ） ：预计阅读/学习时间（例如 、 ） ：列表页展示的简介（强烈推荐写） ：最后更新日期（推荐；格式如 ） / ：章节跳转（填同目录下真实存在的 文件名；没有就写 ） 可选：颜色标注（单色） 站点为固定深色主题，不再区分浅色/深色两套颜色，所以以前的 （Light/Dark）已废弃；统一使用 （单色）。 1) 在元数据里定义颜色变量 2) 在正文里使用 注意： 变量名建议使用英文/ASCII（例如 、 ），否则可能无法正常匹配/渲染。 历史兼容：旧文章如果还写 ，构建与渲染会尽量兼容，但新文章请只用 。 可选：颜色动画 如果你确实需要动画（不建议滥用），可以在元数据中配置 ： 正文： 链接与图片（推荐写法） 同目录章节互链：直接写文件名，例如 图片建议放 ，在 Markdown 里用相对路径（从 出发）： 尽量避免硬编码站点域名链接（方便本地预览与未来迁移）。 构建、校验与本地预览 首次安装依赖： 生成索引/搜索/站点地图（提交前必做）： 模拟 CI 的关键检查（推荐，能提前发现“生成文件没提交”的问题）： 本地预览（任选一个静态服务器）： 然后打开页面，确认： 导航正常 文章渲染正常（代码块、链接、图片） 搜索能搜到新内容 常见问题（踩坑清单） 构建后出现大量 diff：正常，生成文件会更新；请确认已把生成文件一起提交。 文章没出现在列表：检查 Front Matter 是否缺少 ，或 是否放在 下。 写了但分组不对：优先使用 Topic key（如 ），避免写错别名/拼写。 章节跳转 404： / 必须指向真实存在的文件名，否则请写 。 PR 建议 描述清楚：改了什么、为什么改、涉及哪些页面/文章 如果改了 UI/样式：附截图 提交前跑一遍 +"}]}