<!DOCTYPE html>
<!-- 文件夹内容显示页面 -->
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件夹内容 - 泰拉瑞亚Mod制作教程</title>

    <!-- SEO优化标签 -->
    <meta name="description" content="泰拉瑞亚Mod制作教程文档文件夹内容，提供特定文件夹下的所有文档列表">
    <meta name="keywords" content="泰拉瑞亚,Mod,教程,文档,文件夹,tModLoader">
    <meta name="author" content="泰拉瑞亚Mod社区">
    <meta name="robots" content="index, follow">

    <!-- Open Graph标签 -->
    <meta property="og:title" content="文件夹内容 - 泰拉瑞亚Mod制作教程">
    <meta property="og:description" content="泰拉瑞亚Mod制作教程文档文件夹内容，提供特定文件夹下的所有文档列表">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dpapyru.github.io/docs/folder.html">
    <meta property="og:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">
    <meta property="og:site_name" content="泰拉瑞亚Mod制作教程">
    <meta property="og:locale" content="zh_CN">

    <!-- Twitter Card标签 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="文件夹内容 - 泰拉瑞亚Mod制作教程">
    <meta name="twitter:description" content="泰拉瑞亚Mod制作教程文档文件夹内容，提供特定文件夹下的所有文档列表">
    <meta name="twitter:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">

    <!-- 规范URL（实际值会在脚本中根据 ?path 更新） -->
    <link rel="canonical" href="https://dpapyru.github.io/docs/folder.html">

    <!-- 样式和图标 -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/prism.min.css">
    <link rel="stylesheet" href="../assets/css/vs2022-theme.css">
    <link rel="icon" type="image/png" href="../assets/imgs/Green_tModLoader.png">

    <!-- 主题切换脚本 - 早期加载以避免闪烁 -->
    <script src="../assets/js/theme-init.js"></script>

    <!-- 自定义样式 -->
    <style>
        /* 文件夹页面特定样式 */
        .folder-hero {
            background: linear-gradient(0deg, #155724, #28a745, #155724);
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        .folder-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .folder-hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

	        .breadcrumb {
	            background-color: var(--bg-secondary);
	            padding: 15px 0;
	            border-bottom: 1px solid var(--border-color);
	        }

        .breadcrumb-nav {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

	        .breadcrumb-item:not(:last-child)::after {
	            content: "›";
	            margin: 0 10px;
	            color: var(--text-muted);
	        }

	        .breadcrumb-item a {
	            color: var(--link-color);
	            text-decoration: none;
	            transition: color 0.2s ease;
	        }

	        .breadcrumb-item a:hover {
	            color: var(--link-hover);
	            text-decoration: underline;
	        }

	        .breadcrumb-item.active {
	            color: var(--text-muted);
	            font-weight: 500;
	        }

        .folder-content {
            padding: 40px 0;
        }

        .folder-header {
            margin-bottom: 30px;
            text-align: center;
        }

	        .folder-title {
	            font-size: 2rem;
	            margin-bottom: 15px;
	            color: var(--text-color);
	        }

        .folder-description {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 800px;
            margin: 0 auto;
        }

        .subfolder-section {
            margin: 0 0 20px;
            text-align: left;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
        }

        .subfolder-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0 0 8px;
        }

        .subfolder-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .subfolder-item {
            border-bottom: 1px solid var(--border-color);
        }

        .subfolder-item:last-child {
            border-bottom: none;
        }

        .subfolder-link {
            display: block;
            padding: 10px 0;
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .subfolder-link:hover {
            color: var(--link-color);
            background-color: var(--bg-secondary);
        }

	        .filter-container {
	            display: flex;
	            flex-wrap: wrap;
	            gap: 15px;
	            margin-bottom: 20px;
	            padding: 20px;
	            background-color: var(--bg-secondary);
	            border-radius: 8px;
	        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

	        .filter-group label {
	            font-weight: 600;
	            margin-bottom: 5px;
	            color: var(--text-color);
	        }

	        .filter-select {
	            padding: 8px 12px;
	            border: 1px solid var(--border-color);
	            border-radius: 4px;
	            background-color: var(--bg-color);
	            color: var(--text-color);
	            font-size: 0.9rem;
	            outline: none;
	            transition: border-color 0.3s ease;
	        }

	        .filter-select:focus {
	            border-color: var(--primary-color);
	            box-shadow: 0 0 0 2px var(--search-focus);
	        }

        .view-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

	        .view-toggle button {
	            background: none;
	            border: 1px solid var(--border-color);
	            border-radius: 4px;
	            padding: 6px 10px;
	            cursor: pointer;
	            transition: all 0.2s ease;
	            color: var(--text-color);
	        }

	        .view-toggle button.active {
	            background-color: var(--primary-color);
	            color: white;
	            border-color: var(--primary-color);
	        }

	        .search-section {
	            background-color: var(--bg-secondary);
	            padding: 30px 0;
	            border-radius: 8px;
	            margin-bottom: 40px;
	        }

        .search-container {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

	        .search-input {
	            width: 100%;
	            padding: 15px 50px 15px 20px;
	            border: 1px solid var(--border-color);
	            border-radius: 50px;
	            font-size: 1rem;
	            outline: none;
	            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	            transition: all 0.3s ease;
	            background-color: var(--bg-color);
	            color: var(--text-color);
	        }

	        .search-input:focus {
	            border-color: var(--primary-color);
	            box-shadow: 0 0 0 3px var(--search-focus);
	        }

	        .search-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
	            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

	        .search-button:hover {
	            background-color: var(--primary-hover);
	        }

        .doc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .doc-grid.list-view {
            grid-template-columns: 1fr;
            gap: 10px;
        }

	        .doc-card {
	            background-color: var(--bg-content);
	            border-radius: 8px;
	            box-shadow: var(--shadow-md);
	            overflow: hidden;
	            transition: transform 0.3s ease, box-shadow 0.3s ease;
	        }

	        .doc-card:hover {
	            transform: translateY(-5px);
	            box-shadow: var(--shadow-xl);
	        }

	        .doc-card-header {
	            padding: 20px;
	            border-bottom: 1px solid var(--border-light);
	        }

	        .doc-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
	            color: var(--text-color);
	        }

	        .doc-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.85rem;
	            color: var(--text-secondary);
	        }

        .doc-meta-item {
            display: flex;
            align-items: center;
        }

        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

	        .difficulty-badge.beginner {
	            background-color: rgba(40, 167, 69, 0.18);
	            color: #b7f5c5;
	        }

	        .difficulty-badge.intermediate {
	            background-color: rgba(255, 193, 7, 0.18);
	            color: #ffe8a6;
	        }

	        .difficulty-badge.advanced {
	            background-color: rgba(220, 53, 69, 0.18);
	            color: #ffc1c7;
	        }

        .doc-card-body {
            padding: 20px;
        }

	        .doc-description {
	            font-size: 0.95rem;
	            color: var(--text-secondary);
	            margin-bottom: 15px;
	            line-height: 1.5;
	        }

        .doc-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

	        .doc-tag {
	            background-color: var(--bg-tertiary);
	            color: var(--text-secondary);
	            font-size: 0.75rem;
	            padding: 3px 8px;
	            border-radius: 4px;
	        }

	        .doc-card-footer {
	            padding: 15px 20px;
	            background-color: var(--bg-secondary);
	            display: flex;
	            justify-content: space-between;
	            align-items: center;
	        }

	        .doc-author {
	            font-size: 0.9rem;
	            color: var(--text-secondary);
	        }

	        .doc-link {
	            display: inline-block;
	            background-color: var(--primary-color);
	            color: white;
	            padding: 8px 15px;
	            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
        }

	        .doc-link:hover {
	            background-color: var(--primary-hover);
	        }

	        .no-docs {
	            text-align: center;
	            padding: 60px 20px;
	            color: var(--text-secondary);
	        }

        .no-docs-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-docs h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .no-docs p {
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .back-to-docs {
            text-align: center;
            margin-top: 40px;
        }

	        .back-to-docs .btn {
	            display: inline-block;
	            background-color: var(--secondary-color);
	            color: white;
	            padding: 12px 25px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 1rem;
            transition: background-color 0.2s ease;
        }

	        .back-to-docs .btn:hover {
	            background-color: var(--secondary-hover);
	        }

	        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
	            background-color: var(--bg-color);
	            border: 1px solid var(--border-color);
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

	        .search-result-item:hover {
	            background-color: var(--sidebar-hover);
	        }

        .search-result-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

	        .search-result-meta {
	            font-size: 0.85rem;
	            color: var(--text-secondary);
	        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .folder-hero h1 {
                font-size: 2rem;
            }

            .folder-hero p {
                font-size: 1rem;
            }

            .doc-grid {
                grid-template-columns: 1fr;
            }

            .folder-title {
                font-size: 1.5rem;
            }
        }

        /* 文件夹页面特定样式已移至 theme-base.css，使用CSS变量系统 */
    </style>
</head>

<body>
    <a class="skip-link" href="#main-content">跳到主要内容</a>
    <!-- 网站头部导航区域 -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <!-- 网站logo和标题 -->
                <div class="logo">
                    <a href="../index.html">
                        <img src="../assets/imgs/Green_tModLoader.png" alt="泰拉瑞亚Mod制作教程" class="logo-image">
                        <h1 class="site-title">泰拉瑞亚Mod制作教程</h1>
                    </a>
                </div>
                <!-- 主导航菜单 -->
	                <nav class="main-nav" id="main-nav">
	                    <ul class="nav-list">
	                        <li class="nav-item"><a href="../index.html" class="nav-link">首页</a></li>
	                        <li class="nav-item"><a href="index.html" class="nav-link active" aria-current="page">文档</a></li>
	                        <li class="nav-item"><a href="https://github.com/DPapyru/DPapyru.github.io" class="nav-link"
	                                target="_blank" rel="noopener noreferrer">GitHub</a></li>
	                    </ul>
	                </nav>
                <!-- 移动端菜单切换按钮 -->
                <button class="mobile-menu-toggle" type="button" aria-label="切换菜单" aria-controls="main-nav" aria-expanded="false">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 文件夹页面主要内容区域 -->
    <main id="main-content" tabindex="-1">
        <!-- 面包屑导航 -->
        <section class="breadcrumb">
            <div class="container">
                <nav class="breadcrumb-nav" id="breadcrumb">
                    <!-- 面包屑导航将通过JavaScript动态生成 -->
                </nav>
            </div>
        </section>

        <!-- 文件夹英雄区域 -->
        <section class="folder-hero">
            <div class="container">
                <h1>文件夹内容</h1>
                <p>浏览特定文件夹下的所有文档，快速找到您需要的学习资源</p>
            </div>
        </section>

        <!-- 文件夹内容区域 -->
        <section class="folder-content">
            <div class="container">
                <!-- 文件夹标题和描述 -->
                <div class="folder-header" id="folder-header">
                    <!-- 文件夹标题和描述将通过JavaScript动态生成 -->
                </div>

                <!-- 过滤器和搜索区域 -->
                <div class="search-section">
                    <div class="filter-container">
                        <div class="filter-group">
                            <label for="difficulty-filter">难度:</label>
                            <select id="difficulty-filter" class="filter-select">
                                <option value="all">全部级别</option>
                                <option value="beginner">初级</option>
                                <option value="intermediate">中级</option>
                                <option value="advanced">高级</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="category-filter">分类:</label>
                            <select id="category-filter" class="filter-select">
                                <option value="all">全部分类</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="author-filter">作者:</label>
                            <select id="author-filter" class="filter-select">
                                <option value="all">全部作者</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="sort-filter">排序:</label>
                            <select id="sort-filter" class="filter-select">
                                <option value="order">按顺序</option>
                                <option value="title">按标题</option>
                                <option value="author">按作者</option>
                                <option value="last_updated">按更新时间</option>
                            </select>
                        </div>
                        <div class="view-toggle">
                            <button id="grid-view-btn" class="active" type="button" aria-pressed="true">网格视图</button>
                            <button id="list-view-btn" type="button" aria-pressed="false">列表视图</button>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" id="doc-search" class="search-input" placeholder="搜索此文件夹下的文档..."
                            aria-label="搜索此文件夹下的文档" autocomplete="off">
                        <button class="search-button" id="search-btn" type="button" aria-label="搜索">搜索</button>
                        <div class="search-results" id="search-results"></div>
                    </div>
                </div>

                <!-- 文档列表 -->
                <div class="doc-grid" id="doc-grid">
                    <!-- 文档卡片将通过JavaScript动态生成 -->
                </div>

                <!-- 无文档提示 -->
                <div class="no-docs" id="no-docs" style="display: none;">
                    <h3>该文件夹下暂无文档</h3>
                    <p>当前文件夹下没有找到任何文档，或者该文件夹不存在。</p>
                </div>

                <!-- 返回文档首页链接 -->
                <div class="back-to-docs">
                    <a href="index.html" class="btn">返回文档首页</a>
                </div>
            </div>
        </section>
    </main>

    <!-- 网站底部区域 -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>关于项目</h4>
                    <p>这是一个面向泰拉瑞亚Mod开发者的协作教程项目，旨在降低Mod制作门槛。</p>
                </div>
	                <div class="footer-section">
	                    <h4>快速链接</h4>
	                    <ul>
	                        <li><a href="../index.html">首页</a></li>
	                        <li><a href="index.html">文档</a></li>
	                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
	                    </ul>
	                </div>
                <div class="footer-section">
                    <h4>联系我们</h4>
                    <ul>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="mailto:contact@example.com">邮箱</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 泰拉瑞亚Mod制作教程. 采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC
                        BY 4.0</a> 许可协议。</p>
            </div>
        </div>
    </footer>

    <!-- 加载JavaScript文件 -->
    <script src="../assets/js/site-config.js"></script>
    <script src="../assets/js/folder-filter.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/marked.min.js"></script> <!-- Markdown解析库 -->
    <script src="../assets/js/prism.min.js"></script> <!-- 代码高亮库 -->
	    <script src="../assets/js/prism-csharp.min.js"></script> <!-- C#语言高亮支持 -->
	    <script src="../assets/js/search.js"></script>
	    <script src="../assets/js/navigation.js"></script>

	    <script>
	        // 文档配置和元数据管理 - 使用页面级变量避免冲突
	        let FOLDER_DOC_CONFIG = null;
	        let ALL_DOCS = [];
	        let FOLDER_DOCS = [];
	        let CURRENT_FOLDER = '';

	        function escapeHtml(text) {
	            return String(text)
	                .replace(/&/g, '&amp;')
	                .replace(/</g, '&lt;')
	                .replace(/>/g, '&gt;')
	                .replace(/"/g, '&quot;')
	                .replace(/'/g, '&#39;');
	        }

	        function normalizeDifficultyClass(difficulty) {
	            const allowed = ['beginner', 'intermediate', 'advanced'];
	            if (difficulty === 'all') return 'beginner';
	            return allowed.includes(difficulty) ? difficulty : 'beginner';
	        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== docs/folder.html: 页面加载完成 ===');

            // 获取URL参数中的文件夹路径
            const folderPath = getFolderPathFromURL();
            CURRENT_FOLDER = folderPath;
            updateFolderSeoMeta(folderPath);

            // 初始化文档配置
            initializeDocumentConfig().then(() => {
                // 筛选当前文件夹的文档
                filterDocumentsByFolder(folderPath);

                // 生成面包屑导航
                generateBreadcrumb(folderPath);

                // 生成文件夹标题和描述
                generateFolderHeader(folderPath);


                // 生成文档列表
                // 注意：这里不调用 generateDocumentGrid，因为 initFilterAndSortFunctionality 会处理
                // generateDocumentGrid();

                // 初始化搜索功能
                initSearchFunctionality();

                // 初始化过滤器和排序功能
                initFilterAndSortFunctionality();
            });
        });

        // 从URL参数获取文件夹路径
        function getFolderPathFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('path') || '';
        }

        function setMetaContent(selector, content) {
            const el = document.querySelector(selector);
            if (el && content) el.setAttribute('content', content);
        }

        function setCanonical(href) {
            let link = document.querySelector('link[rel="canonical"]');
            if (!link) {
                link = document.createElement('link');
                link.setAttribute('rel', 'canonical');
                document.head.appendChild(link);
            }
            link.setAttribute('href', href);
        }

        function updateFolderSeoMeta(folderPath) {
            const baseUrl = 'https://dpapyru.github.io/docs/folder.html';
            const url = folderPath ? `${baseUrl}?path=${encodeURIComponent(folderPath)}` : baseUrl;
            const title = folderPath ? `${folderPath} - 文件夹内容 - 泰拉瑞亚Mod制作教程` : '文件夹内容 - 泰拉瑞亚Mod制作教程';
            const description = folderPath
                ? `泰拉瑞亚Mod制作教程：浏览 "${folderPath}" 下的文档列表。`
                : '泰拉瑞亚Mod制作教程文档文件夹内容，提供特定文件夹下的所有文档列表。';

            document.title = title;
            setCanonical(url);
            setMetaContent('meta[name="description"]', description);
            setMetaContent('meta[property="og:title"]', title);
            setMetaContent('meta[property="og:description"]', description);
            setMetaContent('meta[property="og:url"]', url);
            setMetaContent('meta[name="twitter:title"]', title);
            setMetaContent('meta[name="twitter:description"]', description);
        }

        // 初始化文档配置
        async function initializeDocumentConfig() {
            try {
                console.log('folder.html: 正在加载配置文件，当前路径:', window.location.pathname);
                if (window.SiteConfig && typeof window.SiteConfig.load === 'function') {
                    FOLDER_DOC_CONFIG = await window.SiteConfig.load();
                } else {
                    const configResponse = await fetch('./config.json');
                    if (!configResponse.ok) throw new Error('无法加载config.json: ' + configResponse.status);
                    FOLDER_DOC_CONFIG = await configResponse.json();
                }
                console.log('成功加载配置文件:', FOLDER_DOC_CONFIG);
            } catch (error) {
                console.warn('加载配置文件失败，使用默认配置:', error);
                FOLDER_DOC_CONFIG = generateDefaultConfig();
            }

            // 从配置文件加载文档列表
            await loadDocumentsFromConfig();
        }

        // 获取分类图标 - 优先从配置文件读取，否则使用默认值
        function getCategoryIcon(categoryKey) {
            return '';
        }

        // 获取分类颜色 - 优先从配置文件读取，否则使用默认值
        function getCategoryColor(categoryKey) {
            // 首先尝试从配置文件中获取颜色
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[categoryKey] && FOLDER_DOC_CONFIG.categories[categoryKey].color) {
                return FOLDER_DOC_CONFIG.categories[categoryKey].color;
            }

            // 默认颜色映射
            const colorMap = {
                '入门': '#4CAF50',
                '进阶': '#2196F3',
                '高级': '#FF5722',
                '个人分享': '#FFC107',
                '怎么贡献': '#9C27B0',
                'Modder入门': '#00BCD4'
            };
            return colorMap[categoryKey] || '#28a745';
        }

        // 获取分类排序 - 优先从配置文件读取，否则使用默认值
        function getCategoryOrder(categoryKey) {
            // 首先尝试从配置文件中获取排序
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[categoryKey] && FOLDER_DOC_CONFIG.categories[categoryKey].order !== undefined) {
                return FOLDER_DOC_CONFIG.categories[categoryKey].order;
            }

            // 默认排序映射
            const orderMap = {
                '入门': 1,
                '进阶': 2,
                '高级': 3,
                '个人分享': 4,
                '怎么贡献': 5,
                'Modder入门': 6
            };
            return orderMap[categoryKey] || 999;
        }

        // 获取默认分类配置
        function getDefaultCategories() {
            return {
                "入门": {
                    "title": "入门",
                    "description": "适合初学者的基础教程",
                    "icon": "",
                    "color": "#4CAF50",
                    "order": 1
                },
                "进阶": {
                    "title": "进阶",
                    "description": "有一定基础后的进阶教程",
                    "icon": "",
                    "color": "#2196F3",
                    "order": 2
                },
                "高级": {
                    "title": "高级",
                    "description": "面向有经验开发者的高级教程",
                    "icon": "",
                    "color": "#FF5722",
                    "order": 3
                },
                "个人分享": {
                    "title": "个人分享",
                    "description": "社区成员的个人经验和技巧分享",
                    "icon": "",
                    "color": "#FFC107",
                    "order": 4
                },
                "怎么贡献": {
                    "title": "怎么贡献",
                    "description": "介绍贡献者应该怎么贡献文章",
                    "icon": "",
                    "color": "#9C27B0",
                    "order": 5,
                    "special": true
                },
                "Modder入门": {
                    "title": "Modder入门",
                    "description": "Modder入门相关的教程",
                    "icon": "",
                    "color": "#00BCD4",
                    "order": 6,
                    "special": true
                }
            };
        }

        // 获取默认主题配置
        function getDefaultTopics() {
            return {
                "mod-basics": {
                    "title": "Mod基础",
                    "description": "Mod开发的基础概念和核心API",
                    "icon": "",
                    "order": 1
                },
                "env": {
                    "title": "环境配置",
                    "description": "开发环境搭建和配置",
                    "icon": "",
                    "order": 2
                },
                "items": {
                    "title": "物品系统",
                    "description": "物品、武器和装备的开发",
                    "icon": "",
                    "order": 3
                },
                "npcs": {
                    "title": "NPC系统",
                    "description": "NPC的创建和行为定制",
                    "icon": "",
                    "order": 4
                },
                "world-gen": {
                    "title": "世界生成",
                    "description": "世界生成和地形修改",
                    "icon": "",
                    "order": 5
                },
                "ui": {
                    "title": "UI界面",
                    "description": "用户界面和交互设计",
                    "icon": "",
                    "order": 6
                },
                "networking": {
                    "title": "网络功能",
                    "description": "多人游戏和网络通信",
                    "icon": "",
                    "order": 7
                },
                "advanced": {
                    "title": "高级功能",
                    "description": "高级开发技巧和优化",
                    "icon": "",
                    "order": 8
                }
            };
        }

        // 生成默认配置（当config.json不存在时）
        function generateDefaultConfig() {
            const config = {
                _metadata: {
                    version: "2.0.0",
                    schema: "tmodloader-docs-v2",
                    created: new Date().toISOString().split('T')[0],
                    lastUpdated: new Date().toISOString().split('T')[0],
                    description: "泰拉瑞亚Mod制作教程配置文件 - 默认配置"
                },
                globalSettings: {
                    language: "zh",
                    theme: "default",
                    siteName: "泰拉瑞亚Mod制作教程",
                    siteDescription: "全面的泰拉瑞亚Mod开发教程资源",
                    baseUrl: "",
                    enableSearch: true,
                    enableDarkMode: true,
                    defaultOrder: 999,
                    dateFormat: "YYYY-MM-DD"
                },
                categories: {},
                topics: {},
                authors: {},
                all_files: [],
                pathMappings: {},
                settings: {
                    defaultCategory: "入门",
                    defaultTopic: "mod-basics",
                    specialCategories: ["怎么贡献", "Modder入门"]
                },
                extensions: {
                    customFields: {
                        difficulty: {
                            type: "select",
                            options: ["beginner", "intermediate", "advanced"],
                            default: "beginner",
                            required: false
                        }
                    }
                }
            };

            // 初始化分类结构
            const defaultCategories = getDefaultCategories();
            Object.keys(defaultCategories).forEach(categoryKey => {
                const category = defaultCategories[categoryKey];
                config.categories[categoryKey] = {
                    ...category,
                    topics: {
                        "mod-basics": {
                            title: "Mod基础",
                            description: "Mod开发的基础概念和核心API",
                            files: []
                        }
                    }
                };
            });

            // 初始化主题结构
            const defaultTopics = getDefaultTopics();
            Object.keys(defaultTopics).forEach(topicKey => {
                const topic = defaultTopics[topicKey];
                config.topics[topicKey] = {
                    ...topic,
                    display_names: {
                        "zh": topic.title,
                        "en": topic.title
                    },
                    aliases: [topic.title]
                };
            });

            return config;
        }

        // 从配置文件加载文档列表
        async function loadDocumentsFromConfig() {
            try {
                // 首先尝试从配置文件加载文档列表
                if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.all_files && FOLDER_DOC_CONFIG.all_files.length > 0) {
                    console.log('从配置文件加载文档列表');
                    ALL_DOCS = [...FOLDER_DOC_CONFIG.all_files];

                    // 确保每个文档都有必要的字段
                    ALL_DOCS = ALL_DOCS.map(doc => {
                        // 处理标签格式
                        let tags = [];
                        if (doc.tags) {
                            if (Array.isArray(doc.tags)) {
                                tags = doc.tags;
                            } else if (typeof doc.tags === 'string') {
                                // 处理可能的JSON字符串格式
                                try {
                                    const parsedTags = JSON.parse(doc.tags);
                                    tags = Array.isArray(parsedTags) ? parsedTags : [parsedTags];
                                } catch (e) {
                                    // 如果不是JSON，按逗号分割
                                    tags = doc.tags.split(',').map(t => t.trim());
                                }
                            }
                        }

                        // 尝试从分类的topics中获取description
                        let description = doc.description || '';
                        if (!description && doc.category && doc.topic && FOLDER_DOC_CONFIG.categories &&
                            FOLDER_DOC_CONFIG.categories[doc.category] &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic] &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic].files) {
                            
                            const topicFiles = FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic].files;
                            const matchingFile = topicFiles.find(file => file.filename === doc.filename);
                            if (matchingFile && matchingFile.description) {
                                description = matchingFile.description;
                            }
                        }

                        return {
                            filename: doc.filename,
                            path: doc.path || doc.filename,
                            title: doc.title || doc.filename.replace('.md', ''),
                            author: doc.author || '未知',
                            category: doc.category || '入门',
                            topic: doc.topic || 'mod-basics',
                            order: parseInt(doc.order) || 999,
                            description: description,
                            tags: tags,
                            last_updated: doc.last_updated || '未知',
                            difficulty: doc.difficulty || 'beginner'
                        };
                    });

                    console.log('从配置文件加载的文档:', ALL_DOCS);
                    return;
                }
            } catch (error) {
                console.error('从配置文件加载文档失败:', error);
                ALL_DOCS = [];
            }
        }

        // 根据文件夹路径筛选文档
        function filterDocumentsByFolder(folderPath) {
            if (!folderPath) {
                console.warn('未提供文件夹路径');
                FOLDER_DOCS = [];
                return;
            }

            console.log(`筛选文件夹 "${folderPath}" 下的文档`);

            // 筛选路径匹配指定文件夹的文档
            FOLDER_DOCS = ALL_DOCS.filter(doc => {
                if (!doc.path) return false;
                return FolderFilter.matchesFolderPath(doc.path, folderPath);
            });

            console.log(`找到 ${FOLDER_DOCS.length} 个文档:`, FOLDER_DOCS);
        }

        // 生成面包屑导航
        function generateBreadcrumb(folderPath) {
            const breadcrumb = document.getElementById('breadcrumb');

            if (!breadcrumb) return;

            breadcrumb.innerHTML = '';

            // 首页链接
            const homeItem = document.createElement('div');
            homeItem.className = 'breadcrumb-item';
            homeItem.innerHTML = '<a href="../index.html">首页</a>';
            breadcrumb.appendChild(homeItem);

            // 文档首页链接
            const docsItem = document.createElement('div');
            docsItem.className = 'breadcrumb-item';
            docsItem.innerHTML = '<a href="index.html">文档</a>';
            breadcrumb.appendChild(docsItem);

            // 当前文件夹
            if (folderPath) {
                const folderItem = document.createElement('div');
                folderItem.className = 'breadcrumb-item active';
                folderItem.textContent = folderPath;
                breadcrumb.appendChild(folderItem);
            }
        }

        // 生成文件夹标题和描述
	        function generateFolderHeader(folderPath) {
	            const folderHeader = document.getElementById('folder-header');

            if (!folderHeader) return;

            if (!folderPath) {
                folderHeader.innerHTML = `
                    <h2 class="folder-title">未指定文件夹</h2>
                    <p class="folder-description">请在URL参数中指定要查看的文件夹路径，例如: folder.html?path=Modder入门</p>
                `;
                return;
            }

            // 尝试从配置中获取文件夹信息
            let folderDescription = '';

            // 检查是否是分类名称
            if (FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[folderPath]) {
                folderDescription = FOLDER_DOC_CONFIG.categories[folderPath].description || '';
            }

	            // 生成文件夹标题和描述
	            folderHeader.innerHTML = `
	                <h2 class="folder-title">${escapeHtml(folderPath)}</h2>
	                <p class="folder-description">${escapeHtml(folderDescription || `浏览 "${folderPath}" 文件夹下的所有文档`)}</p>
	            `;
	        }

        function buildSubfolderSection(folderPath) {
            const existingSection = document.getElementById('subfolder-section');
            const container = existingSection || document.createElement('div');

            container.id = 'subfolder-section';
            container.className = 'subfolder-section';
            container.innerHTML = '';

            if (container.parentNode) {
                container.parentNode.removeChild(container);
            }

            if (!folderPath || !window.FolderFilter ||
                typeof window.FolderFilter.buildSubfolderEntries !== 'function') {
                return null;
            }

            const docPaths = FOLDER_DOCS.map(doc => doc.path || doc.filename).filter(Boolean);
            const entries = window.FolderFilter.buildSubfolderEntries(docPaths, folderPath);
            if (entries.length === 0) return null;

            const list = document.createElement('ul');
            list.className = 'subfolder-list';

            entries.forEach(entry => {
                const item = document.createElement('li');
                item.className = 'subfolder-item';

                const link = document.createElement('a');
                link.className = 'subfolder-link';
                link.href = `folder.html?path=${encodeURIComponent(entry.path)}`;
                link.textContent = entry.label;

                item.appendChild(link);
                list.appendChild(item);
            });

            container.appendChild(list);
            container.style.gridColumn = '1 / -1';

            return container;
        }

        // 生成文档列表
        function generateDocumentGrid() {
            // 这个函数现在由 applyAllFiltersAndSort 代替
            // 保留此函数是为了向后兼容，但实际功能已移至 applyAllFiltersAndSort
            if (typeof applyAllFiltersAndSort === 'function') {
                applyAllFiltersAndSort();
            } else {
                // 如果 applyAllFiltersAndSort 尚未定义，则使用原始逻辑
                const docGrid = document.getElementById('doc-grid');
                const noDocs = document.getElementById('no-docs');

                if (!docGrid || !noDocs) return;

                // 清空现有内容
                docGrid.innerHTML = '';

                const subfolderSection = buildSubfolderSection(CURRENT_FOLDER);
                const hasSubfolders = !!subfolderSection;

                if (FOLDER_DOCS.length === 0 && !hasSubfolders) {
                    // 显示无文档提示
                    docGrid.style.display = 'none';
                    noDocs.style.display = 'block';
                    return;
                }

                // 显示文档网格
                docGrid.style.display = 'grid';
                noDocs.style.display = 'none';

                if (hasSubfolders) {
                    docGrid.appendChild(subfolderSection);
                }

                // 按排序字段排序文档
                const sortedDocs = [...FOLDER_DOCS].sort((a, b) => {
                    return a.order - b.order;
                });

                // 生成文档卡片
                sortedDocs.forEach(doc => {
                    const docCard = document.createElement('div');
                    docCard.className = 'doc-card';

	                    const difficultyClass = normalizeDifficultyClass(doc.difficulty);
	                    const difficultyText = getDifficultyText(doc.difficulty);

                    // 生成标签HTML
	                    let tagsHtml = '';
	                    if (doc.tags && doc.tags.length > 0) {
	                        tagsHtml = doc.tags.map(tag => `<span class="doc-tag">${escapeHtml(tag)}</span>`).join('');
	                    }

                    // 处理描述
	                    let description = '暂无描述';
	                    if (doc.description && typeof doc.description === 'string' && doc.description.trim() !== '') {
	                        description = doc.description;
	                    }

	                    docCard.innerHTML = `
	                        <div class="doc-card-header">
	                            <h3 class="doc-title">${escapeHtml(doc.title)}</h3>
	                            <div class="doc-meta">
	                                <div class="doc-meta-item">
	                                    <span class="difficulty-badge ${difficultyClass}">${escapeHtml(difficultyText)}</span>
	                                </div>
	                                <div class="doc-meta-item">
	                                    <span>作者: ${escapeHtml(doc.author)}</span>
	                                </div>
	                                <div class="doc-meta-item">
	                                    <span>更新: ${escapeHtml(doc.last_updated)}</span>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="doc-card-body">
	                            <p class="doc-description">${escapeHtml(description)}</p>
	                            ${tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : ''}
	                        </div>
	                        <div class="doc-card-footer">
	                            <div class="doc-author">作者: ${escapeHtml(doc.author)}</div>
	                            <a href="viewer.html?file=${encodeURIComponent(doc.path)}" class="doc-link">查看文档</a>
	                        </div>
	                    `;

                    docGrid.appendChild(docCard);
                });
            }
        }

        // 获取难度文本 - 优先从配置文件读取，否则使用默认值
        function getDifficultyText(difficulty) {
            // 首先尝试从配置文件中获取难度映射
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.extensions && FOLDER_DOC_CONFIG.extensions.customFields &&
                FOLDER_DOC_CONFIG.extensions.customFields.difficulty && FOLDER_DOC_CONFIG.extensions.customFields.difficulty.options) {
                const difficultyOptions = FOLDER_DOC_CONFIG.extensions.customFields.difficulty.options;
                const difficultyMap = {
                    'beginner': '初级',
                    'intermediate': '中级',
                    'advanced': '高级',
                    'all': '全部级别'
                };

                // 如果配置中有自定义映射，使用配置中的映射
                if (difficultyOptions.includes(difficulty)) {
                    return difficultyMap[difficulty] || difficulty;
                }
            }

            // 默认难度映射
            const defaultDifficultyMap = {
                'beginner': '初级',
                'intermediate': '中级',
                'advanced': '高级',
                'all': '全部级别'
            };
            return defaultDifficultyMap[difficulty] || difficulty;
        }

        // 初始化搜索功能
        function initSearchFunctionality() {
            const searchInput = document.getElementById('doc-search');
            const searchButton = document.getElementById('search-btn');
            const searchResults = document.getElementById('search-results');

            if (!searchInput || !searchButton || !searchResults) return;

            // 搜索输入事件
            searchInput.addEventListener('input', function () {
                const query = this.value.trim().toLowerCase();

                if (query.length === 0) {
                    // 显示所有文档，但应用当前的过滤器和排序
                    applyAllFiltersAndSort();
                    searchResults.style.display = 'none';
                    return;
                }

                // 先应用过滤器，然后在这些结果中搜索
                let filteredDocs = applyCurrentFilters();

                // 在过滤后的结果中搜索
                const results = filteredDocs.filter(doc =>
                    doc.title.toLowerCase().includes(query) ||
                    doc.author.toLowerCase().includes(query) ||
                    (doc.description && doc.description.toLowerCase().includes(query)) ||
                    (doc.tags && doc.tags.some(tag => tag.toLowerCase().includes(query)))
                );

                // 应用当前排序
                const sortFilter = document.getElementById('sort-filter');
                const sortValue = sortFilter ? sortFilter.value : 'order';
                const sortedResults = sortDocuments(results, sortValue);

                // 显示搜索结果
                displaySearchResults(sortedResults);
                updateDocumentGridWithFilteredDocs(sortedResults);
            });

            // 搜索按钮点击事件
            searchButton.addEventListener('click', function () {
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // 搜索输入框回车事件
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });

            // 点击其他地方关闭搜索结果
            document.addEventListener('click', function (e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });

            // 显示搜索结果
	        function displaySearchResults(results) {
	            searchResults.innerHTML = '';

                if (results.length === 0) {
                    searchResults.innerHTML = `
                        <div class="search-result-item">
                            <div class="search-result-title">没有找到匹配的文档</div>
                            <div class="search-result-meta">请尝试其他关键词</div>
                        </div>
                    `;
                } else {
	                results.forEach(result => {
	                    const resultItem = document.createElement('div');
	                    resultItem.className = 'search-result-item';

	                    resultItem.innerHTML = `
	                        <div class="search-result-title">${escapeHtml(result.title)}</div>
	                        <div class="search-result-meta">作者: ${escapeHtml(result.author)} | 更新: ${escapeHtml(result.last_updated)}</div>
	                    `;

                        resultItem.addEventListener('click', function () {
                            window.location.href = `viewer.html?file=${encodeURIComponent(result.path)}`;
                        });

                        searchResults.appendChild(resultItem);
                    });
                }

                searchResults.style.display = 'block';
            }


            // 执行搜索
            function performSearch(query) {
                // 先应用过滤器，然后在这些结果中搜索
                let filteredDocs = applyCurrentFilters();

                const results = filteredDocs.filter(doc =>
                    doc.title.toLowerCase().includes(query.toLowerCase()) ||
                    doc.author.toLowerCase().includes(query.toLowerCase()) ||
                    (doc.description && doc.description.toLowerCase().includes(query.toLowerCase())) ||
                    (doc.tags && doc.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase())))
                );

                // 应用当前排序
                const sortFilter = document.getElementById('sort-filter');
                const sortValue = sortFilter ? sortFilter.value : 'order';
                const sortedResults = sortDocuments(results, sortValue);

                if (sortedResults.length === 0) {
                    alert('没有找到匹配的文档，请尝试其他关键词');
                } else if (sortedResults.length === 1) {
                    // 如果只有一个结果，直接跳转
                    window.location.href = `viewer.html?file=${encodeURIComponent(sortedResults[0].path)}`;
                } else {
                    // 如果有多个结果，更新文档网格
                    updateDocumentGridWithFilteredDocs(sortedResults);
                    searchInput.value = query;
                }
            }
        }

        // 初始化过滤器
        function initializeFilters() {
            // 填充分类过滤器选项
            if (categoryFilter && FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories) {
                categoryFilter.innerHTML = '<option value="all">全部分类</option>';
                Object.keys(FOLDER_DOC_CONFIG.categories).forEach(categoryKey => {
                    const category = FOLDER_DOC_CONFIG.categories[categoryKey];
                    const option = document.createElement('option');
                    option.value = categoryKey;
                    option.textContent = category.title || categoryKey;
                    categoryFilter.appendChild(option);
                });
            }

            // 填充作者过滤器选项
            if (authorFilter && ALL_DOCS.length > 0) {
                const authors = [...new Set(ALL_DOCS.map(doc => doc.author))].sort();
                authorFilter.innerHTML = '<option value="all">全部作者</option>';
                authors.forEach(author => {
                    const option = document.createElement('option');
                    option.value = author;
                    option.textContent = author;
                    authorFilter.appendChild(option);
                });
            }

            // 添加过滤器事件监听器
            if (difficultyFilter) {
                difficultyFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (categoryFilter) {
                categoryFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (authorFilter) {
                authorFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (sortFilter) {
                sortFilter.addEventListener('change', applyFiltersAndSort);
            }
        }

        // 初始化视图切换
        function initializeViewToggle() {
            if (gridViewBtn && listViewBtn) {
                gridViewBtn.addEventListener('click', function () {
                    gridViewBtn.classList.add('active');
                    listViewBtn.classList.remove('active');
                    document.getElementById('doc-grid').classList.remove('list-view');
                });

                listViewBtn.addEventListener('click', function () {
                    listViewBtn.classList.add('active');
                    gridViewBtn.classList.remove('active');
                    document.getElementById('doc-grid').classList.add('list-view');
                });
            }
        }

        // 应用过滤器和排序
        function applyFiltersAndSort() {
            let filteredDocs = [...FOLDER_DOCS];

            // 应用难度过滤器
            if (difficultyFilter && difficultyFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.difficulty === difficultyFilter.value);
            }

            // 应用分类过滤器
            if (categoryFilter && categoryFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.category === categoryFilter.value);
            }

            // 应用作者过滤器
            if (authorFilter && authorFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.author === authorFilter.value);
            }

            // 应用排序
            if (sortFilter) {
                const sortBy = sortFilter.value;
                filteredDocs.sort((a, b) => {
                    switch (sortBy) {
                        case 'title':
                            return a.title.localeCompare(b.title, 'zh-CN');
                        case 'author':
                            return a.author.localeCompare(b.author, 'zh-CN');
                        case 'last_updated':
                            return new Date(b.last_updated || 0) - new Date(a.last_updated || 0);
                        case 'order':
                        default:
                            return (a.order || 999) - (b.order || 999);
                    }
                });
            }

            // 更新文档网格
            updateDocumentGrid(filteredDocs);
        }

        // 应用所有过滤器和排序
        function applyAllFiltersAndSort() {
            const sortFilter = document.getElementById('sort-filter');
            const sortValue = sortFilter ? sortFilter.value : 'order';

            let filteredDocs = applyCurrentFilters();
            filteredDocs = sortDocuments(filteredDocs, sortValue);

            updateDocumentGridWithFilteredDocs(filteredDocs);
        }

        // 应用当前过滤器（不应用排序）
        function applyCurrentFilters() {
            let filteredDocs = [...FOLDER_DOCS];

            const difficultyFilter = document.getElementById('difficulty-filter');
            const categoryFilter = document.getElementById('category-filter');
            const authorFilter = document.getElementById('author-filter');

            // 应用难度过滤器
            if (difficultyFilter && difficultyFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.difficulty === difficultyFilter.value);
            }

            // 应用分类过滤器
            if (categoryFilter && categoryFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.category === categoryFilter.value);
            }

            // 应用作者过滤器
            if (authorFilter && authorFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.author === authorFilter.value);
            }

            return filteredDocs;
        }

        // 初始化过滤器和排序功能
        function initFilterAndSortFunctionality() {
            const difficultyFilter = document.getElementById('difficulty-filter');
            const categoryFilter = document.getElementById('category-filter');
            const authorFilter = document.getElementById('author-filter');
            const sortFilter = document.getElementById('sort-filter');
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            const docGrid = document.getElementById('doc-grid');

            if (!difficultyFilter || !categoryFilter || !authorFilter || !sortFilter || !gridViewBtn || !listViewBtn || !docGrid) {
                console.error('无法找到过滤器和排序控件');
                return;
            }

            // 填充分类过滤器选项
            populateCategoryFilter();

            // 填充作者过滤器选项
            populateAuthorFilter();

            // 难度过滤器事件
            difficultyFilter.addEventListener('change', applyAllFiltersAndSort);

            // 分类过滤器事件
            categoryFilter.addEventListener('change', applyAllFiltersAndSort);

            // 作者过滤器事件
            authorFilter.addEventListener('change', applyAllFiltersAndSort);

            // 排序过滤器事件
            sortFilter.addEventListener('change', applyAllFiltersAndSort);

            // 网格视图切换事件
            gridViewBtn.addEventListener('click', function () {
                docGrid.classList.remove('list-view');
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
                gridViewBtn.setAttribute('aria-pressed', 'true');
                listViewBtn.setAttribute('aria-pressed', 'false');
            });

            // 列表视图切换事件
            listViewBtn.addEventListener('click', function () {
                docGrid.classList.add('list-view');
                listViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
                listViewBtn.setAttribute('aria-pressed', 'true');
                gridViewBtn.setAttribute('aria-pressed', 'false');
            });

            // 初始应用过滤器和排序
            applyAllFiltersAndSort();
        }

        // 填充分类过滤器选项
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('category-filter');
            if (!categoryFilter) return;

            // 获取所有唯一的分类
            const categories = [...new Set(FOLDER_DOCS.map(doc => doc.category))];

            // 清空现有选项（保留"全部分类"）
            categoryFilter.innerHTML = '<option value="all">全部分类</option>';

            // 添加分类选项
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // 填充作者过滤器选项
        function populateAuthorFilter() {
            const authorFilter = document.getElementById('author-filter');
            if (!authorFilter) return;

            // 获取所有唯一的作者
            const authors = [...new Set(FOLDER_DOCS.map(doc => doc.author))];

            // 清空现有选项（保留"全部作者"）
            authorFilter.innerHTML = '<option value="all">全部作者</option>';

            // 添加作者选项
            authors.forEach(author => {
                const option = document.createElement('option');
                option.value = author;
                option.textContent = author;
                authorFilter.appendChild(option);
            });
        }

        // 排序文档
        function sortDocuments(docs, sortType) {
            const sortedDocs = [...docs];

            switch (sortType) {
                case 'order':
                    sortedDocs.sort((a, b) => a.order - b.order);
                    break;
                case 'title':
                    sortedDocs.sort((a, b) => a.title.localeCompare(b.title, 'zh-CN'));
                    break;
                case 'author':
                    sortedDocs.sort((a, b) => a.author.localeCompare(b.author, 'zh-CN'));
                    break;
                case 'last_updated':
                    sortedDocs.sort((a, b) => {
                        // 尝试将日期字符串转换为Date对象进行比较
                        const dateA = new Date(a.last_updated);
                        const dateB = new Date(b.last_updated);

                        // 如果日期无效，则按字符串比较
                        if (isNaN(dateA.getTime()) || isNaN(dateB.getTime())) {
                            return b.last_updated.localeCompare(a.last_updated);
                        }

                        return dateB.getTime() - dateA.getTime(); // 降序排列，最新的在前
                    });
                    break;
                default:
                    // 默认按顺序排序
                    sortedDocs.sort((a, b) => a.order - b.order);
            }

            return sortedDocs;
        }

        // 使用过滤后的文档更新文档网格
        function updateDocumentGridWithFilteredDocs(filteredDocs) {
            const docGrid = document.getElementById('doc-grid');
            const noDocs = document.getElementById('no-docs');

            if (!docGrid || !noDocs) return;

            // 清空现有内容
            docGrid.innerHTML = '';

            const subfolderSection = buildSubfolderSection(CURRENT_FOLDER);
            const hasSubfolders = !!subfolderSection;

            if (filteredDocs.length === 0 && !hasSubfolders) {
                // 显示无文档提示
                docGrid.style.display = 'none';
                noDocs.style.display = 'block';
                noDocs.innerHTML = `
                    <h3>没有找到匹配的文档</h3>
                    <p>没有找到与过滤条件匹配的文档，请尝试调整过滤条件。</p>
                `;
                return;
            }

            // 显示文档网格
            docGrid.style.display = 'grid';
            noDocs.style.display = 'none';

            if (hasSubfolders) {
                docGrid.appendChild(subfolderSection);
            }

            // 生成文档卡片
            filteredDocs.forEach(doc => {
                const docCard = document.createElement('div');
                docCard.className = 'doc-card';

                const difficultyClass = doc.difficulty === 'all' ? 'beginner' : doc.difficulty;
                const difficultyText = getDifficultyText(doc.difficulty);

                // 生成标签HTML
                let tagsHtml = '';
                if (doc.tags && doc.tags.length > 0) {
                    tagsHtml = doc.tags.map(tag => `<span class="doc-tag">${tag}</span>`).join('');
                }

                // 卡片简介
                let description = '暂无描述';
                if (doc.description && typeof doc.description === 'string' && doc.description.trim() !== '') {
                    description = doc.description;
                }

                docCard.innerHTML = `
                    <div class="doc-card-header">
                        <h3 class="doc-title">${doc.title}</h3>
                        <div class="doc-meta">
                            <div class="doc-meta-item">
                                <span class="difficulty-badge ${difficultyClass}">${difficultyText}</span>
                            </div>
                            <div class="doc-meta-item">
                                <span>作者: ${doc.author}</span>
                            </div>
                            <div class="doc-meta-item">
                                <span>更新: ${doc.last_updated}</span>
                            </div>
                        </div>
                    </div>
                    <div class="doc-card-body">
                        <p class="doc-description">${description}</p>
                        ${tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : ''}
                    </div>
                    <div class="doc-card-footer">
                        <div class="doc-author">作者: ${doc.author}</div>
                        <a href="viewer.html?file=${encodeURIComponent(doc.path)}" class="doc-link">查看文档</a>
                    </div>
                `;

                docGrid.appendChild(docCard);
            });
        }
    </script>
</body>

</html>
