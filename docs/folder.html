<!DOCTYPE html>
<!-- æ–‡ä»¶å¤¹å†…å®¹æ˜¾ç¤ºé¡µé¢ -->
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶å¤¹å†…å®¹ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹</title>

    <!-- SEOä¼˜åŒ–æ ‡ç­¾ -->
    <meta name="description" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£æ–‡ä»¶å¤¹å†…å®¹ï¼Œæä¾›ç‰¹å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨">
    <meta name="keywords" content="æ³°æ‹‰ç‘äºš,Mod,æ•™ç¨‹,æ–‡æ¡£,æ–‡ä»¶å¤¹,tModLoader">
    <meta name="author" content="æ³°æ‹‰ç‘äºšModç¤¾åŒº">
    <meta name="robots" content="index, follow">

    <!-- Open Graphæ ‡ç­¾ -->
    <meta property="og:title" content="æ–‡ä»¶å¤¹å†…å®¹ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹">
    <meta property="og:description" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£æ–‡ä»¶å¤¹å†…å®¹ï¼Œæä¾›ç‰¹å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dpapyru.github.io/docs/folder.html">

    <!-- æ ·å¼å’Œå›¾æ ‡ -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/prism.min.css">
    <link rel="stylesheet" href="../assets/css/vs2022-theme.css">
    <link rel="icon" type="image/png" href="../assets/imgs/Green_tModLoader.png">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        /* æ–‡ä»¶å¤¹é¡µé¢ç‰¹å®šæ ·å¼ */
        .folder-hero {
            background: linear-gradient(0deg, #155724, #28a745, #155724);
            color: white;
            padding: 40px 0;
            text-align: center;
        }

        .folder-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .folder-hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }

        .breadcrumb {
            background-color: #f8f9fa;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .breadcrumb-nav {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
        }

        .breadcrumb-item:not(:last-child)::after {
            content: "â€º";
            margin: 0 10px;
            color: #6c757d;
        }

        .breadcrumb-item a {
            color: #007bff;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .breadcrumb-item a:hover {
            color: #0056b3;
            text-decoration: underline;
        }

        .breadcrumb-item.active {
            color: #6c757d;
            font-weight: 500;
        }

        .folder-content {
            padding: 40px 0;
        }

        .folder-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .folder-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #333;
        }

        .folder-description {
            font-size: 1.1rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .view-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .view-toggle button {
            background: none;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-toggle button.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .search-section {
            background-color: #f8f9fa;
            padding: 30px 0;
            border-radius: 8px;
            margin-bottom: 40px;
        }

        .search-container {
            display: flex;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 1px solid #ddd;
            border-radius: 50px;
            font-size: 1rem;
            outline: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }

        .search-button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-button:hover {
            background-color: #0056b3;
        }

        .doc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .doc-grid.list-view {
            grid-template-columns: 1fr;
            gap: 10px;
        }

        .doc-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .doc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .doc-card-header {
            padding: 20px;
            border-bottom: 1px solid #f1f3f4;
        }

        .doc-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .doc-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        .doc-meta-item {
            display: flex;
            align-items: center;
        }

        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .difficulty-badge.beginner {
            background-color: #d4edda;
            color: #155724;
        }

        .difficulty-badge.intermediate {
            background-color: #fff3cd;
            color: #856404;
        }

        .difficulty-badge.advanced {
            background-color: #f8d7da;
            color: #721c24;
        }

        .doc-card-body {
            padding: 20px;
        }

        .doc-description {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .doc-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .doc-tag {
            background-color: #e9ecef;
            color: #495057;
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .doc-card-footer {
            padding: 15px 20px;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .doc-author {
            font-size: 0.9rem;
            color: #666;
        }

        .doc-link {
            display: inline-block;
            background-color: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
        }

        .doc-link:hover {
            background-color: #0056b3;
        }

        .no-docs {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-docs-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .no-docs h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .no-docs p {
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .back-to-docs {
            text-align: center;
            margin-top: 40px;
        }

        .back-to-docs .btn {
            display: inline-block;
            background-color: #6c757d;
            color: white;
            padding: 12px 25px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 1rem;
            transition: background-color 0.2s ease;
        }

        .back-to-docs .btn:hover {
            background-color: #5a6268;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #fff;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-result-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
        }

        .search-result-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .search-result-meta {
            font-size: 0.85rem;
            color: #666;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .folder-hero h1 {
                font-size: 2rem;
            }

            .folder-hero p {
                font-size: 1rem;
            }

            .doc-grid {
                grid-template-columns: 1fr;
            }

            .folder-title {
                font-size: 1.5rem;
            }
        }

        /* æ–‡ä»¶å¤¹é¡µé¢ç‰¹å®šæ ·å¼å·²ç§»è‡³ theme-base.cssï¼Œä½¿ç”¨CSSå˜é‡ç³»ç»Ÿ */
    </style>
</head>

<body>
    <!-- ç½‘ç«™å¤´éƒ¨å¯¼èˆªåŒºåŸŸ -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <!-- ç½‘ç«™logoå’Œæ ‡é¢˜ -->
                <div class="logo">
                    <a href="../index.html">
                        <img src="../assets/imgs/Green_tModLoader.png" alt="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹" class="logo-image">
                        <h1 class="site-title">æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹</h1>
                    </a>
                </div>
                <!-- ä¸»å¯¼èˆªèœå• -->
                <nav class="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">é¦–é¡µ</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link">æ–‡æ¡£</a></li>
                        <li class="nav-item"><a href="editor.html" class="nav-link">æ–‡æ¡£ç¼–è¾‘å™¨</a></li>
                        <li class="nav-item"><a href="https://github.com/DPapyru/DPapyru.github.io" class="nav-link"
                                target="_blank">GitHub</a></li>
                        <li class="nav-item" id="theme-toggle-container">
                            <button class="theme-toggle-btn nav-link" aria-label="åˆ‡æ¢ä¸»é¢˜">
                                <span class="theme-icon">ğŸŒ™</span>
                                <span class="theme-text">æ·±è‰²</span>
                            </button>
                        </li>
                    </ul>
                </nav>
                <!-- ç§»åŠ¨ç«¯èœå•åˆ‡æ¢æŒ‰é’® -->
                <button class="mobile-menu-toggle" aria-label="åˆ‡æ¢èœå•">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- æ–‡ä»¶å¤¹é¡µé¢ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <main>
        <!-- é¢åŒ…å±‘å¯¼èˆª -->
        <section class="breadcrumb">
            <div class="container">
                <nav class="breadcrumb-nav" id="breadcrumb">
                    <!-- é¢åŒ…å±‘å¯¼èˆªå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </nav>
            </div>
        </section>

        <!-- æ–‡ä»¶å¤¹è‹±é›„åŒºåŸŸ -->
        <section class="folder-hero">
            <div class="container">
                <h1>æ–‡ä»¶å¤¹å†…å®¹</h1>
                <p>æµè§ˆç‰¹å®šæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡æ¡£ï¼Œå¿«é€Ÿæ‰¾åˆ°æ‚¨éœ€è¦çš„å­¦ä¹ èµ„æº</p>
            </div>
        </section>

        <!-- æ–‡ä»¶å¤¹å†…å®¹åŒºåŸŸ -->
        <section class="folder-content">
            <div class="container">
                <!-- æ–‡ä»¶å¤¹æ ‡é¢˜å’Œæè¿° -->
                <div class="folder-header" id="folder-header">
                    <!-- æ–‡ä»¶å¤¹æ ‡é¢˜å’Œæè¿°å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- è¿‡æ»¤å™¨å’Œæœç´¢åŒºåŸŸ -->
                <div class="search-section">
                    <div class="filter-container">
                        <div class="filter-group">
                            <label for="difficulty-filter">éš¾åº¦:</label>
                            <select id="difficulty-filter" class="filter-select">
                                <option value="all">å…¨éƒ¨çº§åˆ«</option>
                                <option value="beginner">åˆçº§</option>
                                <option value="intermediate">ä¸­çº§</option>
                                <option value="advanced">é«˜çº§</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="category-filter">åˆ†ç±»:</label>
                            <select id="category-filter" class="filter-select">
                                <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="author-filter">ä½œè€…:</label>
                            <select id="author-filter" class="filter-select">
                                <option value="all">å…¨éƒ¨ä½œè€…</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="sort-filter">æ’åº:</label>
                            <select id="sort-filter" class="filter-select">
                                <option value="order">æŒ‰é¡ºåº</option>
                                <option value="title">æŒ‰æ ‡é¢˜</option>
                                <option value="author">æŒ‰ä½œè€…</option>
                                <option value="last_updated">æŒ‰æ›´æ–°æ—¶é—´</option>
                            </select>
                        </div>
                        <div class="view-toggle">
                            <button id="grid-view-btn" class="active">ç½‘æ ¼è§†å›¾</button>
                            <button id="list-view-btn">åˆ—è¡¨è§†å›¾</button>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" id="doc-search" class="search-input" placeholder="æœç´¢æ­¤æ–‡ä»¶å¤¹ä¸‹çš„æ–‡æ¡£..."
                            autocomplete="off">
                        <button class="search-button" id="search-btn">ğŸ”</button>
                        <div class="search-results" id="search-results"></div>
                    </div>
                </div>

                <!-- æ–‡æ¡£åˆ—è¡¨ -->
                <div class="doc-grid" id="doc-grid">
                    <!-- æ–‡æ¡£å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <!-- æ— æ–‡æ¡£æç¤º -->
                <div class="no-docs" id="no-docs" style="display: none;">
                    <div class="no-docs-icon">ğŸ“‚</div>
                    <h3>è¯¥æ–‡ä»¶å¤¹ä¸‹æš‚æ— æ–‡æ¡£</h3>
                    <p>å½“å‰æ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ–‡æ¡£ï¼Œæˆ–è€…è¯¥æ–‡ä»¶å¤¹ä¸å­˜åœ¨ã€‚</p>
                </div>

                <!-- è¿”å›æ–‡æ¡£é¦–é¡µé“¾æ¥ -->
                <div class="back-to-docs">
                    <a href="index.html" class="btn">è¿”å›æ–‡æ¡£é¦–é¡µ</a>
                </div>
            </div>
        </section>
    </main>

    <!-- ç½‘ç«™åº•éƒ¨åŒºåŸŸ -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>å…³äºé¡¹ç›®</h4>
                    <p>è¿™æ˜¯ä¸€ä¸ªé¢å‘æ³°æ‹‰ç‘äºšModå¼€å‘è€…çš„åä½œæ•™ç¨‹é¡¹ç›®ï¼Œæ—¨åœ¨é™ä½Modåˆ¶ä½œé—¨æ§›ã€‚</p>
                </div>
                <div class="footer-section">
                    <h4>å¿«é€Ÿé“¾æ¥</h4>
                    <ul>
                        <li><a href="../index.html">é¦–é¡µ</a></li>
                        <li><a href="index.html">æ–‡æ¡£</a></li>
                        <li><a href="editor.html">æ–‡æ¡£ç¼–è¾‘å™¨</a></li>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank">GitHub</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>è”ç³»æˆ‘ä»¬</h4>
                    <ul>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank">GitHub</a></li>
                        <li><a href="mailto:contact@example.com">é‚®ç®±</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹. é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC
                        BY 4.0</a> è®¸å¯åè®®ã€‚</p>
            </div>
        </div>
    </footer>

    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/marked.min.js"></script> <!-- Markdownè§£æåº“ -->
    <script src="../assets/js/prism.min.js"></script> <!-- ä»£ç é«˜äº®åº“ -->
    <script src="../assets/js/prism-csharp.min.js"></script> <!-- C#è¯­è¨€é«˜äº®æ”¯æŒ -->
    <script src="../assets/js/search.js"></script>
    <script src="../assets/js/navigation.js"></script>
    <script src="../assets/js/theme-toggle.js"></script> <!-- ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ -->

    <script>
        // æ–‡æ¡£é…ç½®å’Œå…ƒæ•°æ®ç®¡ç† - ä½¿ç”¨é¡µé¢çº§å˜é‡é¿å…å†²çª
        let FOLDER_DOC_CONFIG = null;
        let ALL_DOCS = [];
        let FOLDER_DOCS = [];
        let CURRENT_FOLDER = '';

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== docs/folder.html: é¡µé¢åŠ è½½å®Œæˆ ===');

            // åˆå§‹åŒ–ç§»åŠ¨ç«¯èœå•
            initMobileMenu();

            // åº”ç”¨ä¿å­˜çš„ä¸»é¢˜åå¥½
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }

            // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½ - ä½¿ç”¨æ ‡å‡†çš„ThemeToggleç±»
            if (typeof ThemeToggle !== 'undefined') {
                // åˆ›å»ºThemeToggleå®ä¾‹ï¼Œä½†ç¦ç”¨æŒ‰é’®åˆ›å»ºä»¥ä½¿ç”¨é¡µé¢ä¸­å·²æœ‰çš„æŒ‰é’®
                const themeToggle = new ThemeToggle();
                // é‡å†™createThemeToggleButtonæ–¹æ³•ï¼Œé˜²æ­¢åˆ›å»ºæ–°æŒ‰é’®
                themeToggle.createThemeToggleButton = function() {
                    // ä»€ä¹ˆéƒ½ä¸åšï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æœ‰æŒ‰é’®äº†
                };
                
                // ç¡®ä¿ç°æœ‰æŒ‰é’®ä¸ThemeToggleç±»æ­£ç¡®å…³è”
                const existingButton = document.querySelector('.theme-toggle-btn');
                if (existingButton) {
                    // ç§»é™¤å¯èƒ½å­˜åœ¨çš„äº‹ä»¶ç›‘å¬å™¨
                    const newButton = existingButton.cloneNode(true);
                    existingButton.parentNode.replaceChild(newButton, existingButton);
                    
                    // æ·»åŠ ThemeToggleçš„äº‹ä»¶å¤„ç†
                    newButton.addEventListener('click', () => themeToggle.toggleTheme());
                }
            }

            // è·å–URLå‚æ•°ä¸­çš„æ–‡ä»¶å¤¹è·¯å¾„
            const folderPath = getFolderPathFromURL();
            CURRENT_FOLDER = folderPath;

            // åˆå§‹åŒ–æ–‡æ¡£é…ç½®
            initializeDocumentConfig().then(() => {
                // ç­›é€‰å½“å‰æ–‡ä»¶å¤¹çš„æ–‡æ¡£
                filterDocumentsByFolder(folderPath);

                // ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
                generateBreadcrumb(folderPath);

                // ç”Ÿæˆæ–‡ä»¶å¤¹æ ‡é¢˜å’Œæè¿°
                generateFolderHeader(folderPath);

                // ç”Ÿæˆæ–‡æ¡£åˆ—è¡¨
                // æ³¨æ„ï¼šè¿™é‡Œä¸è°ƒç”¨ generateDocumentGridï¼Œå› ä¸º initFilterAndSortFunctionality ä¼šå¤„ç†
                // generateDocumentGrid();

                // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
                initSearchFunctionality();

                // åˆå§‹åŒ–è¿‡æ»¤å™¨å’Œæ’åºåŠŸèƒ½
                initFilterAndSortFunctionality();
            });
        });

        // ä»URLå‚æ•°è·å–æ–‡ä»¶å¤¹è·¯å¾„
        function getFolderPathFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('path') || '';
        }

        // åˆå§‹åŒ–æ–‡æ¡£é…ç½®
        async function initializeDocumentConfig() {
            try {
                // å°è¯•åŠ è½½é…ç½®æ–‡ä»¶
                console.log('folder.html: æ­£åœ¨åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå½“å‰è·¯å¾„:', window.location.pathname);
                const configResponse = await fetch('./config.json');
                if (configResponse.ok) {
                    FOLDER_DOC_CONFIG = await configResponse.json();
                    console.log('æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶:', FOLDER_DOC_CONFIG);
                } else {
                    console.warn('é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®');
                    FOLDER_DOC_CONFIG = generateDefaultConfig();
                }
            } catch (error) {
                console.warn('åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error);
                FOLDER_DOC_CONFIG = generateDefaultConfig();
            }

            // ä»é…ç½®æ–‡ä»¶åŠ è½½æ–‡æ¡£åˆ—è¡¨
            await loadDocumentsFromConfig();
        }

        // è·å–åˆ†ç±»å›¾æ ‡ - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryIcon(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–å›¾æ ‡
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[categoryKey] && FOLDER_DOC_CONFIG.categories[categoryKey].icon) {
                return FOLDER_DOC_CONFIG.categories[categoryKey].icon;
            }

            // é»˜è®¤å›¾æ ‡æ˜ å°„
            const iconMap = {
                'å…¥é—¨': 'ğŸš€',
                'è¿›é˜¶': 'ğŸ“š',
                'é«˜çº§': 'ğŸ”¥',
                'ä¸ªäººåˆ†äº«': 'ğŸ’¡',
                'æ€ä¹ˆè´¡çŒ®': 'ğŸ¤',
                'Modderå…¥é—¨': 'ğŸ®'
            };
            return iconMap[categoryKey] || 'ğŸ“„';
        }

        // è·å–åˆ†ç±»é¢œè‰² - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryColor(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–é¢œè‰²
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[categoryKey] && FOLDER_DOC_CONFIG.categories[categoryKey].color) {
                return FOLDER_DOC_CONFIG.categories[categoryKey].color;
            }

            // é»˜è®¤é¢œè‰²æ˜ å°„
            const colorMap = {
                'å…¥é—¨': '#4CAF50',
                'è¿›é˜¶': '#2196F3',
                'é«˜çº§': '#FF5722',
                'ä¸ªäººåˆ†äº«': '#FFC107',
                'æ€ä¹ˆè´¡çŒ®': '#9C27B0',
                'Modderå…¥é—¨': '#00BCD4'
            };
            return colorMap[categoryKey] || '#28a745';
        }

        // è·å–åˆ†ç±»æ’åº - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryOrder(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–æ’åº
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[categoryKey] && FOLDER_DOC_CONFIG.categories[categoryKey].order !== undefined) {
                return FOLDER_DOC_CONFIG.categories[categoryKey].order;
            }

            // é»˜è®¤æ’åºæ˜ å°„
            const orderMap = {
                'å…¥é—¨': 1,
                'è¿›é˜¶': 2,
                'é«˜çº§': 3,
                'ä¸ªäººåˆ†äº«': 4,
                'æ€ä¹ˆè´¡çŒ®': 5,
                'Modderå…¥é—¨': 6
            };
            return orderMap[categoryKey] || 999;
        }

        // è·å–é»˜è®¤åˆ†ç±»é…ç½®
        function getDefaultCategories() {
            return {
                "å…¥é—¨": {
                    "title": "å…¥é—¨",
                    "description": "é€‚åˆåˆå­¦è€…çš„åŸºç¡€æ•™ç¨‹",
                    "icon": "ğŸš€",
                    "color": "#4CAF50",
                    "order": 1
                },
                "è¿›é˜¶": {
                    "title": "è¿›é˜¶",
                    "description": "æœ‰ä¸€å®šåŸºç¡€åçš„è¿›é˜¶æ•™ç¨‹",
                    "icon": "ğŸ“š",
                    "color": "#2196F3",
                    "order": 2
                },
                "é«˜çº§": {
                    "title": "é«˜çº§",
                    "description": "é¢å‘æœ‰ç»éªŒå¼€å‘è€…çš„é«˜çº§æ•™ç¨‹",
                    "icon": "ğŸ”¥",
                    "color": "#FF5722",
                    "order": 3
                },
                "ä¸ªäººåˆ†äº«": {
                    "title": "ä¸ªäººåˆ†äº«",
                    "description": "ç¤¾åŒºæˆå‘˜çš„ä¸ªäººç»éªŒå’ŒæŠ€å·§åˆ†äº«",
                    "icon": "ğŸ’¡",
                    "color": "#FFC107",
                    "order": 4
                },
                "æ€ä¹ˆè´¡çŒ®": {
                    "title": "æ€ä¹ˆè´¡çŒ®",
                    "description": "ä»‹ç»è´¡çŒ®è€…åº”è¯¥æ€ä¹ˆè´¡çŒ®æ–‡ç« ",
                    "icon": "ğŸ¤",
                    "color": "#9C27B0",
                    "order": 5,
                    "special": true
                },
                "Modderå…¥é—¨": {
                    "title": "Modderå…¥é—¨",
                    "description": "Modderå…¥é—¨ç›¸å…³çš„æ•™ç¨‹",
                    "icon": "ğŸ®",
                    "color": "#00BCD4",
                    "order": 6,
                    "special": true
                }
            };
        }

        // è·å–é»˜è®¤ä¸»é¢˜é…ç½®
        function getDefaultTopics() {
            return {
                "mod-basics": {
                    "title": "ModåŸºç¡€",
                    "description": "Modå¼€å‘çš„åŸºç¡€æ¦‚å¿µå’Œæ ¸å¿ƒAPI",
                    "icon": "ğŸ“–",
                    "order": 1
                },
                "env": {
                    "title": "ç¯å¢ƒé…ç½®",
                    "description": "å¼€å‘ç¯å¢ƒæ­å»ºå’Œé…ç½®",
                    "icon": "ğŸ› ï¸",
                    "order": 2
                },
                "items": {
                    "title": "ç‰©å“ç³»ç»Ÿ",
                    "description": "ç‰©å“ã€æ­¦å™¨å’Œè£…å¤‡çš„å¼€å‘",
                    "icon": "âš”ï¸",
                    "order": 3
                },
                "npcs": {
                    "title": "NPCç³»ç»Ÿ",
                    "description": "NPCçš„åˆ›å»ºå’Œè¡Œä¸ºå®šåˆ¶",
                    "icon": "ğŸ‘¥",
                    "order": 4
                },
                "world-gen": {
                    "title": "ä¸–ç•Œç”Ÿæˆ",
                    "description": "ä¸–ç•Œç”Ÿæˆå’Œåœ°å½¢ä¿®æ”¹",
                    "icon": "ğŸŒ",
                    "order": 5
                },
                "ui": {
                    "title": "UIç•Œé¢",
                    "description": "ç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡",
                    "icon": "ğŸ¨",
                    "order": 6
                },
                "networking": {
                    "title": "ç½‘ç»œåŠŸèƒ½",
                    "description": "å¤šäººæ¸¸æˆå’Œç½‘ç»œé€šä¿¡",
                    "icon": "ğŸŒ",
                    "order": 7
                },
                "advanced": {
                    "title": "é«˜çº§åŠŸèƒ½",
                    "description": "é«˜çº§å¼€å‘æŠ€å·§å’Œä¼˜åŒ–",
                    "icon": "ğŸ”§",
                    "order": 8
                }
            };
        }

        // ç”Ÿæˆé»˜è®¤é…ç½®ï¼ˆå½“config.jsonä¸å­˜åœ¨æ—¶ï¼‰
        function generateDefaultConfig() {
            const config = {
                _metadata: {
                    version: "2.0.0",
                    schema: "tmodloader-docs-v2",
                    created: new Date().toISOString().split('T')[0],
                    lastUpdated: new Date().toISOString().split('T')[0],
                    description: "æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹é…ç½®æ–‡ä»¶ - é»˜è®¤é…ç½®"
                },
                globalSettings: {
                    language: "zh",
                    theme: "default",
                    siteName: "æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹",
                    siteDescription: "å…¨é¢çš„æ³°æ‹‰ç‘äºšModå¼€å‘æ•™ç¨‹èµ„æº",
                    baseUrl: "",
                    enableSearch: true,
                    enableDarkMode: true,
                    defaultOrder: 999,
                    dateFormat: "YYYY-MM-DD"
                },
                categories: {},
                topics: {},
                authors: {},
                all_files: [],
                pathMappings: {},
                settings: {
                    defaultCategory: "å…¥é—¨",
                    defaultTopic: "mod-basics",
                    specialCategories: ["æ€ä¹ˆè´¡çŒ®", "Modderå…¥é—¨"]
                },
                extensions: {
                    customFields: {
                        difficulty: {
                            type: "select",
                            options: ["beginner", "intermediate", "advanced"],
                            default: "beginner",
                            required: false
                        }
                    }
                }
            };

            // åˆå§‹åŒ–åˆ†ç±»ç»“æ„
            const defaultCategories = getDefaultCategories();
            Object.keys(defaultCategories).forEach(categoryKey => {
                const category = defaultCategories[categoryKey];
                config.categories[categoryKey] = {
                    ...category,
                    topics: {
                        "mod-basics": {
                            title: "ModåŸºç¡€",
                            description: "Modå¼€å‘çš„åŸºç¡€æ¦‚å¿µå’Œæ ¸å¿ƒAPI",
                            files: []
                        }
                    }
                };
            });

            // åˆå§‹åŒ–ä¸»é¢˜ç»“æ„
            const defaultTopics = getDefaultTopics();
            Object.keys(defaultTopics).forEach(topicKey => {
                const topic = defaultTopics[topicKey];
                config.topics[topicKey] = {
                    ...topic,
                    display_names: {
                        "zh": topic.title,
                        "en": topic.title
                    },
                    aliases: [topic.title]
                };
            });

            return config;
        }

        // ä»é…ç½®æ–‡ä»¶åŠ è½½æ–‡æ¡£åˆ—è¡¨
        async function loadDocumentsFromConfig() {
            try {
                // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶åŠ è½½æ–‡æ¡£åˆ—è¡¨
                if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.all_files && FOLDER_DOC_CONFIG.all_files.length > 0) {
                    console.log('ä»é…ç½®æ–‡ä»¶åŠ è½½æ–‡æ¡£åˆ—è¡¨');
                    ALL_DOCS = [...FOLDER_DOC_CONFIG.all_files];

                    // ç¡®ä¿æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰å¿…è¦çš„å­—æ®µ
                    ALL_DOCS = ALL_DOCS.map(doc => {
                        // å¤„ç†æ ‡ç­¾æ ¼å¼
                        let tags = [];
                        if (doc.tags) {
                            if (Array.isArray(doc.tags)) {
                                tags = doc.tags;
                            } else if (typeof doc.tags === 'string') {
                                // å¤„ç†å¯èƒ½çš„JSONå­—ç¬¦ä¸²æ ¼å¼
                                try {
                                    const parsedTags = JSON.parse(doc.tags);
                                    tags = Array.isArray(parsedTags) ? parsedTags : [parsedTags];
                                } catch (e) {
                                    // å¦‚æœä¸æ˜¯JSONï¼ŒæŒ‰é€—å·åˆ†å‰²
                                    tags = doc.tags.split(',').map(t => t.trim());
                                }
                            }
                        }

                        // å°è¯•ä»åˆ†ç±»çš„topicsä¸­è·å–description
                        let description = doc.description || '';
                        if (!description && doc.category && doc.topic && FOLDER_DOC_CONFIG.categories &&
                            FOLDER_DOC_CONFIG.categories[doc.category] &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic] &&
                            FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic].files) {
                            
                            const topicFiles = FOLDER_DOC_CONFIG.categories[doc.category].topics[doc.topic].files;
                            const matchingFile = topicFiles.find(file => file.filename === doc.filename);
                            if (matchingFile && matchingFile.description) {
                                description = matchingFile.description;
                            }
                        }

                        return {
                            filename: doc.filename,
                            path: doc.path || doc.filename,
                            title: doc.title || doc.filename.replace('.md', ''),
                            author: doc.author || 'æœªçŸ¥',
                            category: doc.category || 'å…¥é—¨',
                            topic: doc.topic || 'mod-basics',
                            order: parseInt(doc.order) || 999,
                            description: description,
                            tags: tags,
                            last_updated: doc.last_updated || 'æœªçŸ¥',
                            difficulty: doc.difficulty || 'beginner'
                        };
                    });

                    console.log('ä»é…ç½®æ–‡ä»¶åŠ è½½çš„æ–‡æ¡£:', ALL_DOCS);
                    return;
                }
            } catch (error) {
                console.error('ä»é…ç½®æ–‡ä»¶åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
                ALL_DOCS = [];
            }
        }

        // æ ¹æ®æ–‡ä»¶å¤¹è·¯å¾„ç­›é€‰æ–‡æ¡£
        function filterDocumentsByFolder(folderPath) {
            if (!folderPath) {
                console.warn('æœªæä¾›æ–‡ä»¶å¤¹è·¯å¾„');
                FOLDER_DOCS = [];
                return;
            }

            console.log(`ç­›é€‰æ–‡ä»¶å¤¹ "${folderPath}" ä¸‹çš„æ–‡æ¡£`);

            // ç­›é€‰è·¯å¾„åŒ…å«æŒ‡å®šæ–‡ä»¶å¤¹çš„æ–‡æ¡£
            FOLDER_DOCS = ALL_DOCS.filter(doc => {
                if (!doc.path) return false;

                // æ£€æŸ¥è·¯å¾„æ˜¯å¦åŒ…å«æŒ‡å®šçš„æ–‡ä»¶å¤¹è·¯å¾„
                const pathParts = doc.path.split('/');
                return pathParts.includes(folderPath);
            });

            console.log(`æ‰¾åˆ° ${FOLDER_DOCS.length} ä¸ªæ–‡æ¡£:`, FOLDER_DOCS);
        }

        // ç”Ÿæˆé¢åŒ…å±‘å¯¼èˆª
        function generateBreadcrumb(folderPath) {
            const breadcrumb = document.getElementById('breadcrumb');

            if (!breadcrumb) return;

            breadcrumb.innerHTML = '';

            // é¦–é¡µé“¾æ¥
            const homeItem = document.createElement('div');
            homeItem.className = 'breadcrumb-item';
            homeItem.innerHTML = '<a href="../index.html">é¦–é¡µ</a>';
            breadcrumb.appendChild(homeItem);

            // æ–‡æ¡£é¦–é¡µé“¾æ¥
            const docsItem = document.createElement('div');
            docsItem.className = 'breadcrumb-item';
            docsItem.innerHTML = '<a href="index.html">æ–‡æ¡£</a>';
            breadcrumb.appendChild(docsItem);

            // å½“å‰æ–‡ä»¶å¤¹
            if (folderPath) {
                const folderItem = document.createElement('div');
                folderItem.className = 'breadcrumb-item active';
                folderItem.textContent = folderPath;
                breadcrumb.appendChild(folderItem);
            }
        }

        // ç”Ÿæˆæ–‡ä»¶å¤¹æ ‡é¢˜å’Œæè¿°
        function generateFolderHeader(folderPath) {
            const folderHeader = document.getElementById('folder-header');

            if (!folderHeader) return;

            if (!folderPath) {
                folderHeader.innerHTML = `
                    <h2 class="folder-title">æœªæŒ‡å®šæ–‡ä»¶å¤¹</h2>
                    <p class="folder-description">è¯·åœ¨URLå‚æ•°ä¸­æŒ‡å®šè¦æŸ¥çœ‹çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œä¾‹å¦‚: folder.html?path=Modderå…¥é—¨</p>
                `;
                return;
            }

            // å°è¯•ä»é…ç½®ä¸­è·å–æ–‡ä»¶å¤¹ä¿¡æ¯
            let folderDescription = '';

            // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ†ç±»åç§°
            if (FOLDER_DOC_CONFIG.categories && FOLDER_DOC_CONFIG.categories[folderPath]) {
                folderDescription = FOLDER_DOC_CONFIG.categories[folderPath].description || '';
            }

            // ç”Ÿæˆæ–‡ä»¶å¤¹æ ‡é¢˜å’Œæè¿°
            folderHeader.innerHTML = `
                <h2 class="folder-title">${folderPath}</h2>
                <p class="folder-description">${folderDescription || `æµè§ˆ "${folderPath}" æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡æ¡£`}</p>
            `;
        }

        // ç”Ÿæˆæ–‡æ¡£åˆ—è¡¨
        function generateDocumentGrid() {
            // è¿™ä¸ªå‡½æ•°ç°åœ¨ç”± applyAllFiltersAndSort ä»£æ›¿
            // ä¿ç•™æ­¤å‡½æ•°æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œä½†å®é™…åŠŸèƒ½å·²ç§»è‡³ applyAllFiltersAndSort
            if (typeof applyAllFiltersAndSort === 'function') {
                applyAllFiltersAndSort();
            } else {
                // å¦‚æœ applyAllFiltersAndSort å°šæœªå®šä¹‰ï¼Œåˆ™ä½¿ç”¨åŸå§‹é€»è¾‘
                const docGrid = document.getElementById('doc-grid');
                const noDocs = document.getElementById('no-docs');

                if (!docGrid || !noDocs) return;

                // æ¸…ç©ºç°æœ‰å†…å®¹
                docGrid.innerHTML = '';

                if (FOLDER_DOCS.length === 0) {
                    // æ˜¾ç¤ºæ— æ–‡æ¡£æç¤º
                    docGrid.style.display = 'none';
                    noDocs.style.display = 'block';
                    return;
                }

                // æ˜¾ç¤ºæ–‡æ¡£ç½‘æ ¼
                docGrid.style.display = 'grid';
                noDocs.style.display = 'none';

                // æŒ‰æ’åºå­—æ®µæ’åºæ–‡æ¡£
                const sortedDocs = [...FOLDER_DOCS].sort((a, b) => {
                    return a.order - b.order;
                });

                // ç”Ÿæˆæ–‡æ¡£å¡ç‰‡
                sortedDocs.forEach(doc => {
                    const docCard = document.createElement('div');
                    docCard.className = 'doc-card';

                    const difficultyClass = doc.difficulty === 'all' ? 'beginner' : doc.difficulty;
                    const difficultyText = getDifficultyText(doc.difficulty);

                    // ç”Ÿæˆæ ‡ç­¾HTML
                    let tagsHtml = '';
                    if (doc.tags && doc.tags.length > 0) {
                        tagsHtml = doc.tags.map(tag => `<span class="doc-tag">${tag}</span>`).join('');
                    }

                    // å¤„ç†æè¿°
                    let description = 'æš‚æ— æè¿°';
                    if (doc.description && typeof doc.description === 'string' && doc.description.trim() !== '') {
                        description = doc.description;
                    }

                    docCard.innerHTML = `
                        <div class="doc-card-header">
                            <h3 class="doc-title">${doc.title}</h3>
                            <div class="doc-meta">
                                <div class="doc-meta-item">
                                    <span class="difficulty-badge ${difficultyClass}">${difficultyText}</span>
                                </div>
                                <div class="doc-meta-item">
                                    <span>ğŸ‘¤ ${doc.author}</span>
                                </div>
                                <div class="doc-meta-item">
                                    <span>ğŸ“… ${doc.last_updated}</span>
                                </div>
                            </div>
                        </div>
                        <div class="doc-card-body">
                            <p class="doc-description">${description}</p>
                            ${tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : ''}
                        </div>
                        <div class="doc-card-footer">
                            <div class="doc-author">ä½œè€…: ${doc.author}</div>
                            <a href="viewer.html?file=${encodeURIComponent(doc.path)}" class="doc-link">æŸ¥çœ‹æ–‡æ¡£</a>
                        </div>
                    `;

                    docGrid.appendChild(docCard);
                });
            }
        }

        // è·å–éš¾åº¦æ–‡æœ¬ - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getDifficultyText(difficulty) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–éš¾åº¦æ˜ å°„
            if (FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.extensions && FOLDER_DOC_CONFIG.extensions.customFields &&
                FOLDER_DOC_CONFIG.extensions.customFields.difficulty && FOLDER_DOC_CONFIG.extensions.customFields.difficulty.options) {
                const difficultyOptions = FOLDER_DOC_CONFIG.extensions.customFields.difficulty.options;
                const difficultyMap = {
                    'beginner': 'åˆçº§',
                    'intermediate': 'ä¸­çº§',
                    'advanced': 'é«˜çº§',
                    'all': 'å…¨éƒ¨çº§åˆ«'
                };

                // å¦‚æœé…ç½®ä¸­æœ‰è‡ªå®šä¹‰æ˜ å°„ï¼Œä½¿ç”¨é…ç½®ä¸­çš„æ˜ å°„
                if (difficultyOptions.includes(difficulty)) {
                    return difficultyMap[difficulty] || difficulty;
                }
            }

            // é»˜è®¤éš¾åº¦æ˜ å°„
            const defaultDifficultyMap = {
                'beginner': 'åˆçº§',
                'intermediate': 'ä¸­çº§',
                'advanced': 'é«˜çº§',
                'all': 'å…¨éƒ¨çº§åˆ«'
            };
            return defaultDifficultyMap[difficulty] || difficulty;
        }

        // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
        function initSearchFunctionality() {
            const searchInput = document.getElementById('doc-search');
            const searchButton = document.getElementById('search-btn');
            const searchResults = document.getElementById('search-results');

            if (!searchInput || !searchButton || !searchResults) return;

            // æœç´¢è¾“å…¥äº‹ä»¶
            searchInput.addEventListener('input', function () {
                const query = this.value.trim().toLowerCase();

                if (query.length === 0) {
                    // æ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£ï¼Œä½†åº”ç”¨å½“å‰çš„è¿‡æ»¤å™¨å’Œæ’åº
                    applyAllFiltersAndSort();
                    searchResults.style.display = 'none';
                    return;
                }

                // å…ˆåº”ç”¨è¿‡æ»¤å™¨ï¼Œç„¶ååœ¨è¿™äº›ç»“æœä¸­æœç´¢
                let filteredDocs = applyCurrentFilters();

                // åœ¨è¿‡æ»¤åçš„ç»“æœä¸­æœç´¢
                const results = filteredDocs.filter(doc =>
                    doc.title.toLowerCase().includes(query) ||
                    doc.author.toLowerCase().includes(query) ||
                    (doc.description && doc.description.toLowerCase().includes(query)) ||
                    (doc.tags && doc.tags.some(tag => tag.toLowerCase().includes(query)))
                );

                // åº”ç”¨å½“å‰æ’åº
                const sortFilter = document.getElementById('sort-filter');
                const sortValue = sortFilter ? sortFilter.value : 'order';
                const sortedResults = sortDocuments(results, sortValue);

                // æ˜¾ç¤ºæœç´¢ç»“æœ
                displaySearchResults(sortedResults);
                updateDocumentGridWithFilteredDocs(sortedResults);
            });

            // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            searchButton.addEventListener('click', function () {
                const query = searchInput.value.trim();
                if (query) {
                    performSearch(query);
                }
            });

            // æœç´¢è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­æœç´¢ç»“æœ
            document.addEventListener('click', function (e) {
                if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });

            // æ˜¾ç¤ºæœç´¢ç»“æœ
            function displaySearchResults(results) {
                searchResults.innerHTML = '';

                if (results.length === 0) {
                    searchResults.innerHTML = `
                        <div class="search-result-item">
                            <div class="search-result-title">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£</div>
                            <div class="search-result-meta">è¯·å°è¯•å…¶ä»–å…³é”®è¯</div>
                        </div>
                    `;
                } else {
                    results.forEach(result => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'search-result-item';

                        resultItem.innerHTML = `
                            <div class="search-result-title">${result.title}</div>
                            <div class="search-result-meta">ä½œè€…: ${result.author} | æ›´æ–°: ${result.last_updated}</div>
                        `;

                        resultItem.addEventListener('click', function () {
                            window.location.href = `viewer.html?file=${encodeURIComponent(result.path)}`;
                        });

                        searchResults.appendChild(resultItem);
                    });
                }

                searchResults.style.display = 'block';
            }


            // æ‰§è¡Œæœç´¢
            function performSearch(query) {
                // å…ˆåº”ç”¨è¿‡æ»¤å™¨ï¼Œç„¶ååœ¨è¿™äº›ç»“æœä¸­æœç´¢
                let filteredDocs = applyCurrentFilters();

                const results = filteredDocs.filter(doc =>
                    doc.title.toLowerCase().includes(query.toLowerCase()) ||
                    doc.author.toLowerCase().includes(query.toLowerCase()) ||
                    (doc.description && doc.description.toLowerCase().includes(query.toLowerCase())) ||
                    (doc.tags && doc.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase())))
                );

                // åº”ç”¨å½“å‰æ’åº
                const sortFilter = document.getElementById('sort-filter');
                const sortValue = sortFilter ? sortFilter.value : 'order';
                const sortedResults = sortDocuments(results, sortValue);

                if (sortedResults.length === 0) {
                    alert('æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯');
                } else if (sortedResults.length === 1) {
                    // å¦‚æœåªæœ‰ä¸€ä¸ªç»“æœï¼Œç›´æ¥è·³è½¬
                    window.location.href = `viewer.html?file=${encodeURIComponent(sortedResults[0].path)}`;
                } else {
                    // å¦‚æœæœ‰å¤šä¸ªç»“æœï¼Œæ›´æ–°æ–‡æ¡£ç½‘æ ¼
                    updateDocumentGridWithFilteredDocs(sortedResults);
                    searchInput.value = query;
                }
            }
        }

        // åˆå§‹åŒ–è¿‡æ»¤å™¨
        function initializeFilters() {
            // å¡«å……åˆ†ç±»è¿‡æ»¤å™¨é€‰é¡¹
            if (categoryFilter && FOLDER_DOC_CONFIG && FOLDER_DOC_CONFIG.categories) {
                categoryFilter.innerHTML = '<option value="all">å…¨éƒ¨åˆ†ç±»</option>';
                Object.keys(FOLDER_DOC_CONFIG.categories).forEach(categoryKey => {
                    const category = FOLDER_DOC_CONFIG.categories[categoryKey];
                    const option = document.createElement('option');
                    option.value = categoryKey;
                    option.textContent = category.title || categoryKey;
                    categoryFilter.appendChild(option);
                });
            }

            // å¡«å……ä½œè€…è¿‡æ»¤å™¨é€‰é¡¹
            if (authorFilter && ALL_DOCS.length > 0) {
                const authors = [...new Set(ALL_DOCS.map(doc => doc.author))].sort();
                authorFilter.innerHTML = '<option value="all">å…¨éƒ¨ä½œè€…</option>';
                authors.forEach(author => {
                    const option = document.createElement('option');
                    option.value = author;
                    option.textContent = author;
                    authorFilter.appendChild(option);
                });
            }

            // æ·»åŠ è¿‡æ»¤å™¨äº‹ä»¶ç›‘å¬å™¨
            if (difficultyFilter) {
                difficultyFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (categoryFilter) {
                categoryFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (authorFilter) {
                authorFilter.addEventListener('change', applyFiltersAndSort);
            }

            if (sortFilter) {
                sortFilter.addEventListener('change', applyFiltersAndSort);
            }
        }

        // åˆå§‹åŒ–è§†å›¾åˆ‡æ¢
        function initializeViewToggle() {
            if (gridViewBtn && listViewBtn) {
                gridViewBtn.addEventListener('click', function () {
                    gridViewBtn.classList.add('active');
                    listViewBtn.classList.remove('active');
                    document.getElementById('doc-grid').classList.remove('list-view');
                });

                listViewBtn.addEventListener('click', function () {
                    listViewBtn.classList.add('active');
                    gridViewBtn.classList.remove('active');
                    document.getElementById('doc-grid').classList.add('list-view');
                });
            }
        }

        // åº”ç”¨è¿‡æ»¤å™¨å’Œæ’åº
        function applyFiltersAndSort() {
            let filteredDocs = [...FOLDER_DOCS];

            // åº”ç”¨éš¾åº¦è¿‡æ»¤å™¨
            if (difficultyFilter && difficultyFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.difficulty === difficultyFilter.value);
            }

            // åº”ç”¨åˆ†ç±»è¿‡æ»¤å™¨
            if (categoryFilter && categoryFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.category === categoryFilter.value);
            }

            // åº”ç”¨ä½œè€…è¿‡æ»¤å™¨
            if (authorFilter && authorFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.author === authorFilter.value);
            }

            // åº”ç”¨æ’åº
            if (sortFilter) {
                const sortBy = sortFilter.value;
                filteredDocs.sort((a, b) => {
                    switch (sortBy) {
                        case 'title':
                            return a.title.localeCompare(b.title, 'zh-CN');
                        case 'author':
                            return a.author.localeCompare(b.author, 'zh-CN');
                        case 'last_updated':
                            return new Date(b.last_updated || 0) - new Date(a.last_updated || 0);
                        case 'order':
                        default:
                            return (a.order || 999) - (b.order || 999);
                    }
                });
            }

            // æ›´æ–°æ–‡æ¡£ç½‘æ ¼
            updateDocumentGrid(filteredDocs);
        }

        // åº”ç”¨æ‰€æœ‰è¿‡æ»¤å™¨å’Œæ’åº
        function applyAllFiltersAndSort() {
            const sortFilter = document.getElementById('sort-filter');
            const sortValue = sortFilter ? sortFilter.value : 'order';

            let filteredDocs = applyCurrentFilters();
            filteredDocs = sortDocuments(filteredDocs, sortValue);

            updateDocumentGridWithFilteredDocs(filteredDocs);
        }

        // åº”ç”¨å½“å‰è¿‡æ»¤å™¨ï¼ˆä¸åº”ç”¨æ’åºï¼‰
        function applyCurrentFilters() {
            let filteredDocs = [...FOLDER_DOCS];

            const difficultyFilter = document.getElementById('difficulty-filter');
            const categoryFilter = document.getElementById('category-filter');
            const authorFilter = document.getElementById('author-filter');

            // åº”ç”¨éš¾åº¦è¿‡æ»¤å™¨
            if (difficultyFilter && difficultyFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.difficulty === difficultyFilter.value);
            }

            // åº”ç”¨åˆ†ç±»è¿‡æ»¤å™¨
            if (categoryFilter && categoryFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.category === categoryFilter.value);
            }

            // åº”ç”¨ä½œè€…è¿‡æ»¤å™¨
            if (authorFilter && authorFilter.value !== 'all') {
                filteredDocs = filteredDocs.filter(doc => doc.author === authorFilter.value);
            }

            return filteredDocs;
        }

        // åˆå§‹åŒ–è¿‡æ»¤å™¨å’Œæ’åºåŠŸèƒ½
        function initFilterAndSortFunctionality() {
            const difficultyFilter = document.getElementById('difficulty-filter');
            const categoryFilter = document.getElementById('category-filter');
            const authorFilter = document.getElementById('author-filter');
            const sortFilter = document.getElementById('sort-filter');
            const gridViewBtn = document.getElementById('grid-view-btn');
            const listViewBtn = document.getElementById('list-view-btn');
            const docGrid = document.getElementById('doc-grid');

            if (!difficultyFilter || !categoryFilter || !authorFilter || !sortFilter || !gridViewBtn || !listViewBtn || !docGrid) {
                console.error('æ— æ³•æ‰¾åˆ°è¿‡æ»¤å™¨å’Œæ’åºæ§ä»¶');
                return;
            }

            // å¡«å……åˆ†ç±»è¿‡æ»¤å™¨é€‰é¡¹
            populateCategoryFilter();

            // å¡«å……ä½œè€…è¿‡æ»¤å™¨é€‰é¡¹
            populateAuthorFilter();

            // éš¾åº¦è¿‡æ»¤å™¨äº‹ä»¶
            difficultyFilter.addEventListener('change', applyAllFiltersAndSort);

            // åˆ†ç±»è¿‡æ»¤å™¨äº‹ä»¶
            categoryFilter.addEventListener('change', applyAllFiltersAndSort);

            // ä½œè€…è¿‡æ»¤å™¨äº‹ä»¶
            authorFilter.addEventListener('change', applyAllFiltersAndSort);

            // æ’åºè¿‡æ»¤å™¨äº‹ä»¶
            sortFilter.addEventListener('change', applyAllFiltersAndSort);

            // ç½‘æ ¼è§†å›¾åˆ‡æ¢äº‹ä»¶
            gridViewBtn.addEventListener('click', function () {
                docGrid.classList.remove('list-view');
                gridViewBtn.classList.add('active');
                listViewBtn.classList.remove('active');
            });

            // åˆ—è¡¨è§†å›¾åˆ‡æ¢äº‹ä»¶
            listViewBtn.addEventListener('click', function () {
                docGrid.classList.add('list-view');
                listViewBtn.classList.add('active');
                gridViewBtn.classList.remove('active');
            });

            // åˆå§‹åº”ç”¨è¿‡æ»¤å™¨å’Œæ’åº
            applyAllFiltersAndSort();
        }

        // å¡«å……åˆ†ç±»è¿‡æ»¤å™¨é€‰é¡¹
        function populateCategoryFilter() {
            const categoryFilter = document.getElementById('category-filter');
            if (!categoryFilter) return;

            // è·å–æ‰€æœ‰å”¯ä¸€çš„åˆ†ç±»
            const categories = [...new Set(FOLDER_DOCS.map(doc => doc.category))];

            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨åˆ†ç±»"ï¼‰
            categoryFilter.innerHTML = '<option value="all">å…¨éƒ¨åˆ†ç±»</option>';

            // æ·»åŠ åˆ†ç±»é€‰é¡¹
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categoryFilter.appendChild(option);
            });
        }

        // å¡«å……ä½œè€…è¿‡æ»¤å™¨é€‰é¡¹
        function populateAuthorFilter() {
            const authorFilter = document.getElementById('author-filter');
            if (!authorFilter) return;

            // è·å–æ‰€æœ‰å”¯ä¸€çš„ä½œè€…
            const authors = [...new Set(FOLDER_DOCS.map(doc => doc.author))];

            // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨ä½œè€…"ï¼‰
            authorFilter.innerHTML = '<option value="all">å…¨éƒ¨ä½œè€…</option>';

            // æ·»åŠ ä½œè€…é€‰é¡¹
            authors.forEach(author => {
                const option = document.createElement('option');
                option.value = author;
                option.textContent = author;
                authorFilter.appendChild(option);
            });
        }

        // æ’åºæ–‡æ¡£
        function sortDocuments(docs, sortType) {
            const sortedDocs = [...docs];

            switch (sortType) {
                case 'order':
                    sortedDocs.sort((a, b) => a.order - b.order);
                    break;
                case 'title':
                    sortedDocs.sort((a, b) => a.title.localeCompare(b.title, 'zh-CN'));
                    break;
                case 'author':
                    sortedDocs.sort((a, b) => a.author.localeCompare(b.author, 'zh-CN'));
                    break;
                case 'last_updated':
                    sortedDocs.sort((a, b) => {
                        // å°è¯•å°†æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸ºDateå¯¹è±¡è¿›è¡Œæ¯”è¾ƒ
                        const dateA = new Date(a.last_updated);
                        const dateB = new Date(b.last_updated);

                        // å¦‚æœæ—¥æœŸæ— æ•ˆï¼Œåˆ™æŒ‰å­—ç¬¦ä¸²æ¯”è¾ƒ
                        if (isNaN(dateA.getTime()) || isNaN(dateB.getTime())) {
                            return b.last_updated.localeCompare(a.last_updated);
                        }

                        return dateB.getTime() - dateA.getTime(); // é™åºæ’åˆ—ï¼Œæœ€æ–°çš„åœ¨å‰
                    });
                    break;
                default:
                    // é»˜è®¤æŒ‰é¡ºåºæ’åº
                    sortedDocs.sort((a, b) => a.order - b.order);
            }

            return sortedDocs;
        }

        // ä½¿ç”¨è¿‡æ»¤åçš„æ–‡æ¡£æ›´æ–°æ–‡æ¡£ç½‘æ ¼
        function updateDocumentGridWithFilteredDocs(filteredDocs) {
            const docGrid = document.getElementById('doc-grid');
            const noDocs = document.getElementById('no-docs');

            if (!docGrid || !noDocs) return;

            // æ¸…ç©ºç°æœ‰å†…å®¹
            docGrid.innerHTML = '';

            if (filteredDocs.length === 0) {
                // æ˜¾ç¤ºæ— æ–‡æ¡£æç¤º
                docGrid.style.display = 'none';
                noDocs.style.display = 'block';
                noDocs.innerHTML = `
                    <div class="no-docs-icon">ğŸ”</div>
                    <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡æ¡£</h3>
                    <p>æ²¡æœ‰æ‰¾åˆ°ä¸è¿‡æ»¤æ¡ä»¶åŒ¹é…çš„æ–‡æ¡£ï¼Œè¯·å°è¯•è°ƒæ•´è¿‡æ»¤æ¡ä»¶ã€‚</p>
                `;
                return;
            }

            // æ˜¾ç¤ºæ–‡æ¡£ç½‘æ ¼
            docGrid.style.display = 'grid';
            noDocs.style.display = 'none';

            // ç”Ÿæˆæ–‡æ¡£å¡ç‰‡
            filteredDocs.forEach(doc => {
                const docCard = document.createElement('div');
                docCard.className = 'doc-card';

                const difficultyClass = doc.difficulty === 'all' ? 'beginner' : doc.difficulty;
                const difficultyText = getDifficultyText(doc.difficulty);

                // ç”Ÿæˆæ ‡ç­¾HTML
                let tagsHtml = '';
                if (doc.tags && doc.tags.length > 0) {
                    tagsHtml = doc.tags.map(tag => `<span class="doc-tag">${tag}</span>`).join('');
                }

                // å¡ç‰‡ç®€ä»‹
                let description = 'æš‚æ— æè¿°';
                if (doc.description && typeof doc.description === 'string' && doc.description.trim() !== '') {
                    description = doc.description;
                }

                docCard.innerHTML = `
                    <div class="doc-card-header">
                        <h3 class="doc-title">${doc.title}</h3>
                        <div class="doc-meta">
                            <div class="doc-meta-item">
                                <span class="difficulty-badge ${difficultyClass}">${difficultyText}</span>
                            </div>
                            <div class="doc-meta-item">
                                <span>ğŸ‘¤ ${doc.author}</span>
                            </div>
                            <div class="doc-meta-item">
                                <span>ğŸ“… ${doc.last_updated}</span>
                            </div>
                        </div>
                    </div>
                    <div class="doc-card-body">
                        <p class="doc-description">${description}</p>
                        ${tagsHtml ? `<div class="doc-tags">${tagsHtml}</div>` : ''}
                    </div>
                    <div class="doc-card-footer">
                        <div class="doc-author">ä½œè€…: ${doc.author}</div>
                        <a href="viewer.html?file=${encodeURIComponent(doc.path)}" class="doc-link">æŸ¥çœ‹æ–‡æ¡£</a>
                    </div>
                `;

                docGrid.appendChild(docCard);
            });
        }
    </script>
</body>

</html>