<!DOCTYPE html>
<!-- 泰拉瑞亚Mod制作教程文档导航页面 -->
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文档导航 - 泰拉瑞亚Mod制作教程</title>
    
    <!-- SEO优化标签 -->
    <meta name="description" content="泰拉瑞亚Mod制作教程文档导航，提供完整的教程分类和快速访问链接">
    <meta name="keywords" content="泰拉瑞亚,Mod,教程,文档,导航,tModLoader">
    <meta name="author" content="泰拉瑞亚Mod社区">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph标签 -->
    <meta property="og:title" content="文档导航 - 泰拉瑞亚Mod制作教程">
    <meta property="og:description" content="泰拉瑞亚Mod制作教程文档导航，提供完整的教程分类和快速访问链接">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dpapyru.github.io/docs/">
    <meta property="og:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">
    <meta property="og:site_name" content="泰拉瑞亚Mod制作教程">
    <meta property="og:locale" content="zh_CN">

    <!-- Twitter Card标签 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="文档导航 - 泰拉瑞亚Mod制作教程">
    <meta name="twitter:description" content="泰拉瑞亚Mod制作教程文档导航，提供完整的教程分类和快速访问链接">
    <meta name="twitter:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">

    <!-- 规范URL -->
    <link rel="canonical" href="https://dpapyru.github.io/docs/">
    
    <!-- 样式和图标 -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/theme-base.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/prism.min.css">
    <link rel="stylesheet" href="../assets/css/vs2022-theme.css">
    <link rel="icon" type="image/png" href="../assets/imgs/Green_tModLoader.png">
    
    <!-- 主题切换脚本 - 早期加载以避免闪烁 -->
    <script src="../assets/js/theme-init.js"></script>
    
    <!-- 自定义样式 -->
    <style>
        /* 文档导航页面特定样式 */
        .docs-hero {
            background: linear-gradient(0deg, #155724, #28a745,#155724);
            color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .docs-hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            font-weight: 700;
        }
        
        .docs-hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        
        .docs-content {
            padding: 60px 0;
        }
        
        .category-grid {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 50px;
        }

        .category-card {
            background-color: transparent !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            overflow: visible;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .category-card:first-child {
            border-top: none;
            padding-top: 0;
        }

        .category-header {
            background-color: transparent !important;
            color: var(--text-color) !important;
            padding: 4px 0 12px;
            position: relative;
            cursor: pointer;
            transition: color 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 6px;
            border-bottom: 1px solid var(--border-color);
        }

        .category-header:hover {
            color: var(--link-color) !important;
        }

        .category-header::after {
            display: none !important;
            background: none !important;
        }

        .category-title {
            font-size: 1.25rem;
            margin: 0;
            font-weight: 600;
            color: var(--text-color) !important;
        }

        .category-description {
            margin: 0;
            color: var(--text-secondary) !important;
            font-size: 0.95rem;
        }
        
        .category-content {
            padding: 0;
        }
        
        .doc-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        
	        .doc-item {
	            border-bottom: 1px solid var(--border-color);
                background-color: transparent !important;
	            transition: background-color 0.2s ease;
	        }
        
        .doc-item:last-child {
            border-bottom: none;
        }
        
	        .doc-item:hover {
	            background-color: var(--sidebar-hover);
	        }
        
	        .doc-link {
	            display: flex;
	            align-items: center;
	            gap: 0;
	            padding: 12px 0;
	            color: var(--text-color) !important;
                background-color: transparent !important;
                border-radius: 0 !important;
	            text-decoration: none;
	            transition: color 0.2s ease, background-color 0.2s ease;
	        }

	        .doc-link:hover {
	            color: var(--link-color) !important;
                background-color: var(--bg-secondary) !important;
	        }

        .doc-info {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 16px;
            min-width: 0;
        }

        .doc-title {
            font-weight: 600;
        }
        
	        .doc-meta {
	            font-size: 0.85rem;
	            color: var(--text-secondary) !important;
	            display: flex;
	            align-items: center;
	            gap: 10px;
	            margin-left: auto;
	            white-space: nowrap;
	        }
        
        .doc-meta span {
            margin-right: 0;
        }

        .subfolder-section {
            margin-top: 8px;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
        }

        .subfolder-title {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0 0 6px;
        }

        .subfolder-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .subfolder-item {
            border-bottom: 1px solid var(--border-color);
        }

        .subfolder-item:last-child {
            border-bottom: none;
        }

        .subfolder-link {
            display: block;
            padding: 10px 0;
            color: var(--text-color);
            text-decoration: none;
            transition: color 0.2s ease, background-color 0.2s ease;
        }

        .subfolder-link:hover {
            color: var(--link-color);
            background-color: var(--bg-secondary);
        }

        html[data-theme="dark"] .docs-content .category-card {
            background-color: transparent !important;
            box-shadow: none !important;
            border-radius: 0 !important;
        }

        html[data-theme="dark"] .docs-content .category-header {
            background-color: transparent !important;
            color: var(--text-color) !important;
        }

        html[data-theme="dark"] .docs-content .category-header::after {
            display: none !important;
            background: none !important;
        }

        html[data-theme="dark"] .docs-content .category-title {
            color: var(--text-color) !important;
        }

        html[data-theme="dark"] .docs-content .category-description {
            color: var(--text-secondary) !important;
        }

        html[data-theme="dark"] .docs-content .doc-item:hover {
            background-color: transparent !important;
        }

        html[data-theme="dark"] .docs-content .doc-link {
            background-color: transparent !important;
            color: var(--text-color) !important;
        }

        html[data-theme="dark"] .docs-content .doc-link:hover {
            background-color: var(--bg-secondary) !important;
            color: var(--link-color) !important;
        }

        html[data-theme="dark"] .quick-links .quick-link-card {
            background-color: transparent !important;
            box-shadow: none !important;
            border-radius: 0 !important;
        }
        
        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
	        .difficulty-badge.beginner {
	            background-color: rgba(40, 167, 69, 0.18);
	            color: #b7f5c5;
	        }
        
	        .difficulty-badge.intermediate {
	            background-color: rgba(255, 193, 7, 0.18);
	            color: #ffe8a6;
	        }
        
	        .difficulty-badge.advanced {
	            background-color: rgba(220, 53, 69, 0.18);
	            color: #ffc1c7;
	        }
        
	        .quick-links {
	            background-color: var(--bg-secondary);
	            padding: 40px 0;
	            border-top: 1px solid var(--border-color);
	        }
        
        .quick-links-grid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .quick-link-card {
            background-color: transparent !important;
            border-radius: 0 !important;
            padding: 16px 0;
            text-align: left;
            box-shadow: none !important;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            transition: background-color 0.2s ease;
        }

        .quick-link-text {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }

	        .quick-link-card:hover {
	            transform: none;
	            box-shadow: none !important;
                background-color: var(--bg-secondary);
	        }

        .quick-link-card:last-child {
            border-bottom: none;
        }

	        .quick-link-title {
	            font-size: 1.1rem;
	            margin: 0;
	            color: var(--text-color);
	        }

        .quick-link-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .docs-hero h1 {
                font-size: 2rem;
            }
            
            .docs-hero p {
                font-size: 1rem;
            }
            
            .category-grid {
                gap: 20px;
            }

            .doc-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .doc-meta {
                margin-left: 0;
                flex-wrap: wrap;
                white-space: normal;
            }
            
            .quick-links-grid {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <a class="skip-link" href="#main-content">跳到主要内容</a>
    <!-- 网站头部导航区域 -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <!-- 网站logo和标题 -->
                <div class="logo">
                    <a href="../index.html">
                        <img src="../assets/imgs/Green_tModLoader.png" alt="泰拉瑞亚Mod制作教程" class="logo-image">
                        <h1 class="site-title">泰拉瑞亚Mod制作教程</h1>
                    </a>
                </div>
                <!-- 主导航菜单 -->
	                <nav class="main-nav" id="main-nav">
	                    <ul class="nav-list">
	                        <li class="nav-item"><a href="../index.html" class="nav-link">首页</a></li>
	                        <li class="nav-item"><a href="index.html" class="nav-link active" aria-current="page">文档</a></li>
	                        <li class="nav-item"><a href="https://github.com/DPapyru/DPapyru.github.io" class="nav-link"
	                                target="_blank" rel="noopener noreferrer">GitHub</a></li>
	                    </ul>
	                </nav>
                <!-- 移动端菜单切换按钮 -->
                <button class="mobile-menu-toggle" type="button" aria-label="切换菜单" aria-controls="main-nav" aria-expanded="false">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 文档导航主要内容区域 -->
    <main id="main-content" tabindex="-1">
        <!-- 文档导航英雄区域 -->
        <section class="docs-hero">
            <div class="container">
                <h1>文档导航</h1>
                <p>探索泰拉瑞亚Mod制作的完整教程体系，从入门到精通，一步步成为Mod开发专家</p>
                <div class="hero-buttons">
                    <a href="#category-grid" class="btn btn-primary">开始学习</a>
                    <a href="viewer.html?file=Modder入门/DPapyru-给新人的前言.md" class="btn btn-secondary">查看教程</a>
                </div>
            </div>
        </section>

        <!-- 文档分类内容区域 -->
        <section class="docs-content">
            <div class="container">
                <div class="category-grid" id="category-grid">
                    <!-- 分类卡片将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>

        <!-- 快速链接区域 -->
        <section class="quick-links">
            <div class="container">
                <h2 class="section-title">快速链接</h2>
                <div class="quick-links-grid" id="quick-links-grid">
                    <!-- 快速链接将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 网站底部区域 -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>关于项目</h4>
                    <p>这是一个面向泰拉瑞亚Mod开发者的协作教程项目，旨在降低Mod制作门槛。</p>
                </div>
	                <div class="footer-section">
	                    <h4>快速链接</h4>
	                    <ul>
	                        <li><a href="../index.html">首页</a></li>
	                        <li><a href="index.html">文档</a></li>
	                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
	                    </ul>
	                </div>
                <div class="footer-section">
                    <h4>联系我们</h4>
                    <ul>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="mailto:contact@example.com">邮箱</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 泰拉瑞亚Mod制作教程. 采用 <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC
                        BY 4.0</a> 许可协议。</p>
            </div>
        </div>
    </footer>

	    <!-- 加载JavaScript文件 -->
	    <script src="../assets/js/site-config.js"></script>
	    <script src="../assets/js/folder-filter.js"></script>
	    <script src="../assets/js/main.js"></script> <!-- 主要功能脚本 -->
	    <script src="../assets/js/navigation.js"></script> <!-- 导航增强脚本 -->
	    <script src="../assets/js/marked.min.js"></script> <!-- Markdown解析库 -->
	    <script src="../assets/js/prism.min.js"></script> <!-- 代码高亮库 -->
	    <script src="../assets/js/prism-csharp.min.js"></script> <!-- C#语言高亮支持 -->
    <script>
        // 设置一个标志，告诉main.js这是index.html页面，不要执行自动加载
        window.IS_INDEX_PAGE = true;
        
        // 文档配置和元数据管理 - 使用页面级变量避免冲突
        // 注意：不要在这里声明 DOC_CONFIG，因为它已经在 main.js 中声明了
        let ALL_DOCS = [];
        
        // 主分类配置 - 将从配置文件动态加载
        let MAIN_CATEGORIES = {};
        
        // 主题领域配置 - 将从配置文件动态加载
        let TOPIC_AREAS = {};

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== docs/index.html: 页面加载完成 ===');

            // 初始化文档配置
            initializeDocumentConfig().then(() => {
                // 生成文档分类卡片
                generateCategoryCards();
               
                // 生成快速链接
                generateQuickLinks();
            });
        });

        // 初始化文档配置
        async function initializeDocumentConfig() {
            try {
                console.log('正在加载配置文件，当前路径:', window.location.pathname);
                if (window.SiteConfig && typeof window.SiteConfig.load === 'function') {
                    window.DOC_CONFIG = await window.SiteConfig.load();
                } else {
                    const configResponse = await fetch('./config.json');
                    if (!configResponse.ok) throw new Error('无法加载config.json: ' + configResponse.status);
                    window.DOC_CONFIG = await configResponse.json();
                }

                if (typeof DOC_CONFIG !== 'undefined') {
                    DOC_CONFIG = window.DOC_CONFIG;
                }

                console.log('成功加载配置文件:', window.DOC_CONFIG);
                    
                    // 从配置文件加载主分类配置
                    if (window.DOC_CONFIG.categories) {
                        MAIN_CATEGORIES = {};
                        Object.keys(window.DOC_CONFIG.categories).forEach(categoryKey => {
                            const category = window.DOC_CONFIG.categories[categoryKey];
                            
                            // 检查是否是特殊分类
                            const isSpecial = ["怎么贡献", "Modder入门"].includes(categoryKey);
                            
                            MAIN_CATEGORIES[categoryKey] = {
                                title: category.title,
                                description: category.description,
                                icon: getCategoryIcon(categoryKey),
                                color: getCategoryColor(categoryKey),
                                order: getCategoryOrder(categoryKey),
                                special: isSpecial
                            };
                        });
                        console.log('成功加载分类配置:', MAIN_CATEGORIES);
                    }
                    
                    // 从配置文件加载主题领域配置
                    if (window.DOC_CONFIG.topics) {
                        TOPIC_AREAS = {};
                        Object.keys(window.DOC_CONFIG.topics).forEach(topicKey => {
                            const topic = window.DOC_CONFIG.topics[topicKey];
                            TOPIC_AREAS[topicKey] = {
                                title: topic.title,
                                description: topic.description,
                                icon: topic.icon || '',
                                display_names: topic.display_names || {},
                                aliases: topic.aliases || []
                            };
                        });
                        console.log('成功加载主题配置:', TOPIC_AREAS);
                    }
            } catch (error) {
                console.warn('加载配置文件失败，使用默认配置:', error);
                window.DOC_CONFIG = generateDefaultConfig();
                if (typeof DOC_CONFIG !== 'undefined') {
                    DOC_CONFIG = window.DOC_CONFIG;
                }
            }
            
            // 从配置文件加载文档列表，而不是扫描目录
            await loadDocumentsFromConfig();
        }

        // 获取分类图标 - 优先从配置文件读取，否则使用默认值
        function getCategoryIcon(categoryKey) {
            return '';
        }

        // 获取分类颜色 - 优先从配置文件读取，否则使用默认值
        function getCategoryColor(categoryKey) {
            // 首先尝试从配置文件中获取颜色
            if (DOC_CONFIG && DOC_CONFIG.categories && DOC_CONFIG.categories[categoryKey] && DOC_CONFIG.categories[categoryKey].color) {
                return DOC_CONFIG.categories[categoryKey].color;
            }
            
            // 默认颜色映射
            const colorMap = {
                '入门': '#4CAF50',
                '进阶': '#2196F3',
                '高级': '#FF5722',
                '个人分享': '#FFC107',
                '怎么贡献': '#9C27B0',
                'Modder入门': '#00BCD4'
            };
            return colorMap[categoryKey] || '#28a745';
        }

        // 获取分类排序 - 优先从配置文件读取，否则使用默认值
        function getCategoryOrder(categoryKey) {
            // 默认排序映射
            const orderMap = {
                '入门': 1,
                '进阶': 2,
                '高级': 3,
                '个人分享': 4,
                '怎么贡献': 5,
                'Modder入门': 6
            };
            return orderMap[categoryKey] || 999;
        }

        // 获取默认分类配置
        function getDefaultCategories() {
            return {
                "入门": {
                    "title": "入门",
                    "description": "适合初学者的基础教程",
                    "icon": "",
                    "color": "#4CAF50",
                    "order": 1
                },
                "进阶": {
                    "title": "进阶",
                    "description": "有一定基础后的进阶教程",
                    "icon": "",
                    "color": "#2196F3",
                    "order": 2
                },
                "高级": {
                    "title": "高级",
                    "description": "面向有经验开发者的高级教程",
                    "icon": "",
                    "color": "#FF5722",
                    "order": 3
                },
                "个人分享": {
                    "title": "个人分享",
                    "description": "社区成员的个人经验和技巧分享",
                    "icon": "",
                    "color": "#FFC107",
                    "order": 4
                },
                "怎么贡献": {
                    "title": "怎么贡献",
                    "description": "介绍贡献者应该怎么贡献文章",
                    "icon": "",
                    "color": "#9C27B0",
                    "order": 5,
                    "special": true
                },
                "Modder入门": {
                    "title": "Modder入门",
                    "description": "Modder入门相关的教程",
                    "icon": "",
                    "color": "#00BCD4",
                    "order": 6,
                    "special": true
                }
            };
        }

        // 获取默认主题配置
        function getDefaultTopics() {
            return {
                "mod-basics": {
                    "title": "Mod基础",
                    "description": "Mod开发的基础概念和核心API",
                    "icon": "",
                    "order": 1
                },
                "env": {
                    "title": "环境配置",
                    "description": "开发环境搭建和配置",
                    "icon": "",
                    "order": 2
                },
                "items": {
                    "title": "物品系统",
                    "description": "物品、武器和装备的开发",
                    "icon": "",
                    "order": 3
                },
                "npcs": {
                    "title": "NPC系统",
                    "description": "NPC的创建和行为定制",
                    "icon": "",
                    "order": 4
                },
                "world-gen": {
                    "title": "世界生成",
                    "description": "世界生成和地形修改",
                    "icon": "",
                    "order": 5
                },
                "ui": {
                    "title": "UI界面",
                    "description": "用户界面和交互设计",
                    "icon": "",
                    "order": 6
                },
                "networking": {
                    "title": "网络功能",
                    "description": "多人游戏和网络通信",
                    "icon": "",
                    "order": 7
                },
                "advanced": {
                    "title": "高级功能",
                    "description": "高级开发技巧和优化",
                    "icon": "",
                    "order": 8
                }
            };
        }

        // 生成默认配置（当config.json不存在时）
        function generateDefaultConfig() {
            const config = {
                _metadata: {
                    version: "2.0.0",
                    schema: "tmodloader-docs-v2",
                    created: new Date().toISOString().split('T')[0],
                    lastUpdated: new Date().toISOString().split('T')[0],
                    description: "泰拉瑞亚Mod制作教程配置文件 - 默认配置"
                },
                globalSettings: {
                    language: "zh",
                    theme: "default",
                    siteName: "泰拉瑞亚Mod制作教程",
                    siteDescription: "全面的泰拉瑞亚Mod开发教程资源",
                    baseUrl: "",
                    enableSearch: true,
                    enableDarkMode: true,
                    defaultOrder: 999,
                    dateFormat: "YYYY-MM-DD"
                },
                categories: {},
                topics: {},
                authors: {},
                all_files: [],
                pathMappings: {},
                settings: {
                    defaultCategory: "入门",
                    defaultTopic: "mod-basics",
                    specialCategories: ["怎么贡献", "Modder入门"]
                },
                extensions: {
                    customFields: {
                        difficulty: {
                            type: "select",
                            options: ["beginner", "intermediate", "advanced"],
                            default: "beginner",
                            required: false
                        }
                    }
                }
            };

            // 初始化分类结构
            const defaultCategories = getDefaultCategories();
            Object.keys(defaultCategories).forEach(categoryKey => {
                const category = defaultCategories[categoryKey];
                config.categories[categoryKey] = {
                    ...category,
                    topics: {
                        "mod-basics": {
                            title: "Mod基础",
                            description: "Mod开发的基础概念和核心API",
                            files: []
                        }
                    }
                };
               
                // 同时初始化MAIN_CATEGORIES
                MAIN_CATEGORIES[categoryKey] = {
                    title: category.title,
                    description: category.description,
                    icon: category.icon,
                    color: category.color,
                    order: category.order,
                    special: category.special || false
                };
            });

            // 初始化主题结构
            const defaultTopics = getDefaultTopics();
            Object.keys(defaultTopics).forEach(topicKey => {
                const topic = defaultTopics[topicKey];
                config.topics[topicKey] = {
                    ...topic,
                    display_names: {
                        "zh": topic.title,
                        "en": topic.title
                    },
                    aliases: [topic.title]
                };
               
                // 同时初始化TOPIC_AREAS
                TOPIC_AREAS[topicKey] = {
                    title: topic.title,
                    description: topic.description,
                    icon: topic.icon,
                    display_names: {
                        "zh": topic.title,
                        "en": topic.title
                    },
                    aliases: [topic.title]
                };
            });

            return config;
        }

        // 从配置文件加载文档列表
        async function loadDocumentsFromConfig() {
            try {
                // 首先尝试从配置文件加载文档列表
                if (DOC_CONFIG && DOC_CONFIG.all_files && DOC_CONFIG.all_files.length > 0) {
                    console.log('从配置文件加载文档列表');
                    ALL_DOCS = [...DOC_CONFIG.all_files];
                    
                    // 确保每个文档都有必要的字段
                    ALL_DOCS = ALL_DOCS.map(doc => {
                        // 处理标签格式
                        let tags = [];
                        if (doc.tags) {
                            if (Array.isArray(doc.tags)) {
                                tags = doc.tags;
                            } else if (typeof doc.tags === 'string') {
                                // 处理可能的JSON字符串格式
                                try {
                                    const parsedTags = JSON.parse(doc.tags);
                                    tags = Array.isArray(parsedTags) ? parsedTags : [parsedTags];
                                } catch (e) {
                                    // 如果不是JSON，按逗号分割
                                    tags = doc.tags.split(',').map(t => t.trim());
                                }
                            }
                        }

                        return {
                            filename: doc.filename,
                            path: doc.path || doc.filename,
                            title: doc.title || doc.filename.replace('.md', ''),
                            author: doc.author || '未知',
                            category: doc.category || '入门',
                            topic: doc.topic || 'mod-basics',
                            order: parseInt(doc.order) || 999,
                            description: doc.description || '',
                            tags: tags,
                            last_updated: doc.last_updated || '未知',
                            difficulty: doc.difficulty || 'beginner',
                        };
                    });
                    
                    console.log('从配置文件加载的文档:', ALL_DOCS);
                    return;
                }
                
                // 如果配置文件中没有文档列表，尝试扫描目录
                console.log('配置文件中没有文档列表，尝试扫描目录');
                await scanDocumentsFromDirectory();
                
            } catch (error) {
                console.error('从配置文件加载文档失败:', error);
                // 提供一些默认文档
                ALL_DOCS = [
                    {
                        filename: 'Modder入门/DPapyru-给新人的前言.md',
                        title: '给新人的前言',
                        author: '小天使',
                        category: 'Modder入门',
                        topic: 'mod-basics',
                        order: 1,
                        description: '新人要看一下前言',
                        tags: ['Modder入门', '新手必看'],
                        last_updated: '2025-12-02',
                        difficulty: 'beginner',
                    }
                ];
            }
        }

        // 扫描目录获取文档列表（备用方法）
        async function scanDocumentsFromDirectory() {
            try {
                // 获取docs目录下的所有.md文件
                const docsResponse = await fetch('./');
                if (!docsResponse.ok) {
                    throw new Error('无法获取docs目录列表');
                }

                const htmlText = await docsResponse.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const links = doc.querySelectorAll('a[href$=".md"]');
                
                ALL_DOCS = [];
                
                for (const link of links) {
                    const filename = link.getAttribute('href');
                    if (filename && filename.endsWith('.md')) {
                        try {
                            // 获取文档内容和元数据
                            const docResponse = await fetch(`./${filename}`);
                            if (docResponse.ok) {
                                const content = await docResponse.text();
                                const { metadata } = parseFrontMatter(content);
                                
                                const docInfo = {
                                    filename: filename,
                                    title: metadata.title || filename.replace('.md', ''),
                                    author: metadata.author || '未知',
                                    category: metadata.category || '入门',
                                    topic: metadata.topic || 'mod-basics',
                                    order: parseInt(metadata.order) || 999,
                                    description: metadata.description || '',
                                    tags: metadata.tags ? metadata.tags.split(',').map(t => t.trim()) : [],
                                    last_updated: metadata.last_updated || '未知',
                                    difficulty: metadata.difficulty || 'beginner',
                                };
                                
                                ALL_DOCS.push(docInfo);
                            }
                        } catch (error) {
                            console.warn(`无法处理文档 ${filename}:`, error);
                        }
                    }
                }
                
                // 按分类和排序
                ALL_DOCS.sort((a, b) => {
                    if (a.category !== b.category) {
                        return MAIN_CATEGORIES[a.category].order - MAIN_CATEGORIES[b.category].order;
                    }
                    return a.order - b.order;
                });
                
                console.log('扫描到的文档:', ALL_DOCS);
                
            } catch (error) {
                console.error('扫描文档失败:', error);
                throw error;
            }
        }

        // 查找主题信息的辅助函数，支持新的配置结构和向后兼容性
        function findTopicInfo(topicKey) {
            // 首先尝试直接查找
            let topic = TOPIC_AREAS[topicKey];
            if (topic) {
                return topic;
            }
            
            // 如果直接找不到，尝试通过 aliases 查找
            Object.keys(TOPIC_AREAS).forEach(key => {
                const area = TOPIC_AREAS[key];
                if (area.aliases && area.aliases.includes(topicKey)) {
                    topic = area;
                }
            });
            
            // 如果还是找不到，尝试通过旧的 english_key 查找（向后兼容）
            if (!topic) {
                Object.keys(TOPIC_AREAS).forEach(key => {
                    const area = TOPIC_AREAS[key];
                    if (area.english_key === topicKey) {
                        topic = area;
                    }
                });
            }
            
            return topic;
        }

        // 获取主题的显示名称，根据当前语言环境
        function getTopicDisplayName(topic, language = 'zh') {
            if (!topic) return '';
            
            // 如果有 display_names 配置，优先使用
            if (topic.display_names && topic.display_names[language]) {
                return topic.display_names[language];
            }
            
            // 否则使用默认的 title
            return topic.title || '';
        }

        // 使用文档信息更新配置
        function updateConfigWithDocument(docInfo) {
            const { category, topic } = docInfo;
            
            // 确保分类存在
            if (!DOC_CONFIG.categories[category]) {
                DOC_CONFIG.categories[category] = {
                    title: category,
                    description: `${category}相关文档`,
                    topics: {}
                };
            }
            
            // 确保主题存在
            if (!DOC_CONFIG.categories[category].topics[topic]) {
                // 使用新的辅助函数查找主题信息
                const topicInfo = findTopicInfo(topic);
                
                DOC_CONFIG.categories[category].topics[topic] = {
                    title: getTopicDisplayName(topicInfo) || topic,
                    description: topicInfo?.description || '',
                    icon: topicInfo?.icon || '',
                    files: []
                };
            }
            
            // 添加文件到对应主题
            DOC_CONFIG.categories[category].topics[topic].files.push(docInfo);
            
            // 更新作者信息
            if (!DOC_CONFIG.authors[docInfo.author]) {
                DOC_CONFIG.authors[docInfo.author] = {
                    name: docInfo.author,
                    files: []
                };
            }
            DOC_CONFIG.authors[docInfo.author].files.push(docInfo.filename);
            
            // 添加到所有文件列表
            DOC_CONFIG.all_files.push(docInfo);
        }

        // 解析Front Matter（文档开头的元数据部分）
        function parseFrontMatter(text) {
            const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
            const match = text.match(frontMatterRegex);

            if (match) {
                const metadata = {};
                const metadataLines = match[1].split('\n');

                metadataLines.forEach(line => {
                    const colonIndex = line.indexOf(':');
                    if (colonIndex > 0) {
                        const key = line.substring(0, colonIndex).trim();
                        const value = line.substring(colonIndex + 1).trim();
                        metadata[key] = value;
                    }
                });

                return {
                    metadata: metadata,
                    content: match[2]
                };
            }

            return {
                metadata: {},
                content: text
            };
        }

	        // 生成文档分类卡片
	        function generateCategoryCards() {
	            const esc = (window.SiteUtils && typeof window.SiteUtils.escapeHtml === 'function')
	                ? window.SiteUtils.escapeHtml
	                : (v) => String(v);

	            const normalizeDifficultyClass = (difficulty) => {
	                const allowed = ['beginner', 'intermediate', 'advanced'];
	                if (difficulty === 'all') return 'beginner';
	                return allowed.includes(difficulty) ? difficulty : 'beginner';
	            };

	            const categoryGrid = document.getElementById('category-grid');
            
            // 清空现有内容
            categoryGrid.innerHTML = '';
            
            // 获取所有分类并按排序
            const sortedCategories = Object.keys(MAIN_CATEGORIES).sort((a, b) => {
                return MAIN_CATEGORIES[a].order - MAIN_CATEGORIES[b].order;
            });
            
            // 按分类顺序生成卡片
            sortedCategories.forEach(categoryKey => {
                const category = MAIN_CATEGORIES[categoryKey];
                
                // 获取该分类下的所有文档
                const categoryDocs = ALL_DOCS.filter(doc => doc.category === categoryKey);
                
                if (categoryDocs.length === 0) {
                    return; // 如果没有文档，跳过该分类
                }
                
                // 创建分类卡片
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                categoryCard.id = categoryKey.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
                
                // 创建分类头部
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                // 添加点击事件，链接到 folder.html 页面
                categoryHeader.addEventListener('click', function() {
                    window.location.href = `folder.html?path=${encodeURIComponent(categoryKey)}`;
                });
                
	                categoryHeader.innerHTML = `
	                    <h3 class="category-title">${esc(category.title)}</h3>
	                    <p class="category-description">${esc(category.description)}</p>
	                `;
                
                // 创建分类内容
                const categoryContent = document.createElement('div');
                categoryContent.className = 'category-content';
                
                // 创建文档列表
                const docList = document.createElement('ul');
                docList.className = 'doc-list';
                
                // 按主题分组显示文档
                const topicGroups = {};
                categoryDocs.forEach(doc => {
                    if (!topicGroups[doc.topic]) {
                        topicGroups[doc.topic] = [];
                    }
                    topicGroups[doc.topic].push(doc);
                });
                
                // 为每个主题创建文档项
                Object.keys(topicGroups).forEach(topicKey => {
                    // 使用新的辅助函数查找主题信息
                    const topic = findTopicInfo(topicKey);
                    const topicDocs = topicGroups[topicKey];
                    
                    // 限制最多显示3个文档
                    const docsToShow = topicDocs.slice(0, 3);
                    const hasMore = topicDocs.length > 3;
                    
                    docsToShow.forEach(doc => {
                        const docItem = document.createElement('li');
                        docItem.className = 'doc-item';
                        
                        const docLink = document.createElement('a');
                        docLink.className = 'doc-link';
                        docLink.href = `viewer.html?file=${encodeURIComponent(doc.path || doc.filename)}`;
                        docLink.title = `${doc.author} - ${doc.description || doc.title}`;
                        
	                        const difficultyClass = normalizeDifficultyClass(doc.difficulty);
	                        const difficultyText = getDifficultyText(doc.difficulty);
                        
	                        docLink.innerHTML = `
	                            <div class="doc-info">
	                                <div class="doc-title">${esc(doc.title)}</div>
	                                <div class="doc-meta">
	                                    <span class="difficulty-badge ${difficultyClass}">${esc(difficultyText)}</span>
	                                    <span>作者: ${esc(doc.author)}</span>
	                                </div>
	                            </div>
	                        `;
                        
                        docItem.appendChild(docLink);
                        docList.appendChild(docItem);
                    });
                    
                    // 如果有更多文档，添加省略号项
                    if (hasMore) {
                        const moreItem = document.createElement('li');
                        moreItem.className = 'doc-item';
                        
                        const moreLink = document.createElement('div');
                        moreLink.className = 'doc-link';
                        moreLink.style.cursor = 'pointer';
                        moreLink.style.color = 'var(--link-color)';
                        moreLink.style.fontStyle = 'italic';
                        moreLink.innerHTML = `
                            <div class="doc-info">
                                <div class="doc-title">... 还有 ${topicDocs.length - 3} 个文档</div>
                                <div class="doc-meta">
                                    <span>点击查看所有文档</span>
                                </div>
                            </div>
                        `;
                        
                        // 添加点击事件，跳转到文件夹页面
                        moreLink.addEventListener('click', function() {
                            window.location.href = `folder.html?path=${encodeURIComponent(categoryKey)}`;
                        });
                        
                        moreItem.appendChild(moreLink);
                        docList.appendChild(moreItem);
                    }
                });

                const docPaths = categoryDocs.map(doc => doc.path || doc.filename).filter(Boolean);
                const subfolderEntries = (window.FolderFilter && typeof window.FolderFilter.buildSubfolderEntries === 'function')
                    ? window.FolderFilter.buildSubfolderEntries(docPaths, categoryKey)
                    : [];

                if (subfolderEntries.length === 0) {
                    categoryContent.appendChild(docList);
                }

                if (subfolderEntries.length > 0) {
                    const subfolderList = document.createElement('ul');
                    subfolderList.className = 'doc-list';

                    subfolderEntries.forEach(entry => {
                        const subfolderItem = document.createElement('li');
                        subfolderItem.className = 'doc-item';

                        const subfolderLink = document.createElement('a');
                        subfolderLink.className = 'doc-link';
                        subfolderLink.href = `folder.html?path=${encodeURIComponent(entry.path)}`;

                        subfolderLink.innerHTML = `
                            <div class="doc-info">
                                <div class="doc-title">${esc(entry.label)}</div>
                                <div class="doc-meta">
                                    <span>子目录</span>
                                </div>
                            </div>
                        `;

                        subfolderItem.appendChild(subfolderLink);
                        subfolderList.appendChild(subfolderItem);
                    });

                    categoryContent.appendChild(subfolderList);
                }
                categoryCard.appendChild(categoryHeader);
                categoryCard.appendChild(categoryContent);
                categoryGrid.appendChild(categoryCard);
            });
            
            // 如果没有任何文档，显示提示信息
            if (ALL_DOCS.length === 0) {
                const noDocsMessage = document.createElement('div');
                noDocsMessage.className = 'no-docs-message';
                noDocsMessage.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>暂无文档</h3>
                        <p>当前目录下没有找到任何文档文件。</p>
                    </div>
                `;
                categoryGrid.appendChild(noDocsMessage);
            }
        }

        // 获取难度文本 - 优先从配置文件读取，否则使用默认值
        function getDifficultyText(difficulty) {
            // 首先尝试从配置文件中获取难度映射
            if (DOC_CONFIG && DOC_CONFIG.extensions && DOC_CONFIG.extensions.customFields &&
                DOC_CONFIG.extensions.customFields.difficulty && DOC_CONFIG.extensions.customFields.difficulty.options) {
                const difficultyOptions = DOC_CONFIG.extensions.customFields.difficulty.options;
                const difficultyMap = {
                    'beginner': '初级',
                    'intermediate': '中级',
                    'advanced': '高级',
                    'all': '全部级别'
                };
                
                // 如果配置中有自定义映射，使用配置中的映射
                if (difficultyOptions.includes(difficulty)) {
                    return difficultyMap[difficulty] || difficulty;
                }
            }
            
            // 默认难度映射
            const defaultDifficultyMap = {
                'beginner': '初级',
                'intermediate': '中级',
                'advanced': '高级',
                'all': '全部级别'
            };
            return defaultDifficultyMap[difficulty] || difficulty;
        }


        // 生成快速链接
        function generateQuickLinks() {
            const quickLinksGrid = document.getElementById('quick-links-grid');
            
            if (!quickLinksGrid) return;
            
            // 清空现有内容
            quickLinksGrid.innerHTML = '';
            
            // 定义快速链接配置
            const quickLinksConfig = [
                {
                    title: '完整教程索引',
                    description: '查看所有教程的完整列表和详细信息',
                    action: 'view-all',
                    buttonClass: 'btn-outline'
                },
                {
                    title: '快速开始',
                    description: '立即开始你的第一个Mod制作之旅',
                    action: 'get-started',
                    buttonClass: 'btn-primary'
                },
                {
                    title: 'API参考',
                    description: '查阅完整的tModLoader API文档',
                    action: 'api-reference',
                    buttonClass: 'btn-outline'
                },
                {
                    title: '社区支持',
                    description: '获取帮助和参与社区讨论',
                    action: 'community',
                    buttonClass: 'btn-outline'
                }
            ];
            
            // 生成快速链接卡片
            quickLinksConfig.forEach(linkConfig => {
                const quickLinkCard = document.createElement('div');
                quickLinkCard.className = 'quick-link-card';
                
                let buttonHtml = '';
                let buttonLink = '#';
                
                // 根据动作类型确定链接
                switch (linkConfig.action) {
                    case 'view-all':
                        // 查找第一个文档
                        if (ALL_DOCS.length > 0) {
                            buttonLink = `viewer.html?file=${encodeURIComponent(ALL_DOCS[0].path || ALL_DOCS[0].filename)}`;
                        }
                        break;
                    case 'get-started':
                        // 查找入门分类的第一个文档
                        const beginnerDoc = ALL_DOCS.find(doc => doc.category === '入门');
                        if (beginnerDoc) {
                            buttonLink = `viewer.html?file=${encodeURIComponent(beginnerDoc.path || beginnerDoc.filename)}`;
                        }
                        break;
                    case 'api-reference':
                        // 查找高级或进阶分类的文档
                        const apiDoc = ALL_DOCS.find(doc =>
                            doc.category === '高级' || doc.category === '进阶'
                        );
                        if (apiDoc) {
                            buttonLink = `viewer.html?file=${encodeURIComponent(apiDoc.path || apiDoc.filename)}`;
                        }
                        break;
                    case 'community':
                        buttonLink = 'https://github.com/DPapyru/DPapyru.github.io';
                        break;
                }
                
                quickLinkCard.innerHTML = `
                    <div class="quick-link-text">
                        <h3 class="quick-link-title">${linkConfig.title}</h3>
                        <p class="quick-link-description">${linkConfig.description}</p>
                    </div>
                    <a href="${buttonLink}" class="btn btn-small ${linkConfig.buttonClass}"
                       ${linkConfig.action === 'community' ? 'target="_blank" rel="noopener noreferrer"' : ''}>
                        ${linkConfig.action === 'view-all' ? '查看索引' :
                          linkConfig.action === 'get-started' ? '开始学习' :
                          linkConfig.action === 'api-reference' ? '查看API' : 'GitHub'}
                    </a>
                `;
                
                quickLinksGrid.appendChild(quickLinkCard);
            });
        }

        // 初始化平滑滚动
        function initSmoothScroll() {
            // 获取所有锚点链接
            const anchorLinks = document.querySelectorAll('a[href^="#"]');
            
            anchorLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                        // 计算目标位置，考虑固定头部的高度
                        const headerHeight = document.querySelector('.site-header').offsetHeight;
                        const targetPosition = targetElement.offsetTop - headerHeight - 20;
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }
    </script>
</body>

</html>
