<!DOCTYPE html>
<!-- æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£æŸ¥çœ‹å™¨é¡µé¢ -->
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£æŸ¥çœ‹å™¨ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹</title>

    <!-- SEOä¼˜åŒ–æ ‡ç­¾ï¼ˆå®é™…å€¼ä¼šåœ¨è„šæœ¬ä¸­æ ¹æ® ?file å’Œæ–‡æ¡£å…ƒæ•°æ®æ›´æ–°ï¼‰ -->
    <meta name="description" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£é˜…è¯»é¡µé¢ï¼Œæ”¯æŒç›®å½•ã€ä»£ç é«˜äº®ä¸åˆ†ç±»å¯¼èˆªã€‚">
    <meta name="keywords" content="æ³°æ‹‰ç‘äºš,Mod,æ•™ç¨‹,tModLoader,C#,æ–‡æ¡£">
    <meta name="author" content="æ³°æ‹‰ç‘äºšModç¤¾åŒº">
    <meta name="robots" content="index, follow">

    <!-- Open Graphæ ‡ç­¾ -->
    <meta property="og:title" content="æ–‡æ¡£æŸ¥çœ‹å™¨ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹">
    <meta property="og:description" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£é˜…è¯»é¡µé¢ï¼Œæ”¯æŒç›®å½•ã€ä»£ç é«˜äº®ä¸åˆ†ç±»å¯¼èˆªã€‚">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://dpapyru.github.io/docs/viewer.html">
    <meta property="og:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">
    <meta property="og:site_name" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹">
    <meta property="og:locale" content="zh_CN">

    <!-- Twitter Cardæ ‡ç­¾ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="æ–‡æ¡£æŸ¥çœ‹å™¨ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹">
    <meta name="twitter:description" content="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£é˜…è¯»é¡µé¢ï¼Œæ”¯æŒç›®å½•ã€ä»£ç é«˜äº®ä¸åˆ†ç±»å¯¼èˆªã€‚">
    <meta name="twitter:image" content="https://dpapyru.github.io/assets/imgs/Green_tModLoader.png">

    <!-- è§„èŒƒURLï¼ˆå®é™…å€¼ä¼šåœ¨è„šæœ¬ä¸­æ ¹æ® ?file æ›´æ–°ï¼‰ -->
    <link rel="canonical" href="https://dpapyru.github.io/docs/viewer.html">

    <!-- åŠ è½½CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../assets/css/style.css"> <!-- ä¸»æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../assets/css/prism.min.css"> <!-- ä»£ç é«˜äº®æ ·å¼ -->
    <link rel="stylesheet" href="../assets/css/vs2022-theme.css"> <!-- VS2022ä»£ç é«˜äº®ä¸»é¢˜ -->
    <link rel="icon" type="image/png" href="../assets/imgs/Green_tModLoader.png"> <!-- ç½‘ç«™å›¾æ ‡ -->

    <!-- ä¸»é¢˜åˆ‡æ¢è„šæœ¬ - æ—©æœŸåŠ è½½ä»¥é¿å…é—ªçƒ -->
    <script src="../assets/js/theme-init.js"></script>
</head>

<body class="viewer-page">
    <a class="skip-link" href="#main-content">è·³åˆ°ä¸»è¦å†…å®¹</a>
    <!-- ç½‘ç«™å¤´éƒ¨å¯¼èˆªåŒºåŸŸ -->
    <header class="site-header">
        <div class="container">
            <!-- å¤´éƒ¨å†…å®¹å®¹å™¨ï¼šåŒ…å«ç½‘ç«™logoã€å¯¼èˆªèœå•å’Œç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
            <div class="header-content">
                <!-- ç½‘ç«™logoå’Œæ ‡é¢˜ -->
                <div class="logo">
                    <a href="../index.html">
                        <img src="../assets/imgs/Green_tModLoader.png" alt="æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹" class="logo-image">
                        <h1 class="site-title">æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹</h1>
                    </a>
                </div>
                <!-- ä¸»å¯¼èˆªèœå• -->
                <nav class="main-nav" id="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">é¦–é¡µ</a></li>
                        <li class="nav-item"><a href="index.html" class="nav-link active" aria-current="page">æ–‡æ¡£</a></li>
                        <li class="nav-item"><a href="https://github.com/DPapyru/DPapyru.github.io" class="nav-link"
                                target="_blank" rel="noopener noreferrer">GitHub</a></li>
                    </ul>
                </nav>
                <!-- ç§»åŠ¨ç«¯èœå•åˆ‡æ¢æŒ‰é’® -->
	                <button class="mobile-menu-toggle" type="button" aria-label="åˆ‡æ¢èœå•" aria-controls="main-nav" aria-expanded="false">
	                    <span class="bar"></span>
	                    <span class="bar"></span>
	                    <span class="bar"></span>
	                </button>
	                <!-- æ‰‹æœºç«¯æ–‡æ¡£å¯¼èˆªæŒ‰é’® -->
	                <button class="mobile-nav-toggle" id="mobile-nav-toggle" type="button" aria-label="æ–‡æ¡£å¯¼èˆª" aria-controls="mobile-nav-overlay" aria-expanded="false">
	                    <span class="nav-icon">â˜°</span>
	                    <span class="nav-text">å¯¼èˆª</span>
	                </button>
            </div>
        </div>
    </header>

    <!-- ç½‘ç«™ä¸»ä½“å®¹å™¨ï¼šåŒ…å«ä¾§è¾¹æ å’Œä¸»å†…å®¹åŒº -->
    <div class="site-container">
        <!-- å·¦ä¾§è¾¹æ ï¼šæ–‡æ¡£å¯¼èˆªå’Œç›¸å…³é“¾æ¥ -->
        <aside class="sidebar">
            <div class="sidebar-content">
                <!-- ä¾§è¾¹æ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡æ¡£å¯¼èˆª -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">æ–‡æ¡£å¯¼èˆª</h3>
                    <ul class="sidebar-list" id="category-sidebar">
                        <!-- åˆ†ç±»ä¾§è¾¹æ å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                </div>
                <!-- ä¾§è¾¹æ ç¬¬äºŒéƒ¨åˆ†ï¼šå½“å‰åˆ†ç±»æ–‡æ¡£ -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title" id="current-category-title">å½“å‰åˆ†ç±»</h3>
                    <ul class="sidebar-list" id="current-category-docs">
                        <!-- å½“å‰åˆ†ç±»çš„æ–‡æ¡£åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                </div>
                <!-- ä¾§è¾¹æ ç¬¬ä¸‰éƒ¨åˆ†ï¼šè´¡çŒ®è€…ä¿¡æ¯ -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">è´¡çŒ®è€…</h3>
                    <div class="contributors">
                        <p>æ¬¢è¿å‚ä¸è´¡çŒ®ï¼</p>
                        <a href="viewer.html?file=æ€ä¹ˆè´¡çŒ®/DPapyru-è´¡çŒ®è€…å¦‚ä½•ç¼–å†™æ–‡ç« åŸºç¡€.md" class="btn btn-small">å¦‚ä½•è´¡çŒ®</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒºåŸŸï¼šæ˜¾ç¤ºMarkdownæ–‡æ¡£å†…å®¹ -->
        <main class="main-content" id="main-content" tabindex="-1">
            <div class="content-wrapper">
                <!-- æ•™ç¨‹å¤´éƒ¨åŒºåŸŸï¼šåŒ…å«é¢åŒ…å±‘å¯¼èˆªå’Œæ–‡æ¡£å…ƒä¿¡æ¯ -->
                <div class="tutorial-header">
                    <!-- é¢åŒ…å±‘å¯¼èˆª -->
                    <div class="breadcrumb">
                        <a href="../index.html">é¦–é¡µ</a> &gt;
                        <a href="index.html">æ–‡æ¡£</a> &gt;
                        <span class="current" id="current-doc-name">æ–‡æ¡£</span>
                    </div>
                    <!-- æ–‡æ¡£æ ‡é¢˜ -->
                    <h1 class="tutorial-title" id="doc-title">æ–‡æ¡£</h1>
                    <!-- æ–‡æ¡£å…ƒä¿¡æ¯ï¼šéš¾åº¦ã€æ—¶é—´ã€ä½œè€…ã€æ›´æ–°æ—¥æœŸ -->
                    <div class="tutorial-meta" id="doc-meta">
                        <span class="difficulty">éš¾åº¦: <span class="difficulty-badge" id="doc-difficulty">æœªçŸ¥</span></span>
                        <span class="time">é¢„è®¡æ—¶é—´: <span id="doc-time">æœªçŸ¥</span></span>
                        <span class="author">ä½œè€…: <span id="doc-author">æœªçŸ¥</span></span>
                        <span class="date">æ›´æ–°æ—¥æœŸ: <span id="doc-date">æœªçŸ¥</span></span>
                    </div>
                </div>

                <!-- æ•™ç¨‹å†…å®¹åŒºåŸŸï¼šåŠ è½½å’Œæ˜¾ç¤ºMarkdownå†…å®¹ -->
                <div class="tutorial-content">
                    <!-- åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ï¼šæ˜¾ç¤ºå†…å®¹åŠ è½½ä¸­çš„æç¤º -->
                    <div id="loading-indicator" class="loading-indicator" role="status" aria-live="polite" aria-busy="true">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
                    </div>

                    <!-- é”™è¯¯ä¿¡æ¯å®¹å™¨ï¼šå½“å†…å®¹åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ -->
                    <div id="error-message" class="error-message" style="display: none;" role="alert" aria-live="assertive" aria-hidden="true">
                        <h3>åŠ è½½å¤±è´¥</h3>
                        <p id="error-text">æ— æ³•åŠ è½½æ–‡æ¡£å†…å®¹ï¼Œè¯·ç¨åå†è¯•ã€‚</p>
                    </div>

                    <!-- ç›®å½•å®¹å™¨ï¼šè‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ç›®å½• -->
                    <nav id="table-of-contents" class="table-of-contents" style="display: none;" aria-label="ç›®å½•">
                        <h3>ç›®å½•</h3>
                        <ul id="toc-list"></ul>
                    </nav>

                    <!-- Markdownå†…å®¹å®¹å™¨ï¼šæ¸²æŸ“åçš„HTMLå†…å®¹å°†æ’å…¥è¿™é‡Œ -->
                    <div id="markdown-content" class="markdown-content" style="display: none;">
                        <!-- æ–‡æ¡£å†…å®¹å°†é€šè¿‡Markdownæ¸²æŸ“åæ’å…¥è¿™é‡Œ -->
                    </div>
                </div>

                <!-- æ•™ç¨‹åº•éƒ¨åŒºåŸŸï¼šå¯¼èˆªé“¾æ¥å’Œåé¦ˆè¡¨å• -->
                <div class="tutorial-footer">
                    <!-- æ•™ç¨‹å¯¼èˆªï¼šä¸Šä¸€ç¯‡/ä¸‹ä¸€ç¯‡é“¾æ¥ -->
                    <div class="tutorial-navigation">
                        <a href="index.html" class="btn btn-outline prev-tutorial">â† è¿”å›æ–‡æ¡£åˆ—è¡¨</a>
                        <a href="?file=Modderå…¥é—¨/DPapyru-ç»™æ–°äººçš„å‰è¨€.md" class="btn btn-secondary">æŸ¥çœ‹æ•™ç¨‹</a>
                        <a href="?file=æ€ä¹ˆè´¡çŒ®/DPapyru-è´¡çŒ®è€…å¦‚ä½•ç¼–å†™æ–‡ç« åŸºç¡€.md" class="btn btn-primary next-tutorial">è´¡çŒ®æŒ‡å— â†’</a>
                    </div>
                    <!-- æ•™ç¨‹åé¦ˆï¼šç”¨æˆ·åé¦ˆå’Œé—®é¢˜æäº¤ -->
                    <div class="tutorial-feedback">
                        <h3>æ•™ç¨‹åé¦ˆ</h3>
                        <p>å¦‚æœä½ å¯¹æœ¬æ•™ç¨‹æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨GitHubä¸Šæå‡ºIssueæˆ–PRã€‚</p>
                        <a href="https://github.com/DPapyru/DPapyru.github.io/issues" class="btn btn-small"
                            target="_blank" rel="noopener noreferrer">æä¾›åé¦ˆ</a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ç½‘ç«™åº•éƒ¨åŒºåŸŸ -->
    <footer class="site-footer">
        <div class="container">
            <!-- åº•éƒ¨å†…å®¹å®¹å™¨ -->
            <div class="footer-content">
                <!-- åº•éƒ¨ç¬¬ä¸€æ ï¼šå…³äºé¡¹ç›® -->
                <div class="footer-section">
                    <h4>å…³äºé¡¹ç›®</h4>
                    <p>è¿™æ˜¯ä¸€ä¸ªé¢å‘æ³°æ‹‰ç‘äºšModå¼€å‘è€…çš„åä½œæ•™ç¨‹é¡¹ç›®ï¼Œæ—¨åœ¨é™ä½Modåˆ¶ä½œé—¨æ§›ã€‚</p>
                </div>
                <!-- åº•éƒ¨ç¬¬äºŒæ ï¼šå¿«é€Ÿé“¾æ¥ -->
                <div class="footer-section">
                    <h4>å¿«é€Ÿé“¾æ¥</h4>
                    <ul>
                        <li><a href="../index.html">é¦–é¡µ</a></li>
                        <li><a href="index.html">æ–‡æ¡£</a></li>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                    </ul>
                </div>
                <!-- åº•éƒ¨ç¬¬ä¸‰æ ï¼šè”ç³»æˆ‘ä»¬ -->
                <div class="footer-section">
                    <h4>è”ç³»æˆ‘ä»¬</h4>
                    <ul>
                        <li><a href="https://github.com/DPapyru/DPapyru.github.io" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li><a href="mailto:contact@example.com">é‚®ç®±</a></li>
                    </ul>
                </div>
            </div>
            <!-- åº•éƒ¨ç‰ˆæƒä¿¡æ¯ -->
            <div class="footer-bottom">
                <p>&copy; 2023 æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹. é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">CC
                        BY 4.0</a> è®¸å¯åè®®ã€‚</p>
            </div>
        </div>
    </footer>

    <!-- æ‰‹æœºç«¯å¯¼èˆªè¦†ç›–å±‚ -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay" role="dialog" aria-modal="true" aria-label="æ–‡æ¡£å¯¼èˆª" aria-hidden="true">
        <!-- å¯¼èˆªåŒºåŸŸ (å å±å¹•2/3) -->
        <div class="mobile-nav-content">
            <div class="mobile-nav-header">
                <h3>æ–‡æ¡£å¯¼èˆª</h3>
                <button class="mobile-nav-close" id="mobile-nav-close" type="button" aria-label="å…³é—­å¯¼èˆª">âœ•</button>
            </div>
            <div class="mobile-nav-body">
                <!-- å¯¼èˆªå†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                <div class="mobile-nav-sections" id="mobile-nav-sections">
                    <!-- åˆ†ç±»å¯¼èˆªå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        <!-- åŠé€æ˜è¿”å›åŒºåŸŸ (å å±å¹•1/3) -->
        <button class="mobile-nav-back" id="mobile-nav-back" type="button" aria-label="è¿”å›æ–‡ç« ">
            <div class="mobile-nav-back-hint">
                <p>ç‚¹å‡»æ­¤å¤„è¿”å›æ–‡ç« </p>
                <div class="back-arrow">â†‘</div>
            </div>
        </button>
    </div>

	    <!-- åŠ è½½JavaScriptæ–‡ä»¶ -->
	    <script src="../assets/js/site-config.js"></script>
	    <script src="../assets/js/marked.min.js"></script> <!-- Markdownè§£æåº“ -->
	    <script src="../assets/js/prism.min.js"></script> <!-- ä»£ç é«˜äº®åº“ -->
	    <script src="../assets/js/prism-csharp.min.js"></script> <!-- C#è¯­è¨€é«˜äº®æ”¯æŒ -->
    <script>
        // è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå‘Šè¯‰main.jsè¿™æ˜¯viewer.htmlé¡µé¢ï¼Œä¸è¦æ‰§è¡Œè‡ªåŠ¨åŠ è½½
        window.IS_VIEWER_PAGE = true;

        // ç¦ç”¨main.jsä¸­çš„è·¯ç”±ç³»ç»Ÿï¼Œé¿å…å¹²æ‰°viewer.htmlçš„æ–‡ä»¶åŠ è½½
        window.DISABLE_ROUTER = true;
    </script>
    <script src="../assets/js/main.js"></script> <!-- ä¸»è¦åŠŸèƒ½è„šæœ¬ -->
    <script src="../assets/js/navigation.js"></script> <!-- å¯¼èˆªåŠŸèƒ½è„šæœ¬ -->

    <script>
        // æ–‡æ¡£é…ç½®å’Œå…ƒæ•°æ®ç®¡ç†
        let VIEWER_DOC_CONFIG = null;
        let ALL_DOCS = [];
        let CURRENT_DOC_PATH = null;
        let DOC_LOOKUP_MAP = null;

        // ä¸»åˆ†ç±»é…ç½® - å°†ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½
        let MAIN_CATEGORIES = {};
        
        // ä¸»é¢˜é¢†åŸŸé…ç½® - å°†ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½
        let TOPIC_AREAS = {};
        
        // è·¯å¾„é‡å®šå‘æ˜ å°„ - å°†ä»é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½
        let VIEWER_PATH_REDIRECTS = {};

        // æ–‡æ¡£æŸ¥çœ‹å™¨çš„ä¸»è¦JavaScripté€»è¾‘
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== docs/viewer.html: é¡µé¢åŠ è½½å®Œæˆ ===');
            console.log('=== è¯Šæ–­ä¿¡æ¯ ===');
            console.log('å½“å‰é¡µé¢URL:', window.location.href);
            console.log('å½“å‰é¡µé¢è·¯å¾„:', window.location.pathname);
            console.log('å½“å‰æœç´¢å‚æ•°:', window.location.search);

            // åˆå§‹åŒ–ä¾§è¾¹æ æ»šåŠ¨åŠŸèƒ½
            initializeSidebarScrolling();

            // åˆå§‹åŒ–æ–‡æ¡£é…ç½®
            initializeDocumentConfig().then(() => {
                // åˆå§‹åŒ–åˆ†ç±»å¯¼èˆª
                initializeCategoryNavigation();

                // ä»URLå‚æ•°è·å–è¦åŠ è½½çš„Markdownæ–‡ä»¶
                const urlParams = new URLSearchParams(window.location.search);
                let markdownFile = urlParams.get('file');
                console.log('ä»URLå‚æ•°è·å–çš„æ–‡ä»¶å:', markdownFile);

                // å¦‚æœæ²¡æœ‰æŒ‡å®šæ–‡ä»¶ï¼Œå°è¯•ä»è·¯å¾„ä¸­è·å–
                if (!markdownFile) {
                    const pathParts = window.location.pathname.split('/');
                    markdownFile = pathParts[pathParts.length - 1];
                    console.log('ä»è·¯å¾„è·å–çš„æ–‡ä»¶å:', markdownFile);
                }

                // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œé»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªå¯ç”¨çš„æ–‡æ¡£
                if (!markdownFile || !markdownFile.endsWith('.md')) {
                    // å°è¯•ä»é…ç½®ä¸­è·å–ç¬¬ä¸€ä¸ªæ–‡æ¡£
                    if (ALL_DOCS && ALL_DOCS.length > 0) {
                        markdownFile = ALL_DOCS[0].filename || ALL_DOCS[0].path;
                        console.log('ä½¿ç”¨é…ç½®ä¸­çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£:', markdownFile);
                    } else {
                        // å¦‚æœæ²¡æœ‰é…ç½®ï¼Œä½¿ç”¨å·²çŸ¥çš„æ–‡æ¡£
                        markdownFile = 'Modderå…¥é—¨/DPapyru-ç»™æ–°äººçš„å‰è¨€.md';
                        console.log('ä½¿ç”¨é»˜è®¤æ–‡æ¡£:', markdownFile);
                    }
                }

                console.log(`docs/viewer.html: å‡†å¤‡åŠ è½½Markdownæ–‡ä»¶: ${markdownFile}`);

                // å»¶è¿ŸåŠ è½½ï¼Œç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½å·²åˆå§‹åŒ–
                setTimeout(function () {
                    // ç›´æ¥ä½¿ç”¨æœ¬åœ°åŠ è½½å‡½æ•°ï¼Œé¿å…main.jsä¸­çš„è·¯å¾„å¤„ç†é—®é¢˜
                    console.log('docs/viewer.html: ä½¿ç”¨æœ¬åœ°loadMarkdownDirectlyå‡½æ•°');
                    loadMarkdownDirectly(markdownFile);
                }, 200);
            });

            // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
            initializeDropdownMenu();

            // åˆå§‹åŒ–æ‰‹æœºç«¯å¯¼èˆª
            initializeMobileNavigation();

            // åˆå§‹åŒ–MDæ¸²æŸ“å™¨
            initializeMarkedRender();
        });

	        async function initializeMarkedRender() {
	            console.log('åˆå§‹åŒ–MDæ¸²æŸ“å™¨...');

	            try {
	                function escapeHtml(text) {
	                    return String(text)
	                        .replace(/&/g, '&amp;')
	                        .replace(/</g, '&lt;')
	                        .replace(/>/g, '&gt;')
	                        .replace(/"/g, '&quot;')
	                        .replace(/'/g, '&#39;');
	                }

	                function normalizeMarkedArgs(href, title, text) {
	                    if (href && typeof href === 'object') {
	                        return {
	                            href: href.href,
	                            title: href.title,
	                            text: href.text || href.raw || ''
	                        };
	                    }
	                    return { href, title, text };
	                }

	                function isSafeUrl(href) {
	                    if (!href) return true;
	                    const trimmed = String(href).trim().toLowerCase();
	                    return !(
	                        trimmed.startsWith('javascript:') ||
	                        trimmed.startsWith('data:') ||
	                        trimmed.startsWith('vbscript:')
	                    );
	                }

	                const renderer = (marked.Renderer && typeof marked.Renderer === 'function')
	                    ? new marked.Renderer()
	                    : null;

	                if (renderer) {
	                    // ç¦æ­¢åœ¨ Markdown ä¸­æ¸²æŸ“åŸå§‹ HTMLï¼ˆé˜²æ­¢ XSSï¼‰
	                    renderer.html = (html) => escapeHtml(html);

	                    // è¿‡æ»¤å±é™©é“¾æ¥åè®®
	                    renderer.link = (href, title, text) => {
	                        const normalized = normalizeMarkedArgs(href, title, text);
	                        if (!isSafeUrl(normalized.href)) return escapeHtml(normalized.text || '');

	                        const rawHref = String(normalized.href || '');
	                        const safeText = normalized.text || '';
	                        const safeTitle = normalized.title ? ` title="${escapeHtml(normalized.title)}"` : '';

	                        if (rawHref.startsWith('#')) {
	                            return `<a href="${escapeHtml(rawHref)}"${safeTitle}>${safeText}</a>`;
	                        }

	                        const hashIndex = rawHref.indexOf('#');
	                        const hash = hashIndex >= 0 ? rawHref.slice(hashIndex) : '';
	                        const baseHref = hashIndex >= 0 ? rawHref.slice(0, hashIndex) : rawHref;

	                        if (!baseHref) return escapeHtml(safeText);

	                        if (
	                            baseHref.includes('.html') ||
	                            baseHref.startsWith('?') ||
	                            baseHref.includes('viewer.html') ||
	                            baseHref.includes('folder.html') ||
	                            /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(baseHref)
	                        ) {
	                            return `<a href="${escapeHtml(rawHref)}"${safeTitle}>${safeText}</a>`;
	                        }

	                        const resolvedDoc = resolveDocLinkPath(baseHref, CURRENT_DOC_PATH);
	                        if (resolvedDoc) {
	                            const finalHref = `viewer.html?file=${encodeURIComponent(resolvedDoc)}${hash}`;
	                            return `<a href="${escapeHtml(finalHref)}"${safeTitle}>${safeText}</a>`;
	                        }

	                        const resolvedRelative = resolveRelativeHref(baseHref, CURRENT_DOC_PATH);
	                        const finalHref = `viewer.html?file=${encodeURIComponent(resolvedRelative)}${hash}`;
	                        return `<a href="${escapeHtml(finalHref)}"${safeTitle}>${safeText}</a>`;
	                    };

	                    renderer.image = (href, title, text) => {
	                        const normalized = normalizeMarkedArgs(href, title, text);
	                        if (!isSafeUrl(normalized.href)) return '';
	                        const resolvedSrc = resolveRelativeHref(normalized.href, CURRENT_DOC_PATH);
	                        const safeSrc = escapeHtml(resolvedSrc);
	                        const safeAlt = escapeHtml(normalized.text || '');
	                        const safeTitle = normalized.title ? ` title="${escapeHtml(normalized.title)}"` : '';
	                        return `<img src="${safeSrc}" alt="${safeAlt}"${safeTitle} loading="lazy" decoding="async" />`;
	                    };
	                }

	                // é…ç½® marked.js é€‰é¡¹ï¼ˆGitHub Pages çº¯é™æ€ç¯å¢ƒï¼‰
	                marked.setOptions({
	                    renderer: renderer || undefined,
	                    highlight: function (code, lang) {
	                        if (typeof Prism !== 'undefined' && lang && Prism.languages[lang]) {
	                            return Prism.highlight(code, Prism.languages[lang], lang);
	                        }
	                        return code;
	                    },
	                    breaks: true,
	                    gfm: true,
	                    tables: true,
	                    smartLists: true,
	                    smartypants: true,
	                    mangle: true,
	                    headerIds: true,
	                    xhtml: false,
	                    pedantic: false
	                });
	                console.log('MDæ¸²æŸ“å™¨åˆå§‹åŒ–å®Œæ¯•!');
	            } catch (error) {
	                console.error('åˆå§‹åŒ–MDæ¸²æŸ“å™¨å¤±è´¥:', error);
	            }
	        }

        // åˆå§‹åŒ–æ–‡æ¡£é…ç½®
        async function initializeDocumentConfig() {
            try {
                console.log('viewer.html: æ­£åœ¨åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå½“å‰è·¯å¾„:', window.location.pathname);
                if (window.SiteConfig && typeof window.SiteConfig.load === 'function') {
                    VIEWER_DOC_CONFIG = await window.SiteConfig.load();
                } else {
                    const configResponse = await fetch('./config.json');
                    if (!configResponse.ok) throw new Error('æ— æ³•åŠ è½½config.json: ' + configResponse.status);
                    VIEWER_DOC_CONFIG = await configResponse.json();
                }
                console.log('æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶:', VIEWER_DOC_CONFIG);
                    
                    // ä»é…ç½®æ–‡ä»¶ä¸­æå–åˆ†ç±»ã€ä¸»é¢˜å’Œè·¯å¾„æ˜ å°„
                    const categories = VIEWER_DOC_CONFIG.categories || {};
                    MAIN_CATEGORIES = {};
                    
                    // è½¬æ¢åˆ†ç±»æ ¼å¼ä»¥åŒ¹é…viewer.htmlçš„æœŸæœ›
                    Object.keys(categories).forEach(categoryKey => {
                        const category = categories[categoryKey];
                        const isSpecial = ["æ€ä¹ˆè´¡çŒ®", "Modderå…¥é—¨"].includes(categoryKey);
                        
                        MAIN_CATEGORIES[categoryKey] = {
                            title: category.title,
                            description: category.description,
                            icon: getCategoryIcon(categoryKey),
                            color: getCategoryColor(categoryKey),
                            order: getCategoryOrder(categoryKey),
                            special: isSpecial
                        };
                    });
                    
                    TOPIC_AREAS = VIEWER_DOC_CONFIG.topics || {};
                    VIEWER_PATH_REDIRECTS =
                        VIEWER_DOC_CONFIG.pathMappings ||
                        (VIEWER_DOC_CONFIG.settings && VIEWER_DOC_CONFIG.settings.pathMappings) ||
                        window.PATH_REDIRECTS ||
                        {};
                    
                    console.log('åŠ è½½çš„åˆ†ç±»:', MAIN_CATEGORIES);
                    console.log('åŠ è½½çš„ä¸»é¢˜:', TOPIC_AREAS);
                    console.log('åŠ è½½çš„è·¯å¾„æ˜ å°„:', VIEWER_PATH_REDIRECTS);
            } catch (error) {
                console.warn('åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', error);
                VIEWER_DOC_CONFIG = generateDefaultConfig();
                // ä½¿ç”¨é»˜è®¤é…ç½®åˆå§‹åŒ–åˆ†ç±»ã€ä¸»é¢˜å’Œè·¯å¾„æ˜ å°„
                MAIN_CATEGORIES = getDefaultCategories();
                TOPIC_AREAS = getDefaultTopics();
                VIEWER_PATH_REDIRECTS = window.PATH_REDIRECTS || {};
            }

            // æ‰«ææ‰€æœ‰æ–‡æ¡£æ–‡ä»¶
            await scanAllDocuments();
        }

        // è·å–åˆ†ç±»å›¾æ ‡ - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryIcon(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–å›¾æ ‡
            if (VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.categories && VIEWER_DOC_CONFIG.categories[categoryKey] && VIEWER_DOC_CONFIG.categories[categoryKey].icon) {
                return VIEWER_DOC_CONFIG.categories[categoryKey].icon;
            }
            
            // é»˜è®¤å›¾æ ‡æ˜ å°„
            const iconMap = {
                'å…¥é—¨': 'ğŸš€',
                'è¿›é˜¶': 'ğŸ“š',
                'é«˜çº§': 'ğŸ”¥',
                'ä¸ªäººåˆ†äº«': 'ğŸ’¡',
                'æ€ä¹ˆè´¡çŒ®': 'ğŸ¤',
                'Modderå…¥é—¨': 'ğŸ®'
            };
            return iconMap[categoryKey] || 'ğŸ“„';
        }

        // è·å–åˆ†ç±»é¢œè‰² - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryColor(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–é¢œè‰²
            if (VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.categories && VIEWER_DOC_CONFIG.categories[categoryKey] && VIEWER_DOC_CONFIG.categories[categoryKey].color) {
                return VIEWER_DOC_CONFIG.categories[categoryKey].color;
            }
            
            // é»˜è®¤é¢œè‰²æ˜ å°„
            const colorMap = {
                'å…¥é—¨': '#4CAF50',
                'è¿›é˜¶': '#2196F3',
                'é«˜çº§': '#FF5722',
                'ä¸ªäººåˆ†äº«': '#FFC107',
                'æ€ä¹ˆè´¡çŒ®': '#9C27B0',
                'Modderå…¥é—¨': '#00BCD4'
            };
            return colorMap[categoryKey] || '#28a745';
        }

        // è·å–åˆ†ç±»æ’åº - ä¼˜å…ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼
        function getCategoryOrder(categoryKey) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–æ’åº
            if (VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.categories && VIEWER_DOC_CONFIG.categories[categoryKey] && VIEWER_DOC_CONFIG.categories[categoryKey].order !== undefined) {
                return VIEWER_DOC_CONFIG.categories[categoryKey].order;
            }
            
            // é»˜è®¤æ’åºæ˜ å°„
            const orderMap = {
                'å…¥é—¨': 1,
                'è¿›é˜¶': 2,
                'é«˜çº§': 3,
                'ä¸ªäººåˆ†äº«': 4,
                'æ€ä¹ˆè´¡çŒ®': 5,
                'Modderå…¥é—¨': 6
            };
            return orderMap[categoryKey] || 999;
        }

        // è·å–é»˜è®¤åˆ†ç±»é…ç½®
        function getDefaultCategories() {
            return {
                "å…¥é—¨": {
                    "title": "å…¥é—¨",
                    "description": "é€‚åˆåˆå­¦è€…çš„åŸºç¡€æ•™ç¨‹",
                    "icon": "ğŸš€",
                    "color": "#4CAF50",
                    "order": 1
                },
                "è¿›é˜¶": {
                    "title": "è¿›é˜¶",
                    "description": "æœ‰ä¸€å®šåŸºç¡€åçš„è¿›é˜¶æ•™ç¨‹",
                    "icon": "ğŸ“š",
                    "color": "#2196F3",
                    "order": 2
                },
                "é«˜çº§": {
                    "title": "é«˜çº§",
                    "description": "é¢å‘æœ‰ç»éªŒå¼€å‘è€…çš„é«˜çº§æ•™ç¨‹",
                    "icon": "ğŸ”¥",
                    "color": "#FF5722",
                    "order": 3
                },
                "ä¸ªäººåˆ†äº«": {
                    "title": "ä¸ªäººåˆ†äº«",
                    "description": "ç¤¾åŒºæˆå‘˜çš„ä¸ªäººç»éªŒå’ŒæŠ€å·§åˆ†äº«",
                    "icon": "ğŸ’¡",
                    "color": "#FFC107",
                    "order": 4
                },
                "æ€ä¹ˆè´¡çŒ®": {
                    "title": "æ€ä¹ˆè´¡çŒ®",
                    "description": "ä»‹ç»è´¡çŒ®è€…åº”è¯¥æ€ä¹ˆè´¡çŒ®æ–‡ç« ",
                    "icon": "ğŸ¤",
                    "color": "#9C27B0",
                    "order": 5,
                    "special": true
                },
                "Modderå…¥é—¨": {
                    "title": "Modderå…¥é—¨",
                    "description": "Modderå…¥é—¨ç›¸å…³çš„æ•™ç¨‹",
                    "icon": "ğŸ®",
                    "color": "#00BCD4",
                    "order": 6,
                    "special": true
                }
            };
        }

        // è·å–é»˜è®¤ä¸»é¢˜é…ç½®
        function getDefaultTopics() {
            return {
                "mod-basics": {
                    "title": "ModåŸºç¡€",
                    "description": "Modå¼€å‘çš„åŸºç¡€æ¦‚å¿µå’Œæ ¸å¿ƒAPI",
                    "icon": "ğŸ“–",
                    "order": 1
                },
                "env": {
                    "title": "ç¯å¢ƒé…ç½®",
                    "description": "å¼€å‘ç¯å¢ƒæ­å»ºå’Œé…ç½®",
                    "icon": "ğŸ› ï¸",
                    "order": 2
                },
                "items": {
                    "title": "ç‰©å“ç³»ç»Ÿ",
                    "description": "ç‰©å“ã€æ­¦å™¨å’Œè£…å¤‡çš„å¼€å‘",
                    "icon": "âš”ï¸",
                    "order": 3
                },
                "npcs": {
                    "title": "NPCç³»ç»Ÿ",
                    "description": "NPCçš„åˆ›å»ºå’Œè¡Œä¸ºå®šåˆ¶",
                    "icon": "ğŸ‘¥",
                    "order": 4
                },
                "world-gen": {
                    "title": "ä¸–ç•Œç”Ÿæˆ",
                    "description": "ä¸–ç•Œç”Ÿæˆå’Œåœ°å½¢ä¿®æ”¹",
                    "icon": "ğŸŒ",
                    "order": 5
                },
                "ui": {
                    "title": "UIç•Œé¢",
                    "description": "ç”¨æˆ·ç•Œé¢å’Œäº¤äº’è®¾è®¡",
                    "icon": "ğŸ¨",
                    "order": 6
                },
                "networking": {
                    "title": "ç½‘ç»œåŠŸèƒ½",
                    "description": "å¤šäººæ¸¸æˆå’Œç½‘ç»œé€šä¿¡",
                    "icon": "ğŸŒ",
                    "order": 7
                },
                "advanced": {
                    "title": "é«˜çº§åŠŸèƒ½",
                    "description": "é«˜çº§å¼€å‘æŠ€å·§å’Œä¼˜åŒ–",
                    "icon": "ğŸ”§",
                    "order": 8
                }
            };
        }

        // ç”Ÿæˆé»˜è®¤é…ç½®ï¼ˆå½“config.jsonä¸å­˜åœ¨æ—¶ï¼‰
        function generateDefaultConfig() {
            const config = {
                _metadata: {
                    version: "2.0.0",
                    schema: "tmodloader-docs-v2",
                    created: new Date().toISOString().split('T')[0],
                    lastUpdated: new Date().toISOString().split('T')[0],
                    description: "æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹é…ç½®æ–‡ä»¶ - é»˜è®¤é…ç½®"
                },
                globalSettings: {
                    language: "zh",
                    theme: "default",
                    siteName: "æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹",
                    siteDescription: "å…¨é¢çš„æ³°æ‹‰ç‘äºšModå¼€å‘æ•™ç¨‹èµ„æº",
                    baseUrl: "",
                    enableSearch: true,
                    enableDarkMode: true,
                    defaultOrder: 999,
                    dateFormat: "YYYY-MM-DD"
                },
                categories: {},
                topics: {},
                authors: {},
                all_files: [],
                pathMappings: {},
                settings: {
                    defaultCategory: "å…¥é—¨",
                    defaultTopic: "mod-basics",
                    specialCategories: ["æ€ä¹ˆè´¡çŒ®", "Modderå…¥é—¨"]
                }
            };

            // åˆå§‹åŒ–åˆ†ç±»ç»“æ„
            const defaultCategories = getDefaultCategories();
            Object.keys(defaultCategories).forEach(categoryKey => {
                config.categories[categoryKey] = {
                    ...defaultCategories[categoryKey],
                    topics: {
                        "mod-basics": {
                            title: "ModåŸºç¡€",
                            description: "Modå¼€å‘çš„åŸºç¡€æ¦‚å¿µå’Œæ ¸å¿ƒAPI",
                            files: []
                        }
                    }
                };
            });

            // åˆå§‹åŒ–ä¸»é¢˜ç»“æ„
            const defaultTopics = getDefaultTopics();
            Object.keys(defaultTopics).forEach(topicKey => {
                config.topics[topicKey] = defaultTopics[topicKey];
            });

            return config;
        }

        // æ‰«ææ‰€æœ‰æ–‡æ¡£æ–‡ä»¶
        async function scanAllDocuments() {
            console.log('=== scanAllDocuments() è¯Šæ–­å¼€å§‹ ===');
            try {
                // å®Œå…¨ä¾èµ–é…ç½®æ–‡ä»¶ï¼Œå› ä¸ºéƒ¨ç½²æ—¶ä¼šè°ƒç”¨ generate-index.js ç”Ÿæˆæ–°çš„ config.json
                try {
                    const config = VIEWER_DOC_CONFIG || (window.SiteConfig ? await window.SiteConfig.load() : null);
                    if (config) {
                        console.log('æˆåŠŸåŠ è½½é…ç½®æ–‡ä»¶:', config);

                        // ä»é…ç½®æ–‡ä»¶ä¸­æå–æ–‡æ¡£åˆ—è¡¨
                        ALL_DOCS = config.all_files || [];
                        console.log('ä»é…ç½®æ–‡ä»¶åŠ è½½çš„æ–‡æ¡£æ•°é‡:', ALL_DOCS.length);
                        console.log('ä»é…ç½®æ–‡ä»¶åŠ è½½çš„æ–‡æ¡£:', ALL_DOCS);

                        // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰æ–‡æ¡£ï¼Œç›´æ¥ä½¿ç”¨
                        if (ALL_DOCS.length > 0) {
                            // ç¡®ä¿æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰å¿…è¦çš„å±æ€§
                            ALL_DOCS = ALL_DOCS.map(doc => {
                                // å¤„ç†æ ‡ç­¾æ ¼å¼
                                let tags = [];
                                if (doc.tags) {
                                    if (Array.isArray(doc.tags)) {
                                        tags = doc.tags;
                                    } else if (typeof doc.tags === 'string') {
                                        // å¤„ç†å¯èƒ½çš„JSONå­—ç¬¦ä¸²æ ¼å¼
                                        try {
                                            const parsedTags = JSON.parse(doc.tags);
                                            tags = Array.isArray(parsedTags) ? parsedTags : [parsedTags];
                                        } catch (e) {
                                            // å¦‚æœä¸æ˜¯JSONï¼ŒæŒ‰é€—å·åˆ†å‰²
                                            tags = doc.tags.split(',').map(t => t.trim());
                                        }
                                    }
                                }

                                return {
                                    ...doc,
                                    path: doc.path || doc.filename,
                                    title: doc.title || doc.filename.replace('.md', ''),
                                    author: doc.author || 'æœªçŸ¥',
                                    category: doc.category || 'å…¥é—¨',
                                    topic: doc.topic || 'mod-basics',
                                    order: parseInt(doc.order) || 999,
                                    description: doc.description || '',
                                    tags: tags,
                                    last_updated: doc.last_updated || 'æœªçŸ¥'
                                };
                            });

                            console.log('å¤„ç†åçš„æ–‡æ¡£åˆ—è¡¨:', ALL_DOCS);
                            console.log('=== scanAllDocuments() è¯Šæ–­ç»“æŸ ===');
                            buildDocLookupMap();
                            return;
                        } else {
                            console.warn('é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°æ–‡æ¡£');
                        }
                    } else {
                        console.warn('æ— æ³•è·å–é…ç½®æ–‡ä»¶ï¼Œæ–‡æ¡£åˆ—è¡¨ä¸ºç©º');
                    }
                } catch (configError) {
                    console.warn('åŠ è½½é…ç½®æ–‡ä»¶å¤±è´¥:', configError);
                }

                // å¦‚æœé…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥æˆ–æ²¡æœ‰æ–‡æ¡£ï¼Œå°è¯•æ‰«æå¸¸è§çš„æ–‡æ¡£æ–‡ä»¶
                console.warn('é…ç½®æ–‡ä»¶ä¸å¯ç”¨ï¼Œå°è¯•æ‰«æå¸¸è§æ–‡æ¡£æ–‡ä»¶');
                const commonFiles = [
                    'Modderå…¥é—¨/DPapyru-ç»™æ–°äººçš„å‰è¨€.md',
                    'æ€ä¹ˆè´¡çŒ®/DPapyru-è´¡çŒ®è€…å¦‚ä½•ç¼–å†™æ–‡ç« åŸºç¡€.md',
                    'æ€ä¹ˆè´¡çŒ®/TopicSystemä½¿ç”¨æŒ‡å—.md',
                    'èºçº¿ç¿»è¯‘tmlæ•™ç¨‹/0-å¼€å§‹/0-Home ä¸»é¡µ.md'
                ];

                ALL_DOCS = [];

                for (const filename of commonFiles) {
                    try {
                        console.log(`å°è¯•å¤„ç†æ–‡æ¡£: ${filename}`);
                        // è·å–æ–‡æ¡£å†…å®¹å’Œå…ƒæ•°æ®
                        const docUrl = `./${filename}`;
                        const docResponse = await fetch(docUrl);

                        if (docResponse.ok) {
                            const content = await docResponse.text();
                            const { metadata } = parseFrontMatter(content);

                            // å¤„ç†åˆ†ç±»æ˜ å°„
                            let category = metadata.category || 'å…¥é—¨';
                            if (category && MAIN_CATEGORIES[category] && MAIN_CATEGORIES[category].mapsTo) {
                                const oldCategory = category;
                                category = MAIN_CATEGORIES[category].mapsTo;
                                console.log(`æ–‡æ¡£ ${filename} çš„åˆ†ç±»ä» ${oldCategory} æ˜ å°„åˆ° ${category}`);
                            }

                            const docInfo = {
                                filename: filename,
                                title: metadata.title || filename.replace('.md', ''),
                                author: metadata.author || 'æœªçŸ¥',
                                category: category,
                                topic: metadata.topic || 'mod-basics',
                                order: parseInt(metadata.order) || 999,
                                description: metadata.description || '',
                                tags: metadata.tags ? metadata.tags.split(',').map(t => t.trim()) : [],
                                last_updated: metadata.last_updated || 'æœªçŸ¥'
                            };

                            ALL_DOCS.push(docInfo);
                            console.log('æˆåŠŸæ·»åŠ æ–‡æ¡£:', docInfo.title);
                        } else {
                            console.warn(`æ–‡æ¡£ ${filename} è¯·æ±‚å¤±è´¥: ${docResponse.status} ${docResponse.statusText}`);
                        }
                    } catch (error) {
                        console.warn(`æ— æ³•å¤„ç†æ–‡æ¡£ ${filename}:`, error);
                    }
                }

                // æŒ‰åˆ†ç±»å’Œæ’åº
                ALL_DOCS.sort((a, b) => {
                    if (a.category !== b.category) {
                        return (MAIN_CATEGORIES[a.category]?.order || 999) - (MAIN_CATEGORIES[b.category]?.order || 999);
                    }
                    return a.order - b.order;
                });

                console.log('æ‰«æåˆ°çš„æ–‡æ¡£æ•°é‡:', ALL_DOCS.length);
                console.log('æ‰«æåˆ°çš„æ–‡æ¡£:', ALL_DOCS);
                console.log('=== scanAllDocuments() è¯Šæ–­ç»“æŸ ===');
                buildDocLookupMap();

            } catch (error) {
                console.error('æ‰«ææ–‡æ¡£å¤±è´¥:', error);
                console.log('=== scanAllDocuments() å› é”™è¯¯ç»“æŸ ===');
                // æä¾›ä¸€äº›é»˜è®¤æ–‡æ¡£
                ALL_DOCS = [
                    {
                        filename: 'DPapyru-ç»™æ–°äººçš„å‰è¨€.md',
                        path: 'Modderå…¥é—¨/DPapyru-ç»™æ–°äººçš„å‰è¨€.md',
                        title: 'ç»™æ–°äººçš„å‰è¨€',
                        author: 'DPapyru',
                        category: 'Modderå…¥é—¨',
                        topic: 'mod-basics',
                        order: 1,
                        description: 'é¢å‘æ–°äººçš„å…¥é—¨å¼•å¯¼æ–‡æ¡£',
                        tags: ['å…¥é—¨'],
                        last_updated: 'æœªçŸ¥'
                    }
                ];
                console.log('ä½¿ç”¨é»˜è®¤æ–‡æ¡£é…ç½®');
                buildDocLookupMap();
            }
        }

        function buildDocLookupMap() {
            const map = new Map();

            function addKey(key, value) {
                if (!key || !value) return;
                const strKey = String(key);
                map.set(strKey, value);
                const lower = strKey.toLowerCase();
                if (!map.has(lower)) map.set(lower, value);
            }

            function slugFromFilename(filename) {
                const base = String(filename || '').replace(/\.md$/i, '');
                if (!base) return '';
                const firstToken = base.split(' ')[0];
                return firstToken.replace(/^\d+-/, '');
            }

            (ALL_DOCS || []).forEach(doc => {
                const resolvedPath = doc && (doc.path || doc.filename);
                if (!resolvedPath) return;

                addKey(resolvedPath, resolvedPath);
                addKey(resolvedPath.replace(/\.md$/i, ''), resolvedPath);

                if (doc.filename) {
                    addKey(doc.filename, resolvedPath);
                    addKey(String(doc.filename).replace(/\.md$/i, ''), resolvedPath);

                    const slug = slugFromFilename(doc.filename);
                    addKey(slug, resolvedPath);
                    addKey(`${slug}.md`, resolvedPath);
                }

                if (doc.originalPath) {
                    addKey(doc.originalPath, resolvedPath);
                    addKey(String(doc.originalPath).replace(/\.md$/i, ''), resolvedPath);
                }
            });

            DOC_LOOKUP_MAP = map;
        }

        function normalizePath(inputPath) {
            const parts = String(inputPath || '').split('/');
            const stack = [];
            for (const part of parts) {
                if (!part || part === '.') continue;
                if (part === '..') {
                    if (stack.length) stack.pop();
                    continue;
                }
                stack.push(part);
            }
            return stack.join('/');
        }

        function resolveRelativeHref(rawHref, currentDocPath) {
            if (!currentDocPath) return rawHref;
            if (!rawHref) return rawHref;

            const hrefStr = String(rawHref);
            if (
                hrefStr.startsWith('#') ||
                hrefStr.startsWith('/') ||
                /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(hrefStr)
            ) {
                return rawHref;
            }

            const hashIndex = hrefStr.indexOf('#');
            const baseHref = hashIndex >= 0 ? hrefStr.slice(0, hashIndex) : hrefStr;
            const hash = hashIndex >= 0 ? hrefStr.slice(hashIndex) : '';

            let decoded = baseHref;
            try {
                decoded = decodeURIComponent(baseHref);
            } catch {
                decoded = baseHref;
            }

            const baseDir = String(currentDocPath).split('/').slice(0, -1).join('/');
            if (!baseDir) return rawHref;

            const joined = normalizePath(`${baseDir}/${decoded.replace(/^\.?\//, '')}`);
            return `${joined}${hash}`;
        }

        function resolveDocLinkPath(href, currentDocPath) {
            if (!href) return null;

            const hrefStr = String(href);
            if (hrefStr.startsWith('/') || /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(hrefStr)) return null;

            let decodedPath = hrefStr;
            try {
                decodedPath = decodeURIComponent(hrefStr);
            } catch {
                decodedPath = hrefStr;
            }

            decodedPath = decodedPath.replace(/^\.?\//, '').replace(/^docs\//, '');

            const candidates = [];
            if (decodedPath) {
                candidates.push(decodedPath);
                candidates.push(decodedPath.replace(/\.md$/i, ''));
                if (!decodedPath.endsWith('.md') && !decodedPath.includes('.')) {
                    candidates.push(`${decodedPath}.md`);
                }
            }

            if (currentDocPath && decodedPath) {
                const baseDir = String(currentDocPath).split('/').slice(0, -1).join('/');
                if (baseDir) {
                    const joined = normalizePath(`${baseDir}/${decodedPath}`);
                    candidates.unshift(joined);
                    candidates.unshift(joined.replace(/\.md$/i, ''));
                    if (!joined.endsWith('.md') && !joined.includes('.')) {
                        candidates.unshift(`${joined}.md`);
                    }
                }
            }

            const lookup = DOC_LOOKUP_MAP;
            if (!lookup) return null;

            for (const c of candidates) {
                if (!c) continue;
                const hit = lookup.get(c) || lookup.get(String(c).toLowerCase());
                if (hit) return hit;
            }

            return null;
        }

        // ä½¿ç”¨æ–‡æ¡£ä¿¡æ¯æ›´æ–°é…ç½®
        function updateConfigWithDocument(docInfo) {
            const { category, topic } = docInfo;

            // ç¡®ä¿åˆ†ç±»å­˜åœ¨
            if (!VIEWER_DOC_CONFIG.categories[category]) {
                VIEWER_DOC_CONFIG.categories[category] = {
                    title: category,
                    description: `${category}ç›¸å…³æ–‡æ¡£`,
                    topics: {}
                };
            }

            // ç¡®ä¿ä¸»é¢˜å­˜åœ¨
            if (!VIEWER_DOC_CONFIG.categories[category].topics[topic]) {
                VIEWER_DOC_CONFIG.categories[category].topics[topic] = {
                    title: TOPIC_AREAS[topic]?.title || topic,
                    description: TOPIC_AREAS[topic]?.description || '',
                    files: []
                };
            }

            // æ·»åŠ æ–‡ä»¶åˆ°å¯¹åº”ä¸»é¢˜
            DOC_CONFIG.categories[category].topics[topic].files.push(docInfo);

            // æ›´æ–°ä½œè€…ä¿¡æ¯
            if (!VIEWER_DOC_CONFIG.authors[docInfo.author]) {
                VIEWER_DOC_CONFIG.authors[docInfo.author] = {
                    name: docInfo.author,
                    files: []
                };
            }
            VIEWER_DOC_CONFIG.authors[docInfo.author].files.push(docInfo.filename);

            // æ·»åŠ åˆ°æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨
            VIEWER_DOC_CONFIG.all_files.push(docInfo);
        }
        // ç›´æ¥åŠ è½½Markdownå†…å®¹çš„å¤‡ç”¨å‡½æ•°
	        function loadMarkdownDirectly(filePath) {
	            const loadingIndicator = document.getElementById('loading-indicator');
	            const errorMessage = document.getElementById('error-message');
	            const markdownContent = document.getElementById('markdown-content');

                if (loadingIndicator) {
                    loadingIndicator.style.display = 'block';
                    loadingIndicator.setAttribute('aria-busy', 'true');
                }
                if (errorMessage) {
                    errorMessage.style.display = 'none';
                    errorMessage.setAttribute('aria-hidden', 'true');
                }
                if (markdownContent) {
                    markdownContent.style.display = 'none';
                }

            console.log(`=== loadMarkdownDirectly() è¯Šæ–­å¼€å§‹ ===`);
            console.log(`docs/viewer.html: åŸå§‹æ–‡ä»¶è·¯å¾„: ${filePath}`);
            console.log('å½“å‰é¡µé¢ä½ç½®:', window.location.href);

	            try {
	                // å¢å¼ºçš„è·¯å¾„æ¸…ç†é€»è¾‘ï¼ˆä»…å…è®¸åŠ è½½ config.json åˆ—å‡ºçš„æ–‡æ¡£ï¼Œé¿å…è·¯å¾„ç©¿è¶Šï¼‰
	                let fetchPath = filePath;
	                console.log(`docs/viewer.html: åˆå§‹fetchPath: ${fetchPath}`);

	                // 1. URLè§£ç 
	                fetchPath = decodeURIComponent(fetchPath);
	                console.log(`docs/viewer.html: URLè§£ç å: ${fetchPath}`);

	                // 1.1 åŸºç¡€å®‰å…¨æ ¡éªŒï¼šæ‹’ç»è·¯å¾„ç©¿è¶Š/åæ–œæ /ç©ºå­—èŠ‚
	                if (/(^|\/|\\)\.\.(\/|\\|$)/.test(fetchPath) || fetchPath.includes('\\') || fetchPath.includes('\0')) {
	                    throw new Error('éæ³•è·¯å¾„å‚æ•°');
	                }

            // 2. å¦‚æœåªæ˜¯æ–‡ä»¶åï¼Œå°è¯•åœ¨æ–‡æ¡£åˆ—è¡¨ä¸­æŸ¥æ‰¾å®Œæ•´è·¯å¾„
            if (!fetchPath.includes('/') && ALL_DOCS.length > 0) {
                const doc = ALL_DOCS.find(d => d.filename === fetchPath || d.path === fetchPath);
                if (doc && doc.path) {
                    fetchPath = doc.path;
                    console.log(`docs/viewer.html: é€šè¿‡æ–‡æ¡£åˆ—è¡¨æ‰¾åˆ°å®Œæ•´è·¯å¾„: ${fetchPath}`);
                }
            }

            // 3. ç§»é™¤å¼€å¤´çš„docs/å‰ç¼€ï¼ˆå› ä¸ºviewer.htmlå·²ç»åœ¨docsç›®å½•ä¸­ï¼‰
            if (fetchPath.startsWith('docs/')) {
                fetchPath = fetchPath.substring(5);
                console.log(`docs/viewer.html: ç§»é™¤docså‰ç¼€: ${fetchPath}`);
            }

            // 4. ç§»é™¤å¼€å¤´çš„æ–œæ 
            if (fetchPath.startsWith('/')) {
                fetchPath = fetchPath.substring(1);
                console.log(`docs/viewer.html: ç§»é™¤å¼€å¤´æ–œæ : ${fetchPath}`);
            }

            // 4. æ£€æŸ¥æ˜¯å¦æ˜¯æ—§è·¯å¾„æ ¼å¼ï¼Œè¿›è¡Œé‡å®šå‘
            if (VIEWER_PATH_REDIRECTS[fetchPath]) {
                fetchPath = VIEWER_PATH_REDIRECTS[fetchPath];
                console.log(`docs/viewer.html: æ—§è·¯å¾„é‡å®šå‘: ${fetchPath}`);
            }

	            // 5. æ£€æŸ¥æ˜¯å¦æ˜¯å·²çŸ¥çš„åˆ†ç±»åæˆ–ç‰¹æ®Šæ–‡ä»¶
	            const knownCategories = ['01-å…¥é—¨æŒ‡å—', '02-åŸºç¡€æ¦‚å¿µ', '03-å†…å®¹åˆ›å»º', '04-é«˜çº§å¼€å‘', '05-ä¸“é¢˜ä¸»é¢˜', '06-èµ„æºå‚è€ƒ'];
	            const rootFiles = []; // ä½äºdocsæ ¹ç›®å½•çš„ç‰¹æ®Šæ–‡ä»¶åˆ—è¡¨ï¼ˆå¦‚æœ‰éœ€è¦å¯æ·»åŠ ï¼‰
	            const defaultDocPath = (ALL_DOCS && ALL_DOCS.length > 0) ? (ALL_DOCS[0].path || ALL_DOCS[0].filename) : null;

            if (knownCategories.includes(fetchPath) || fetchPath.match(/^\d+-[^\/]+$/)) {
                // å¦‚æœæ˜¯åˆ†ç±»åï¼Œå°è¯•é‡å®šå‘åˆ°å¯¹åº”çš„æ–‡æ¡£
                console.log(`docs/viewer.html: è¯†åˆ«ä¸ºæ—§åˆ†ç±»åï¼Œå°è¯•é‡å®šå‘`);
                // å°è¯•æ‰¾åˆ°è¯¥åˆ†ç±»ä¸‹çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£
	                const firstDoc = ALL_DOCS.find(doc => doc.category === getCategoryFromOldPath(fetchPath));
	                if (firstDoc) {
	                    fetchPath = firstDoc.path || firstDoc.filename;
	                    console.log(`docs/viewer.html: é‡å®šå‘åˆ°æ–‡æ¡£: ${fetchPath}`);
	                } else {
	                    if (!defaultDocPath) throw new Error('æœªæ‰¾åˆ°å¯ç”¨æ–‡æ¡£');
	                    fetchPath = defaultDocPath;
	                    console.log(`docs/viewer.html: æœªæ‰¾åˆ°å¯¹åº”æ–‡æ¡£ï¼Œä½¿ç”¨é»˜è®¤: ${fetchPath}`);
	                }
	            } else if (rootFiles.includes(fetchPath)) {
                // å¦‚æœæ˜¯æ ¹ç›®å½•ä¸‹çš„ç‰¹æ®Šæ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨
                console.log(`docs/viewer.html: è¯†åˆ«ä¸ºæ ¹ç›®å½•æ–‡ä»¶: ${fetchPath}`);
            } else if (fetchPath.includes('/')) {
                // è·¯å¾„å·²ç»åŒ…å«ç›®å½•ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æ—§æ ¼å¼
                if (fetchPath.match(/^\d+-[^\/]+\/.*/)) {
                    // æ—§æ ¼å¼è·¯å¾„ï¼Œå°è¯•é‡å®šå‘
                    console.log(`docs/viewer.html: è¯†åˆ«ä¸ºæ—§æ ¼å¼è·¯å¾„ï¼Œå°è¯•é‡å®šå‘`);
                    const filename = fetchPath.split('/').pop();
	                    const doc = ALL_DOCS.find(d => d.filename === filename || d.filename.endsWith(filename));
	                    if (doc) {
	                        fetchPath = doc.path || doc.filename;
	                        console.log(`docs/viewer.html: é‡å®šå‘åˆ°æ–‡æ¡£: ${fetchPath}`);
	                    } else {
	                        if (!defaultDocPath) throw new Error('æœªæ‰¾åˆ°å¯ç”¨æ–‡æ¡£');
	                        fetchPath = defaultDocPath;
	                        console.log(`docs/viewer.html: æœªæ‰¾åˆ°å¯¹åº”æ–‡æ¡£ï¼Œä½¿ç”¨é»˜è®¤: ${fetchPath}`);
	                    }
	                } else {
                    // è·¯å¾„å·²ç»åŒ…å«ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨
                    console.log(`docs/viewer.html: ä½¿ç”¨å®Œæ•´è·¯å¾„: ${fetchPath}`);
                }
            } else {
                // å¦‚æœåªæ˜¯æ–‡ä»¶åï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨äºæ–‡æ¡£åˆ—è¡¨ä¸­
	                const doc = ALL_DOCS.find(d => d.filename === fetchPath || d.path === fetchPath || d.filename === `${fetchPath}.md`);
	                if (doc) {
	                    fetchPath = doc.path || doc.filename;
	                    console.log(`docs/viewer.html: æ‰¾åˆ°åŒ¹é…æ–‡æ¡£: ${fetchPath}`);
	                } else {
	                    if (!defaultDocPath) throw new Error('æœªæ‰¾åˆ°å¯ç”¨æ–‡æ¡£');
	                    fetchPath = defaultDocPath;
	                    console.log(`docs/viewer.html: æœªæ‰¾åˆ°åŒ¹é…æ–‡æ¡£ï¼Œä½¿ç”¨é»˜è®¤: ${fetchPath}`);
	                }
	            }

	            // 6. æœ€ç»ˆç™½åå•æ ¡éªŒï¼šå¿…é¡»å­˜åœ¨äº ALL_DOCS ä¸­
	            if (ALL_DOCS && ALL_DOCS.length > 0) {
	                const matches = ALL_DOCS.filter(d => d.path === fetchPath || d.filename === fetchPath);
	                if (matches.length === 1) {
	                    fetchPath = matches[0].path || matches[0].filename;
	                } else if (matches.length === 0) {
	                    throw new Error('æ–‡æ¡£ä¸å­˜åœ¨æˆ–æœªè¢«ç´¢å¼•ï¼ˆè¯·ä½¿ç”¨ docs/config.json ä¸­çš„è·¯å¾„ï¼‰');
	                } else {
	                    throw new Error('æ–‡æ¡£åç§°ä¸å”¯ä¸€ï¼Œè¯·ä½¿ç”¨å®Œæ•´è·¯å¾„');
	                }
	            }

	            // 7. ç¡®ä¿æ–‡ä»¶ä»¥.mdç»“å°¾
	            if (!fetchPath.endsWith('.md')) {
	                fetchPath += '.md';
	                console.log(`docs/viewer.html: æ·»åŠ .mdæ‰©å±•å: ${fetchPath}`);
	            }

            console.log(`docs/viewer.html: æœ€ç»ˆä½¿ç”¨è·¯å¾„: ${fetchPath}`);
            CURRENT_DOC_PATH = fetchPath;

            // ç¡®ä¿è·¯å¾„ç›¸å¯¹äºå½“å‰é¡µé¢ï¼ˆdocsç›®å½•ï¼‰
            let fetchUrl = fetchPath.startsWith('./') ? fetchPath : `./${fetchPath}`;

            // é¿å…é‡å¤çš„docsè·¯å¾„
            if (fetchUrl.startsWith('./docs/')) {
                fetchUrl = fetchUrl.substring(6); // ç§»é™¤ './docs/'
                if (!fetchUrl.startsWith('./')) {
                    fetchUrl = `./${fetchUrl}`;
                }
            }

            console.log(`docs/viewer.html: å®é™…fetch URL: ${fetchUrl}`);
            console.log(`å®Œæ•´è¯·æ±‚URLå°†æ˜¯: ${window.location.origin}${window.location.pathname.replace(/\/[^\/]*$/, '/')}${fetchUrl}`);

	            fetch(encodeURI(fetchUrl))
	                .then(response => {
                    console.log(`è·å–å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(markdownText => {
                    console.log(`docs/viewer.html: æˆåŠŸè·å–Markdownå†…å®¹ï¼Œé•¿åº¦: ${markdownText.length}`);

                    if (typeof marked !== 'undefined') {
                        console.log('marked.jså·²åŠ è½½ï¼Œå¼€å§‹æ¸²æŸ“');

                        // è§£æFront Matterï¼ˆæ–‡æ¡£å…ƒæ•°æ®ï¼‰
                        const frontMatter = parseFrontMatter(markdownText);
                        const content = frontMatter.content;
                        const metadata = frontMatter.metadata;

                        // è¡¥é½ç¼ºå¤±çš„å…ƒæ•°æ®ï¼šä¼˜å…ˆä½¿ç”¨ config.json ä¸­çš„ç´¢å¼•ä¿¡æ¯ï¼ˆä¸ä¿®æ”¹ Markdown åŸæ–‡ï¼‰
                        const docFromConfig = ALL_DOCS.find(d => {
                            const p = d.path || d.filename;
                            return p === fetchPath || d.filename === fetchPath || d.path === fetchPath;
                        });
                        if (docFromConfig) {
                            if (!metadata.title && docFromConfig.title) metadata.title = docFromConfig.title;
                            if (!metadata.author && docFromConfig.author) metadata.author = docFromConfig.author;
                            if (!metadata.description && docFromConfig.description) metadata.description = docFromConfig.description;
                            if (!metadata.category && docFromConfig.category) metadata.category = docFromConfig.category;
                            if (!metadata.topic && docFromConfig.topic) metadata.topic = docFromConfig.topic;
                            if (!metadata.difficulty && docFromConfig.difficulty) metadata.difficulty = docFromConfig.difficulty;
                            if (!metadata.time && docFromConfig.time) metadata.time = docFromConfig.time;
                            if (!metadata.last_updated && docFromConfig.last_updated) metadata.last_updated = docFromConfig.last_updated;
                            if (!metadata.prev_chapter && docFromConfig.prev_chapter) metadata.prev_chapter = docFromConfig.prev_chapter;
                            if (!metadata.next_chapter && docFromConfig.next_chapter) metadata.next_chapter = docFromConfig.next_chapter;
                        }

                        console.log('è§£æçš„å…ƒæ•°æ®:', metadata);

                        // æ›´æ–°é¡µé¢å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€éš¾åº¦ã€ä½œè€…ç­‰ï¼‰
                        updatePageMetadata(metadata, fetchPath);

                        // æ›´æ–°å½“å‰åˆ†ç±»çš„æ–‡æ¡£åˆ—è¡¨
                        updateCurrentCategoryDocs(fetchPath);

                        const renderedHTML = marked.parse(content);
                        console.log('Markdownæ¸²æŸ“å®Œæˆï¼ŒHTMLé•¿åº¦:', renderedHTML.length);
                        markdownContent.innerHTML = renderedHTML;

                        // åº”ç”¨ä»£ç è¯­æ³•é«˜äº®
                        if (typeof Prism !== 'undefined') {
                            console.log('åº”ç”¨ä»£ç é«˜äº®');
                            Prism.highlightAllUnder(markdownContent);
                        } else {
                            console.warn('Prism.jsæœªåŠ è½½ï¼Œè·³è¿‡ä»£ç é«˜äº®');
                        }

                        // è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç›®å½•
                        generateTableOfContents(markdownContent);

                        // æ˜¾ç¤ºå†…å®¹ï¼Œéšè—åŠ è½½æŒ‡ç¤ºå™¨
                        if (loadingIndicator) {
                            loadingIndicator.style.display = 'none';
                            loadingIndicator.setAttribute('aria-busy', 'false');
                        }
                        markdownContent.style.display = 'block';
                        document.getElementById('table-of-contents').style.display = 'block';
                        if (errorMessage) errorMessage.setAttribute('aria-hidden', 'true');

                        // åˆå§‹åŒ–å›¾ç‰‡ç¼©æ”¾
                        initImageZoom();

                    } else {
                        throw new Error('marked.jsæœªåŠ è½½');
                    }
                })
	                .catch(error => {
                    console.error('docs/viewer.html: åŠ è½½Markdownå¤±è´¥:', error);
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                        loadingIndicator.setAttribute('aria-busy', 'false');
                    }
                    if (errorMessage) {
                        errorMessage.style.display = 'block';
                        errorMessage.setAttribute('aria-hidden', 'false');
                        document.getElementById('error-text').textContent = `æ— æ³•åŠ è½½æ–‡ä»¶ "${fetchPath}": ${error.message}`;
                    }
	                });
	            } catch (error) {
	                console.error('docs/viewer.html: æ— æ³•è§£æ/åŠ è½½æ–‡æ¡£:', error);
	                if (loadingIndicator) {
	                    loadingIndicator.style.display = 'none';
                        loadingIndicator.setAttribute('aria-busy', 'false');
	                }
	                if (errorMessage) {
	                    errorMessage.style.display = 'block';
                        errorMessage.setAttribute('aria-hidden', 'false');
	                    document.getElementById('error-text').textContent = `æ— æ³•åŠ è½½æ–‡ä»¶ "${filePath}": ${error.message}`;
	                }
	            }
	        }

        // åˆ†ç±»æ˜ å°„å‡½æ•°ï¼šå°†æ—§åˆ†ç±»ç³»ç»Ÿæ˜ å°„åˆ°æ–°åˆ†ç±»ç³»ç»Ÿ
        function mapCategoryToNewSystem(oldCategory) {
            console.log(`æ˜ å°„åˆ†ç±»: ${oldCategory}`);

            // å¦‚æœåˆ†ç±»å·²ç»å­˜åœ¨äºæ–°ç³»ç»Ÿä¸­ï¼Œç›´æ¥è¿”å›
            if (MAIN_CATEGORIES[oldCategory]) {
                console.log(`åˆ†ç±» ${oldCategory} å·²å­˜åœ¨äºæ–°ç³»ç»Ÿä¸­`);
                return oldCategory;
            }

            // å¦‚æœé…ç½®æ–‡ä»¶ä¸­æœ‰åˆ†ç±»æ˜ å°„ï¼Œä½¿ç”¨æ˜ å°„
            if (VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.categoryMappings && VIEWER_DOC_CONFIG.categoryMappings[oldCategory]) {
                const newCategory = VIEWER_DOC_CONFIG.categoryMappings[oldCategory];
                console.log(`åˆ†ç±» ${oldCategory} æ˜ å°„åˆ° ${newCategory}`);
                return newCategory;
            }

            // å°è¯•ä»æ—§è·¯å¾„ä¸­æå–åˆ†ç±»
            const pathMap = {
                '00-æµ‹è¯•æ–‡æ¡£': 'å…¥é—¨',
                '01-å…¥é—¨æŒ‡å—': 'å…¥é—¨',
                '02-åŸºç¡€æ¦‚å¿µ': 'å…¥é—¨',
                '03-å†…å®¹åˆ›å»º': 'è¿›é˜¶',
                '04-é«˜çº§å¼€å‘': 'é«˜çº§',
                '05-ä¸“é¢˜ä¸»é¢˜': 'é«˜çº§',
                '06-èµ„æºå‚è€ƒ': 'ä¸ªäººåˆ†äº«',
                '0-å¼€å§‹': 'å…¥é—¨',
                '1-åŸºç¡€': 'å…¥é—¨',
                '2-ä¸­é˜¶': 'è¿›é˜¶',
                '3-é«˜é˜¶': 'é«˜çº§',
                '4-ä¸“å®¶': 'é«˜çº§'
            };

            const mappedCategory = pathMap[oldCategory] || 'å…¥é—¨';
            console.log(`é€šè¿‡è·¯å¾„æ˜ å°„ï¼Œåˆ†ç±» ${oldCategory} æ˜ å°„åˆ° ${mappedCategory}`);
            return mappedCategory;
        }

        // ä»æ—§è·¯å¾„è·å–å¯¹åº”çš„åˆ†ç±»
        function getCategoryFromOldPath(oldPath) {
            console.log(`ä»æ—§è·¯å¾„è·å–åˆ†ç±»: ${oldPath}`);
            const category = mapCategoryToNewSystem(oldPath);
            console.log(`æ˜ å°„ç»“æœ: ${category}`);
            return category;
        }

        // è§£æFront Matterï¼ˆæ–‡æ¡£å¼€å¤´çš„å…ƒæ•°æ®éƒ¨åˆ†ï¼‰
        function parseFrontMatter(text) {
            const frontMatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
            const match = text.match(frontMatterRegex);

            if (match) {
                const yamlText = match[1];
                const content = match[2];

                // æ›´å¼ºå¤§çš„YAMLè§£æå™¨
                const metadata = parseYaml(yamlText);

                return {
                    metadata: metadata,
                    content: content
                };
            }

            return {
                metadata: {},
                content: text
            };
        }

        // ç®€å•çš„YAMLè§£æå™¨ï¼Œæ”¯æŒåµŒå¥—å¯¹è±¡å’Œæ•°ç»„
        function parseYaml(yamlText) {
            // ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½è¡Œ
            const lines = yamlText.trim().split('\n');
            const result = {};

            // ç®€å•çš„æ ˆç»“æ„è·Ÿè¸ªå½“å‰å¯¹è±¡å’Œç¼©è¿›çº§åˆ«
            const stack = [{ obj: result, indent: -1 }];

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                if (!line.trim()) continue;

                // è®¡ç®—å®é™…ç¼©è¿›ï¼ˆç©ºæ ¼æ•°ï¼‰
                const indent = line.search(/\S/);
                const trimmedLine = line.trim();

                // ç§»é™¤æ¯”å½“å‰ç¼©è¿›çº§åˆ«æ›´æ·±çš„æ‰€æœ‰å¯¹è±¡
                while (stack.length > 1 && stack[stack.length - 1].indent >= indent) {
                    stack.pop();
                }

                const current = stack[stack.length - 1];
                const currentObj = current.obj;

                // å¤„ç†æ•°ç»„é¡¹ï¼ˆä»¥-å¼€å¤´ï¼‰
                if (trimmedLine.startsWith('-')) {
                    const content = trimmedLine.substring(1).trim();

                    // æ£€æŸ¥æ˜¯å¦æ˜¯é”®å€¼å¯¹å½¢å¼ (- key: value)
                    if (content.includes(':')) {
                        const colonIndex = content.indexOf(':');
                        const key = content.substring(0, colonIndex).trim();
                        const value = content.substring(colonIndex + 1).trim();

                        // å¤„ç†å¸¦å¼•å·çš„å­—ç¬¦ä¸²
                        let finalValue = value;
                        if ((value.startsWith('"') && value.endsWith('"')) ||
                            (value.startsWith("'") && value.endsWith("'"))) {
                            finalValue = value.substring(1, value.length - 1);
                        }

                        // å¦‚æœå½“å‰å¯¹è±¡æ˜¯æ•°ç»„ï¼Œåˆ™æ¨å…¥æ–°å¯¹è±¡
                        if (Array.isArray(currentObj)) {
                            const newObj = {};
                            newObj[key] = finalValue;
                            currentObj.push(newObj);
                        } else {
                            // å¦åˆ™åˆ›å»ºæ•°ç»„å¹¶æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ 
                            const arrayKey = Object.keys(currentObj).pop();
                            if (!Array.isArray(currentObj[arrayKey])) {
                                currentObj[arrayKey] = [];
                            }
                            const newObj = {};
                            newObj[key] = finalValue;
                            currentObj[arrayKey].push(newObj);
                        }
                    } else {
                        // ç®€å•å€¼å½¢å¼ (- value)
                        let finalValue = content;
                        if ((content.startsWith('"') && content.endsWith('"')) ||
                            (content.startsWith("'") && content.endsWith("'"))) {
                            finalValue = content.substring(1, content.length - 1);
                        }

                        // ç¡®ä¿å½“å‰ä¸Šä¸‹æ–‡æ˜¯æ•°ç»„
                        const parent = stack[stack.length - 2];
                        if (parent) {
                            const parentObj = parent.obj;
                            const arrayKey = Object.keys(parentObj).pop();

                            if (!Array.isArray(parentObj[arrayKey])) {
                                parentObj[arrayKey] = [];
                            }
                            parentObj[arrayKey].push(finalValue);
                        }
                    }
                }
                // å¤„ç†é”®å€¼å¯¹ (key: value)
                else if (trimmedLine.includes(':')) {
                    const colonIndex = trimmedLine.indexOf(':');
                    const key = trimmedLine.substring(0, colonIndex).trim();
                    const value = trimmedLine.substring(colonIndex + 1).trim();

                    // å¦‚æœå€¼ä¸ºç©ºï¼Œè¿™æ˜¯ä¸€ä¸ªåµŒå¥—å¯¹è±¡
                    if (!value) {
                        const newObj = {};
                        currentObj[key] = newObj;
                        stack.push({ obj: newObj, indent: indent });
                    }
                    // å¦‚æœå€¼ä¸ä¸ºç©ºï¼Œæ˜¯ç®€å•é”®å€¼å¯¹
                    else {
                        // å¤„ç†å¸¦å¼•å·çš„å­—ç¬¦ä¸²
                        let finalValue = value;
                        if ((value.startsWith('"') && value.endsWith('"')) ||
                            (value.startsWith("'") && value.endsWith("'"))) {
                            finalValue = value.substring(1, value.length - 1);
                        }
                        // å¤„ç†é¢œè‰²å€¼ç­‰ç‰¹æ®Šæ ¼å¼
                        else if (value.startsWith('#')) {
                            finalValue = value;
                        }
                        // å°è¯•è½¬æ¢æ•°å­—
                        else if (!isNaN(value) && !isNaN(parseFloat(value))) {
                            finalValue = parseFloat(value);
                        }
                        // å¤„ç†å¸ƒå°”å€¼
                        else if (value.toLowerCase() === 'true') {
                            finalValue = true;
                        }
                        else if (value.toLowerCase() === 'false') {
                            finalValue = false;
                        }

                        currentObj[key] = finalValue;
                    }
                }
                // å¤„ç†æ•°ç»„å¼€å§‹çš„æƒ…å†µ ([key]:)
                else if (trimmedLine.endsWith(':')) {
                    const key = trimmedLine.slice(0, -1).trim();
                    const newArray = [];
                    currentObj[key] = newArray;
                    stack.push({ obj: newArray, indent: indent });
                }
            }

            return result;
        }

        // æ›´æ–°é¡µé¢å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€éš¾åº¦ã€æ—¶é—´ã€ä½œè€…ã€æ—¥æœŸï¼‰
        function updatePageMetadata(metadata, filePath) {
            const title = metadata.title || filePath.replace('.md', '');
            const difficulty = metadata.difficulty || 'beginner';
            const time = metadata.time || 'æœªçŸ¥';
            const author = metadata.author || 'æœªçŸ¥';
            const last_updated = metadata.last_updated || 'æœªçŸ¥';
            const prevChapter = metadata.prev_chapter || null;
            const nextChapter = metadata.next_chapter || null;
            const colorLD = metadata.colorLD || null;
            const colorChange = metadata.colorChange || null;

            console.log('æ›´æ–°é¡µé¢å…ƒæ•°æ®:', { title, difficulty, time, author, last_updated, prevChapter, nextChapter, colorLD, colorChange });

            document.title = `${title} - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹`;
            document.getElementById('current-doc-name').textContent = title;
            document.getElementById('doc-title').textContent = title;
            document.getElementById('doc-difficulty').textContent = getDifficultyText(difficulty);
            document.getElementById('doc-difficulty').className = `difficulty-badge ${difficulty}`;
            document.getElementById('doc-time').textContent = time;
            document.getElementById('doc-author').textContent = author;
            document.getElementById('doc-date').textContent = last_updated;

            // æ›´æ–°ç‰¹æ®Šé¢œè‰²
            updateColorStyle(colorLD, colorChange);

            // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
            updateBreadcrumbNavigation(metadata, filePath);

            // æ›´æ–°å¯¼èˆªæŒ‰é’®
            updateNavigationButtons(prevChapter, nextChapter);

            // æ›´æ–° SEO å…ƒæ ‡ç­¾ï¼ˆcanonical/OG/Twitter/descriptionï¼‰
            updateSeoMeta({
                title,
                description: metadata.description || metadata.summary || '',
                filePath
            });
        }

        function setMetaContent(selector, content) {
            const el = document.querySelector(selector);
            if (el && content) el.setAttribute('content', content);
        }

        function setCanonical(href) {
            let link = document.querySelector('link[rel="canonical"]');
            if (!link) {
                link = document.createElement('link');
                link.setAttribute('rel', 'canonical');
                document.head.appendChild(link);
            }
            link.setAttribute('href', href);
        }

        function updateSeoMeta({ title, description, filePath }) {
            const baseUrl = 'https://dpapyru.github.io/docs/viewer.html';
            const url = filePath ? `${baseUrl}?file=${encodeURIComponent(filePath)}` : baseUrl;

            const safeTitle = title ? `${title} - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹` : 'æ–‡æ¡£æŸ¥çœ‹å™¨ - æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹';
            const safeDescription = (description && String(description).trim())
                ? String(description).trim()
                : 'æ³°æ‹‰ç‘äºšModåˆ¶ä½œæ•™ç¨‹æ–‡æ¡£é˜…è¯»é¡µé¢ï¼Œæ”¯æŒç›®å½•ã€ä»£ç é«˜äº®ä¸åˆ†ç±»å¯¼èˆªã€‚';

            setCanonical(url);
            setMetaContent('meta[name="description"]', safeDescription);
            setMetaContent('meta[property="og:title"]', safeTitle);
            setMetaContent('meta[property="og:description"]', safeDescription);
            setMetaContent('meta[property="og:url"]', url);
            setMetaContent('meta[name="twitter:title"]', safeTitle);
            setMetaContent('meta[name="twitter:description"]', safeDescription);
        }

        function updateColorStyle(colorLDArray, colorChangeArray) {
            const style = document.createElement('style'); // åˆ›å»ºä¸€ä¸ªstyle
            // æ·±æµ…å­—ä½“é¢œè‰²
            let colorLD = null;
            if (!colorLDArray)
                console.warn('æ²¡æœ‰è®¾ç½®æ·±æµ…å­—ä½“é¢œè‰²!è·³è¿‡æ·±æµ…é¢œè‰²çš„è®¾ç½®!');
            else
                colorLD = colorLDStyle(colorLDArray);
            // é¢œè‰²åŠ¨ç”»
            let colorChange = null;
            if (!colorChangeArray)
                console.warn('æ²¡æœ‰è®¾ç½®é¢œè‰²è½¬æ¢å˜é‡!è·³è¿‡é¢œè‰²è½¬æ¢å˜é‡çš„è®¾ç½®!');
            else
                colorChange = colorChangeStyle(colorChangeArray);
            
            const light = colorLD ? colorLD.light : '';
            const dark = colorLD ? colorLD.dark : '';
            style.textContent = `
                        ${colorChange || ''}
                        :root{
                            ${light}
                        }
                        [data-theme="dark"]{
                            ${dark}
                        }
                    `;
            document.head.appendChild(style);
        }

        function colorLDStyle(colorLDArray) {
            try {
                const forEach_color = colorLDArray;
                let style_text_light = '';
                let style_text_dark = '';
                if (forEach_color) {
                    Object.entries(forEach_color).forEach(color => {
                        // ä¸ºæ¯ç§é¢œè‰²ç”Ÿæˆå”¯ä¸€çš„CSSç±»å
                        // color0æ˜¯åå­—
                        // color1æ˜¯é¢œè‰²æ•°ç»„
                        // color1ä¸‹:
                        // 0æ˜¯æµ…è‰²,1æ˜¯æ·±è‰²
                        style_text_light = style_text_light.concat(`
                            --marked-text-color-${color[0]}:${color[1][0]};
                        `).trim();
                        style_text_dark = style_text_dark.concat(`
                            --marked-text-color-${color[0]}:${color[1][1]};
                        `).trim();
                    });
                    return {
                        light: style_text_light,
                        dark: style_text_dark
                    };
                }
                else {
                    console.error('ç‰¹æ®Šå­—ä½“é¢œè‰²é…ç½®å¤±æ•ˆï¼');
                }
            } catch (error) {
                console.error('åˆ›å»ºcssæ—¶å€™å‡ºç°ä¸¥é‡é—®é¢˜!é—®é¢˜:', error);
            }
        }

        /**
         * æ ¹æ®é¢œè‰²å˜åŒ–æ•°ç»„ç”ŸæˆCSSåŠ¨ç”»æ ·å¼
         * @param {Array} colorChangeArray - é¢œè‰²å˜åŒ–é…ç½®æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å«åŠ¨ç”»åç§°å’Œé¢œè‰²å€¼æ•°ç»„
         * @returns {void}
         */
        function colorChangeStyle(colorChangeArray) {
            try {
                const forEach_color = colorChangeArray; // é¢œè‰²åŠ¨ç”»çš„æ•°ç»„
                let style_text = ''; // è¾“å‡ºçš„å†…å®¹
                if (forEach_color) { // å¦‚æœæœ‰é¢œè‰²æ•°ç»„
                    // éå†é¢œè‰²æ”¹å˜æ•°ç»„
                    Object.entries(forEach_color).forEach(colorName => {
                        // colorName0æ˜¯åå­—
                        // colorName1æ˜¯é¢œè‰²æ•°ç»„

                        const colorArray = [];
                        // éå†æ¯ä¸ªå˜é‡å
                        colorName[1].forEach(color => {
                            colorArray.push(color);
                        });
                        const colorLength = colorArray.length;
                        let useColor = '';
                        // æ„å»ºå…³é”®å¸§åŠ¨ç”»çš„é¢œè‰²å˜åŒ–éƒ¨åˆ†
                        for (let i = 0; i < colorLength; i++) {
                            const colorPercent = (i / colorLength) * 100;
                            useColor = useColor.concat(`${colorPercent.toFixed(0)}% {color:${colorArray[i]};}\n`);
                        }
                        useColor = useColor.concat(`100% {color:${colorArray[0]};}\n`);
                        // æ·»åŠ æ ·å¼
                        style_text = style_text.concat(`
                            @keyframes colorChange-${colorName[0]}{
                                ${useColor}
                            }
                        `);
                    });
                    return style_text;
                }
                else {
                    console.error('ç‰¹æ®Šå­—ä½“é¢œè‰²é…ç½®å¤±æ•ˆï¼');
                }
            } catch (error) {
                console.error('åˆ›å»ºcssæ—¶å€™å‡ºç°ä¸¥é‡é—®é¢˜!é—®é¢˜:', error);
            }
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumbNavigation(metadata, filePath) {
            const breadcrumb = document.querySelector('.breadcrumb');
            if (!breadcrumb) return;

            // æŸ¥æ‰¾å½“å‰æ–‡æ¡£ä¿¡æ¯
            const currentDoc = ALL_DOCS.find(doc => doc.filename === filePath || doc.path === filePath);

            // æ¸…ç©ºç°æœ‰é¢åŒ…å±‘
            breadcrumb.innerHTML = '';

            // æ·»åŠ é¦–é¡µé“¾æ¥
            const homeLink = document.createElement('a');
            homeLink.href = '../index.html';
            homeLink.textContent = 'é¦–é¡µ';
            breadcrumb.appendChild(homeLink);

            // æ·»åŠ åˆ†éš”ç¬¦
            const separator1 = document.createElement('span');
            separator1.className = 'breadcrumb-separator';
            separator1.textContent = ' > ';
            breadcrumb.appendChild(separator1);

            // æ·»åŠ æ–‡æ¡£åˆ—è¡¨é“¾æ¥
            const docsLink = document.createElement('a');
            docsLink.href = 'index.html';
            docsLink.textContent = 'æ–‡æ¡£';
            breadcrumb.appendChild(docsLink);

            // å¦‚æœæ‰¾åˆ°å½“å‰æ–‡æ¡£ä¿¡æ¯ï¼Œæ·»åŠ åˆ†ç±»å’Œä¸»é¢˜è·¯å¾„
            if (currentDoc) {
                // æ·»åŠ åˆ†éš”ç¬¦
                const separator2 = document.createElement('span');
                separator2.className = 'breadcrumb-separator';
                separator2.textContent = ' > ';
                breadcrumb.appendChild(separator2);

                // æ·»åŠ åˆ†ç±»é“¾æ¥
                const category = MAIN_CATEGORIES[currentDoc.category];
                if (category) {
                    const categoryLink = document.createElement('a');
                    categoryLink.href = `folder.html?path=${encodeURIComponent(currentDoc.category)}`;
                    categoryLink.textContent = category.title;
                    breadcrumb.appendChild(categoryLink);

                    // ä¸»é¢˜ä¿¡æ¯ä»…å±•ç¤ºä¸ºæ–‡æœ¬ï¼ˆå½“å‰ç«™ç‚¹ä¸æ”¯æŒæŒ‰ topic è¿‡æ»¤è·³è½¬ï¼‰
                    if (currentDoc.topic && VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.topics && VIEWER_DOC_CONFIG.topics[currentDoc.topic]) {
                        const separator3 = document.createElement('span');
                        separator3.className = 'breadcrumb-separator';
                        separator3.textContent = ' > ';
                        breadcrumb.appendChild(separator3);

                        const topicSpan = document.createElement('span');
                        topicSpan.className = 'breadcrumb-topic';
                        topicSpan.textContent = VIEWER_DOC_CONFIG.topics[currentDoc.topic].title;
                        breadcrumb.appendChild(topicSpan);

                        const separator4 = document.createElement('span');
                        separator4.className = 'breadcrumb-separator';
                        separator4.textContent = ' > ';
                        breadcrumb.appendChild(separator4);
                    }
                }
            }

            // æ·»åŠ å½“å‰æ–‡æ¡£æ ‡é¢˜
            const currentSpan = document.createElement('span');
            currentSpan.className = 'current';
            currentSpan.textContent = metadata.title || filePath.replace('.md', '');
            breadcrumb.appendChild(currentSpan);
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®
	        function updateNavigationButtons(prevChapter, nextChapter) {
            const navigationContainer = document.querySelector('.tutorial-navigation');
            if (!navigationContainer) {
                console.warn('æ‰¾ä¸åˆ°å¯¼èˆªå®¹å™¨');
                return;
            }

            // æ¸…ç©ºç°æœ‰å¯¼èˆªå†…å®¹
            navigationContainer.innerHTML = '';

	            // æ·»åŠ è¿”å›æ–‡æ¡£åˆ—è¡¨æŒ‰é’®
	            const backToListBtn = document.createElement('a');
	            backToListBtn.href = 'index.html';
	            backToListBtn.className = 'btn btn-outline prev-tutorial';
	            backToListBtn.textContent = 'â† è¿”å›æ–‡æ¡£åˆ—è¡¨';
	            navigationContainer.appendChild(backToListBtn);

            // æ·»åŠ ä¸Šä¸€ç« æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
	            if (prevChapter) {
	                const prevBtn = document.createElement('a');
	                prevBtn.href = `?file=${encodeURIComponent(prevChapter)}`;
	                prevBtn.className = 'btn btn-secondary prev-tutorial';
	                prevBtn.textContent = 'â† ä¸Šä¸€ç« ';
	                navigationContainer.appendChild(prevBtn);
	            }

            // æ·»åŠ ä¸‹ä¸€ç« æŒ‰é’®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
	            if (nextChapter) {
	                const nextBtn = document.createElement('a');
	                nextBtn.href = `?file=${encodeURIComponent(nextChapter)}`;
	                nextBtn.className = 'btn btn-primary next-tutorial';
	                nextBtn.textContent = 'ä¸‹ä¸€ç«  â†’';
	                navigationContainer.appendChild(nextBtn);
	            }

            console.log('å¯¼èˆªæŒ‰é’®å·²æ›´æ–°:', { prevChapter, nextChapter });
        }

        // å°†éš¾åº¦ä»£ç è½¬æ¢ä¸ºä¸­æ–‡æ–‡æœ¬
        function getDifficultyText(difficulty) {
            // é¦–å…ˆå°è¯•ä»é…ç½®æ–‡ä»¶ä¸­è·å–éš¾åº¦æ˜ å°„
            if (VIEWER_DOC_CONFIG && VIEWER_DOC_CONFIG.extensions && VIEWER_DOC_CONFIG.extensions.customFields &&
                VIEWER_DOC_CONFIG.extensions.customFields.difficulty && VIEWER_DOC_CONFIG.extensions.customFields.difficulty.options) {
                const difficultyOptions = VIEWER_DOC_CONFIG.extensions.customFields.difficulty.options;
                const difficultyMap = {
                    'beginner': 'åˆçº§',
                    'intermediate': 'ä¸­çº§',
                    'advanced': 'é«˜çº§'
                };
                
                // å¦‚æœé…ç½®ä¸­æœ‰è‡ªå®šä¹‰æ˜ å°„ï¼Œä½¿ç”¨é…ç½®ä¸­çš„æ˜ å°„
                if (difficultyOptions.includes(difficulty)) {
                    return difficultyMap[difficulty] || difficulty;
                }
            }
            
            // é»˜è®¤éš¾åº¦æ˜ å°„
            const defaultDifficultyMap = {
                'beginner': 'åˆçº§',
                'intermediate': 'ä¸­çº§',
                'advanced': 'é«˜çº§'
            };
            return defaultDifficultyMap[difficulty] || difficulty;
        }

        // ç”Ÿæˆæ–‡æ¡£ç›®å½•ï¼ˆåŸºäºæ ‡é¢˜h1-h6ï¼‰
        function generateTableOfContents(contentElement) {
            const tableOfContents = document.getElementById('table-of-contents');
            const tocList = document.getElementById('toc-list');

            if (!tableOfContents || !tocList || !contentElement) {
                return;
            }

            const headings = contentElement.querySelectorAll('h1, h2, h3, h4, h5, h6');
            console.log(`æ‰¾åˆ° ${headings.length} ä¸ªæ ‡é¢˜ç”¨äºç”Ÿæˆç›®å½•`);

            if (headings.length === 0) {
                tableOfContents.style.display = 'none';
                return;
            }

            tocList.innerHTML = '';

            headings.forEach((heading, index) => {
                // ä¸ºæ²¡æœ‰IDçš„æ ‡é¢˜è‡ªåŠ¨ç”ŸæˆID
                if (!heading.id) {
                    heading.id = `heading-${index}`;
                }

                // åˆ›å»ºç›®å½•é¡¹
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${heading.id}`;
                a.textContent = heading.textContent;

                // æ ¹æ®æ ‡é¢˜çº§åˆ«è®¾ç½®ç¼©è¿›
                const level = parseInt(heading.tagName.substring(1));
                a.style.paddingLeft = `${(level - 1) * 15}px`;

                li.appendChild(a);
                tocList.appendChild(li);

                // æ·»åŠ å¹³æ»‘æ»šåŠ¨æ•ˆæœ
                a.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetElement = document.getElementById(heading.id);
                    if (targetElement) {
                        // è®¡ç®—æ»šåŠ¨ä½ç½®ï¼Œè€ƒè™‘å›ºå®šå¤´éƒ¨é«˜åº¦
                        const headerHeight = document.querySelector('.site-header').offsetHeight;
                        const targetPosition = targetElement.offsetTop - headerHeight - 20;

                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            tableOfContents.style.display = 'block';
            console.log('ç›®å½•ç”Ÿæˆå®Œæˆ');
        }

        // æ£€æŸ¥åˆ†ç±»æ˜¯å¦æœ‰æ–‡æ¡£
        function categoryHasDocuments(categoryKey) {
            console.log(`æ£€æŸ¥åˆ†ç±» ${categoryKey} æ˜¯å¦æœ‰æ–‡æ¡£`);

            // é¦–å…ˆæ£€æŸ¥ALL_DOCSä¸­æ˜¯å¦æœ‰è¯¥åˆ†ç±»çš„æ–‡æ¡£
            if (ALL_DOCS && ALL_DOCS.length > 0) {
                const docsInCategory = ALL_DOCS.filter(doc => doc.category === categoryKey);
                if (docsInCategory.length > 0) {
                    console.log(`åœ¨ALL_DOCSä¸­æ‰¾åˆ° ${docsInCategory.length} ä¸ª ${categoryKey} åˆ†ç±»çš„æ–‡æ¡£`);
                    return true;
                }
            }

            // å¦‚æœALL_DOCSä¸­æ²¡æœ‰ï¼Œæ£€æŸ¥é…ç½®æ–‡ä»¶
            if (!VIEWER_DOC_CONFIG || !VIEWER_DOC_CONFIG.categories || !VIEWER_DOC_CONFIG.categories[categoryKey]) {
                console.log(`é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æ‰¾åˆ°åˆ†ç±» ${categoryKey}`);
                return false;
            }

            const categoryTopics = VIEWER_DOC_CONFIG.categories[categoryKey].topics || {};
            console.log(`åˆ†ç±» ${categoryKey} ä¸‹çš„ä¸»é¢˜:`, Object.keys(categoryTopics));

            // æ£€æŸ¥è¯¥åˆ†ç±»ä¸‹æ˜¯å¦æœ‰ä»»ä½•ä¸»é¢˜åŒ…å«æ–‡æ¡£
            for (const topicKey in categoryTopics) {
                const topic = categoryTopics[topicKey];
                if (topic.files && topic.files.length > 0) {
                    console.log(`ä¸»é¢˜ ${topicKey} ä¸‹æœ‰ ${topic.files.length} ä¸ªæ–‡æ¡£`);
                    return true;
                }
            }

            console.log(`åˆ†ç±» ${categoryKey} æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ–‡æ¡£`);
            return false;
        }

        // åˆå§‹åŒ–åˆ†ç±»å¯¼èˆª
        function initializeCategoryNavigation() {
            console.log('=== initializeCategoryNavigation() å¼€å§‹ ===');
            const categorySidebar = document.getElementById('category-sidebar');

            if (!categorySidebar) {
                console.error('æ‰¾ä¸åˆ°åˆ†ç±»ä¾§è¾¹æ å…ƒç´ ');
                return;
            }

            // æ¸…ç©ºç°æœ‰å¯¼èˆª
            categorySidebar.innerHTML = '';

            // ç­‰å¾…é…ç½®åŠ è½½å®Œæˆ
            if (!VIEWER_DOC_CONFIG) {
                console.warn('æ–‡æ¡£é…ç½®å°šæœªåŠ è½½ï¼Œç¨åé‡è¯•');
                setTimeout(initializeCategoryNavigation, 100);
                return;
            }

            console.log('DOC_CONFIGå·²åŠ è½½ï¼Œå¼€å§‹ç”Ÿæˆåˆ†ç±»å¯¼èˆª');
            console.log('ALL_DOCSæ•°é‡:', ALL_DOCS.length);
            console.log('å¯ç”¨åˆ†ç±»:', Object.keys(MAIN_CATEGORIES));

            // æ·»åŠ åˆ†å‰²çº¿
            const divider = document.createElement('div');
            divider.className = 'sidebar-divider';
            categorySidebar.appendChild(divider);

            // ç”Ÿæˆåˆ†ç±»å¯¼èˆª
            let visibleCategories = 0;
            Object.keys(MAIN_CATEGORIES).forEach(categoryKey => {
                const category = MAIN_CATEGORIES[categoryKey];
                console.log(`å¤„ç†åˆ†ç±»: ${categoryKey} (${category.title})`);

                // æ£€æŸ¥è¯¥åˆ†ç±»æ˜¯å¦æœ‰æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡
                if (!categoryHasDocuments(categoryKey)) {
                    console.log(`è·³è¿‡ç©ºåˆ†ç±»: ${categoryKey}`);
                    return; // è·³è¿‡ç©ºåˆ†ç±»
                }

                visibleCategories++;
                console.log(`æ˜¾ç¤ºåˆ†ç±»: ${categoryKey}`);

                // åˆ›å»ºåˆ†ç±»å¯¼èˆªé¡¹
                const categoryItem = document.createElement('li');
                categoryItem.className = 'category-item';

                // åˆ›å»ºåˆ†ç±»æ ‡é¢˜
                const categoryHeader = document.createElement('h4');
                categoryHeader.className = 'category-header';

                // æ·»åŠ åˆ†ç±»æ ‡é¢˜æ–‡æœ¬
                const titleSpan = document.createElement('span');
                titleSpan.className = 'category-title-text';
                titleSpan.textContent = category.title;
                categoryHeader.appendChild(titleSpan);

                // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'category-toggle';
                toggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·åˆ†ç±»');
                toggleBtn.innerHTML = 'â–¼';
                categoryHeader.appendChild(toggleBtn);

                categoryItem.appendChild(categoryHeader);

                // åˆ›å»ºä¸»é¢˜å­èœå•
                const topicList = document.createElement('ul');
                topicList.className = 'topic-list';

                // è·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰ä¸»é¢˜
                const categoryTopics = VIEWER_DOC_CONFIG.categories[categoryKey]?.topics || {};

                if (Object.keys(categoryTopics).length > 0) {
                    Object.keys(categoryTopics).forEach(topicKey => {
                        const topic = categoryTopics[topicKey];

                        // æ£€æŸ¥ä¸»é¢˜æ˜¯å¦æœ‰æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡
                        if (!topic.files || topic.files.length === 0) {
                            return; // è·³è¿‡ç©ºä¸»é¢˜
                        }

                        // åˆ›å»ºä¸»é¢˜æ ‡é¢˜
                        const topicHeader = document.createElement('h5');
                        topicHeader.className = 'topic-header';

                        // æ·»åŠ ä¸»é¢˜æ ‡é¢˜æ–‡æœ¬
                        const topicTitleSpan = document.createElement('span');
                        topicTitleSpan.className = 'topic-title-text';
                        topicTitleSpan.textContent = topic.title;
                        topicHeader.appendChild(topicTitleSpan);

                        // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
                        const topicToggleBtn = document.createElement('button');
                        topicToggleBtn.className = 'topic-toggle';
                        topicToggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·ä¸»é¢˜');
                        topicToggleBtn.innerHTML = 'â–¼';
                        topicHeader.appendChild(topicToggleBtn);

                        // ä¸ºä¸»é¢˜æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        topicHeader.addEventListener('click', function () {
                            toggleTopic(categoryKey, topicKey, topicHeader, topicHeader.nextElementSibling);
                        });

                        // ä¸ºä¸»é¢˜æ ‡é¢˜çš„æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                        topicToggleBtn.addEventListener('click', function (e) {
                            e.stopPropagation();
                            toggleTopic(categoryKey, topicKey, topicHeader, topicHeader.nextElementSibling);
                        });

                        topicList.appendChild(topicHeader);

                        // åˆ›å»ºæ–‡æ¡£åˆ—è¡¨
                        const fileList = document.createElement('ul');
                        fileList.className = 'file-list';

                        // ç¡®ä¿topic.fileså­˜åœ¨ä¸”æ˜¯æ•°ç»„
                        const files = topic.files || [];
                        files.forEach(file => {
                            const fileItem = document.createElement('li');
                            fileItem.className = 'file-item';

	                            const fileLink = document.createElement('a');
	                            fileLink.href = `?file=${encodeURIComponent(file.path || file.filename)}`;
	                            fileLink.textContent = file.title;
	                            fileLink.title = `${file.author || 'æœªçŸ¥'} - ${file.description || file.title}`;

                            fileItem.appendChild(fileLink);
                            fileList.appendChild(fileItem);
                        });

                        topicList.appendChild(fileList);
                    });
                }

                categoryItem.appendChild(topicList);
                categorySidebar.appendChild(categoryItem);

                // ä¸ºåˆ†ç±»æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
                categoryHeader.addEventListener('click', function () {
                    toggleCategory(categoryKey, categoryHeader, topicList);
                });

                // ä¸ºåˆ†ç±»æ ‡é¢˜çš„æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                toggleBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    toggleCategory(categoryKey, categoryHeader, topicList);
                });

                // æ¢å¤åˆ†ç±»çš„å±•å¼€/æ”¶èµ·çŠ¶æ€
                const isCollapsed = getCollapsedState('category', categoryKey);
                if (isCollapsed) {
                    topicList.classList.add('collapsed');
                    toggleBtn.classList.add('collapsed');
                    // toggleBtn.innerHTML = 'â–¶';
                } else {
                    toggleBtn.innerHTML = 'â–¼';
                }
            });

            // æ·»åŠ åˆ†å‰²çº¿
            const allDocsDivider = document.createElement('div');
            allDocsDivider.className = 'sidebar-divider';
            categorySidebar.appendChild(allDocsDivider);

            // æ·»åŠ "æ‰€æœ‰æ–‡æ¡£"éƒ¨åˆ†
            const allDocsItem = document.createElement('li');
            allDocsItem.className = 'category-item all-docs';

            const allDocsHeader = document.createElement('h4');
            allDocsHeader.className = 'category-header';

            // æ·»åŠ "æ‰€æœ‰æ–‡æ¡£"æ ‡é¢˜æ–‡æœ¬
            const allDocsTitleSpan = document.createElement('span');
            allDocsTitleSpan.className = 'category-title-text';
            allDocsTitleSpan.textContent = 'æ‰€æœ‰æ–‡æ¡£';
            allDocsHeader.appendChild(allDocsTitleSpan);

            // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
            const allDocsToggleBtn = document.createElement('button');
            allDocsToggleBtn.className = 'category-toggle';
            allDocsToggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·æ‰€æœ‰æ–‡æ¡£');
            allDocsToggleBtn.innerHTML = 'â–¼';
            allDocsHeader.appendChild(allDocsToggleBtn);

            allDocsItem.appendChild(allDocsHeader);

            const allDocsList = document.createElement('ul');
            allDocsList.className = 'file-list';

            // ç¡®ä¿ALL_DOCSå­˜åœ¨ä¸”æ˜¯æ•°ç»„
            const allDocs = ALL_DOCS || [];
            if (allDocs.length === 0) {
                // å¦‚æœæ²¡æœ‰æ–‡æ¡£ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                const noDocsItem = document.createElement('li');
                noDocsItem.className = 'no-docs';
                noDocsItem.textContent = 'æœªæ‰¾åˆ°ä»»ä½•æ–‡æ¡£';
                allDocsList.appendChild(noDocsItem);
            } else {
                // æŒ‰åˆ†ç±»å’Œæ’åºç»„ç»‡æ–‡æ¡£
                const sortedDocs = [...allDocs].sort((a, b) => {
                    // å…ˆæŒ‰åˆ†ç±»æ’åº
                    const categoryOrderA = MAIN_CATEGORIES[a.category]?.order || 999;
                    const categoryOrderB = MAIN_CATEGORIES[b.category]?.order || 999;
                    if (categoryOrderA !== categoryOrderB) {
                        return categoryOrderA - categoryOrderB;
                    }
                    // åŒä¸€åˆ†ç±»å†…æŒ‰æ’åºå€¼æ’åº
                    return (a.order || 999) - (b.order || 999);
                });

                sortedDocs.forEach(doc => {
                    const docItem = document.createElement('li');
                    docItem.className = 'file-item';

	                    const docLink = document.createElement('a');
	                    docLink.href = `?file=${encodeURIComponent(doc.path || doc.filename)}`;
	                    docLink.textContent = doc.title;

                    // æ·»åŠ æ›´è¯¦ç»†çš„æ ‡é¢˜ä¿¡æ¯
                    const categoryTitle = MAIN_CATEGORIES[doc.category]?.title || doc.category;
                    const topicTitle = VIEWER_DOC_CONFIG.topics[doc.topic]?.title || doc.topic;
                    const pathInfo = doc.path && doc.path !== doc.filename ? ` [è·¯å¾„: ${doc.path}]` : '';
                    docLink.title = `${doc.author || 'æœªçŸ¥ä½œè€…'} - ${doc.description || doc.title} [${categoryTitle} - ${topicTitle}]${pathInfo}`;

                    docItem.appendChild(docLink);
                    allDocsList.appendChild(docItem);
                });
            }

            allDocsItem.appendChild(allDocsList);
            categorySidebar.appendChild(allDocsItem);

            // ä¸º"æ‰€æœ‰æ–‡æ¡£"æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
            allDocsHeader.addEventListener('click', function () {
                toggleAllDocs(allDocsHeader, allDocsList);
            });

            // ä¸º"æ‰€æœ‰æ–‡æ¡£"æ ‡é¢˜çš„æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            allDocsToggleBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleAllDocs(allDocsHeader, allDocsList);
            });

            // æ¢å¤"æ‰€æœ‰æ–‡æ¡£"çš„å±•å¼€/æ”¶èµ·çŠ¶æ€
            const isAllDocsCollapsed = getCollapsedState('all-docs', 'all-docs');
            if (isAllDocsCollapsed) {
                allDocsList.classList.add('collapsed');
                allDocsToggleBtn.classList.add('collapsed');
                // allDocsToggleBtn.innerHTML = 'â–¶';
            } else {
                allDocsToggleBtn.innerHTML = 'â–¼';
            }
        }

        // å±•å¼€/æ”¶èµ·åˆ†ç±»
        function toggleCategory(categoryKey, categoryHeader, topicList) {
            const isCollapsed = topicList.classList.contains('collapsed');
            const toggleBtn = categoryHeader.querySelector('.category-toggle');

            if (isCollapsed) {
                // å±•å¼€
                topicList.classList.remove('collapsed');
                toggleBtn.classList.remove('collapsed');
                toggleBtn.innerHTML = 'â–¼';
                setCollapsedState('category', categoryKey, false);
            } else {
                // æ”¶èµ·
                topicList.classList.add('collapsed');
                toggleBtn.classList.add('collapsed');
                // toggleBtn.innerHTML = 'â–¶';
                setCollapsedState('category', categoryKey, true);
            }
        }

        // å±•å¼€/æ”¶èµ·ä¸»é¢˜
        function toggleTopic(categoryKey, topicKey, topicHeader, fileList) {
            const isCollapsed = fileList.classList.contains('collapsed');
            const toggleBtnArray = topicHeader.querySelectorAll('.topic-toggle');

            for (let i = 0; i < toggleBtnArray.length; i++) {
                const toggleBtn = toggleBtnArray[i];
                if (isCollapsed) {
                    // å±•å¼€
                    fileList.classList.remove('collapsed');
                    toggleBtn.classList.remove('collapsed');
                    toggleBtn.innerHTML = 'â–¼';  // æ·»åŠ è¿™è¡Œ
                    setCollapsedState('topic', `${categoryKey}-${topicKey}`, false);
                } else {
                    // æ”¶èµ·
                    fileList.classList.add('collapsed');
                    toggleBtn.classList.add('collapsed');
                    // toggleBtn.innerHTML = 'â–¶';  // æ·»åŠ è¿™è¡Œ
                    setCollapsedState('topic', `${categoryKey}-${topicKey}`, true);
                }
            }
        }

        // å±•å¼€/æ”¶èµ·"æ‰€æœ‰æ–‡æ¡£"
        function toggleAllDocs(allDocsHeader, allDocsList) {
            const isCollapsed = allDocsList.classList.contains('collapsed');
            const toggleBtn = allDocsHeader.querySelector('.category-toggle');

            if (isCollapsed) {
                // å±•å¼€
                allDocsList.classList.remove('collapsed');
                toggleBtn.classList.remove('collapsed');
                toggleBtn.innerHTML = 'â–¼';  // æ·»åŠ è¿™è¡Œ
                setCollapsedState('all-docs', 'all-docs', false);
            } else {
                // æ”¶èµ·
                allDocsList.classList.add('collapsed');
                toggleBtn.classList.add('collapsed');
                // toggleBtn.innerHTML = 'â–¶';  // æ·»åŠ è¿™è¡Œ
                setCollapsedState('all-docs', 'all-docs', true);
            }
        }



        // ä»localStorageè·å–å±•å¼€/æ”¶èµ·çŠ¶æ€
        function getCollapsedState(type, key) {
            try {
                const storageKey = `docsViewerSidebar${type.charAt(0).toUpperCase() + type.slice(1)}${key.charAt(0).toUpperCase() + key.slice(1)}`;
                const state = localStorage.getItem(storageKey);
                return state === 'true';
            } catch (error) {
                console.warn('æ— æ³•ä»localStorageè·å–å±•å¼€/æ”¶èµ·çŠ¶æ€:', error);
                return false;
            }
        }

        // ä¿å­˜å±•å¼€/æ”¶èµ·çŠ¶æ€åˆ°localStorage
        function setCollapsedState(type, key, isCollapsed) {
            try {
                const storageKey = `docsViewerSidebar${type.charAt(0).toUpperCase() + type.slice(1)}${key.charAt(0).toUpperCase() + key.slice(1)}`;
                localStorage.setItem(storageKey, isCollapsed.toString());
            } catch (error) {
                console.warn('æ— æ³•ä¿å­˜å±•å¼€/æ”¶èµ·çŠ¶æ€åˆ°localStorage:', error);
            }
        }

        // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
        function initializeDropdownMenu() {
            const dropdownToggle = document.querySelector('.dropdown-toggle');
            const dropdownMenu = document.querySelector('.dropdown-menu');

            if (!dropdownToggle || !dropdownMenu) return;

            // ç‚¹å‡»åˆ‡æ¢ä¸‹æ‹‰èœå•
            dropdownToggle.addEventListener('click', function (e) {
                e.preventDefault();
                dropdownMenu.classList.toggle('show');
            });

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰èœå•
            document.addEventListener('click', function (e) {
                if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });
        }

        // æ›´æ–°å½“å‰åˆ†ç±»çš„æ–‡æ¡£åˆ—è¡¨
        function updateCurrentCategoryDocs(filePath) {
            const currentCategoryTitle = document.getElementById('current-category-title');
            const currentCategoryDocs = document.getElementById('current-category-docs');

            if (!currentCategoryTitle || !currentCategoryDocs) return;

            // ç­‰å¾…é…ç½®åŠ è½½å®Œæˆ
            if (!VIEWER_DOC_CONFIG || !ALL_DOCS || ALL_DOCS.length === 0) {
                console.warn('æ–‡æ¡£é…ç½®å°šæœªåŠ è½½ï¼Œç¨åé‡è¯•');
                setTimeout(() => updateCurrentCategoryDocs(filePath), 100);
                return;
            }

	            // æŸ¥æ‰¾å½“å‰æ–‡æ¡£ä¿¡æ¯ï¼ˆæ”¯æŒ filename æˆ– pathï¼‰
	            const currentDoc = ALL_DOCS.find(doc => doc.filename === filePath || doc.path === filePath);

            if (!currentDoc) {
                // å¦‚æœæ‰¾ä¸åˆ°æ–‡æ¡£ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ–‡æ¡£
                currentCategoryTitle.textContent = 'æ‰€æœ‰æ–‡æ¡£';
                currentCategoryDocs.innerHTML = '';

                // æŒ‰åˆ†ç±»å’Œæ’åºç»„ç»‡æ–‡æ¡£
                const sortedDocs = [...ALL_DOCS].sort((a, b) => {
                    // å…ˆæŒ‰åˆ†ç±»æ’åº
                    const categoryOrderA = MAIN_CATEGORIES[a.category]?.order || 999;
                    const categoryOrderB = MAIN_CATEGORIES[b.category]?.order || 999;
                    if (categoryOrderA !== categoryOrderB) {
                        return categoryOrderA - categoryOrderB;
                    }
                    // åŒä¸€åˆ†ç±»å†…æŒ‰æ’åºå€¼æ’åº
                    return (a.order || 999) - (b.order || 999);
                });

                sortedDocs.forEach(doc => {
                    const li = document.createElement('li');
                    const link = document.createElement('a');
	                    link.href = `?file=${encodeURIComponent(doc.path || doc.filename)}`;
	                    link.textContent = doc.title;
	                    link.title = `${doc.author || 'æœªçŸ¥ä½œè€…'} - ${doc.description || doc.title}`;

	                    if ((doc.path || doc.filename) === filePath || doc.filename === filePath || doc.path === filePath) {
	                        link.classList.add('active');
	                    }

                    li.appendChild(link);
                    currentCategoryDocs.appendChild(li);
                });

                return;
            }

            // æ˜¾ç¤ºå½“å‰æ–‡æ¡£çš„åˆ†ç±»ä¿¡æ¯
            const category = MAIN_CATEGORIES[currentDoc.category];
            const topic = VIEWER_DOC_CONFIG.topics ? VIEWER_DOC_CONFIG.topics[currentDoc.topic] : null;

            let titleText = category ? category.title : currentDoc.category;
            if (topic) {
                titleText += ` - ${topic.title}`;
            }

            currentCategoryTitle.textContent = titleText;

            // æ¸…ç©ºç°æœ‰åˆ—è¡¨
            currentCategoryDocs.innerHTML = '';

            // æ˜¾ç¤ºåŒä¸€åˆ†ç±»å’Œä¸»é¢˜ä¸‹çš„å…¶ä»–æ–‡æ¡£
            const relatedDocs = ALL_DOCS.filter(doc =>
                doc.category === currentDoc.category && doc.topic === currentDoc.topic
            ).sort((a, b) => (a.order || 999) - (b.order || 999));

            if (relatedDocs.length > 0) {
                relatedDocs.forEach(doc => {
                    const li = document.createElement('li');
                    const link = document.createElement('a');
	                    link.href = `?file=${encodeURIComponent(doc.path || doc.filename)}`;
	                    link.textContent = doc.title;
	                    link.title = `${doc.author || 'æœªçŸ¥ä½œè€…'} - ${doc.description || doc.title}`;

	                    if ((doc.path || doc.filename) === filePath || doc.filename === filePath || doc.path === filePath) {
	                        link.classList.add('active');
	                    }

                    li.appendChild(link);
                    currentCategoryDocs.appendChild(li);
                });
            } else {
                // å¦‚æœæ²¡æœ‰ç›¸å…³æ–‡æ¡£ï¼Œæ˜¾ç¤ºåŒä¸€åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ–‡æ¡£
                const categoryDocs = ALL_DOCS.filter(doc =>
                    doc.category === currentDoc.category
                ).sort((a, b) => (a.order || 999) - (b.order || 999));

	                categoryDocs.forEach(doc => {
	                    const li = document.createElement('li');
	                    const link = document.createElement('a');
	                    link.href = `?file=${encodeURIComponent(doc.path || doc.filename)}`;
	                    link.textContent = doc.title;
	                    link.title = `${doc.author || 'æœªçŸ¥ä½œè€…'} - ${doc.description || doc.title}`;

	                    if ((doc.path || doc.filename) === filePath || doc.filename === filePath || doc.path === filePath) {
	                        link.classList.add('active');
	                    }

                    li.appendChild(link);
                    currentCategoryDocs.appendChild(li);
                });
            }
        }

        // åˆå§‹åŒ–æ‰‹æœºç«¯å¯¼èˆª
        function initializeMobileNavigation() {
            const mobileNavToggle = document.getElementById('mobile-nav-toggle');
            const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
            const mobileNavClose = document.getElementById('mobile-nav-close');
            const mobileNavBack = document.getElementById('mobile-nav-back');
            const mobileNavSections = document.getElementById('mobile-nav-sections');

            if (!mobileNavToggle || !mobileNavOverlay || !mobileNavClose || !mobileNavBack || !mobileNavSections) {
                return;
            }

            mobileNavToggle.setAttribute('aria-expanded', 'false');
            mobileNavOverlay.setAttribute('aria-hidden', 'true');

            let lastFocusedElement = null;

            function getFocusableElements(container) {
                const selectors = [
                    'a[href]',
                    'button:not([disabled])',
                    'input:not([disabled])',
                    'select:not([disabled])',
                    'textarea:not([disabled])',
                    '[tabindex]:not([tabindex="-1"])'
                ];
                return Array.from(container.querySelectorAll(selectors.join(','))).filter(el => {
                    return !!(el.offsetWidth || el.offsetHeight || el.getClientRects().length);
                });
            }

            function trapFocus(event) {
                if (!mobileNavOverlay.classList.contains('active')) return;
                if (event.key !== 'Tab') return;

                const focusable = getFocusableElements(mobileNavOverlay);
                if (focusable.length === 0) return;

                const first = focusable[0];
                const last = focusable[focusable.length - 1];
                const active = document.activeElement;

                if (event.shiftKey) {
                    if (active === first || !mobileNavOverlay.contains(active)) {
                        event.preventDefault();
                        last.focus();
                    }
                } else {
                    if (active === last) {
                        event.preventDefault();
                        first.focus();
                    }
                }
            }

            // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
            function isMobileDevice() {
                return window.innerWidth <= 768;
            }

            // è®¾ç½®åˆå§‹æ˜¾ç¤ºçŠ¶æ€
            updateMobileNavVisibility();

            // ç¡®ä¿åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
            if (isMobileDevice()) {
                console.log('æ£€æµ‹åˆ°ç§»åŠ¨è®¾å¤‡ï¼Œåˆå§‹åŒ–æ‰‹æœºç«¯å¯¼èˆª');
            }

            // ç”Ÿæˆæ‰‹æœºç«¯å¯¼èˆªå†…å®¹
            function generateMobileNavContent() {
                if (!VIEWER_DOC_CONFIG || ALL_DOCS.length === 0) {
                    console.warn('æ–‡æ¡£é…ç½®å°šæœªåŠ è½½ï¼Œç¨åé‡è¯•');
                    setTimeout(generateMobileNavContent, 100);
                    return;
                }

                mobileNavSections.innerHTML = '';

                // æ·»åŠ åˆ†å‰²çº¿
                const divider = document.createElement('div');
                divider.className = 'mobile-nav-divider';
                mobileNavSections.appendChild(divider);

                // ç”Ÿæˆåˆ†ç±»å¯¼èˆª
                Object.keys(MAIN_CATEGORIES).forEach(categoryKey => {
                    const category = MAIN_CATEGORIES[categoryKey];

                    // æ£€æŸ¥è¯¥åˆ†ç±»æ˜¯å¦æœ‰æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡
                    if (!categoryHasDocuments(categoryKey)) {
                        return; // è·³è¿‡ç©ºåˆ†ç±»
                    }

                    // åˆ›å»ºåˆ†ç±»å®¹å™¨
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'mobile-category';

                    // åˆ›å»ºåˆ†ç±»æ ‡é¢˜ï¼ˆå¯ç‚¹å‡»å±•å¼€/æ”¶èµ·ï¼‰
                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'mobile-category-title';
                    categoryTitle.textContent = category.title;

                    // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
                    const categoryToggleBtn = document.createElement('button');
                    categoryToggleBtn.className = 'mobile-category-toggle';
                    categoryToggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·åˆ†ç±»');
                    categoryToggleBtn.innerHTML = 'â–¼';
                    categoryTitle.appendChild(categoryToggleBtn);

                    // ä¸ºåˆ†ç±»æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    categoryTitle.addEventListener('click', function (e) {
                        // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œè®©æŒ‰é’®å¤„ç†
                        if (e.target === categoryToggleBtn) return;
                        toggleMobileCategory(categoryKey, categoryDiv, categoryToggleBtn);
                    });

                    // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    categoryToggleBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        console.log('[viewer-mobile-toggle-click]', {
                            type: 'category',
                            category: categoryKey
                        });
                        toggleMobileCategory(categoryKey, categoryDiv, categoryToggleBtn);
                    });

                    categoryDiv.appendChild(categoryTitle);

                    // è·å–è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰ä¸»é¢˜
                    const categoryTopics = VIEWER_DOC_CONFIG.categories[categoryKey]?.topics || {};
                    const topicKeys = Object.keys(categoryTopics);
                    const topicCount = topicKeys.filter(key => {
                        const topic = categoryTopics[key];
                        return topic && topic.files && topic.files.length > 0;
                    }).length;

                    if (topicCount > 0) {
                        const shouldShowTopicToggle = shouldRenderMobileTopicToggle(categoryKey, topicCount);
                        topicKeys.forEach(topicKey => {
                            const topic = categoryTopics[topicKey];

                            // æ£€æŸ¥ä¸»é¢˜æ˜¯å¦æœ‰æ–‡æ¡£ï¼Œå¦‚æœæ²¡æœ‰åˆ™è·³è¿‡
                            if (!topic.files || topic.files.length === 0) {
                                return; // è·³è¿‡ç©ºä¸»é¢˜
                            }

                            // åˆ›å»ºä¸»é¢˜å®¹å™¨
                            const topicDiv = document.createElement('div');
                            topicDiv.className = 'mobile-topic';

                            // åˆ›å»ºä¸»é¢˜æ ‡é¢˜ï¼ˆå¯ç‚¹å‡»å±•å¼€/æ”¶èµ·ï¼‰
                            const topicTitle = document.createElement('div');
                            topicTitle.className = 'mobile-topic-title';
                            topicTitle.textContent = topic.title;

                            // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
                            let topicToggleBtn = null;
                            if (shouldShowTopicToggle) {
                                topicToggleBtn = document.createElement('button');
                                topicToggleBtn.className = 'mobile-topic-toggle';
                                topicToggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·ä¸»é¢˜');
                                topicToggleBtn.innerHTML = 'â–¼';
                                topicTitle.appendChild(topicToggleBtn);
                            }

                            // ä¸ºä¸»é¢˜æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
                            if (shouldShowTopicToggle) {
                                topicTitle.addEventListener('click', function (e) {
                                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œè®©æŒ‰é’®å¤„ç†
                                    if (topicToggleBtn && e.target === topicToggleBtn) return;
                                    toggleMobileTopic(categoryKey, topicKey, topicDiv, topicToggleBtn);
                                });
                            }

                            // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                            if (topicToggleBtn) {
                                topicToggleBtn.addEventListener('click', function (e) {
                                    e.stopPropagation();
                                    console.log('[viewer-mobile-toggle-click]', {
                                        type: 'topic',
                                        category: categoryKey,
                                        topic: topicKey
                                    });
                                    toggleMobileTopic(categoryKey, topicKey, topicDiv, topicToggleBtn);
                                });
                            }

                            topicDiv.appendChild(topicTitle);

                            // åˆ›å»ºæ–‡æ¡£åˆ—è¡¨
                            const fileList = document.createElement('ul');
                            fileList.className = 'mobile-file-list';

	                            topic.files.forEach(file => {
                                const fileItem = document.createElement('li');
                                fileItem.className = 'mobile-file-item';

	                                const fileLink = document.createElement('a');
	                                fileLink.href = `?file=${encodeURIComponent(file.path || file.filename)}`;
	                                fileLink.className = 'mobile-file-link';
	                                fileLink.textContent = file.title;
	                                fileLink.title = file.description || file.title;

                                // æ£€æŸ¥æ˜¯å¦ä¸ºå½“å‰æ–‡æ¡£
                                const currentUrl = new URL(window.location);
	                                const currentFile = currentUrl.searchParams.get('file') || '';
	                                if ((file.path || file.filename) === currentFile || file.filename === currentFile || file.path === currentFile) {
	                                    fileLink.classList.add('active');
	                                }

                                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åå…³é—­å¯¼èˆª
                                fileLink.addEventListener('click', function () {
                                    closeMobileNav();
                                });

                                fileItem.appendChild(fileLink);
                                fileList.appendChild(fileItem);
                            });

                            topicDiv.appendChild(fileList);
                            categoryDiv.appendChild(topicDiv);

                            // æ¢å¤ä¸»é¢˜çš„å±•å¼€/æ”¶èµ·çŠ¶æ€
                            if (shouldShowTopicToggle) {
                                const isTopicCollapsed = getMobileCollapsedState('topic', `${categoryKey}-${topicKey}`);
                                if (isTopicCollapsed) {
                                    topicDiv.classList.add('collapsed');
                                    if (topicToggleBtn) {
                                        topicToggleBtn.classList.add('collapsed');
                                    }
                                    // topicToggleBtn.innerHTML = 'â–¶';
                                }
                            }
                        });
                    }

                    mobileNavSections.appendChild(categoryDiv);

                    // æ¢å¤åˆ†ç±»çš„å±•å¼€/æ”¶èµ·çŠ¶æ€
                    const isCategoryCollapsed = getMobileCollapsedState('category', categoryKey);
                    if (isCategoryCollapsed) {
                        categoryDiv.classList.add('collapsed');
                        const categoryToggleBtn = categoryDiv.querySelector('.mobile-category-toggle');
                        if (categoryToggleBtn) {
                            categoryToggleBtn.classList.add('collapsed');
                            // categoryToggleBtn.innerHTML = 'â–¶';
                        }
                    }
                });

                // æ·»åŠ åˆ†å‰²çº¿
                const allDocsDivider = document.createElement('div');
                allDocsDivider.className = 'mobile-nav-divider';
                mobileNavSections.appendChild(allDocsDivider);

                // æ·»åŠ "æ‰€æœ‰æ–‡æ¡£"éƒ¨åˆ†
                const allDocsDiv = document.createElement('div');
                allDocsDiv.className = 'mobile-category all-docs';

                const allDocsTitle = document.createElement('div');
                allDocsTitle.className = 'mobile-category-title';
                allDocsTitle.textContent = 'æ‰€æœ‰æ–‡æ¡£';

                // æ·»åŠ å±•å¼€/æ”¶èµ·æŒ‰é’®
                const allDocsToggleBtn = document.createElement('button');
                allDocsToggleBtn.className = 'mobile-category-toggle';
                allDocsToggleBtn.setAttribute('aria-label', 'å±•å¼€/æ”¶èµ·æ‰€æœ‰æ–‡æ¡£');
                allDocsToggleBtn.innerHTML = 'â–¼';
                allDocsTitle.appendChild(allDocsToggleBtn);

                // ä¸º"æ‰€æœ‰æ–‡æ¡£"æ ‡é¢˜æ·»åŠ ç‚¹å‡»äº‹ä»¶
                allDocsTitle.addEventListener('click', function (e) {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œè®©æŒ‰é’®å¤„ç†
                    if (e.target === allDocsToggleBtn) return;
                    toggleMobileAllDocs(allDocsDiv, allDocsToggleBtn);
                });

                // ä¸ºæŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
                allDocsToggleBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    console.log('[viewer-mobile-toggle-click]', {
                        type: 'all-docs'
                    });
                    toggleMobileAllDocs(allDocsDiv, allDocsToggleBtn);
                });

                allDocsDiv.appendChild(allDocsTitle);

                const allDocsList = document.createElement('ul');
                allDocsList.className = 'mobile-file-list';

                // ç¡®ä¿ALL_DOCSå­˜åœ¨ä¸”æ˜¯æ•°ç»„
                const allDocs = ALL_DOCS || [];
                if (allDocs.length === 0) {
                    // å¦‚æœæ²¡æœ‰æ–‡æ¡£ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                    const noDocsItem = document.createElement('li');
                    noDocsItem.className = 'mobile-file-item';
                    noDocsItem.textContent = 'æœªæ‰¾åˆ°ä»»ä½•æ–‡æ¡£';
                    allDocsList.appendChild(noDocsItem);
                } else {
                    // æŒ‰åˆ†ç±»å’Œæ’åºç»„ç»‡æ–‡æ¡£
                    const sortedDocs = [...allDocs].sort((a, b) => {
                        // å…ˆæŒ‰åˆ†ç±»æ’åº
                        const categoryOrderA = MAIN_CATEGORIES[a.category]?.order || 999;
                        const categoryOrderB = MAIN_CATEGORIES[b.category]?.order || 999;
                        if (categoryOrderA !== categoryOrderB) {
                            return categoryOrderA - categoryOrderB;
                        }
                        // åŒä¸€åˆ†ç±»å†…æŒ‰æ’åºå€¼æ’åº
                        return (a.order || 999) - (b.order || 999);
                    });

                    sortedDocs.forEach(doc => {
                        const docItem = document.createElement('li');
                        docItem.className = 'mobile-file-item';

	                        const docLink = document.createElement('a');
	                        docLink.href = `?file=${encodeURIComponent(doc.path || doc.filename)}`;
	                        docLink.className = 'mobile-file-link';
	                        docLink.textContent = doc.title;

                        // æ·»åŠ æ›´è¯¦ç»†çš„æ ‡é¢˜ä¿¡æ¯
                        const categoryTitle = MAIN_CATEGORIES[doc.category]?.title || doc.category;
                        const topicTitle = VIEWER_DOC_CONFIG.topics && VIEWER_DOC_CONFIG.topics[doc.topic] ? VIEWER_DOC_CONFIG.topics[doc.topic].title : doc.topic;
                        const pathInfo = doc.path && doc.path !== doc.filename ? ` [è·¯å¾„: ${doc.path}]` : '';
                        docLink.title = `${doc.author || 'æœªçŸ¥ä½œè€…'} - ${doc.description || doc.title} [${categoryTitle} - ${topicTitle}]${pathInfo}`;

                        // æ£€æŸ¥æ˜¯å¦ä¸ºå½“å‰æ–‡æ¡£
                        const currentUrl = new URL(window.location);
	                        const currentFile = currentUrl.searchParams.get('file') || '';
	                        if ((doc.path || doc.filename) === currentFile || doc.filename === currentFile || doc.path === currentFile) {
	                            docLink.classList.add('active');
	                        }

                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»åå…³é—­å¯¼èˆª
                        docLink.addEventListener('click', function () {
                            closeMobileNav();
                        });

                        docItem.appendChild(docLink);
                        allDocsList.appendChild(docItem);
                    });
                }

                allDocsDiv.appendChild(allDocsList);
                mobileNavSections.appendChild(allDocsDiv);
            }

            // æ‰“å¼€æ‰‹æœºç«¯å¯¼èˆª
	            let previousBodyOverflow = '';
	            let previousHtmlOverflow = '';

	            function openMobileNav() {
	                lastFocusedElement = document.activeElement;
	                previousBodyOverflow = document.body.style.overflow || '';
	                previousHtmlOverflow = document.documentElement.style.overflow || '';
	                mobileNavOverlay.classList.add('active');
	                // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨ï¼ˆç§»åŠ¨ç«¯éœ€è¦åŒæ—¶é”å®š html/body æ‰æ›´ç¨³å®šï¼‰
	                document.body.style.overflow = 'hidden';
	                document.documentElement.style.overflow = 'hidden';
	                generateMobileNavContent();
	                mobileNavToggle.setAttribute('aria-expanded', 'true');
	                mobileNavOverlay.setAttribute('aria-hidden', 'false');
	                mobileNavClose.focus();
	                document.addEventListener('keydown', trapFocus, true);
	            }

	            // å…³é—­æ‰‹æœºç«¯å¯¼èˆª
	            function closeMobileNav() {
	                mobileNavOverlay.classList.remove('active');
	                document.body.style.overflow = previousBodyOverflow; // æ¢å¤æ»šåŠ¨
	                document.documentElement.style.overflow = previousHtmlOverflow;
	                mobileNavToggle.setAttribute('aria-expanded', 'false');
	                mobileNavOverlay.setAttribute('aria-hidden', 'true');
	                document.removeEventListener('keydown', trapFocus, true);
	                if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
	                    lastFocusedElement.focus();
                } else {
                    mobileNavToggle.focus();
                }
            }

            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            mobileNavToggle.addEventListener('click', openMobileNav);
            mobileNavClose.addEventListener('click', closeMobileNav);
            mobileNavBack.addEventListener('click', closeMobileNav);

            document.addEventListener('keydown', function (event) {
                if (event.key === 'Escape' && mobileNavOverlay.classList.contains('active')) {
                    closeMobileNav();
                }
            });

            // ç‚¹å‡»è¦†ç›–å±‚èƒŒæ™¯å…³é—­å¯¼èˆªï¼ˆé™¤äº†è¿”å›åŒºåŸŸï¼‰
            mobileNavOverlay.addEventListener('click', function (e) {
                if (e.target === mobileNavOverlay) {
                    closeMobileNav();
                }
            });

            // æ›´æ–°æ‰‹æœºç«¯å¯¼èˆªå¯è§æ€§
            function updateMobileNavVisibility() {
                if (isMobileDevice()) {
                    mobileNavToggle.style.display = 'flex';
                } else {
                    mobileNavToggle.style.display = 'none';
                    closeMobileNav(); // åœ¨éç§»åŠ¨è®¾å¤‡ä¸Šå…³é—­å¯¼èˆª
                }
            }

            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', updateMobileNavVisibility);
        }

        function shouldRenderMobileTopicToggle(categoryKey, topicCount) {
            return topicCount > 1;
        }

        // ç§»åŠ¨ç«¯åˆ†ç±»å±•å¼€/æ”¶èµ·åŠŸèƒ½
        function toggleMobileCategory(categoryKey, categoryDiv, toggleBtn) {
            const isCollapsed = categoryDiv.classList.contains('collapsed');

            if (isCollapsed) {
                // å±•å¼€
                categoryDiv.classList.remove('collapsed');
                toggleBtn.classList.remove('collapsed');
                toggleBtn.innerHTML = 'â–¼';
                setMobileCollapsedState('category', categoryKey, false);
            } else {
                // æ”¶èµ·
                categoryDiv.classList.add('collapsed');
                toggleBtn.classList.add('collapsed');
                // toggleBtn.innerHTML = 'â–¶';
                setMobileCollapsedState('category', categoryKey, true);
            }
        }

        // ç§»åŠ¨ç«¯ä¸»é¢˜å±•å¼€/æ”¶èµ·åŠŸèƒ½
        function toggleMobileTopic(categoryKey, topicKey, topicDiv, toggleBtn) {
            const isCollapsed = topicDiv.classList.contains('collapsed');

            if (isCollapsed) {
                // å±•å¼€
                topicDiv.classList.remove('collapsed');
                if (toggleBtn) {
                    toggleBtn.classList.remove('collapsed');
                    toggleBtn.innerHTML = 'â–¼';
                }
                setMobileCollapsedState('topic', `${categoryKey}-${topicKey}`, false);
            } else {
                // æ”¶èµ·
                topicDiv.classList.add('collapsed');
                if (toggleBtn) {
                    toggleBtn.classList.add('collapsed');
                }
                // toggleBtn.innerHTML = 'â–¶';
                setMobileCollapsedState('topic', `${categoryKey}-${topicKey}`, true);
            }
        }

        // ç§»åŠ¨ç«¯"æ‰€æœ‰æ–‡æ¡£"å±•å¼€/æ”¶èµ·åŠŸèƒ½
        function toggleMobileAllDocs(allDocsDiv, toggleBtn) {
            const isCollapsed = allDocsDiv.classList.contains('collapsed');

            if (isCollapsed) {
                // å±•å¼€
                allDocsDiv.classList.remove('collapsed');
                toggleBtn.classList.remove('collapsed');
                toggleBtn.innerHTML = 'â–¼';
                setMobileCollapsedState('all-docs', 'all-docs', false);
            } else {
                // æ”¶èµ·
                allDocsDiv.classList.add('collapsed');
                toggleBtn.classList.add('collapsed');
                // toggleBtn.innerHTML = 'â–¶';
                setMobileCollapsedState('all-docs', 'all-docs', true);
            }
        }

        // ä»localStorageè·å–ç§»åŠ¨ç«¯å±•å¼€/æ”¶èµ·çŠ¶æ€
        function getMobileCollapsedState(type, key) {
            try {
                const storageKey = `mobileNav${type.charAt(0).toUpperCase() + type.slice(1)}${key.charAt(0).toUpperCase() + key.slice(1)}`;
                const state = localStorage.getItem(storageKey);
                return state === 'true';
            } catch (error) {
                console.warn('æ— æ³•ä»localStorageè·å–ç§»åŠ¨ç«¯å±•å¼€/æ”¶èµ·çŠ¶æ€:', error);
                return false;
            }
        }

        // ä¿å­˜ç§»åŠ¨ç«¯å±•å¼€/æ”¶èµ·çŠ¶æ€åˆ°localStorage
        function setMobileCollapsedState(type, key, isCollapsed) {
            try {
                const storageKey = `mobileNav${type.charAt(0).toUpperCase() + type.slice(1)}${key.charAt(0).toUpperCase() + key.slice(1)}`;
                localStorage.setItem(storageKey, isCollapsed.toString());
            } catch (error) {
                console.warn('æ— æ³•ä¿å­˜ç§»åŠ¨ç«¯å±•å¼€/æ”¶èµ·çŠ¶æ€åˆ°localStorage:', error);
            }
        }

        // åˆå§‹åŒ–ä¾§è¾¹æ æ»šåŠ¨åŠŸèƒ½
        function initializeSidebarScrolling() {
            const sidebar = document.querySelector('.sidebar');
            if (!sidebar) return;

            let isScrolling = false;
            let scrollTimeout;

            // æ»šåŠ¨äº‹ä»¶å¤„ç†
            sidebar.addEventListener('scroll', function () {
                if (!isScrolling) {
                    sidebar.classList.add('scrolling');
                    isScrolling = true;
                }

                // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
                clearTimeout(scrollTimeout);

                // è®¾ç½®æ–°çš„è¶…æ—¶ï¼Œåœ¨åœæ­¢æ»šåŠ¨åç§»é™¤ç±»
                scrollTimeout = setTimeout(function () {
                    sidebar.classList.remove('scrolling');
                    isScrolling = false;
                }, 150);
            });

            // ä¸ºä¾§è¾¹æ å†…çš„é“¾æ¥æ·»åŠ å¹³æ»‘æ»šåŠ¨æ•ˆæœ
            const sidebarLinks = sidebar.querySelectorAll('a[href^="#"]');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        // è®¡ç®—æ»šåŠ¨ä½ç½®ï¼Œè€ƒè™‘å›ºå®šå¤´éƒ¨é«˜åº¦
                        const headerHeight = document.querySelector('.site-header').offsetHeight;
                        const targetPosition = targetElement.offsetTop - headerHeight - 20;

                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // æ·»åŠ é”®ç›˜å¯¼èˆªæ”¯æŒ
            sidebar.addEventListener('keydown', function (e) {
                // ä¸Šä¸‹ç®­å¤´é”®æ»šåŠ¨
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    sidebar.scrollTop -= 30;
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    sidebar.scrollTop += 30;
                }
                // Homeé”®æ»šåŠ¨åˆ°é¡¶éƒ¨
                else if (e.key === 'Home') {
                    e.preventDefault();
                    sidebar.scrollTop = 0;
                }
                // Endé”®æ»šåŠ¨åˆ°åº•éƒ¨
                else if (e.key === 'End') {
                    e.preventDefault();
                    sidebar.scrollTop = sidebar.scrollHeight;
                }
            });

            // ç¡®ä¿ä¾§è¾¹æ å¯ä»¥è·å¾—ç„¦ç‚¹ä»¥æ”¯æŒé”®ç›˜å¯¼èˆª
            sidebar.setAttribute('tabindex', '0');

            // æ·»åŠ æ»šåŠ¨æŒ‡ç¤ºå™¨ï¼ˆå¯é€‰ï¼‰
            addScrollIndicator(sidebar);
        }

        // æ·»åŠ æ»šåŠ¨æŒ‡ç¤ºå™¨
        function addScrollIndicator(sidebar) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ»šåŠ¨æŒ‡ç¤ºå™¨
            function checkScrollNeeded() {
                const needsScroll = sidebar.scrollHeight > sidebar.clientHeight;

                // å¦‚æœéœ€è¦æ»šåŠ¨ä¸”æ²¡æœ‰æŒ‡ç¤ºå™¨ï¼Œåˆ™æ·»åŠ ä¸€ä¸ª
                if (needsScroll && !sidebar.querySelector('.scroll-indicator')) {
                    const indicator = document.createElement('div');
                    indicator.className = 'scroll-indicator';
                    indicator.innerHTML = 'â†“';
                    indicator.style.cssText = `
                        position: absolute;
                        bottom: 10px;
                        right: 10px;
                        background: rgba(0, 123, 255, 0.7);
                        color: white;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 12px;
                        opacity: 0.7;
                        pointer-events: none;
                        transition: opacity 0.3s ease;
                        z-index: 10;
                    `;

                    // å°†æŒ‡ç¤ºå™¨æ·»åŠ åˆ°ä¾§è¾¹æ å†…å®¹åŒºåŸŸ
                    const sidebarContent = sidebar.querySelector('.sidebar-content');
                    if (sidebarContent) {
                        sidebarContent.style.position = 'relative';
                        sidebarContent.appendChild(indicator);

                        // ç›‘å¬æ»šåŠ¨ï¼Œå½“ç”¨æˆ·å¼€å§‹æ»šåŠ¨æ—¶éšè—æŒ‡ç¤ºå™¨
                        let hideTimeout;
                        sidebar.addEventListener('scroll', function () {
                            indicator.style.opacity = '0';

                            // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
                            clearTimeout(hideTimeout);

                            // å¦‚æœæ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œé‡æ–°æ˜¾ç¤ºæŒ‡ç¤ºå™¨
                            if (sidebar.scrollTop <= 10) {
                                hideTimeout = setTimeout(() => {
                                    indicator.style.opacity = '0.7';
                                }, 1000);
                            }
                        });
                    }
                }
                // å¦‚æœä¸éœ€è¦æ»šåŠ¨ä¸”æœ‰æŒ‡ç¤ºå™¨ï¼Œåˆ™ç§»é™¤å®ƒ
                else if (!needsScroll) {
                    const indicator = sidebar.querySelector('.scroll-indicator');
                    if (indicator) {
                        indicator.remove();
                    }
                }
            }

            // åˆå§‹æ£€æŸ¥
            checkScrollNeeded();

            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°æ£€æŸ¥
            window.addEventListener('resize', checkScrollNeeded);

            // å†…å®¹å˜åŒ–æ—¶é‡æ–°æ£€æŸ¥ï¼ˆä½¿ç”¨MutationObserverï¼‰
            const observer = new MutationObserver(checkScrollNeeded);
            observer.observe(sidebar, { childList: true, subtree: true });
        }
    </script>
</body>

</html>
